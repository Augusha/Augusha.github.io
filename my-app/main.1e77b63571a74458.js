(self.webpackChunkmy_app=self.webpackChunkmy_app||[]).push([[179],{930:(nm,lu,cu)=>{"use strict";function ri(t){return"function"==typeof t}function Bh(t){const e=t(r=>{Error.call(r),r.stack=(new Error).stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}const im=Bh(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((r,l)=>`${l+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e});function p(t,n){if(t){const e=t.indexOf(n);0<=e&&t.splice(e,1)}}class je{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;const{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(const h of e)h.remove(this);else e.remove(this);const{initialTeardown:r}=this;if(ri(r))try{r()}catch(h){n=h instanceof im?h.errors:[h]}const{_finalizers:l}=this;if(l){this._finalizers=null;for(const h of l)try{Kt(h)}catch(_){n=n??[],_ instanceof im?n=[...n,..._.errors]:n.push(_)}}if(n)throw new im(n)}}add(n){var e;if(n&&n!==this)if(this.closed)Kt(n);else{if(n instanceof je){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=null!==(e=this._finalizers)&&void 0!==e?e:[]).push(n)}}_hasParent(n){const{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){const{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){const{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&p(e,n)}remove(n){const{_finalizers:e}=this;e&&p(e,n),n instanceof je&&n._removeParent(this)}}je.EMPTY=(()=>{const t=new je;return t.closed=!0,t})();const Xo=je.EMPTY;function so(t){return t instanceof je||t&&"closed"in t&&ri(t.remove)&&ri(t.add)&&ri(t.unsubscribe)}function Kt(t){ri(t)?t():t.unsubscribe()}const Zt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Li={setTimeout(t,n,...e){const{delegate:r}=Li;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){const{delegate:n}=Li;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function kr(t){Li.setTimeout(()=>{const{onUnhandledError:n}=Zt;if(!n)throw t;n(t)})}function Eo(){}const ws=Xr("C",void 0,void 0);function Xr(t,n,e){return{kind:t,value:n,error:e}}let ao=null;function Hr(t){if(Zt.useDeprecatedSynchronousErrorHandling){const n=!ao;if(n&&(ao={errorThrown:!1,error:null}),t(),n){const{errorThrown:e,error:r}=ao;if(ao=null,e)throw r}}else t()}class Cs extends je{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,so(n)&&n.add(this)):this.destination=uu}static create(n,e,r){return new Da(n,e,r)}next(n){this.isStopped?rc(function dl(t){return Xr("N",t,void 0)}(n),this):this._next(n)}error(n){this.isStopped?rc(function ic(t){return Xr("E",void 0,t)}(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?rc(ws,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Io=Function.prototype.bind;function at(t,n){return Io.call(t,n)}class Nh{constructor(n){this.partialObserver=n}next(n){const{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){on(r)}}error(n){const{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){on(r)}else on(n)}complete(){const{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){on(e)}}}class Da extends Cs{constructor(n,e,r){let l;if(super(),ri(n)||!n)l={next:n??void 0,error:e??void 0,complete:r??void 0};else{let h;this&&Zt.useDeprecatedNextContext?(h=Object.create(n),h.unsubscribe=()=>this.unsubscribe(),l={next:n.next&&at(n.next,h),error:n.error&&at(n.error,h),complete:n.complete&&at(n.complete,h)}):l=n}this.destination=new Nh(l)}}function on(t){Zt.useDeprecatedSynchronousErrorHandling?function Ta(t){Zt.useDeprecatedSynchronousErrorHandling&&ao&&(ao.errorThrown=!0,ao.error=t)}(t):kr(t)}function rc(t,n){const{onStoppedNotification:e}=Zt;e&&Li.setTimeout(()=>e(t,n))}const uu={closed:!0,next:Eo,error:function Hi(t){throw t},complete:Eo},Sa="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ko(t){return t}function ka(t){return 0===t.length?Ko:1===t.length?t[0]:function(e){return t.reduce((r,l)=>l(r),e)}}let pn=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){const r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,l){const h=function Ci(t){return t&&t instanceof Cs||function Ys(t){return t&&ri(t.next)&&ri(t.error)&&ri(t.complete)}(t)&&so(t)}(e)?e:new Da(e,r,l);return Hr(()=>{const{operator:_,source:C}=this;h.add(_?_.call(h,C):C?this._subscribe(h):this._trySubscribe(h))}),h}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return new(r=Bi(r))((l,h)=>{const _=new Da({next:C=>{try{e(C)}catch(M){h(M),_.unsubscribe()}},error:h,complete:l});this.subscribe(_)})}_subscribe(e){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(e)}[Sa](){return this}pipe(...e){return ka(e)(this)}toPromise(e){return new(e=Bi(e))((r,l)=>{let h;this.subscribe(_=>h=_,_=>l(_),()=>r(h))})}}return t.create=n=>new t(n),t})();function Bi(t){var n;return null!==(n=t??Zt.Promise)&&void 0!==n?n:Promise}const Js=Bh(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let nr=(()=>{class t extends pn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){const r=new Es(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new Js}next(e){Hr(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(e)}})}error(e){Hr(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;const{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Hr(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){const{hasError:r,isStopped:l,observers:h}=this;return r||l?Xo:(this.currentObservers=null,h.push(e),new je(()=>{this.currentObservers=null,p(h,e)}))}_checkFinalizedStatuses(e){const{hasError:r,thrownError:l,isStopped:h}=this;r?e.error(l):h&&e.complete()}asObservable(){const e=new pn;return e.source=this,e}}return t.create=(n,e)=>new Es(n,e),t})();class Es extends nr{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.next)||void 0===r||r.call(e,n)}error(n){var e,r;null===(r=null===(e=this.destination)||void 0===e?void 0:e.error)||void 0===r||r.call(e,n)}complete(){var n,e;null===(e=null===(n=this.destination)||void 0===n?void 0:n.complete)||void 0===e||e.call(n)}_subscribe(n){var e,r;return null!==(r=null===(e=this.source)||void 0===e?void 0:e.subscribe(n))&&void 0!==r?r:Xo}}function Yo(t){return ri(t?.lift)}function hi(t){return n=>{if(Yo(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jn(t,n,e,r,l){return new pl(t,n,e,r,l)}class pl extends Cs{constructor(n,e,r,l,h,_){super(n),this.onFinalize=h,this.shouldUnsubscribe=_,this._next=e?function(C){try{e(C)}catch(M){n.error(M)}}:super._next,this._error=l?function(C){try{l(C)}catch(M){n.error(M)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(C){n.error(C)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:e}=this;super.unsubscribe(),!e&&(null===(n=this.onFinalize)||void 0===n||n.call(this))}}}function ct(t,n){return hi((e,r)=>{let l=0;e.subscribe(Jn(r,h=>{r.next(t.call(n,h,l++))}))})}function To(t){return this instanceof To?(this.v=t,this):new To(t)}function Oa(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t=function Kr(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(h){e[h]=t[h]&&function(_){return new Promise(function(C,M){!function l(h,_,C,M){Promise.resolve(M).then(function(P){h({value:P,done:C})},_)}(C,M,(_=t[h](_)).done,_.value)})}}}const he=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function ge(t){return ri(t?.then)}function Ce(t){return ri(t[Sa])}function be(t){return Symbol.asyncIterator&&ri(t?.[Symbol.asyncIterator])}function me(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const it=function Se(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function st(t){return ri(t?.[it])}function Ye(t){return function Pa(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var l,r=e.apply(t,n||[]),h=[];return l={},_("next"),_("throw"),_("return"),l[Symbol.asyncIterator]=function(){return this},l;function _(ie){r[ie]&&(l[ie]=function(ue){return new Promise(function(ve,Le){h.push([ie,ue,ve,Le])>1||C(ie,ue)})})}function C(ie,ue){try{!function M(ie){ie.value instanceof To?Promise.resolve(ie.value.v).then(P,B):G(h[0][2],ie)}(r[ie](ue))}catch(ve){G(h[0][3],ve)}}function P(ie){C("next",ie)}function B(ie){C("throw",ie)}function G(ie,ue){ie(ue),h.shift(),h.length&&C(h[0][0],h[0][1])}}(this,arguments,function*(){const e=t.getReader();try{for(;;){const{value:r,done:l}=yield To(e.read());if(l)return yield To(void 0);yield yield To(r)}}finally{e.releaseLock()}})}function Ut(t){return ri(t?.getReader)}function Rt(t){if(t instanceof pn)return t;if(null!=t){if(Ce(t))return function Ht(t){return new pn(n=>{const e=t[Sa]();if(ri(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(he(t))return function nn(t){return new pn(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}(t);if(ge(t))return function fn(t){return new pn(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,kr)})}(t);if(be(t))return yi(t);if(st(t))return function oi(t){return new pn(n=>{for(const e of t)if(n.next(e),n.closed)return;n.complete()})}(t);if(Ut(t))return function fr(t){return yi(Ye(t))}(t)}throw me(t)}function yi(t){return new pn(n=>{(function Pi(t,n){var e,r,l,h;return function na(t,n,e,r){return new(e||(e=Promise))(function(h,_){function C(B){try{P(r.next(B))}catch(G){_(G)}}function M(B){try{P(r.throw(B))}catch(G){_(G)}}function P(B){B.done?h(B.value):function l(h){return h instanceof e?h:new e(function(_){_(h)})}(B.value).then(C,M)}P((r=r.apply(t,n||[])).next())})}(this,void 0,void 0,function*(){try{for(e=Oa(t);!(r=yield e.next()).done;)if(n.next(r.value),n.closed)return}catch(_){l={error:_}}finally{try{r&&!r.done&&(h=e.return)&&(yield h.call(e))}finally{if(l)throw l.error}}n.complete()})})(t,n).catch(e=>n.error(e))})}function $i(t,n,e,r=0,l=!1){const h=n.schedule(function(){e(),l?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(h),!l)return h}function zn(t,n,e=1/0){return ri(n)?zn((r,l)=>ct((h,_)=>n(r,h,l,_))(Rt(t(r,l))),e):("number"==typeof n&&(e=n),hi((r,l)=>function qi(t,n,e,r,l,h,_,C){const M=[];let P=0,B=0,G=!1;const ie=()=>{G&&!M.length&&!P&&n.complete()},ue=Le=>P<r?ve(Le):M.push(Le),ve=Le=>{h&&n.next(Le),P++;let qe=!1;Rt(e(Le,B++)).subscribe(Jn(n,tt=>{l?.(tt),h?ue(tt):n.next(tt)},()=>{qe=!0},void 0,()=>{if(qe)try{for(P--;M.length&&P<r;){const tt=M.shift();_?$i(n,_,()=>ve(tt)):ve(tt)}ie()}catch(tt){n.error(tt)}}))};return t.subscribe(Jn(n,ue,()=>{G=!0,ie()})),()=>{C?.()}}(r,l,t,e)))}function Do(t=1/0){return zn(Ko,t)}const Jo=new pn(t=>t.complete());function Fa(t){return t[t.length-1]}function fu(t){return ri(Fa(t))?t.pop():void 0}function ra(t){return function Uh(t){return t&&ri(t.schedule)}(Fa(t))?t.pop():void 0}function ts(t,n=0){return hi((e,r)=>{e.subscribe(Jn(r,l=>$i(r,t,()=>r.next(l),n),()=>$i(r,t,()=>r.complete(),n),l=>$i(r,t,()=>r.error(l),n)))})}function mu(t,n=0){return hi((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function Oe(t,n){if(!t)throw new Error("Iterable cannot be null");return new pn(e=>{$i(e,n,()=>{const r=t[Symbol.asyncIterator]();$i(e,n,()=>{r.next().then(l=>{l.done?e.complete():e.next(l.value)})},0,!0)})})}function An(t,n){return n?function Ei(t,n){if(null!=t){if(Ce(t))return function Gh(t,n){return Rt(t).pipe(mu(n),ts(n))}(t,n);if(he(t))return function Is(t,n){return new pn(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}(t,n);if(ge(t))return function La(t,n){return Rt(t).pipe(mu(n),ts(n))}(t,n);if(be(t))return Oe(t,n);if(st(t))return function cc(t,n){return new pn(e=>{let r;return $i(e,n,()=>{r=t[it](),$i(e,n,()=>{let l,h;try{({value:l,done:h}=r.next())}catch(_){return void e.error(_)}h?e.complete():e.next(l)},0,!0)}),()=>ri(r?.return)&&r.return()})}(t,n);if(Ut(t))return function Ms(t,n){return Oe(Ye(t),n)}(t,n)}throw me(t)}(t,n):Rt(t)}function uc(t,n,...e){if(!0===n)return void t();if(!1===n)return;const r=new Da({next:()=>{r.unsubscribe(),t()}});return Rt(n(...e)).subscribe(r)}function Qn(t){for(let n in t)if(t[n]===Qn)return n;throw Error("Could not find renamed property on target object.")}function oa(t,n){for(const e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Ke(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(Ke).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const e=n.indexOf("\n");return-1===e?n:n.substring(0,e)}function sn(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const an=Qn({__forward_ref__:Qn});function yn(t){return t.__forward_ref__=yn,t.toString=function(){return Ke(this())},t}function kt(t){return Yt(t)?t():t}function Yt(t){return"function"==typeof t&&t.hasOwnProperty(an)&&t.__forward_ref__===yn}function Pr(t){return t&&!!t.\u0275providers}const ns="https://g.co/ng/security#xss";class rt extends Error{constructor(n,e){super(Wn(n,e)),this.code=n}}function Wn(t,n){return`NG0${Math.abs(t)}${n?": "+n.trim():""}`}function Jt(t){return"string"==typeof t?t:null==t?"":String(t)}function dc(t,n){throw new rt(-201,!1)}function mr(t,n){null==t&&function Bn(t,n,e,r){throw new Error(`ASSERTION ERROR: ${t}`+(null==r?"":` [Expected=> ${e} ${r} ${n} <=Actual]`))}(n,t,null,"!=")}function Mt(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function di(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ba(t){return Au(t,rs)||Au(t,Al)}function Au(t,n){return t.hasOwnProperty(n)?t[n]:null}function xu(t){return t&&(t.hasOwnProperty(ko)||t.hasOwnProperty(Ts))?t[ko]:null}const rs=Qn({\u0275prov:Qn}),ko=Qn({\u0275inj:Qn}),Al=Qn({ngInjectableDef:Qn}),Ts=Qn({ngInjectorDef:Qn});var Lt=(()=>((Lt=Lt||{})[Lt.Default=0]="Default",Lt[Lt.Host=1]="Host",Lt[Lt.Self=2]="Self",Lt[Lt.SkipSelf=4]="SkipSelf",Lt[Lt.Optional=8]="Optional",Lt))();let aa;function Jr(t){const n=aa;return aa=t,n}function gc(t,n,e){const r=Ba(t);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:e&Lt.Optional?null:void 0!==n?n:void dc(Ke(t))}const ei=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Na={},bu="__NG_DI_FLAG__",xl="ngTempTokenPath",cp="ngTokenPath",$h=/\n/gm,bl="\u0275",yc="__source";let os;function $r(t){const n=os;return os=t,n}function za(t,n=Lt.Default){if(void 0===os)throw new rt(-203,!1);return null===os?gc(t,void 0,n):os.get(t,n&Lt.Optional?null:void 0,n)}function mt(t,n=Lt.Default){return(function mc(){return aa}()||za)(kt(t),n)}function $t(t,n=Lt.Default){return mt(t,wl(n))}function wl(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function vc(t){const n=[];for(let e=0;e<t.length;e++){const r=kt(t[e]);if(Array.isArray(r)){if(0===r.length)throw new rt(900,!1);let l,h=Lt.Default;for(let _=0;_<r.length;_++){const C=r[_],M=wu(C);"number"==typeof M?-1===M?l=C.token:h|=M:l=C}n.push(mt(l,h))}else n.push(mt(r))}return n}function la(t,n){return t[bu]=n,t.prototype[bu]=n,t}function wu(t){return t[bu]}function eo(t){return{toString:t}.toString()}var Po=(()=>((Po=Po||{})[Po.OnPush=0]="OnPush",Po[Po.Default=1]="Default",Po))(),ho=(()=>{return(t=ho||(ho={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",ho;var t})();const ss={},bn=[],Cl=Qn({\u0275cmp:Qn}),Zh=Qn({\u0275dir:Qn}),Qh=Qn({\u0275pipe:Qn}),up=Qn({\u0275mod:Qn}),Ro=Qn({\u0275fac:Qn}),Va=Qn({__NG_ELEMENT_ID__:Qn});let Xh=0;function _r(t){return eo(()=>{const n=Eu(t),e={...n,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Po.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:null,data:t.data||{},encapsulation:t.encapsulation||ho.Emulated,id:"c"+Xh++,styles:t.styles||bn,_:null,schemas:t.schemas||null,tView:null};dp(e);const r=t.dependencies;return e.directiveDefs=Il(r,!1),e.pipeDefs=Il(r,!0),e})}function hp(t){return mn(t)||zi(t)}function am(t){return null!==t}function Ni(t){return eo(()=>({type:t.type,bootstrap:t.bootstrap||bn,declarations:t.declarations||bn,imports:t.imports||bn,exports:t.exports||bn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function Cu(t,n){if(null==t)return ss;const e={};for(const r in t)if(t.hasOwnProperty(r)){let l=t[r],h=l;Array.isArray(l)&&(h=l[1],l=l[0]),e[l]=r,n&&(n[l]=h)}return e}function Bt(t){return eo(()=>{const n=Eu(t);return dp(n),n})}function mn(t){return t[Cl]||null}function zi(t){return t[Zh]||null}function vr(t){return t[Qh]||null}function qr(t,n){const e=t[up]||null;if(!e&&!0===n)throw new Error(`Type ${Ke(t)} does not have '\u0275mod' property.`);return e}function Eu(t){const n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,exportAs:t.exportAs||null,standalone:!0===t.standalone,selectors:t.selectors||bn,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Cu(t.inputs,n),outputs:Cu(t.outputs)}}function dp(t){t.features?.forEach(n=>n(t))}function Il(t,n){if(!t)return null;const e=n?vr:hp;return()=>("function"==typeof t?t():t).map(r=>e(r)).filter(am)}const po=0,xt=1,un=2,ci=3,Oo=4,Ss=5,rr=6,as=7,Ai=8,ja=9,Ac=10,en=11,Yh=12,xc=13,pp=14,Ml=15,Ar=16,Tl=17,ks=18,Rr=19,Dl=20,Jh=21,On=22,Wr=1,Sl=2,bc=7,ls=8,Fo=9,Wi=10;function qt(t){return Array.isArray(t)&&"object"==typeof t[Wr]}function Or(t){return Array.isArray(t)&&!0===t[Wr]}function Iu(t){return 0!=(4&t.flags)}function ca(t){return t.componentOffset>-1}function Ps(t){return 1==(1&t.flags)}function fo(t){return!!t.template}function Mu(t){return 0!=(256&t[un])}function ha(t,n){return t.hasOwnProperty(Ro)?t[Ro]:null}class Ru{constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}}function ji(){return Ou}function Ou(t){return t.type.prototype.ngOnChanges&&(t.setInput=_p),cm}function cm(){const t=Fu(this),n=t?.current;if(n){const e=t.previous;if(e===ss)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function _p(t,n,e,r){const l=this.declaredInputs[e],h=Fu(t)||function sd(t,n){return t[Ua]=n}(t,{previous:ss,current:null}),_=h.current||(h.current={}),C=h.previous,M=C[l];_[l]=new Ru(M&&M.currentValue,n,C===ss),t[r]=n}ji.ngInherit=!0;const Ua="__ngSimpleChanges__";function Fu(t){return t[Ua]||null}const xr=function(t,n,e){};function Zi(t){for(;Array.isArray(t);)t=t[po];return t}function Ic(t,n){return Zi(n[t])}function Ri(t,n){return Zi(n[t.index])}function ld(t,n){return t.data[n]}function Fr(t,n){const e=n[t];return qt(e)?e:e[po]}function Mc(t){return 64==(64&t[un])}function pi(t,n){return null==n?null:t[n]}function Ap(t){t[ks]=0}function Nu(t,n){t[Ss]+=n;let e=t,r=t[ci];for(;null!==r&&(1===n&&1===e[Ss]||-1===n&&0===e[Ss]);)r[Ss]+=n,e=r,r=r[ci]}const rn={lFrame:$(null),bindingsEnabled:!0};function No(){return rn.bindingsEnabled}function Ae(){return rn.lFrame.lView}function En(){return rn.lFrame.tView}function In(t){return rn.lFrame.contextLView=t,t[Ai]}function gn(t){return rn.lFrame.contextLView=null,t}function fi(){let t=dt();for(;null!==t&&64===t.type;)t=t.parent;return t}function dt(){return rn.lFrame.currentTNode}function us(t,n){const e=rn.lFrame;e.currentTNode=t,e.isParent=n}function Vu(){return rn.lFrame.isParent}function Lr(){const t=rn.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function da(){return rn.lFrame.bindingIndex++}function Zr(t){const n=rn.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function u(t,n){const e=rn.lFrame;e.bindingIndex=e.bindingRootIndex=t,v(n)}function v(t){rn.lFrame.currentDirectiveIndex=t}function I(){return rn.lFrame.currentQueryIndex}function T(t){rn.lFrame.currentQueryIndex=t}function S(t){const n=t[xt];return 2===n.type?n.declTNode:1===n.type?t[rr]:null}function F(t,n,e){if(e&Lt.SkipSelf){let l=n,h=t;for(;!(l=l.parent,null!==l||e&Lt.Host||(l=S(h),null===l||(h=h[Ml],10&l.type))););if(null===l)return!1;n=l,t=h}const r=rn.lFrame=z();return r.currentTNode=n,r.lView=t,!0}function O(t){const n=z(),e=t[xt];rn.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function z(){const t=rn.lFrame,n=null===t?null:t.child;return null===n?$(t):n}function $(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Q(){const t=rn.lFrame;return rn.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const K=Q;function X(){const t=Q();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function W(){return rn.lFrame.selectedIndex}function ne(t){rn.lFrame.selectedIndex=t}function te(){const t=rn.lFrame;return ld(t.tView,t.selectedIndex)}function We(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){const h=t.data[e].type.prototype,{ngAfterContentInit:_,ngAfterContentChecked:C,ngAfterViewInit:M,ngAfterViewChecked:P,ngOnDestroy:B}=h;_&&(t.contentHooks??(t.contentHooks=[])).push(-e,_),C&&((t.contentHooks??(t.contentHooks=[])).push(e,C),(t.contentCheckHooks??(t.contentCheckHooks=[])).push(e,C)),M&&(t.viewHooks??(t.viewHooks=[])).push(-e,M),P&&((t.viewHooks??(t.viewHooks=[])).push(e,P),(t.viewCheckHooks??(t.viewCheckHooks=[])).push(e,P)),null!=B&&(t.destroyHooks??(t.destroyHooks=[])).push(e,B)}}function Ee(t,n,e){Ze(t,n,3,e)}function Be(t,n,e,r){(3&t[un])===e&&Ze(t,n,e,r)}function De(t,n){let e=t[un];(3&e)===n&&(e&=2047,e+=1,t[un]=e)}function Ze(t,n,e,r){const h=r??-1,_=n.length-1;let C=0;for(let M=void 0!==r?65535&t[ks]:0;M<_;M++)if("number"==typeof n[M+1]){if(C=n[M],null!=r&&C>=r)break}else n[M]<0&&(t[ks]+=65536),(C<h||-1==h)&&(Ie(t,e,n,M),t[ks]=(4294901760&t[ks])+M+2),M++}function Ie(t,n,e,r){const l=e[r]<0,h=e[r+1],C=t[l?-e[r]:e[r]];if(l){if(t[un]>>11<t[ks]>>16&&(3&t[un])===n){t[un]+=2048,xr(4,C,h);try{h.call(C)}finally{xr(5,C,h)}}}else{xr(4,C,h);try{h.call(C)}finally{xr(5,C,h)}}}const Fe=-1;class Qe{constructor(n,e,r){this.factory=n,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=r}}function wt(t,n,e){let r=0;for(;r<e.length;){const l=e[r];if("number"==typeof l){if(0!==l)break;r++;const h=e[r++],_=e[r++],C=e[r++];t.setAttribute(n,_,C,h)}else{const h=l,_=e[++r];Vn(h)?t.setProperty(n,h,_):t.setAttribute(n,h,_),r++}}return r}function Dn(t){return 3===t||4===t||6===t}function Vn(t){return 64===t.charCodeAt(0)}function Sn(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){const l=n[r];"number"==typeof l?e=l:0===e||jn(t,e,l,null,-1===e||2===e?n[++r]:null)}}return t}function jn(t,n,e,r,l){let h=0,_=t.length;if(-1===n)_=-1;else for(;h<t.length;){const C=t[h++];if("number"==typeof C){if(C===n){_=-1;break}if(C>n){_=h-1;break}}}for(;h<t.length;){const C=t[h];if("number"==typeof C)break;if(C===e){if(null===r)return void(null!==l&&(t[h+1]=l));if(r===t[h+1])return void(t[h+2]=l)}h++,null!==r&&h++,null!==l&&h++}-1!==_&&(t.splice(_,0,n),h=_+1),t.splice(h++,0,e),null!==r&&t.splice(h++,0,r),null!==l&&t.splice(h++,0,l)}function or(t){return t!==Fe}function Ti(t){return 32767&t}function to(t,n){let e=function mo(t){return t>>16}(t),r=n;for(;e>0;)r=r[Ml],e--;return r}let Xn=!0;function Fn(t){const n=Xn;return Xn=t,n}const xi=255,br=5;let ti=0;const mi={};function hs(t,n){const e=ds(t,n);if(-1!==e)return e;const r=n[xt];r.firstCreatePass&&(t.injectorIndex=n.length,$a(r.data,t),$a(n,null),$a(r.blueprint,null));const l=ps(t,n),h=t.injectorIndex;if(or(l)){const _=Ti(l),C=to(l,n),M=C[xt].data;for(let P=0;P<8;P++)n[h+P]=C[_+P]|M[_+P]}return n[h+8]=l,h}function $a(t,n){t.push(0,0,0,0,0,0,0,0,n)}function ds(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function ps(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let e=0,r=null,l=n;for(;null!==l;){if(r=H_(l),null===r)return Fe;if(e++,l=l[Ml],-1!==r.injectorIndex)return r.injectorIndex|e<<16}return Fe}function Rs(t,n,e){!function Uu(t,n,e){let r;"string"==typeof e?r=e.charCodeAt(0)||0:e.hasOwnProperty(Va)&&(r=e[Va]),null==r&&(r=e[Va]=ti++);const l=r&xi;n.data[t+(l>>br)]|=1<<l}(t,n,e)}function Ol(t,n,e){if(e&Lt.Optional||void 0!==t)return t;dc()}function Hu(t,n,e,r){if(e&Lt.Optional&&void 0===r&&(r=null),!(e&(Lt.Self|Lt.Host))){const l=t[ja],h=Jr(void 0);try{return l?l.get(n,r,e&Lt.Optional):gc(n,r,e&Lt.Optional)}finally{Jr(h)}}return Ol(r,0,e)}function dm(t,n,e,r=Lt.Default,l){if(null!==t){if(1024&n[un]){const _=function $A(t,n,e,r,l){let h=t,_=n;for(;null!==h&&null!==_&&1024&_[un]&&!(256&_[un]);){const C=pm(h,_,e,r|Lt.Self,mi);if(C!==mi)return C;let M=h.parent;if(!M){const P=_[Jh];if(P){const B=P.get(e,mi,r);if(B!==mi)return B}M=H_(_),_=_[Ml]}h=M}return l}(t,n,e,r,mi);if(_!==mi)return _}const h=pm(t,n,e,r,mi);if(h!==mi)return h}return Hu(n,e,r,l)}function pm(t,n,e,r,l){const h=function G_(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Va)?t[Va]:void 0;return"number"==typeof n?n>=0?n&xi:Ip:n}(e);if("function"==typeof h){if(!F(n,t,r))return r&Lt.Host?Ol(l,0,r):Hu(n,e,r,l);try{const _=h(r);if(null!=_||r&Lt.Optional)return _;dc()}finally{K()}}else if("number"==typeof h){let _=null,C=ds(t,n),M=Fe,P=r&Lt.Host?n[Ar][rr]:null;for((-1===C||r&Lt.SkipSelf)&&(M=-1===C?ps(t,n):n[C+8],M!==Fe&&ud(r,!1)?(_=n[xt],C=Ti(M),n=to(M,n)):C=-1);-1!==C;){const B=n[xt];if(Ep(h,C,B.data)){const G=HA(C,n,e,_,r,P);if(G!==mi)return G}M=n[C+8],M!==Fe&&ud(r,n[xt].data[C+8]===P)&&Ep(h,C,n)?(_=B,C=Ti(M),n=to(M,n)):C=-1}}return l}function HA(t,n,e,r,l,h){const _=n[xt],C=_.data[t+8],B=$u(C,_,e,null==r?ca(C)&&Xn:r!=_&&0!=(3&C.type),l&Lt.Host&&h===C);return null!==B?pa(n,_,B,C):mi}function $u(t,n,e,r,l){const h=t.providerIndexes,_=n.data,C=1048575&h,M=t.directiveStart,B=h>>20,ie=l?C+B:t.directiveEnd;for(let ue=r?C:C+B;ue<ie;ue++){const ve=_[ue];if(ue<M&&e===ve||ue>=M&&ve.type===e)return ue}if(l){const ue=_[M];if(ue&&fo(ue)&&ue.type===e)return M}return null}function pa(t,n,e,r){let l=t[e];const h=n.data;if(function Ue(t){return t instanceof Qe}(l)){const _=l;_.resolving&&function hc(t,n){const e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new rt(-200,`Circular dependency in DI detected for ${t}${e}`)}(function vn(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Jt(t)}(h[e]));const C=Fn(_.canSeeViewProviders);_.resolving=!0;const M=_.injectImpl?Jr(_.injectImpl):null;F(t,r,Lt.Default);try{l=t[e]=_.factory(void 0,h,t,r),n.firstCreatePass&&e>=r.directiveStart&&function Me(t,n,e){const{ngOnChanges:r,ngOnInit:l,ngDoCheck:h}=n.type.prototype;if(r){const _=Ou(n);(e.preOrderHooks??(e.preOrderHooks=[])).push(t,_),(e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(t,_)}l&&(e.preOrderHooks??(e.preOrderHooks=[])).push(0-t,l),h&&((e.preOrderHooks??(e.preOrderHooks=[])).push(t,h),(e.preOrderCheckHooks??(e.preOrderCheckHooks=[])).push(t,h))}(e,h[e],n)}finally{null!==M&&Jr(M),Fn(C),_.resolving=!1,K()}}return l}function Ep(t,n,e){return!!(e[n+(t>>br)]&1<<t)}function ud(t,n){return!(t&Lt.Self||t&Lt.Host&&n)}class go{constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return dm(this._tNode,this._lView,n,wl(r),e)}}function Ip(){return new go(fi(),Ae())}function wr(t){return eo(()=>{const n=t.prototype.constructor,e=n[Ro]||Mp(n),r=Object.prototype;let l=Object.getPrototypeOf(t.prototype).constructor;for(;l&&l!==r;){const h=l[Ro]||Mp(l);if(h&&h!==e)return h;l=Object.getPrototypeOf(l)}return h=>new h})}function Mp(t){return Yt(t)?()=>{const n=Mp(kt(t));return n&&n()}:ha(t)}function H_(t){const n=t[xt],e=n.type;return 2===e?n.declTNode:1===e?t[rr]:null}const fa="__parameters__";function jo(t,n,e){return eo(()=>{const r=function Vo(t){return function(...e){if(t){const r=t(...e);for(const l in r)this[l]=r[l]}}}(n);function l(...h){if(this instanceof l)return r.apply(this,h),this;const _=new l(...h);return C.annotation=_,C;function C(M,P,B){const G=M.hasOwnProperty(fa)?M[fa]:Object.defineProperty(M,fa,{value:[]})[fa];for(;G.length<=B;)G.push(null);return(G[B]=G[B]||[]).push(_),M}}return e&&(l.prototype=Object.create(e.prototype)),l.prototype.ngMetadataName=t,l.annotationCls=l,l})}class vt{constructor(n,e){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=Mt({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Br(t,n){t.forEach(e=>Array.isArray(e)?Br(e,n):n(e))}function Dp(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function _a(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function _o(t,n,e){let r=Ll(t,n);return r>=0?t[1|r]=e:(r=~r,function Sp(t,n,e,r){let l=t.length;if(l==n)t.push(e,r);else if(1===l)t.push(r,t[0]),t[0]=e;else{for(l--,t.push(t[l-1],t[l]);l>n;)t[l]=t[l-2],l--;t[n]=e,t[n+1]=r}}(t,r,n,e)),r}function fm(t,n){const e=Ll(t,n);if(e>=0)return t[1|e]}function Ll(t,n){return function Wu(t,n,e){let r=0,l=t.length>>e;for(;l!==r;){const h=r+(l-r>>1),_=t[h<<e];if(n===_)return h<<e;_>n?l=h:r=h+1}return~(l<<e)}(t,n,1)}const sr=la(jo("Optional"),8),ni=la(jo("SkipSelf"),4);var ar=(()=>((ar=ar||{})[ar.Important=1]="Important",ar[ar.DashCase=2]="DashCase",ar))();const Fc=new Map;let wm=0;const Bp="__ngContext__";function Di(t,n){qt(n)?(t[Bp]=n[Dl],function Ju(t){Fc.set(t[Dl],t)}(n)):t[Bp]=n}let _d;function zp(t,n){return _d(t,n)}function yd(t){const n=t[ci];return Or(n)?n[ci]:n}function Dm(t){return Nl(t[xc])}function Ns(t){return Nl(t[Oo])}function Nl(t){for(;null!==t&&!Or(t);)t=t[Oo];return t}function Xa(t,n,e,r,l){if(null!=r){let h,_=!1;Or(r)?h=r:qt(r)&&(_=!0,r=r[po]);const C=Zi(r);0===t&&null!==e?null==l?dy(n,e,C):Lc(n,e,C,l||null,!0):1===t&&null!==e?Lc(n,e,C,l||null,!0):2===t?function Gm(t,n,e){const r=Up(t,n);r&&function n0(t,n,e,r){t.removeChild(n,e,r)}(t,r,n,e)}(n,C,_):3===t&&n.destroyNode(C),null!=h&&function Nc(t,n,e,r,l){const h=e[bc];h!==Zi(e)&&Xa(n,t,r,h,l);for(let C=Wi;C<e.length;C++){const M=e[C];Bc(M[xt],M,t,n,r,h)}}(n,t,h,e,l)}}function Sm(t,n,e){return t.createElement(n,e)}function Rm(t,n){const e=t[Fo],r=e.indexOf(n),l=n[ci];512&n[un]&&(n[un]&=-513,Nu(l,-1)),e.splice(r,1)}function Ka(t,n){if(t.length<=Wi)return;const e=Wi+n,r=t[e];if(r){const l=r[Tl];null!==l&&l!==t&&Rm(l,r),n>0&&(t[e-1][Oo]=r[Oo]);const h=_a(t,Wi+n);!function uy(t,n){Bc(t,n,n[en],2,null,null),n[po]=null,n[rr]=null}(r[xt],r);const _=h[Rr];null!==_&&_.detachView(h[xt]),r[ci]=null,r[Oo]=null,r[un]&=-65}return r}function Om(t,n){if(!(128&n[un])){const e=n[en];e.destroyNode&&Bc(t,n,e,3,null,null),function t0(t){let n=t[xc];if(!n)return Fm(t[xt],t);for(;n;){let e=null;if(qt(n))e=n[xc];else{const r=n[Wi];r&&(e=r)}if(!e){for(;n&&!n[Oo]&&n!==t;)qt(n)&&Fm(n[xt],n),n=n[ci];null===n&&(n=t),qt(n)&&Fm(n[xt],n),e=n&&n[Oo]}n=e}}(n)}}function Fm(t,n){if(!(128&n[un])){n[un]&=-65,n[un]|=128,function jp(t,n){let e;if(null!=t&&null!=(e=t.destroyHooks))for(let r=0;r<e.length;r+=2){const l=n[e[r]];if(!(l instanceof Qe)){const h=e[r+1];if(Array.isArray(h))for(let _=0;_<h.length;_+=2){const C=l[h[_]],M=h[_+1];xr(4,C,M);try{M.call(C)}finally{xr(5,C,M)}}else{xr(4,l,h);try{h.call(l)}finally{xr(5,l,h)}}}}}(t,n),function ih(t,n){const e=t.cleanup,r=n[as];let l=-1;if(null!==e)for(let h=0;h<e.length-1;h+=2)if("string"==typeof e[h]){const _=e[h+3];_>=0?r[l=_]():r[l=-_].unsubscribe(),h+=2}else{const _=r[l=e[h+1]];e[h].call(_)}if(null!==r){for(let h=l+1;h<r.length;h++)(0,r[h])();n[as]=null}}(t,n),1===n[xt].type&&n[en].destroy();const e=n[Tl];if(null!==e&&Or(n[ci])){e!==n[ci]&&Rm(e,n);const r=n[Rr];null!==r&&r.detachView(t)}!function Em(t){Fc.delete(t[Dl])}(n)}}function Lm(t,n,e){return function Bm(t,n,e){let r=n;for(;null!==r&&40&r.type;)r=(n=r).parent;if(null===r)return e[po];{const{componentOffset:l}=r;if(l>-1){const{encapsulation:h}=t.data[r.directiveStart+l];if(h===ho.None||h===ho.Emulated)return null}return Ri(r,e)}}(t,n.parent,e)}function Lc(t,n,e,r,l){t.insertBefore(n,e,r,l)}function dy(t,n,e){t.appendChild(n,e)}function Nm(t,n,e,r,l){null!==r?Lc(t,n,e,r,l):dy(t,n,e)}function Up(t,n){return t.parentNode(n)}let vd,qp,Zm,bd,jm=function Vm(t,n,e){return 40&t.type?Ri(t,e):null};function zr(t,n,e,r){const l=Lm(t,r,n),h=n[en],C=function zm(t,n,e){return jm(t,n,e)}(r.parent||n[rr],r,n);if(null!=l)if(Array.isArray(e))for(let M=0;M<e.length;M++)Nm(h,l,e[M],C,!1);else Nm(h,l,e,C,!1);void 0!==vd&&vd(h,r,n,e,l)}function Gp(t,n){if(null!==n){const e=n.type;if(3&e)return Ri(n,t);if(4&e)return Um(-1,t[n.index]);if(8&e){const r=n.child;if(null!==r)return Gp(t,r);{const l=t[n.index];return Or(l)?Um(-1,l):Zi(l)}}if(32&e)return zp(n,t)()||Zi(t[n.index]);{const r=Hp(t,n);return null!==r?Array.isArray(r)?r[0]:Gp(yd(t[Ar]),r):Gp(t,n.next)}}return null}function Hp(t,n){return null!==n?t[Ar][rr].projection[n.projection]:null}function Um(t,n){const e=Wi+t+1;if(e<n.length){const r=n[e],l=r[xt].firstChild;if(null!==l)return Gp(r,l)}return n[bc]}function Hm(t,n,e,r,l,h,_){for(;null!=e;){const C=r[e.index],M=e.type;if(_&&0===n&&(C&&Di(Zi(C),r),e.flags|=2),32!=(32&e.flags))if(8&M)Hm(t,n,e.child,r,l,h,!1),Xa(n,t,l,C,h);else if(32&M){const P=zp(e,r);let B;for(;B=P();)Xa(n,t,l,B,h);Xa(n,t,l,C,h)}else 16&M?$m(t,n,r,e,l,h):Xa(n,t,l,C,h);e=_?e.projectionNext:e.next}}function Bc(t,n,e,r,l,h){Hm(e,r,t.firstChild,n,l,h,!1)}function $m(t,n,e,r,l,h){const _=e[Ar],M=_[rr].projection[r.projection];if(Array.isArray(M))for(let P=0;P<M.length;P++)Xa(n,t,l,M[P],h);else Hm(t,n,M,_[ci],l,h,!0)}function py(t,n,e){""===e?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function fy(t,n,e){const{mergedAttrs:r,classes:l,styles:h}=e;null!==r&&wt(t,n,r),null!==l&&py(t,n,l),null!==h&&function s0(t,n,e){t.setAttribute(n,"style",e)}(t,n,h)}function rh(t){return function qm(){if(void 0===qp&&(qp=null,ei.trustedTypes))try{qp=ei.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return qp}()?.createHTML(t)||t}function Qm(t){return function sh(){if(void 0===bd&&(bd=null,ei.trustedTypes))try{bd=ei.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return bd}()?.createScriptURL(t)||t}class zl{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ns})`}}class Cd extends zl{getTypeName(){return"HTML"}}class Xm extends zl{getTypeName(){return"Style"}}class Km extends zl{getTypeName(){return"Script"}}class Ym extends zl{getTypeName(){return"URL"}}class l0 extends zl{getTypeName(){return"ResourceURL"}}function vo(t){return t instanceof zl?t.changingThisBreaksApplicationSecurity:t}function Ao(t,n){const e=function c0(t){return t instanceof zl&&t.getTypeName()||null}(t);if(null!=e&&e!==n){if("ResourceURL"===e&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${ns})`)}return e===n}class h0{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const e=(new window.DOMParser).parseFromString(rh(n),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(n):(e.removeChild(e.firstChild),e)}catch{return null}}}class d0{constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){const e=this.inertDocument.createElement("template");return e.innerHTML=rh(n),e}}const f0=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Zp(t){return(t=String(t)).match(f0)?t:"unsafe:"+t}function gs(t){const n={};for(const e of t.split(","))n[e]=!0;return n}function Ed(...t){const n={};for(const e of t)for(const r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}const ng=gs("area,br,col,hr,img,wbr"),zc=gs("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),gy=gs("rp,rt"),Qp=Ed(ng,Ed(zc,gs("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Ed(gy,gs("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Ed(gy,zc)),ig=gs("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),Xp=Ed(ig,gs("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),gs("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),Kp=gs("script,style,template");class Yp{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let e=n.firstChild,r=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let l=this.checkClobberedElement(e,e.nextSibling);if(l){e=l;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(n){const e=n.nodeName.toLowerCase();if(!Qp.hasOwnProperty(e))return this.sanitizedSomething=!0,!Kp.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const r=n.attributes;for(let l=0;l<r.length;l++){const h=r.item(l),_=h.name,C=_.toLowerCase();if(!Xp.hasOwnProperty(C)){this.sanitizedSomething=!0;continue}let M=h.value;ig[C]&&(M=Zp(M)),this.buf.push(" ",_,'="',lh(M),'"')}return this.buf.push(">"),!0}endElement(n){const e=n.nodeName.toLowerCase();Qp.hasOwnProperty(e)&&!ng.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(lh(n))}checkClobberedElement(n,e){if(e&&(n.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return e}}const g0=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,_0=/([^\#-~ |!])/g;function lh(t){return t.replace(/&/g,"&amp;").replace(g0,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(_0,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Vl;function rg(t,n){let e=null;try{Vl=Vl||function my(t){const n=new d0(t);return function p0(){try{return!!(new window.DOMParser).parseFromString(rh(""),"text/html")}catch{return!1}}()?new h0(n):n}(t);let r=n?String(n):"";e=Vl.getInertBodyElement(r);let l=5,h=r;do{if(0===l)throw new Error("Failed to sanitize html because the input is unstable");l--,r=h,h=e.innerHTML,e=Vl.getInertBodyElement(r)}while(r!==h);return rh((new Yp).sanitizeChildren(Vc(e)||e))}finally{if(e){const r=Vc(e)||e;for(;r.firstChild;)r.removeChild(r.firstChild)}}}function Vc(t){return"content"in t&&function _y(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Zn=(()=>((Zn=Zn||{})[Zn.NONE=0]="NONE",Zn[Zn.HTML=1]="HTML",Zn[Zn.STYLE=2]="STYLE",Zn[Zn.SCRIPT=3]="SCRIPT",Zn[Zn.URL=4]="URL",Zn[Zn.RESOURCE_URL=5]="RESOURCE_URL",Zn))();function Aa(t){const n=Qi();return n?n.sanitize(Zn.URL,t)||"":Ao(t,"URL")?vo(t):Zp(Jt(t))}function Jp(t){const n=Qi();if(n)return Qm(n.sanitize(Zn.RESOURCE_URL,t)||"");if(Ao(t,"ResourceURL"))return Qm(vo(t));throw new rt(904,!1)}function Qi(){const t=Ae();return t&&t[Yh]}const jl=new vt("ENVIRONMENT_INITIALIZER"),jc=new vt("INJECTOR",-1),ch=new vt("INJECTOR_DEF_TYPES");class ag{get(n,e=Na){if(e===Na){const r=new Error(`NullInjectorError: No provider for ${Ke(n)}!`);throw r.name="NullInjectorError",r}return e}}function x0(...t){return{\u0275providers:wy(0,t),\u0275fromNgModule:!0}}function wy(t,...n){const e=[],r=new Set;let l;return Br(n,h=>{const _=h;lg(_,e,[],r)&&(l||(l=[]),l.push(_))}),void 0!==l&&Cy(l,e),e}function Cy(t,n){for(let e=0;e<t.length;e++){const{providers:l}=t[e];cg(l,h=>{n.push(h)})}}function lg(t,n,e,r){if(!(t=kt(t)))return!1;let l=null,h=xu(t);const _=!h&&mn(t);if(h||_){if(_&&!_.standalone)return!1;l=t}else{const M=t.ngModule;if(h=xu(M),!h)return!1;l=M}const C=r.has(l);if(_){if(C)return!1;if(r.add(l),_.dependencies){const M="function"==typeof _.dependencies?_.dependencies():_.dependencies;for(const P of M)lg(P,n,e,r)}}else{if(!h)return!1;{if(null!=h.imports&&!C){let P;r.add(l);try{Br(h.imports,B=>{lg(B,n,e,r)&&(P||(P=[]),P.push(B))})}finally{}void 0!==P&&Cy(P,n)}if(!C){const P=ha(l)||(()=>new l);n.push({provide:l,useFactory:P,deps:bn},{provide:ch,useValue:l,multi:!0},{provide:jl,useValue:()=>mt(l),multi:!0})}const M=h.providers;null==M||C||cg(M,B=>{n.push(B)})}}return l!==t&&void 0!==t.providers}function cg(t,n){for(let e of t)Pr(e)&&(e=e.\u0275providers),Array.isArray(e)?cg(e,n):n(e)}const ef=Qn({provide:String,useValue:Qn});function ug(t){return null!==t&&"object"==typeof t&&ef in t}function Ul(t){return"function"==typeof t}const pg=new vt("Set Injector scope."),tf={},w0={};let fg;function Id(){return void 0===fg&&(fg=new ag),fg}class xa{}class Xi extends xa{get destroyed(){return this._destroyed}constructor(n,e,r,l){super(),this.parent=e,this.source=r,this.scopes=l,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,gg(n,_=>this.processProvider(_)),this.records.set(jc,uh(void 0,this)),l.has("environment")&&this.records.set(xa,uh(void 0,this));const h=this.records.get(pg);null!=h&&"string"==typeof h.value&&this.scopes.add(h.value),this.injectorDefTypes=new Set(this.get(ch.multi,bn,Lt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const n of this._ngOnDestroyHooks)n.ngOnDestroy();for(const n of this._onDestroyHooks)n()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(n){this._onDestroyHooks.push(n)}runInContext(n){this.assertNotDestroyed();const e=$r(this),r=Jr(void 0);try{return n()}finally{$r(e),Jr(r)}}get(n,e=Na,r=Lt.Default){this.assertNotDestroyed(),r=wl(r);const l=$r(this),h=Jr(void 0);try{if(!(r&Lt.SkipSelf)){let C=this.records.get(n);if(void 0===C){const M=function E0(t){return"function"==typeof t||"object"==typeof t&&t instanceof vt}(n)&&Ba(n);C=M&&this.injectableDefInScope(M)?uh(Ho(n),tf):null,this.records.set(n,C)}if(null!=C)return this.hydrate(n,C)}return(r&Lt.Self?Id():this.parent).get(n,e=r&Lt.Optional&&e===Na?null:e)}catch(_){if("NullInjectorError"===_.name){if((_[xl]=_[xl]||[]).unshift(Ke(n)),l)throw _;return function Wh(t,n,e,r){const l=t[xl];throw n[yc]&&l.unshift(n[yc]),t.message=function xn(t,n,e,r=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==bl?t.slice(2):t;let l=Ke(n);if(Array.isArray(n))l=n.map(Ke).join(" -> ");else if("object"==typeof n){let h=[];for(let _ in n)if(n.hasOwnProperty(_)){let C=n[_];h.push(_+":"+("string"==typeof C?JSON.stringify(C):Ke(C)))}l=`{${h.join(", ")}}`}return`${e}${r?"("+r+")":""}[${l}]: ${t.replace($h,"\n  ")}`}("\n"+t.message,l,e,r),t[cp]=l,t[xl]=null,t}(_,n,"R3InjectorError",this.source)}throw _}finally{Jr(h),$r(l)}}resolveInjectorInitializers(){const n=$r(this),e=Jr(void 0);try{const r=this.get(jl.multi,bn,Lt.Self);for(const l of r)l()}finally{$r(n),Jr(e)}}toString(){const n=[],e=this.records;for(const r of e.keys())n.push(Ke(r));return`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new rt(205,!1)}processProvider(n){let e=Ul(n=kt(n))?n:kt(n&&n.provide);const r=function nf(t){return ug(t)?uh(void 0,t.useValue):uh(Uc(t),tf)}(n);if(Ul(n)||!0!==n.multi)this.records.get(e);else{let l=this.records.get(e);l||(l=uh(void 0,tf,!0),l.factory=()=>vc(l.multi),this.records.set(e,l)),e=n,l.multi.push(n)}this.records.set(e,r)}hydrate(n,e){return e.value===tf&&(e.value=w0,e.value=e.factory()),"object"==typeof e.value&&e.value&&function Md(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}injectableDefInScope(n){if(!n.providedIn)return!1;const e=kt(n.providedIn);return"string"==typeof e?"any"===e||this.scopes.has(e):this.injectorDefTypes.has(e)}}function Ho(t){const n=Ba(t),e=null!==n?n.factory:ha(t);if(null!==e)return e;if(t instanceof vt)throw new rt(204,!1);if(t instanceof Function)return function mg(t){const n=t.length;if(n>0)throw function qa(t,n){const e=[];for(let r=0;r<t;r++)e.push(n);return e}(n,"?"),new rt(204,!1);const e=function vl(t){const n=t&&(t[rs]||t[Al]);return n?(function is(t){if(t.hasOwnProperty("name"))return t.name;(""+t).match(/^function\s*([^\s(]+)/)}(t),n):null}(t);return null!==e?()=>e.factory(t):()=>new t}(t);throw new rt(204,!1)}function Uc(t,n,e){let r;if(Ul(t)){const l=kt(t);return ha(l)||Ho(l)}if(ug(t))r=()=>kt(t.useValue);else if(function dg(t){return!(!t||!t.useFactory)}(t))r=()=>t.useFactory(...vc(t.deps||[]));else if(function hg(t){return!(!t||!t.useExisting)}(t))r=()=>mt(kt(t.useExisting));else{const l=kt(t&&(t.useClass||t.provide));if(!function C0(t){return!!t.deps}(t))return ha(l)||Ho(l);r=()=>new l(...vc(t.deps))}return r}function uh(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function gg(t,n){for(const e of t)Array.isArray(e)?gg(e,n):e&&Pr(e)?gg(e.\u0275providers,n):n(e)}class Ey{}class _g{}class Ty{resolveComponentFactory(n){throw function Iy(t){const n=Error(`No component factory found for ${Ke(t)}. Did you add it to @NgModule.entryComponents?`);return n.ngComponent=t,n}(n)}}let hh=(()=>{class t{}return t.NULL=new Ty,t})();function Ya(){return zs(fi(),Ae())}function zs(t,n){return new Vr(Ri(t,n))}let Vr=(()=>{class t{constructor(e){this.nativeElement=e}}return t.__NG_ELEMENT_ID__=Ya,t})();function I0(t){return t instanceof Vr?t.nativeElement:t}class Dy{}let Ja=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function M0(){const t=Ae(),e=Fr(fi().index,t);return(qt(e)?e:t)[en]}(),t})(),T0=(()=>{class t{}return t.\u0275prov=Mt({token:t,providedIn:"root",factory:()=>null}),t})();class Gc{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const D0=new Gc("15.2.7"),yg={},vg="ngOriginalError";function Gl(t){return t[vg]}class el{constructor(){this._console=console}handleError(n){const e=this._findOriginalError(n);this._console.error("ERROR",n),e&&this._console.error("ORIGINAL ERROR",e)}_findOriginalError(n){let e=n&&Gl(n);for(;e&&Gl(e);)e=Gl(e);return e||null}}function Td(t){return t.ownerDocument.defaultView}function af(t){return t.ownerDocument}function Vs(t){return t instanceof Function?t():t}function Dd(t,n,e){let r=t.length;for(;;){const l=t.indexOf(n,e);if(-1===l)return l;if(0===l||t.charCodeAt(l-1)<=32){const h=n.length;if(l+h===r||t.charCodeAt(l+h)<=32)return l}e=l+1}}const Py="ng-template";function Ry(t,n,e){let r=0,l=!0;for(;r<t.length;){let h=t[r++];if("string"==typeof h&&l){const _=t[r++];if(e&&"class"===h&&-1!==Dd(_.toLowerCase(),n,0))return!0}else{if(1===h){for(;r<t.length&&"string"==typeof(h=t[r++]);)if(h.toLowerCase()===n)return!0;return!1}"number"==typeof h&&(l=!1)}}return!1}function bg(t){return 4===t.type&&t.value!==Py}function R0(t,n,e){return n===(4!==t.type||e?t.value:Py)}function Oy(t,n,e){let r=4;const l=t.attrs||[],h=function Fy(t){for(let n=0;n<t.length;n++)if(Dn(t[n]))return n;return t.length}(l);let _=!1;for(let C=0;C<n.length;C++){const M=n[C];if("number"!=typeof M){if(!_)if(4&r){if(r=2|1&r,""!==M&&!R0(t,M,e)||""===M&&1===n.length){if(_s(r))return!1;_=!0}}else{const P=8&r?M:n[++C];if(8&r&&null!==t.attrs){if(!Ry(t.attrs,P,e)){if(_s(r))return!1;_=!0}continue}const G=wg(8&r?"class":M,l,bg(t),e);if(-1===G){if(_s(r))return!1;_=!0;continue}if(""!==P){let ie;ie=G>h?"":l[G+1].toLowerCase();const ue=8&r?ie:null;if(ue&&-1!==Dd(ue,P,0)||2&r&&P!==ie){if(_s(r))return!1;_=!0}}}}else{if(!_&&!_s(r)&&!_s(M))return!1;if(_&&_s(M))continue;_=!1,r=M|1&r}}return _s(r)||_}function _s(t){return 0==(1&t)}function wg(t,n,e,r){if(null===n)return-1;let l=0;if(r||!e){let h=!1;for(;l<n.length;){const _=n[l];if(_===t)return l;if(3===_||6===_)h=!0;else{if(1===_||2===_){let C=n[++l];for(;"string"==typeof C;)C=n[++l];continue}if(4===_)break;if(0===_){l+=4;continue}}l+=h?1:2}return-1}return function tl(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){const r=t[e];if("number"==typeof r)return-1;if(r===n)return e;e++}return-1}(n,t)}function Cg(t,n,e=!1){for(let r=0;r<n.length;r++)if(Oy(t,n[r],e))return!0;return!1}function Eg(t,n){return t?":not("+n.trim()+")":n}function By(t){let n=t[0],e=1,r=2,l="",h=!1;for(;e<t.length;){let _=t[e];if("string"==typeof _)if(2&r){const C=t[++e];l+="["+_+(C.length>0?'="'+C+'"':"")+"]"}else 8&r?l+="."+_:4&r&&(l+=" "+_);else""!==l&&!_s(_)&&(n+=Eg(h,l),l=""),r=_,h=h||!_s(r);e++}return""!==l&&(n+=Eg(h,l)),n}const dn={};function ut(t){Ig(En(),Ae(),W()+t,!1)}function Ig(t,n,e,r){if(!r)if(3==(3&n[un])){const h=t.preOrderCheckHooks;null!==h&&Ee(n,h,e)}else{const h=t.preOrderHooks;null!==h&&Be(n,h,0,e)}ne(e)}function Dg(t,n=null,e=null,r){const l=Sd(t,n,e,r);return l.resolveInjectorInitializers(),l}function Sd(t,n=null,e=null,r,l=new Set){const h=[e||bn,x0(t)];return r=r||("object"==typeof t?void 0:Ke(t)),new Xi(h,n||Id(),r||null,l)}let xo=(()=>{class t{static create(e,r){if(Array.isArray(e))return Dg({name:""},r,e,"");{const l=e.name??"";return Dg({name:l},e.parent,e.providers,l)}}}return t.THROW_IF_NOT_FOUND=Na,t.NULL=new ag,t.\u0275prov=Mt({token:t,providedIn:"any",factory:()=>mt(jc)}),t.__NG_ELEMENT_ID__=-1,t})();function He(t,n=Lt.Default){const e=Ae();return null===e?mt(t,n):dm(fi(),e,kt(t),n)}function Wy(t,n){const e=t.contentQueries;if(null!==e)for(let r=0;r<e.length;r+=2){const h=e[r+1];if(-1!==h){const _=t.data[h];T(e[r]),_.contentQueries(2,n[h],h)}}}function pf(t,n,e,r,l,h,_,C,M,P,B){const G=n.blueprint.slice();return G[po]=l,G[un]=76|r,(null!==B||t&&1024&t[un])&&(G[un]|=1024),Ap(G),G[ci]=G[Ml]=t,G[Ai]=e,G[Ac]=_||t&&t[Ac],G[en]=C||t&&t[en],G[Yh]=M||t&&t[Yh]||null,G[ja]=P||t&&t[ja]||null,G[rr]=h,G[Dl]=function ry(){return wm++}(),G[Jh]=B,G[Ar]=2==n.type?t[Ar]:G,G}function Xc(t,n,e,r,l){let h=t.data[n];if(null===h)h=function Fg(t,n,e,r,l){const h=dt(),_=Vu(),M=t.data[n]=function U0(t,n,e,r,l,h){return{type:e,index:r,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:l,attrs:h,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,_?h:h&&h.parent,e,n,r,l);return null===t.firstChild&&(t.firstChild=M),null!==h&&(_?null==h.child&&null!==M.parent&&(h.child=M):null===h.next&&(h.next=M,M.prev=h)),M}(t,n,e,r,l),function f(){return rn.lFrame.inI18n}()&&(h.flags|=32);else if(64&h.type){h.type=e,h.value=r,h.attrs=l;const _=function Ha(){const t=rn.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();h.injectorIndex=null===_?-1:_.injectorIndex}return us(h,!0),h}function gh(t,n,e,r){if(0===e)return-1;const l=n.length;for(let h=0;h<e;h++)n.push(r),t.blueprint.push(r),t.data.push(null);return l}function Lg(t,n,e){O(n);try{const r=t.viewQuery;null!==r&&Ah(1,r,e);const l=t.template;null!==l&&Xy(t,n,l,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Wy(t,n),t.staticViewQueries&&Ah(2,t.viewQuery,e);const h=t.components;null!==h&&function Qy(t,n){for(let e=0;e<n.length;e++)ov(t,n[e])}(n,h)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[un]&=-5,X()}}function Rd(t,n,e,r){const l=n[un];if(128!=(128&l)){O(n);try{Ap(n),function ju(t){return rn.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==e&&Xy(t,n,e,2,r);const _=3==(3&l);if(_){const P=t.preOrderCheckHooks;null!==P&&Ee(n,P,null)}else{const P=t.preOrderHooks;null!==P&&Be(n,P,0,null),De(n,0)}if(function iv(t){for(let n=Dm(t);null!==n;n=Ns(n)){if(!n[Sl])continue;const e=n[Fo];for(let r=0;r<e.length;r++){const l=e[r];512&l[un]||Nu(l[ci],1),l[un]|=512}}}(n),function nv(t){for(let n=Dm(t);null!==n;n=Ns(n))for(let e=Wi;e<n.length;e++){const r=n[e],l=r[xt];Mc(r)&&Rd(l,r,l.template,r[Ai])}}(n),null!==t.contentQueries&&Wy(t,n),_){const P=t.contentCheckHooks;null!==P&&Ee(n,P)}else{const P=t.contentHooks;null!==P&&Be(n,P,1),De(n,1)}!function df(t,n){const e=t.hostBindingOpCodes;if(null!==e)try{for(let r=0;r<e.length;r++){const l=e[r];if(l<0)ne(~l);else{const h=l,_=e[++r],C=e[++r];u(_,h),C(2,n[h])}}}finally{ne(-1)}}(t,n);const C=t.components;null!==C&&function Zy(t,n){for(let e=0;e<n.length;e++)rv(t,n[e])}(n,C);const M=t.viewQuery;if(null!==M&&Ah(2,M,r),_){const P=t.viewCheckHooks;null!==P&&Ee(n,P)}else{const P=t.viewHooks;null!==P&&Be(n,P,2),De(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),n[un]&=-41,512&n[un]&&(n[un]&=-513,Nu(n[ci],-1))}finally{X()}}}function Xy(t,n,e,r,l){const h=W(),_=2&r;try{ne(-1),_&&n.length>On&&Ig(t,n,On,!1),xr(_?2:0,l),e(r,l)}finally{ne(h),xr(_?3:1,l)}}function Bg(t,n,e){if(Iu(n)){const l=n.directiveEnd;for(let h=n.directiveStart;h<l;h++){const _=t.data[h];_.contentQueries&&_.contentQueries(1,e[h],h)}}}function _h(t,n,e){No()&&(function Yy(t,n,e,r){const l=e.directiveStart,h=e.directiveEnd;ca(e)&&function tv(t,n,e){const r=Ri(n,t),l=Od(e),h=t[Ac],_=Gs(t,pf(t,l,null,e.onPush?32:16,r,n,h,h.createRenderer(r,e),null,null,null));t[n.index]=_}(n,e,t.data[l+e.componentOffset]),t.firstCreatePass||hs(e,n),Di(r,n);const _=e.initialInputs;for(let C=l;C<h;C++){const M=t.data[C],P=pa(n,t,C,e);Di(P,n),null!==_&&Gg(0,C-l,P,M,0,_),fo(M)&&(Fr(e.index,n)[Ai]=pa(n,t,C,e))}}(t,n,e,Ri(e,n)),64==(64&e.flags)&&Jy(t,n,e))}function yh(t,n,e=Ri){const r=n.localNames;if(null!==r){let l=n.index+1;for(let h=0;h<r.length;h+=2){const _=r[h+1],C=-1===_?e(n,t):t[_];t[l++]=C}}}function Od(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Ng(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function Ng(t,n,e,r,l,h,_,C,M,P){const B=On+r,G=B+l,ie=function zg(t,n){const e=[];for(let r=0;r<n;r++)e.push(r<t?null:dn);return e}(B,G),ue="function"==typeof P?P():P;return ie[xt]={type:t,blueprint:ie,template:e,queries:null,viewQuery:C,declTNode:n,data:ie.slice().fill(null,B),bindingStartIndex:B,expandoStartIndex:G,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof h?h():h,pipeRegistry:"function"==typeof _?_():_,firstChild:null,schemas:M,consts:ue,incompleteFirstPass:!1}}function nl(t,n,e,r){const l=Kc(n);null===e?l.push(r):(l.push(e),t.firstCreatePass&&Af(t).push(r,l.length-1))}function ff(t,n,e,r){for(let l in t)if(t.hasOwnProperty(l)){e=null===e?{}:e;const h=t[l];null===r?jg(e,n,l,h):r.hasOwnProperty(l)&&jg(e,n,r[l],h)}return e}function jg(t,n,e,r){t.hasOwnProperty(e)?t[e].push(n,r):t[e]=[n,r]}function qo(t,n,e,r,l,h,_,C){const M=Ri(n,e);let B,P=n.inputs;!C&&null!=P&&(B=P[r])?(Ld(t,e,B,r,l),ca(n)&&function H0(t,n){const e=Fr(n,t);16&e[un]||(e[un]|=32)}(e,n.index)):3&n.type&&(r=function G0(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(r),l=null!=_?_(l,n.value||"",r):l,h.setProperty(M,r,l))}function Ug(t,n,e,r){if(No()){const l=null===r?null:{"":-1},h=function vs(t,n){const e=t.directiveRegistry;let r=null,l=null;if(e)for(let h=0;h<e.length;h++){const _=e[h];if(Cg(n,_.selectors,!1))if(r||(r=[]),fo(_))if(null!==_.findHostDirectiveDefs){const C=[];l=l||new Map,_.findHostDirectiveDefs(_,C,l),r.unshift(...C,_),As(t,n,C.length)}else r.unshift(_),As(t,n,0);else l=l||new Map,_.findHostDirectiveDefs?.(_,r,l),r.push(_)}return null===r?null:[r,l]}(t,e);let _,C;null===h?_=C=null:[_,C]=h,null!==_&&vh(t,n,e,_,l,C),l&&function ql(t,n,e){if(n){const r=t.localNames=[];for(let l=0;l<n.length;l+=2){const h=e[n[l+1]];if(null==h)throw new rt(-301,!1);r.push(n[l],h)}}}(e,r,l)}e.mergedAttrs=Sn(e.mergedAttrs,e.attrs)}function vh(t,n,e,r,l,h){for(let P=0;P<r.length;P++)Rs(hs(e,n),t,r[P].type);!function Wl(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}(e,t.data.length,r.length);for(let P=0;P<r.length;P++){const B=r[P];B.providersResolver&&B.providersResolver(B)}let _=!1,C=!1,M=gh(t,n,r.length,null);for(let P=0;P<r.length;P++){const B=r[P];e.mergedAttrs=Sn(e.mergedAttrs,B.hostAttrs),gf(t,e,n,M,B),ba(M,B,l),null!==B.contentQueries&&(e.flags|=4),(null!==B.hostBindings||null!==B.hostAttrs||0!==B.hostVars)&&(e.flags|=64);const G=B.type.prototype;!_&&(G.ngOnChanges||G.ngOnInit||G.ngDoCheck)&&((t.preOrderHooks??(t.preOrderHooks=[])).push(e.index),_=!0),!C&&(G.ngOnChanges||G.ngDoCheck)&&((t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(e.index),C=!0),M++}!function mf(t,n,e){const l=n.directiveEnd,h=t.data,_=n.attrs,C=[];let M=null,P=null;for(let B=n.directiveStart;B<l;B++){const G=h[B],ie=e?e.get(G):null,ve=ie?ie.outputs:null;M=ff(G.inputs,B,M,ie?ie.inputs:null),P=ff(G.outputs,B,P,ve);const Le=null===M||null===_||bg(n)?null:Z0(M,B,_);C.push(Le)}null!==M&&(M.hasOwnProperty("class")&&(n.flags|=8),M.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=C,n.inputs=M,n.outputs=P}(t,e,h)}function Jy(t,n,e){const r=e.directiveStart,l=e.directiveEnd,h=e.index,_=function g(){return rn.lFrame.currentDirectiveIndex}();try{ne(h);for(let C=r;C<l;C++){const M=t.data[C],P=n[C];v(C),(null!==M.hostBindings||0!==M.hostVars||null!==M.hostAttrs)&&ev(M,P)}}finally{ne(-1),v(_)}}function ev(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function As(t,n,e){n.componentOffset=e,(t.components??(t.components=[])).push(n.index)}function ba(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;fo(n)&&(e[""]=t)}}function gf(t,n,e,r,l){t.data[r]=l;const h=l.factory||(l.factory=ha(l.type)),_=new Qe(h,fo(l),He);t.blueprint[r]=_,e[r]=_,function q0(t,n,e,r,l){const h=l.hostBindings;if(h){let _=t.hostBindingOpCodes;null===_&&(_=t.hostBindingOpCodes=[]);const C=~n.index;(function W0(t){let n=t.length;for(;n>0;){const e=t[--n];if("number"==typeof e&&e<0)return e}return 0})(_)!=C&&_.push(C),_.push(e,r,h)}}(t,n,r,gh(t,e,l.hostVars,dn),l)}function Us(t,n,e,r,l,h){const _=Ri(t,n);!function _f(t,n,e,r,l,h,_){if(null==h)t.removeAttribute(n,l,e);else{const C=null==_?Jt(h):_(h,r||"",l);t.setAttribute(n,l,C,e)}}(n[en],_,h,t.value,e,r,l)}function Gg(t,n,e,r,l,h){const _=h[n];if(null!==_){const C=r.setInput;for(let M=0;M<_.length;){const P=_[M++],B=_[M++],G=_[M++];null!==C?r.setInput(e,G,P,B):e[B]=G}}}function Z0(t,n,e){let r=null,l=0;for(;l<e.length;){const h=e[l];if(0!==h)if(5!==h){if("number"==typeof h)break;if(t.hasOwnProperty(h)){null===r&&(r=[]);const _=t[h];for(let C=0;C<_.length;C+=2)if(_[C]===n){r.push(h,_[C+1],e[l+1]);break}}l+=2}else l+=2;else l+=4}return r}function Hg(t,n,e,r){return[t,!0,!1,n,null,0,r,e,null,null]}function rv(t,n){const e=Fr(n,t);if(Mc(e)){const r=e[xt];48&e[un]?Rd(r,e,r.template,e[Ai]):e[Ss]>0&&yf(e)}}function yf(t){for(let r=Dm(t);null!==r;r=Ns(r))for(let l=Wi;l<r.length;l++){const h=r[l];if(Mc(h))if(512&h[un]){const _=h[xt];Rd(_,h,_.template,h[Ai])}else h[Ss]>0&&yf(h)}const e=t[xt].components;if(null!==e)for(let r=0;r<e.length;r++){const l=Fr(e[r],t);Mc(l)&&l[Ss]>0&&yf(l)}}function ov(t,n){const e=Fr(n,t),r=e[xt];(function sv(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])})(r,e),Lg(r,e,e[Ai])}function Gs(t,n){return t[xc]?t[pp][Oo]=n:t[xc]=n,t[pp]=n,n}function Fd(t){for(;t;){t[un]|=32;const n=yd(t);if(Mu(t)&&!n)return t;t=n}return null}function vf(t,n,e,r=!0){const l=n[Ac];l.begin&&l.begin();try{Rd(t,n,t.template,e)}catch(_){throw r&&Hs(n,_),_}finally{l.end&&l.end()}}function Ah(t,n,e){T(0),n(t,e)}function Kc(t){return t[as]||(t[as]=[])}function Af(t){return t.cleanup||(t.cleanup=[])}function Hs(t,n){const e=t[ja],r=e?e.get(el,null):null;r&&r.handleError(n)}function Ld(t,n,e,r,l){for(let h=0;h<e.length;){const _=e[h++],C=e[h++],M=n[_],P=t.data[_];null!==P.setInput?P.setInput(M,l,r,C):M[C]=l}}function $s(t,n,e){const r=Ic(n,t);!function Vp(t,n,e){t.setValue(n,e)}(t[en],r,e)}function bo(t,n,e){let r=e?t.styles:null,l=e?t.classes:null,h=0;if(null!==n)for(let _=0;_<n.length;_++){const C=n[_];"number"==typeof C?h=C:1==h?l=sn(l,C):2==h&&(r=sn(r,C+": "+n[++_]+";"))}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=l:t.classesWithoutHost=l}function wa(t,n,e,r,l=!1){for(;null!==e;){const h=n[e.index];if(null!==h&&r.push(Zi(h)),Or(h))for(let C=Wi;C<h.length;C++){const M=h[C],P=M[xt].firstChild;null!==P&&wa(M[xt],M,P,r)}const _=e.type;if(8&_)wa(t,n,e.child,r);else if(32&_){const C=zp(e,n);let M;for(;M=C();)r.push(M)}else if(16&_){const C=Hp(n,e);if(Array.isArray(C))r.push(...C);else{const M=yd(n[Ar]);wa(M[xt],M,C,r,!0)}}e=l?e.projectionNext:e.next}return r}class xh{get rootNodes(){const n=this._lView,e=n[xt];return wa(e,n,e.firstChild,[])}constructor(n,e){this._lView=n,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ai]}set context(n){this._lView[Ai]=n}get destroyed(){return 128==(128&this._lView[un])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[ci];if(Or(n)){const e=n[ls],r=e?e.indexOf(this):-1;r>-1&&(Ka(n,r),_a(e,r))}this._attachedToViewContainer=!1}Om(this._lView[xt],this._lView)}onDestroy(n){nl(this._lView[xt],this._lView,null,n)}markForCheck(){Fd(this._cdRefInjectingView||this._lView)}detach(){this._lView[un]&=-65}reattach(){this._lView[un]|=64}detectChanges(){vf(this._lView[xt],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new rt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function km(t,n){Bc(t,n,n[en],2,null,null)}(this._lView[xt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new rt(902,!1);this._appRef=n}}class av extends xh{constructor(n){super(n),this._view=n}detectChanges(){const n=this._view;vf(n[xt],n,n[Ai],!1)}checkNoChanges(){}get context(){return null}}class bh extends hh{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const e=mn(n);return new Nd(e,this.ngModule)}}function Bd(t){const n=[];for(let e in t)t.hasOwnProperty(e)&&n.push({propName:t[e],templateName:e});return n}class cv{constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=wl(r);const l=this.injector.get(n,yg,r);return l!==yg||e===yg?l:this.parentInjector.get(n,e,r)}}class Nd extends _g{get inputs(){return Bd(this.componentDef.inputs)}get outputs(){return Bd(this.componentDef.outputs)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=function Ny(t){return t.map(By).join(",")}(n.selectors),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!e}create(n,e,r,l){let h=(l=l||this.ngModule)instanceof xa?l:l?.injector;h&&null!==this.componentDef.getStandaloneInjector&&(h=this.componentDef.getStandaloneInjector(h)||h);const _=h?new cv(n,h):n,C=_.get(Dy,null);if(null===C)throw new rt(407,!1);const M=_.get(T0,null),P=C.createRenderer(null,this.componentDef),B=this.componentDef.selectors[0][0]||"div",G=r?function Vg(t,n,e){return t.selectRootElement(n,e===ho.ShadowDom)}(P,r,this.componentDef.encapsulation):Sm(P,B,function lv(t){const n=t.toLowerCase();return"svg"===n?"svg":"math"===n?"math":null}(B)),ie=this.componentDef.onPush?288:272,ue=Ng(0,null,null,1,0,null,null,null,null,null),ve=pf(null,ue,null,ie,null,null,C,P,M,_,null);let Le,qe;O(ve);try{const tt=this.componentDef;let bt,Je=null;tt.findHostDirectiveDefs?(bt=[],Je=new Map,tt.findHostDirectiveDefs(tt,bt,Je),bt.push(tt)):bt=[tt];const Xt=function hv(t,n){const e=t[xt],r=On;return t[r]=n,Xc(e,r,2,"#host",null)}(ve,G),_i=function X0(t,n,e,r,l,h,_,C){const M=l[xt];!function $g(t,n,e,r){for(const l of t)n.mergedAttrs=Sn(n.mergedAttrs,l.hostAttrs);null!==n.mergedAttrs&&(bo(n,n.mergedAttrs,!0),null!==e&&fy(r,e,n))}(r,t,n,_);const P=h.createRenderer(n,e),B=pf(l,Od(e),null,e.onPush?32:16,l[t.index],t,h,P,C||null,null,null);return M.firstCreatePass&&As(M,t,r.length-1),Gs(l,B),l[t.index]=B}(Xt,G,tt,bt,ve,C,P);qe=ld(ue,On),G&&function pv(t,n,e,r){if(r)wt(t,e,["ng-version",D0.full]);else{const{attrs:l,classes:h}=function F0(t){const n=[],e=[];let r=1,l=2;for(;r<t.length;){let h=t[r];if("string"==typeof h)2===l?""!==h&&n.push(h,t[++r]):8===l&&e.push(h);else{if(!_s(l))break;l=h}r++}return{attrs:n,classes:e}}(n.selectors[0]);l&&wt(t,e,l),h&&h.length>0&&py(t,e,h.join(" "))}}(P,tt,G,r),void 0!==e&&function fv(t,n,e){const r=t.projection=[];for(let l=0;l<n.length;l++){const h=e[l];r.push(null!=h?Array.from(h):null)}}(qe,this.ngContentSelectors,e),Le=function dv(t,n,e,r,l,h){const _=fi(),C=l[xt],M=Ri(_,l);vh(C,l,_,e,null,r);for(let B=0;B<e.length;B++)Di(pa(l,C,_.directiveStart+B,_),l);Jy(C,l,_),M&&Di(M,l);const P=pa(l,C,_.directiveStart+_.componentOffset,_);if(t[Ai]=l[Ai]=P,null!==h)for(const B of h)B(P,n);return Bg(C,_,t),P}(_i,tt,bt,Je,ve,[qg]),Lg(ue,ve,null)}finally{X()}return new uv(this.componentType,Le,zs(qe,ve),ve,qe)}}class uv extends Ey{constructor(n,e,r,l,h){super(),this.location=r,this._rootLView=l,this._tNode=h,this.instance=e,this.hostView=this.changeDetectorRef=new av(l),this.componentType=n}setInput(n,e){const r=this._tNode.inputs;let l;if(null!==r&&(l=r[n])){const h=this._rootLView;Ld(h[xt],h,l,n,e),Fd(Fr(this._tNode.index,h))}}get injector(){return new go(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}function qg(){const t=fi();We(Ae()[xt],t)}function Kn(t){let n=function bf(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),e=!0;const r=[t];for(;n;){let l;if(fo(t))l=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new rt(903,!1);l=n.\u0275dir}if(l){if(e){r.push(l);const _=t;_.inputs=Vd(t.inputs),_.declaredInputs=Vd(t.declaredInputs),_.outputs=Vd(t.outputs);const C=l.hostBindings;C&&i(t,C);const M=l.viewQuery,P=l.contentQueries;if(M&&mv(t,M),P&&o(t,P),oa(t.inputs,l.inputs),oa(t.declaredInputs,l.declaredInputs),oa(t.outputs,l.outputs),fo(l)&&l.data.animation){const B=t.data;B.animation=(B.animation||[]).concat(l.data.animation)}}const h=l.features;if(h)for(let _=0;_<h.length;_++){const C=h[_];C&&C.ngInherit&&C(t),C===Kn&&(e=!1)}}n=Object.getPrototypeOf(n)}!function zd(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){const l=t[r];l.hostVars=n+=l.hostVars,l.hostAttrs=Sn(l.hostAttrs,e=Sn(e,l.hostAttrs))}}(r)}function Vd(t){return t===ss?{}:t===bn?[]:t}function mv(t,n){const e=t.viewQuery;t.viewQuery=e?(r,l)=>{n(r,l),e(r,l)}:n}function o(t,n){const e=t.contentQueries;t.contentQueries=e?(r,l,h)=>{n(r,l,h),e(r,l,h)}:n}function i(t,n){const e=t.hostBindings;t.hostBindings=e?(r,l)=>{n(r,l),e(r,l)}:n}function R(t){return!!j(t)&&(Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t)}function j(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function J(t,n,e){return t[n]=e}function Y(t,n,e){return!Object.is(t[n],e)&&(t[n]=e,!0)}function oe(t,n,e,r){const l=Y(t,n,e);return Y(t,n+1,r)||l}function xe(t,n,e,r){const l=Ae();return Y(l,da(),n)&&(En(),Us(te(),l,t,n,e,r)),xe}function Re(t,n,e,r){return Y(t,da(),e)?n+Jt(e)+r:dn}function $e(t,n,e,r,l,h){const C=oe(t,function zo(){return rn.lFrame.bindingIndex}(),e,l);return Zr(2),C?n+Jt(e)+r+Jt(l)+h:dn}function yt(t,n,e,r,l,h,_,C){const M=Ae(),P=En(),B=t+On,G=P.firstCreatePass?function Yn(t,n,e,r,l,h,_,C,M){const P=n.consts,B=Xc(n,t,4,_||null,pi(P,C));Ug(n,e,B,pi(P,M)),We(n,B);const G=B.tView=Ng(2,B,r,l,h,n.directiveRegistry,n.pipeRegistry,null,n.schemas,P);return null!==n.queries&&(n.queries.template(n,B),G.queries=n.queries.embeddedTView(B)),B}(B,P,M,n,e,r,l,h,_):P.data[B];us(G,!1);const ie=M[en].createComment("");zr(P,M,ie,G),Di(ie,M),Gs(M,M[B]=Hg(ie,M,ie,G)),Ps(G)&&_h(P,M,G),null!=_&&yh(M,G,C)}function Nn(t){return function Rl(t,n){return t[n]}(function wp(){return rn.lFrame.contextLView}(),On+t)}function ot(t,n,e){const r=Ae();return Y(r,da(),n)&&qo(En(),te(),r,t,n,r[en],e,!1),ot}function Un(t,n,e,r,l){const _=l?"class":"style";Ld(t,e,n.inputs[_],_,r)}function ke(t,n,e,r){const l=Ae(),h=En(),_=On+t,C=l[en],M=h.firstCreatePass?function Hn(t,n,e,r,l,h){const _=n.consts,M=Xc(n,t,2,r,pi(_,l));return Ug(n,e,M,pi(_,h)),null!==M.attrs&&bo(M,M.attrs,!1),null!==M.mergedAttrs&&bo(M,M.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,M),M}(_,h,l,n,e,r):h.data[_],P=l[_]=Sm(C,n,function _e(){return rn.lFrame.currentNamespace}()),B=Ps(M);return us(M,!0),fy(C,P,M),32!=(32&M.flags)&&zr(h,l,P,M),0===function bp(){return rn.lFrame.elementDepthCount}()&&Di(P,l),function um(){rn.lFrame.elementDepthCount++}(),B&&(_h(h,l,M),Bg(h,M,l)),null!==r&&yh(l,M),ke}function Ve(){let t=fi();Vu()?function Tc(){rn.lFrame.isParent=!1}():(t=t.parent,us(t,!1));const n=t;!function Bo(){rn.lFrame.elementDepthCount--}();const e=En();return e.firstCreatePass&&(We(e,t),Iu(t)&&e.queries.elementEnd(t)),null!=n.classesWithoutHost&&function _t(t){return 0!=(8&t.flags)}(n)&&Un(e,n,Ae(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function Dt(t){return 0!=(16&t.flags)}(n)&&Un(e,n,Ae(),n.stylesWithoutHost,!1),Ve}function St(t,n,e,r){return ke(t,n,e,r),Ve(),St}function Gt(){return Ae()}function ai(t){return!!t&&"function"==typeof t.then}const Ir=function qn(t){return!!t&&"function"==typeof t.subscribe};function ft(t,n,e,r){const l=Ae(),h=En(),_=fi();return function jr(t,n,e,r,l,h,_){const C=Ps(r),P=t.firstCreatePass&&Af(t),B=n[Ai],G=Kc(n);let ie=!0;if(3&r.type||_){const Le=Ri(r,n),qe=_?_(Le):Le,tt=G.length,bt=_?Xt=>_(Zi(Xt[r.index])):r.index;let Je=null;if(!_&&C&&(Je=function Ji(t,n,e,r){const l=t.cleanup;if(null!=l)for(let h=0;h<l.length-1;h+=2){const _=l[h];if(_===e&&l[h+1]===r){const C=n[as],M=l[h+2];return C.length>M?C[M]:null}"string"==typeof _&&(h+=2)}return null}(t,n,l,r.index)),null!==Je)(Je.__ngLastListenerFn__||Je).__ngNextListenerFn__=h,Je.__ngLastListenerFn__=h,ie=!1;else{h=xs(r,n,B,h,!1);const Xt=e.listen(qe,l,h);G.push(h,Xt),P&&P.push(l,bt,tt,tt+1)}}else h=xs(r,n,B,h,!1);const ue=r.outputs;let ve;if(ie&&null!==ue&&(ve=ue[l])){const Le=ve.length;if(Le)for(let qe=0;qe<Le;qe+=2){const _i=n[ve[qe]][ve[qe+1]].subscribe(h),pr=G.length;G.push(h,_i),P&&P.push(l,r.index,pr,-(pr+1))}}}(h,l,l[en],_,t,n,r),ft}function Ui(t,n,e,r){try{return xr(6,n,e),!1!==e(r)}catch(l){return Hs(t,l),!1}finally{xr(7,n,e)}}function xs(t,n,e,r,l){return function h(_){if(_===Function)return r;Fd(t.componentOffset>-1?Fr(t.index,n):n);let M=Ui(n,e,r,_),P=h.__ngNextListenerFn__;for(;P;)M=Ui(n,e,P,_)&&M,P=P.__ngNextListenerFn__;return l&&!1===M&&(_.preventDefault(),_.returnValue=!1),M}}function Ot(t=1){return function ee(t){return(rn.lFrame.contextLView=function V(t,n){for(;t>0;)n=n[Ml],t--;return n}(t,rn.lFrame.contextLView))[Ai]}(t)}function Yc(t,n,e){return wf(t,"",n,"",e),Yc}function wf(t,n,e,r,l){const h=Ae(),_=Re(h,n,e,r);return _!==dn&&qo(En(),te(),h,t,_,h[en],l,!1),wf}function Ws(t,n){return t<<17|n<<2}function Ca(t){return t>>17&32767}function Qr(t){return 2|t}function Zs(t){return(131068&t)>>2}function Gd(t,n){return-131069&t|n<<2}function il(t){return 1|t}function Fw(t,n,e,r,l){const h=t[e+1],_=null===n;let C=r?Ca(h):Zs(h),M=!1;for(;0!==C&&(!1===M||_);){const B=t[C+1];fD(t[C],n)&&(M=!0,t[C+1]=r?il(B):Qr(B)),C=r?Ca(B):Zs(B)}M&&(t[e+1]=r?Qr(h):il(h))}function fD(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&Ll(t,n)>=0}function Df(t,n,e){return rl(t,n,e,!1),Df}function Sf(t,n){return rl(t,n,null,!0),Sf}function rl(t,n,e,r){const l=Ae(),h=En(),_=Zr(2);h.firstUpdatePass&&function Gw(t,n,e,r){const l=t.data;if(null===l[e+1]){const h=l[W()],_=function Uw(t,n){return n>=t.expandoStartIndex}(t,e);(function Ww(t,n){return 0!=(t.flags&(n?8:16))})(h,r)&&null===n&&!_&&(n=!1),n=function wD(t,n,e,r){const l=function b(t){const n=rn.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let h=r?n.residualClasses:n.residualStyles;if(null===l)0===(r?n.classBindings:n.styleBindings)&&(e=Qg(e=Y0(null,t,n,e,r),n.attrs,r),h=null);else{const _=n.directiveStylingLast;if(-1===_||t[_]!==l)if(e=Y0(l,t,n,e,r),null===h){let M=function CD(t,n,e){const r=e?n.classBindings:n.styleBindings;if(0!==Zs(r))return t[Ca(r)]}(t,n,r);void 0!==M&&Array.isArray(M)&&(M=Y0(null,t,n,M[1],r),M=Qg(M,n.attrs,r),function ED(t,n,e,r){t[Ca(e?n.classBindings:n.styleBindings)]=r}(t,n,r,M))}else h=function ID(t,n,e){let r;const l=n.directiveEnd;for(let h=1+n.directiveStylingLast;h<l;h++)r=Qg(r,t[h].hostAttrs,e);return Qg(r,n.attrs,e)}(t,n,r)}return void 0!==h&&(r?n.residualClasses=h:n.residualStyles=h),e}(l,h,n,r),function dD(t,n,e,r,l,h){let _=h?n.classBindings:n.styleBindings,C=Ca(_),M=Zs(_);t[r]=e;let B,P=!1;if(Array.isArray(e)?(B=e[1],(null===B||Ll(e,B)>0)&&(P=!0)):B=e,l)if(0!==M){const ie=Ca(t[C+1]);t[r+1]=Ws(ie,C),0!==ie&&(t[ie+1]=Gd(t[ie+1],r)),t[C+1]=function wo(t,n){return 131071&t|n<<17}(t[C+1],r)}else t[r+1]=Ws(C,0),0!==C&&(t[C+1]=Gd(t[C+1],r)),C=r;else t[r+1]=Ws(M,0),0===C?C=r:t[M+1]=Gd(t[M+1],r),M=r;P&&(t[r+1]=Qr(t[r+1])),Fw(t,B,r,!0),Fw(t,B,r,!1),function pD(t,n,e,r,l){const h=l?t.residualClasses:t.residualStyles;null!=h&&"string"==typeof n&&Ll(h,n)>=0&&(e[r+1]=il(e[r+1]))}(n,B,t,r,h),_=Ws(C,M),h?n.classBindings=_:n.styleBindings=_}(l,h,n,e,_,r)}}(h,t,_,r),n!==dn&&Y(l,_,n)&&function $w(t,n,e,r,l,h,_,C){if(!(3&n.type))return;const M=t.data,P=M[C+1],B=function _v(t){return 1==(1&t)}(P)?qw(M,n,e,l,Zs(P),_):void 0;yv(B)||(yv(h)||function K0(t){return 2==(2&t)}(P)&&(h=qw(M,null,e,l,C,_)),function Ad(t,n,e,r,l){if(n)l?t.addClass(e,r):t.removeClass(e,r);else{let h=-1===r.indexOf("-")?void 0:ar.DashCase;null==l?t.removeStyle(e,r,h):("string"==typeof l&&l.endsWith("!important")&&(l=l.slice(0,-10),h|=ar.Important),t.setStyle(e,r,l,h))}}(r,_,Ic(W(),e),l,h))}(h,h.data[W()],l,l[en],t,l[_+1]=function DD(t,n){return null==t||""===t||("string"==typeof n?t+=n:"object"==typeof t&&(t=Ke(vo(t)))),t}(n,e),r,_)}function Y0(t,n,e,r,l){let h=null;const _=e.directiveEnd;let C=e.directiveStylingLast;for(-1===C?C=e.directiveStart:C++;C<_&&(h=n[C],r=Qg(r,h.hostAttrs,l),h!==t);)C++;return null!==t&&(e.directiveStylingLast=C),r}function Qg(t,n,e){const r=e?1:2;let l=-1;if(null!==n)for(let h=0;h<n.length;h++){const _=n[h];"number"==typeof _?l=_:l===r&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),_o(t,_,!!e||n[++h]))}return void 0===t?null:t}function qw(t,n,e,r,l,h){const _=null===n;let C;for(;l>0;){const M=t[l],P=Array.isArray(M),B=P?M[1]:M,G=null===B;let ie=e[l+1];ie===dn&&(ie=G?bn:void 0);let ue=G?fm(ie,r):B===r?ie:void 0;if(P&&!yv(ue)&&(ue=fm(M,r)),yv(ue)&&(C=ue,_))return C;const ve=t[l+1];l=_?Ca(ve):Zs(ve)}if(null!==n){let M=h?n.residualClasses:n.residualStyles;null!=M&&(C=fm(M,r))}return C}function yv(t){return void 0!==t}function At(t,n=""){const e=Ae(),r=En(),l=t+On,h=r.firstCreatePass?Xc(r,l,1,n,null):r.data[l],_=e[l]=function nh(t,n){return t.createText(n)}(e[en],n);zr(r,e,_,h),us(h,!1)}function Jc(t){return ro("",t,""),Jc}function ro(t,n,e){const r=Ae(),l=Re(r,t,n,e);return l!==dn&&$s(r,W(),l),ro}function vv(t,n,e,r,l){const h=Ae(),_=$e(h,t,n,e,r,l);return _!==dn&&$s(h,W(),_),vv}const Pf="en-US";let m1=Pf;function tx(t,n,e,r,l){if(t=kt(t),Array.isArray(t))for(let h=0;h<t.length;h++)tx(t[h],n,e,r,l);else{const h=En(),_=Ae();let C=Ul(t)?t:kt(t.provide),M=Uc(t);const P=fi(),B=1048575&P.providerIndexes,G=P.directiveStart,ie=P.providerIndexes>>20;if(Ul(t)||!t.multi){const ue=new Qe(M,l,He),ve=ix(C,n,l?B:B+ie,G);-1===ve?(Rs(hs(P,_),h,C),nx(h,t,n.length),n.push(C),P.directiveStart++,P.directiveEnd++,l&&(P.providerIndexes+=1048576),e.push(ue),_.push(ue)):(e[ve]=ue,_[ve]=ue)}else{const ue=ix(C,n,B+ie,G),ve=ix(C,n,B,B+ie),qe=ve>=0&&e[ve];if(l&&!qe||!l&&!(ue>=0&&e[ue])){Rs(hs(P,_),h,C);const tt=function WS(t,n,e,r,l){const h=new Qe(t,e,He);return h.multi=[],h.index=n,h.componentProviders=0,V1(h,l,r&&!e),h}(l?qS:$S,e.length,l,r,M);!l&&qe&&(e[ve].providerFactory=tt),nx(h,t,n.length,0),n.push(C),P.directiveStart++,P.directiveEnd++,l&&(P.providerIndexes+=1048576),e.push(tt),_.push(tt)}else nx(h,t,ue>-1?ue:ve,V1(e[l?ve:ue],M,!l&&r));!l&&r&&qe&&e[ve].componentProviders++}}}function nx(t,n,e,r){const l=Ul(n),h=function b0(t){return!!t.useClass}(n);if(l||h){const M=(h?kt(n.useClass):n).prototype.ngOnDestroy;if(M){const P=t.destroyHooks||(t.destroyHooks=[]);if(!l&&n.multi){const B=P.indexOf(e);-1===B?P.push(e,[r,M]):P[B+1].push(r,M)}else P.push(e,M)}}}function V1(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function ix(t,n,e,r){for(let l=e;l<r;l++)if(n[l]===t)return l;return-1}function $S(t,n,e,r){return rx(this.multi,[])}function qS(t,n,e,r){const l=this.multi;let h;if(this.providerFactory){const _=this.providerFactory.componentProviders,C=pa(e,e[xt],this.providerFactory.index,r);h=C.slice(0,_),rx(l,h);for(let M=_;M<C.length;M++)h.push(C[M])}else h=[],rx(l,h);return h}function rx(t,n){for(let e=0;e<t.length;e++)n.push((0,t[e])());return n}function Fi(t,n=[]){return e=>{e.providersResolver=(r,l)=>function HS(t,n,e){const r=En();if(r.firstCreatePass){const l=fo(t);tx(e,r.data,r.blueprint,l,!0),tx(n,r.data,r.blueprint,l,!1)}}(r,l?l(t):t,n)}}class Rf{}class j1{}class U1 extends Rf{constructor(n,e){super(),this._parent=e,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new bh(this);const r=qr(n);this._bootstrapComponents=Vs(r.bootstrap),this._r3Injector=Sd(n,e,[{provide:Rf,useValue:this},{provide:hh,useValue:this.componentFactoryResolver}],Ke(n),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(n)}get injector(){return this._r3Injector}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class ox extends j1{constructor(n){super(),this.moduleType=n}create(n){return new U1(this.moduleType,n)}}class QS extends Rf{constructor(n,e,r){super(),this.componentFactoryResolver=new bh(this),this.instance=null;const l=new Xi([...n,{provide:Rf,useValue:this},{provide:hh,useValue:this.componentFactoryResolver}],e||Id(),r,new Set(["environment"]));this.injector=l,l.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}}function Cv(t,n,e=null){return new QS(t,n,e).injector}let XS=(()=>{class t{constructor(e){this._injector=e,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e.id)){const r=wy(0,e.type),l=r.length>0?Cv([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e.id,l)}return this.cachedInjectors.get(e.id)}ngOnDestroy(){try{for(const e of this.cachedInjectors.values())null!==e&&e.destroy()}finally{this.cachedInjectors.clear()}}}return t.\u0275prov=Mt({token:t,providedIn:"environment",factory:()=>new t(mt(xa))}),t})();function G1(t){t.getStandaloneInjector=n=>n.get(XS).getOrCreateStandaloneInjector(t)}function Ev(t,n,e){const r=Lr()+t,l=Ae();return l[r]===dn?J(l,r,e?n.call(e):n()):function se(t,n){return t[n]}(l,r)}function Qs(t,n,e,r){return function X1(t,n,e,r,l,h){const _=n+e;return Y(t,_,l)?J(t,_+1,h?r.call(h,l):r(l)):t_(t,_+1)}(Ae(),Lr(),t,n,e,r)}function eu(t,n,e,r,l){return function K1(t,n,e,r,l,h,_){const C=n+e;return oe(t,C,l,h)?J(t,C+2,_?r.call(_,l,h):r(l,h)):t_(t,C+2)}(Ae(),Lr(),t,n,e,r,l)}function Iv(t,n,e,r,l,h){return function Y1(t,n,e,r,l,h,_,C){const M=n+e;return function ce(t,n,e,r,l){const h=oe(t,n,e,r);return Y(t,n+2,l)||h}(t,M,l,h,_)?J(t,M+3,C?r.call(C,l,h,_):r(l,h,_)):t_(t,M+3)}(Ae(),Lr(),t,n,e,r,l,h)}function t_(t,n){const e=t[n];return e===dn?void 0:e}function ax(t){return n=>{setTimeout(t,void 0,n)}}const ii=class y2 extends nr{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,e,r){let l=n,h=e||(()=>null),_=r;if(n&&"object"==typeof n){const M=n;l=M.next?.bind(M),h=M.error?.bind(M),_=M.complete?.bind(M)}this.__isAsync&&(h=ax(h),l&&(l=ax(l)),_&&(_=ax(_)));const C=super.subscribe({next:l,error:h,complete:_});return n instanceof je&&n.add(C),C}};function v2(){return this._results[Symbol.iterator]()}class lx{get changes(){return this._changes||(this._changes=new ii)}constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=lx.prototype;e[Symbol.iterator]||(e[Symbol.iterator]=v2)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){const r=this;r.dirty=!1;const l=function Uo(t){return t.flat(Number.POSITIVE_INFINITY)}(n);(this._changesDetected=!function $_(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let l=t[r],h=n[r];if(e&&(l=e(l),h=e(h)),h!==l)return!1}return!0}(r._results,l,e))&&(r._results=l,r.length=l.length,r.last=l[this.length-1],r.first=l[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let tu=(()=>{class t{}return t.__NG_ELEMENT_ID__=b2,t})();const A2=tu,x2=class extends A2{constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}createEmbeddedView(n,e){const r=this._declarationTContainer.tView,l=pf(this._declarationLView,r,n,16,null,r.declTNode,null,null,null,null,e||null);l[Tl]=this._declarationLView[this._declarationTContainer.index];const _=this._declarationLView[Rr];return null!==_&&(l[Rr]=_.createEmbeddedView(r)),Lg(r,l,n),new xh(l)}};function b2(){return Mv(fi(),Ae())}function Mv(t,n){return 4&t.type?new x2(n,t,zs(t,n)):null}let sl=(()=>{class t{}return t.__NG_ELEMENT_ID__=w2,t})();function w2(){return iC(fi(),Ae())}const C2=sl,tC=class extends C2{constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return zs(this._hostTNode,this._hostLView)}get injector(){return new go(this._hostTNode,this._hostLView)}get parentInjector(){const n=ps(this._hostTNode,this._hostLView);if(or(n)){const e=to(n,this._hostLView),r=Ti(n);return new go(e[xt].data[r+8],e)}return new go(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const e=nC(this._lContainer);return null!==e&&e[n]||null}get length(){return this._lContainer.length-Wi}createEmbeddedView(n,e,r){let l,h;"number"==typeof r?l=r:null!=r&&(l=r.index,h=r.injector);const _=n.createEmbeddedView(e||{},h);return this.insert(_,l),_}createComponent(n,e,r,l,h){const _=n&&!function Cr(t){return"function"==typeof t}(n);let C;if(_)C=e;else{const G=e||{};C=G.index,r=G.injector,l=G.projectableNodes,h=G.environmentInjector||G.ngModuleRef}const M=_?n:new Nd(mn(n)),P=r||this.parentInjector;if(!h&&null==M.ngModule){const ie=(_?P:this.parentInjector).get(xa,null);ie&&(h=ie)}const B=M.create(P,l,void 0,h);return this.insert(B.hostView,C),B}insert(n,e){const r=n._lView,l=r[xt];if(function vp(t){return Or(t[ci])}(r)){const B=this.indexOf(n);if(-1!==B)this.detach(B);else{const G=r[ci],ie=new tC(G,G[rr],G[ci]);ie.detach(ie.indexOf(n))}}const h=this._adjustIndex(e),_=this._lContainer;!function Pm(t,n,e,r){const l=Wi+r,h=e.length;r>0&&(e[l-1][Oo]=n),r<h-Wi?(n[Oo]=e[l],Dp(e,Wi+r,n)):(e.push(n),n[Oo]=null),n[ci]=e;const _=n[Tl];null!==_&&e!==_&&function hy(t,n){const e=t[Fo];n[Ar]!==n[ci][ci][Ar]&&(t[Sl]=!0),null===e?t[Fo]=[n]:e.push(n)}(_,n);const C=n[Rr];null!==C&&C.insertView(t),n[un]|=64}(l,r,_,h);const C=Um(h,_),M=r[en],P=Up(M,_[bc]);return null!==P&&function e0(t,n,e,r,l,h){r[po]=l,r[rr]=n,Bc(t,r,e,1,l,h)}(l,_[rr],M,r,P,C),n.attachToViewContainerRef(),Dp(cx(_),h,n),n}move(n,e){return this.insert(n,e)}indexOf(n){const e=nC(this._lContainer);return null!==e?e.indexOf(n):-1}remove(n){const e=this._adjustIndex(n,-1),r=Ka(this._lContainer,e);r&&(_a(cx(this._lContainer),e),Om(r[xt],r))}detach(n){const e=this._adjustIndex(n,-1),r=Ka(this._lContainer,e);return r&&null!=_a(cx(this._lContainer),e)?new xh(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function nC(t){return t[ls]}function cx(t){return t[ls]||(t[ls]=[])}function iC(t,n){let e;const r=n[t.index];if(Or(r))e=r;else{let l;if(8&t.type)l=Zi(r);else{const h=n[en];l=h.createComment("");const _=Ri(t,n);Lc(h,Up(h,_),l,function o0(t,n){return t.nextSibling(n)}(h,_),!1)}n[t.index]=e=Hg(r,n,l,t),Gs(n,e)}return new tC(e,t,n)}class ux{constructor(n){this.queryList=n,this.matches=null}clone(){return new ux(this.queryList)}setDirty(){this.queryList.setDirty()}}class hx{constructor(n=[]){this.queries=n}createEmbeddedView(n){const e=n.queries;if(null!==e){const r=null!==n.contentQueries?n.contentQueries[0]:e.length,l=[];for(let h=0;h<r;h++){const _=e.getByIndex(h);l.push(this.queries[_.indexInDeclarationView].clone())}return new hx(l)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)null!==cC(n,e).matches&&this.queries[e].setDirty()}}class rC{constructor(n,e,r=null){this.predicate=n,this.flags=e,this.read=r}}class dx{constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){const l=null!==e?e.length:0,h=this.getByIndex(r).embeddedTView(n,l);h&&(h.indexInDeclarationView=r,null!==e?e.push(h):e=[h])}return null!==e?new dx(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class px{constructor(n,e=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new px(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let r=n.parent;for(;null!==r&&8&r.type&&r.index!==e;)r=r.parent;return e===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){const r=this.metadata.predicate;if(Array.isArray(r))for(let l=0;l<r.length;l++){const h=r[l];this.matchTNodeWithReadOption(n,e,E2(e,h)),this.matchTNodeWithReadOption(n,e,$u(e,n,h,!1,!1))}else r===tu?4&e.type&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,$u(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(null!==r){const l=this.metadata.read;if(null!==l)if(l===Vr||l===sl||l===tu&&4&e.type)this.addMatch(e.index,-2);else{const h=$u(e,n,l,!1,!1);null!==h&&this.addMatch(e.index,h)}else this.addMatch(e.index,r)}}addMatch(n,e){null===this.matches?this.matches=[n,e]:this.matches.push(n,e)}}function E2(t,n){const e=t.localNames;if(null!==e)for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1];return null}function M2(t,n,e,r){return-1===e?function I2(t,n){return 11&t.type?zs(t,n):4&t.type?Mv(t,n):null}(n,t):-2===e?function T2(t,n,e){return e===Vr?zs(n,t):e===tu?Mv(n,t):e===sl?iC(n,t):void 0}(t,n,r):pa(t,t[xt],e,n)}function oC(t,n,e,r){const l=n[Rr].queries[r];if(null===l.matches){const h=t.data,_=e.matches,C=[];for(let M=0;M<_.length;M+=2){const P=_[M];C.push(P<0?null:M2(n,h[P],_[M+1],e.metadata.read))}l.matches=C}return l.matches}function fx(t,n,e,r){const l=t.queries.getByIndex(e),h=l.matches;if(null!==h){const _=oC(t,n,l,e);for(let C=0;C<h.length;C+=2){const M=h[C];if(M>0)r.push(_[C/2]);else{const P=h[C+1],B=n[-M];for(let G=Wi;G<B.length;G++){const ie=B[G];ie[Tl]===ie[ci]&&fx(ie[xt],ie,P,r)}if(null!==B[Fo]){const G=B[Fo];for(let ie=0;ie<G.length;ie++){const ue=G[ie];fx(ue[xt],ue,P,r)}}}}}return r}function wh(t){const n=Ae(),e=En(),r=I();T(r+1);const l=cC(e,r);if(t.dirty&&function cd(t){return 4==(4&t[un])}(n)===(2==(2&l.metadata.flags))){if(null===l.matches)t.reset([]);else{const h=l.crossesNgTemplate?fx(e,n,r,[]):oC(e,n,l,r);t.reset(h,I0),t.notifyOnChanges()}return!0}return!1}function $d(t,n,e){const r=En();r.firstCreatePass&&(function lC(t,n,e){null===t.queries&&(t.queries=new dx),t.queries.track(new px(n,e))}(r,new rC(t,n,e),-1),2==(2&n)&&(r.staticViewQueries=!0)),function aC(t,n,e){const r=new lx(4==(4&e));nl(t,n,r,r.destroy),null===n[Rr]&&(n[Rr]=new hx),n[Rr].queries.push(new ux(r))}(r,Ae(),n)}function Ch(){return function D2(t,n){return t[Rr].queries[n].queryList}(Ae(),I())}function cC(t,n){return t.queries.getByIndex(n)}function Dv(...t){}const Sv=new vt("Application Initializer");let kv=(()=>{class t{constructor(e){this.appInits=e,this.resolve=Dv,this.reject=Dv,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,l)=>{this.resolve=r,this.reject=l})}runInitializers(){if(this.initialized)return;const e=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let l=0;l<this.appInits.length;l++){const h=this.appInits[l]();if(ai(h))e.push(h);else if(Ir(h)){const _=new Promise((C,M)=>{h.subscribe({complete:C,error:M})});e.push(_)}}Promise.all(e).then(()=>{r()}).catch(l=>{this.reject(l)}),0===e.length&&r(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(mt(Sv,8))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const r_=new vt("AppId",{providedIn:"root",factory:function MC(){return`${Ax()}${Ax()}${Ax()}`}});function Ax(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const TC=new vt("Platform Initializer"),o_=new vt("Platform ID",{providedIn:"platform",factory:()=>"unknown"});let K2=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Kl=new vt("LocaleId",{providedIn:"root",factory:()=>$t(Kl,Lt.Optional|Lt.SkipSelf)||function Y2(){return typeof $localize<"u"&&$localize.locale||Pf}()});class ek{constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}}let DC=(()=>{class t{compileModuleSync(e){return new ox(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){const r=this.compileModuleSync(e),h=Vs(qr(e).declarations).reduce((_,C)=>{const M=mn(C);return M&&_.push(new Nd(M)),_},[]);return new ek(r,h)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ik=(()=>Promise.resolve(0))();function xx(t){typeof Zone>"u"?ik.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class tr{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ii(!1),this.onMicrotaskEmpty=new ii(!1),this.onStable=new ii(!1),this.onError=new ii(!1),typeof Zone>"u")throw new rt(908,!1);Zone.assertZonePatched();const l=this;l._nesting=0,l._outer=l._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(l._inner=l._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(l._inner=l._inner.fork(Zone.longStackTraceZoneSpec)),l.shouldCoalesceEventChangeDetection=!r&&e,l.shouldCoalesceRunChangeDetection=r,l.lastRequestAnimationFrameId=-1,l.nativeRequestAnimationFrame=function rk(){let t=ei.requestAnimationFrame,n=ei.cancelAnimationFrame;if(typeof Zone<"u"&&t&&n){const e=t[Zone.__symbol__("OriginalDelegate")];e&&(t=e);const r=n[Zone.__symbol__("OriginalDelegate")];r&&(n=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function ak(t){const n=()=>{!function sk(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(ei,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,wx(t),t.isCheckStableRunning=!0,bx(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),wx(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(e,r,l,h,_,C)=>{try{return PC(t),e.invokeTask(l,h,_,C)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===h.type||t.shouldCoalesceRunChangeDetection)&&n(),RC(t)}},onInvoke:(e,r,l,h,_,C,M)=>{try{return PC(t),e.invoke(l,h,_,C,M)}finally{t.shouldCoalesceRunChangeDetection&&n(),RC(t)}},onHasTask:(e,r,l,h)=>{e.hasTask(l,h),r===l&&("microTask"==h.change?(t._hasPendingMicrotasks=h.microTask,wx(t),bx(t)):"macroTask"==h.change&&(t.hasPendingMacrotasks=h.macroTask))},onHandleError:(e,r,l,h)=>(e.handleError(l,h),t.runOutsideAngular(()=>t.onError.emit(h)),!1)})}(l)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!tr.isInAngularZone())throw new rt(909,!1)}static assertNotInAngularZone(){if(tr.isInAngularZone())throw new rt(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,l){const h=this._inner,_=h.scheduleEventTask("NgZoneEvent: "+l,n,ok,Dv,Dv);try{return h.runTask(_,e,r)}finally{h.cancelTask(_)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}}const ok={};function bx(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function wx(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function PC(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function RC(t){t._nesting--,bx(t)}class lk{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ii,this.onMicrotaskEmpty=new ii,this.onStable=new ii,this.onError=new ii}run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,l){return n.apply(e,r)}}const OC=new vt(""),Pv=new vt("");let Ix,Cx=(()=>{class t{constructor(e,r,l){this._ngZone=e,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ix||(function ck(t){Ix=t}(l),l.addToWindow(r)),this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{tr.assertNotInAngularZone(),xx(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())xx(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(e)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,r,l){let h=-1;r&&r>0&&(h=setTimeout(()=>{this._callbacks=this._callbacks.filter(_=>_.timeoutId!==h),e(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:e,timeoutId:h,updateCb:l})}whenStable(e,r,l){if(l&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,r,l),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(e){this.registry.registerApplication(e,this)}unregisterApplication(e){this.registry.unregisterApplication(e)}findProviders(e,r,l){return[]}}return t.\u0275fac=function(e){return new(e||t)(mt(tr),mt(Ex),mt(Pv))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})(),Ex=(()=>{class t{constructor(){this._applications=new Map}registerApplication(e,r){this._applications.set(e,r)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,r=!0){return Ix?.findTestabilityInTree(this,e,r)??null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const nu=!1;let Eh=null;const FC=new vt("AllowMultipleToken"),Mx=new vt("PlatformDestroyListeners"),LC=new vt("appBootstrapListener");class BC{constructor(n,e){this.name=n,this.token=e}}function zC(t,n,e=[]){const r=`Platform: ${n}`,l=new vt(r);return(h=[])=>{let _=Tx();if(!_||_.injector.get(FC,!1)){const C=[...e,...h,{provide:l,useValue:!0}];t?t(C):function dk(t){if(Eh&&!Eh.get(FC,!1))throw new rt(400,!1);Eh=t;const n=t.get(jC);(function NC(t){const n=t.get(TC,null);n&&n.forEach(e=>e())})(t)}(function VC(t=[],n){return xo.create({name:n,providers:[{provide:pg,useValue:"platform"},{provide:Mx,useValue:new Set([()=>Eh=null])},...t]})}(C,r))}return function fk(t){const n=Tx();if(!n)throw new rt(401,!1);return n}()}}function Tx(){return Eh?.get(jC)??null}let jC=(()=>{class t{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,r){const l=function GC(t,n){let e;return e="noop"===t?new lk:("zone.js"===t?void 0:t)||new tr(n),e}(r?.ngZone,function UC(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!t||!t.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!t||!t.ngZoneRunCoalescing)||!1}}(r)),h=[{provide:tr,useValue:l}];return l.run(()=>{const _=xo.create({providers:h,parent:this.injector,name:e.moduleType.name}),C=e.create(_),M=C.injector.get(el,null);if(!M)throw new rt(402,!1);return l.runOutsideAngular(()=>{const P=l.onError.subscribe({next:B=>{M.handleError(B)}});C.onDestroy(()=>{Ov(this._modules,C),P.unsubscribe()})}),function HC(t,n,e){try{const r=e();return ai(r)?r.catch(l=>{throw n.runOutsideAngular(()=>t.handleError(l)),l}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}(M,l,()=>{const P=C.injector.get(kv);return P.runInitializers(),P.donePromise.then(()=>(function g1(t){mr(t,"Expected localeId to be defined"),"string"==typeof t&&(m1=t.toLowerCase().replace(/_/g,"-"))}(C.injector.get(Kl,Pf)||Pf),this._moduleDoBootstrap(C),C))})})}bootstrapModule(e,r=[]){const l=$C({},r);return function uk(t,n,e){const r=new ox(e);return Promise.resolve(r)}(0,0,e).then(h=>this.bootstrapModuleFactory(h,l))}_moduleDoBootstrap(e){const r=e.injector.get(Rv);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(l=>r.bootstrap(l));else{if(!e.instance.ngDoBootstrap)throw new rt(-403,!1);e.instance.ngDoBootstrap(r)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new rt(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const e=this._injector.get(Mx,null);e&&(e.forEach(r=>r()),e.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(mt(xo))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function $C(t,n){return Array.isArray(n)?n.reduce($C,t):{...t,...n}}let Rv=(()=>{class t{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(e,r,l){this._zone=e,this._injector=r,this._exceptionHandler=l,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const h=new pn(C=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{C.next(this._stable),C.complete()})}),_=new pn(C=>{let M;this._zone.runOutsideAngular(()=>{M=this._zone.onStable.subscribe(()=>{tr.assertNotInAngularZone(),xx(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,C.next(!0))})})});const P=this._zone.onUnstable.subscribe(()=>{tr.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{C.next(!1)}))});return()=>{M.unsubscribe(),P.unsubscribe()}});this.isStable=function rp(...t){const n=ra(t),e=function es(t,n){return"number"==typeof Fa(t)?t.pop():n}(t,1/0),r=t;return r.length?1===r.length?Rt(r[0]):Do(e)(An(r,n)):Jo}(h,_.pipe(function So(t={}){const{connector:n=(()=>new nr),resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:l=!0}=t;return h=>{let _,C,M,P=0,B=!1,G=!1;const ie=()=>{C?.unsubscribe(),C=void 0},ue=()=>{ie(),_=M=void 0,B=G=!1},ve=()=>{const Le=_;ue(),Le?.unsubscribe()};return hi((Le,qe)=>{P++,!G&&!B&&ie();const tt=M=M??n();qe.add(()=>{P--,0===P&&!G&&!B&&(C=uc(ve,l))}),tt.subscribe(qe),!_&&P>0&&(_=new Da({next:bt=>tt.next(bt),error:bt=>{G=!0,ie(),C=uc(ue,e,bt),tt.error(bt)},complete:()=>{B=!0,ie(),C=uc(ue,r),tt.complete()}}),Rt(Le).subscribe(_))})(h)}}()))}bootstrap(e,r){const l=e instanceof _g;if(!this._injector.get(kv).done){!l&&function Ds(t){const n=mn(t)||zi(t)||vr(t);return null!==n&&n.standalone}(e);throw new rt(405,nu)}let _;_=l?e:this._injector.get(hh).resolveComponentFactory(e),this.componentTypes.push(_.componentType);const C=function hk(t){return t.isBoundToModule}(_)?void 0:this._injector.get(Rf),P=_.create(xo.NULL,[],r||_.selector,C),B=P.location.nativeElement,G=P.injector.get(OC,null);return G?.registerApplication(B),P.onDestroy(()=>{this.detachView(P.hostView),Ov(this.components,P),G?.unregisterApplication(B)}),this._loadComponent(P),P}tick(){if(this._runningTick)throw new rt(101,!1);try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){const r=e;Ov(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e);const r=this._injector.get(LC,[]);r.push(...this._bootstrapListeners),r.forEach(l=>l(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Ov(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new rt(406,!1);const e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return t.\u0275fac=function(e){return new(e||t)(mt(tr),mt(xa),mt(el))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Ov(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}let Lf=(()=>{class t{}return t.__NG_ELEMENT_ID__=gk,t})();function gk(t){return function _k(t,n,e){if(ca(t)&&!e){const r=Fr(t.index,n);return new xh(r,r)}return 47&t.type?new xh(n[Ar],n):null}(fi(),Ae(),16==(16&t))}class XC{constructor(){}supports(n){return R(n)}create(n){return new wk(n)}}const bk=(t,n)=>n;class wk{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||bk}forEachItem(n){let e;for(e=this._itHead;null!==e;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,l=0,h=null;for(;e||r;){const _=!r||e&&e.currentIndex<YC(r,l,h)?e:r,C=YC(_,l,h),M=_.currentIndex;if(_===r)l--,r=r._nextRemoved;else if(e=e._next,null==_.previousIndex)l++;else{h||(h=[]);const P=C-l,B=M-l;if(P!=B){for(let ie=0;ie<P;ie++){const ue=ie<h.length?h[ie]:h[ie]=0,ve=ue+ie;B<=ve&&ve<P&&(h[ie]=ue+1)}h[_.previousIndex]=B-P}}C!==M&&n(_,C,M)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)n(e)}diff(n){if(null==n&&(n=[]),!R(n))throw new rt(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let l,h,_,e=this._itHead,r=!1;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)h=n[C],_=this._trackByFn(C,h),null!==e&&Object.is(e.trackById,_)?(r&&(e=this._verifyReinsertion(e,h,_,C)),Object.is(e.item,h)||this._addIdentityChange(e,h)):(e=this._mismatch(e,h,_,C),r=!0),e=e._next}else l=0,function N(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{const e=t[Symbol.iterator]();let r;for(;!(r=e.next()).done;)n(r.value)}}(n,C=>{_=this._trackByFn(l,C),null!==e&&Object.is(e.trackById,_)?(r&&(e=this._verifyReinsertion(e,C,_,l)),Object.is(e.item,C)||this._addIdentityChange(e,C)):(e=this._mismatch(e,C,_,l),r=!0),e=e._next,l++}),this.length=l;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,l){let h;return null===n?h=this._itTail:(h=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,h,l)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(r,l))?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,h,l)):n=this._addAfter(new Ck(e,r),h,l),n}_verifyReinsertion(n,e,r,l){let h=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==h?n=this._reinsertAfter(h,n._prev,l):n.currentIndex!=l&&(n.currentIndex=l,this._addToMoves(n,l)),n}_truncate(n){for(;null!==n;){const e=n._next;this._addToRemovals(this._unlink(n)),n=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const l=n._prevRemoved,h=n._nextRemoved;return null===l?this._removalsHead=h:l._nextRemoved=h,null===h?this._removalsTail=l:h._prevRemoved=l,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){const l=null===e?this._itHead:e._next;return n._next=l,n._prev=e,null===l?this._itTail=n:l._prev=n,null===e?this._itHead=n:e._next=n,null===this._linkedRecords&&(this._linkedRecords=new KC),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const e=n._prev,r=n._next;return null===e?this._itHead=r:e._next=r,null===r?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new KC),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class Ck{constructor(n,e){this.item=n,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Ek{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===e||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){const e=n._prevDup,r=n._nextDup;return null===e?this._head=r:e._nextDup=r,null===r?this._tail=e:r._prevDup=e,null===this._head}}class KC{constructor(){this.map=new Map}put(n){const e=n.trackById;let r=this.map.get(e);r||(r=new Ek,this.map.set(e,r)),r.add(n)}get(n,e){const l=this.map.get(n);return l?l.get(n,e):null}remove(n){const e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function YC(t,n,e){const r=t.previousIndex;if(null===r)return r;let l=0;return e&&r<e.length&&(l=e[r]),r+n+l}class JC{constructor(){}supports(n){return n instanceof Map||j(n)}create(){return new Ik}}class Ik{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let e;for(e=this._mapHead;null!==e;e=e._next)n(e)}forEachPreviousItem(n){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)n(e)}forEachChangedItem(n){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)n(e)}diff(n){if(n){if(!(n instanceof Map||j(n)))throw new rt(900,!1)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(n,(r,l)=>{if(e&&e.key===l)this._maybeAddToChanges(e,r),this._appendAfter=e,e=e._next;else{const h=this._getOrCreateRecordForKey(l,r);e=this._insertBeforeOrAppend(e,h)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let r=e;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,e){if(n){const r=n._prev;return e._next=n,e._prev=r,n._prev=e,r&&(r._next=e),n===this._mapHead&&(this._mapHead=e),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(n,e){if(this._records.has(n)){const l=this._records.get(n);this._maybeAddToChanges(l,e);const h=l._prev,_=l._next;return h&&(h._next=_),_&&(_._prev=h),l._next=null,l._prev=null,l}const r=new Mk(n);return this._records.set(n,r),r.currentValue=e,this._addToAdditions(r),r}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,e){Object.is(e,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=e,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,e){n instanceof Map?n.forEach(e):Object.keys(n).forEach(r=>e(n[r],r))}}class Mk{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function eE(){return new Bv([new XC])}let Bv=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(null!=r){const l=r.factories.slice();e=e.concat(l)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||eE()),deps:[[t,new ni,new sr]]}}find(e){const r=this.factories.find(l=>l.supports(e));if(null!=r)return r;throw new rt(901,!1)}}return t.\u0275prov=Mt({token:t,providedIn:"root",factory:eE}),t})();function tE(){return new s_([new JC])}let s_=(()=>{class t{constructor(e){this.factories=e}static create(e,r){if(r){const l=r.factories.slice();e=e.concat(l)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||tE()),deps:[[t,new ni,new sr]]}}find(e){const r=this.factories.find(l=>l.supports(e));if(r)return r;throw new rt(901,!1)}}return t.\u0275prov=Mt({token:t,providedIn:"root",factory:tE}),t})();const Sk=zC(null,"core",[]);let kk=(()=>{class t{constructor(e){}}return t.\u0275fac=function(e){return new(e||t)(mt(Rv))},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({}),t})();function Bf(t){return"boolean"==typeof t?t:null!=t&&"false"!==t}let Rx=null;function iu(){return Rx}class Ok{}const ki=new vt("DocumentToken");let Ox=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return function Fk(){return mt(nE)}()},providedIn:"platform"}),t})();const Lk=new vt("Location Initialized");let nE=(()=>{class t extends Ox{constructor(e){super(),this._doc=e,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return iu().getBaseHref(this._doc)}onPopState(e){const r=iu().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){const r=iu().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,l){iE()?this._history.pushState(e,r,l):this._location.hash=l}replaceState(e,r,l){iE()?this._history.replaceState(e,r,l):this._location.hash=l}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:function(){return function Bk(){return new nE(mt(ki))}()},providedIn:"platform"}),t})();function iE(){return!!window.history.pushState}function Fx(t,n){if(0==t.length)return n;if(0==n.length)return t;let e=0;return t.endsWith("/")&&e++,n.startsWith("/")&&e++,2==e?t+n.substring(1):1==e?t+n:t+"/"+n}function rE(t){const n=t.match(/#|\?|$/),e=n&&n.index||t.length;return t.slice(0,e-("/"===t[e-1]?1:0))+t.slice(e)}function ru(t){return t&&"?"!==t[0]?"?"+t:t}let Wd=(()=>{class t{historyGo(e){throw new Error("Not implemented")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return $t(sE)},providedIn:"root"}),t})();const oE=new vt("appBaseHref");let sE=(()=>{class t extends Wd{constructor(e,r){super(),this._platformLocation=e,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??$t(ki).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return Fx(this._baseHref,e)}path(e=!1){const r=this._platformLocation.pathname+ru(this._platformLocation.search),l=this._platformLocation.hash;return l&&e?`${r}${l}`:r}pushState(e,r,l,h){const _=this.prepareExternalUrl(l+ru(h));this._platformLocation.pushState(e,r,_)}replaceState(e,r,l,h){const _=this.prepareExternalUrl(l+ru(h));this._platformLocation.replaceState(e,r,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(mt(Ox),mt(oE,8))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Nk=(()=>{class t extends Wd{constructor(e,r){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(e){const r=Fx(this._baseHref,e);return r.length>0?"#"+r:r}pushState(e,r,l,h){let _=this.prepareExternalUrl(l+ru(h));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.pushState(e,r,_)}replaceState(e,r,l,h){let _=this.prepareExternalUrl(l+ru(h));0==_.length&&(_=this._platformLocation.pathname),this._platformLocation.replaceState(e,r,_)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}}return t.\u0275fac=function(e){return new(e||t)(mt(Ox),mt(oE,8))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})(),Lx=(()=>{class t{constructor(e){this._subject=new ii,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=e;const r=this._locationStrategy.getBaseHref();this._basePath=function jk(t){if(new RegExp("^(https?:)?//").test(t)){const[,e]=t.split(/\/\/[^\/]+/);return e}return t}(rE(aE(r))),this._locationStrategy.onPopState(l=>{this._subject.emit({url:this.path(!0),pop:!0,state:l.state,type:l.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+ru(r))}normalize(e){return t.stripTrailingSlash(function Vk(t,n){if(!t||!n.startsWith(t))return n;const e=n.substring(t.length);return""===e||["/",";","?","#"].includes(e[0])?e:n}(this._basePath,aE(e)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",l=null){this._locationStrategy.pushState(l,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ru(r)),l)}replaceState(e,r="",l=null){this._locationStrategy.replaceState(l,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ru(r)),l)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(l=>l(e,r))}subscribe(e,r,l){return this._subject.subscribe({next:e,error:r,complete:l})}}return t.normalizeQueryParams=ru,t.joinWithSlash=Fx,t.stripTrailingSlash=rE,t.\u0275fac=function(e){return new(e||t)(mt(Wd))},t.\u0275prov=Mt({token:t,factory:function(){return function zk(){return new Lx(mt(Wd))}()},providedIn:"root"}),t})();function aE(t){return t.replace(/\/index.html$/,"")}function gE(t,n){n=encodeURIComponent(n);for(const e of t.split(";")){const r=e.indexOf("="),[l,h]=-1==r?[e,""]:[e.slice(0,r),e.slice(r+1)];if(l.trim()===n)return decodeURIComponent(h)}return null}const qx=/\s+/,_E=[];let Nf=(()=>{class t{constructor(e,r,l,h){this._iterableDiffers=e,this._keyValueDiffers=r,this._ngEl=l,this._renderer=h,this.initialClasses=_E,this.stateMap=new Map}set klass(e){this.initialClasses=null!=e?e.trim().split(qx):_E}set ngClass(e){this.rawClass="string"==typeof e?e.trim().split(qx):e}ngDoCheck(){for(const r of this.initialClasses)this._updateState(r,!0);const e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(const r of e)this._updateState(r,!0);else if(null!=e)for(const r of Object.keys(e))this._updateState(r,Boolean(e[r]));this._applyStateDiff()}_updateState(e,r){const l=this.stateMap.get(e);void 0!==l?(l.enabled!==r&&(l.changed=!0,l.enabled=r),l.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(const e of this.stateMap){const r=e[0],l=e[1];l.changed?(this._toggleClass(r,l.enabled),l.changed=!1):l.touched||(l.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),l.touched=!1}}_toggleClass(e,r){(e=e.trim()).length>0&&e.split(qx).forEach(l=>{r?this._renderer.addClass(this._ngEl.nativeElement,l):this._renderer.removeClass(this._ngEl.nativeElement,l)})}}return t.\u0275fac=function(e){return new(e||t)(He(Bv),He(s_),He(Vr),He(Ja))},t.\u0275dir=Bt({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),t})();class EP{constructor(n,e,r,l){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=l}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let c_=(()=>{class t{set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}constructor(e,r,l){this._viewContainer=e,this._template=r,this._differs=l,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const r=this._viewContainer;e.forEachOperation((l,h,_)=>{if(null==l.previousIndex)r.createEmbeddedView(this._template,new EP(l.item,this._ngForOf,-1,-1),null===_?void 0:_);else if(null==_)r.remove(null===h?void 0:h);else if(null!==h){const C=r.get(h);r.move(C,_),AE(C,l)}});for(let l=0,h=r.length;l<h;l++){const C=r.get(l).context;C.index=l,C.count=h,C.ngForOf=this._ngForOf}e.forEachIdentityChange(l=>{AE(r.get(l.currentIndex),l)})}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(He(sl),He(tu),He(Bv))},t.\u0275dir=Bt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),t})();function AE(t,n){t.context.$implicit=n.item}let Zd=(()=>{class t{constructor(e,r){this._viewContainer=e,this._context=new MP,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){xE("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){xE("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,r){return!0}}return t.\u0275fac=function(e){return new(e||t)(He(sl),He(tu))},t.\u0275dir=Bt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class MP{constructor(){this.$implicit=null,this.ngIf=null}}function xE(t,n){if(n&&!n.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Ke(n)}'.`)}let Qx=(()=>{class t{constructor(e,r,l){this._ngEl=e,this._differs=r,this._renderer=l,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,r){const[l,h]=e.split("."),_=-1===l.indexOf("-")?void 0:ar.DashCase;null!=r?this._renderer.setStyle(this._ngEl.nativeElement,l,h?`${r}${h}`:r,_):this._renderer.removeStyle(this._ngEl.nativeElement,l,_)}_applyChanges(e){e.forEachRemovedItem(r=>this._setStyle(r.key,null)),e.forEachAddedItem(r=>this._setStyle(r.key,r.currentValue)),e.forEachChangedItem(r=>this._setStyle(r.key,r.currentValue))}}return t.\u0275fac=function(e){return new(e||t)(He(Vr),He(s_),He(Ja))},t.\u0275dir=Bt({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),t})(),CE=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({}),t})();const EE="browser";function Yx(t){return t===EE}let nR=(()=>{class t{}return t.\u0275prov=Mt({token:t,providedIn:"root",factory:()=>new iR(mt(ki),window)}),t})();class iR{constructor(n,e){this.document=n,this.window=e,this.offset=()=>[0,0]}setOffset(n){this.offset=Array.isArray(n)?()=>n:n}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(n){this.supportsScrolling()&&this.window.scrollTo(n[0],n[1])}scrollToAnchor(n){if(!this.supportsScrolling())return;const e=function rR(t,n){const e=t.getElementById(n)||t.getElementsByName(n)[0];if(e)return e;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const r=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let l=r.currentNode;for(;l;){const h=l.shadowRoot;if(h){const _=h.getElementById(n)||h.querySelector(`[name="${n}"]`);if(_)return _}l=r.nextNode()}}return null}(this.document,n);e&&(this.scrollToElement(e),e.focus())}setHistoryScrollRestoration(n){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=n)}}scrollToElement(n){const e=n.getBoundingClientRect(),r=e.left+this.window.pageXOffset,l=e.top+this.window.pageYOffset,h=this.offset();this.window.scrollTo(r-h[0],l-h[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const n=IE(this.window.history)||IE(Object.getPrototypeOf(this.window.history));return!(!n||!n.writable&&!n.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function IE(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class ME{}class kR extends Ok{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class tb extends kR{static makeCurrent(){!function Rk(t){Rx||(Rx=t)}(new tb)}onAndCancel(n,e,r){return n.addEventListener(e,r,!1),()=>{n.removeEventListener(e,r,!1)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.parentNode&&n.parentNode.removeChild(n)}createElement(n,e){return(e=e||this.getDefaultDocument()).createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return"window"===e?window:"document"===e?n:"body"===e?n.body:null}getBaseHref(n){const e=function PR(){return h_=h_||document.querySelector("base"),h_?h_.getAttribute("href"):null}();return null==e?null:function RR(t){Qv=Qv||document.createElement("a"),Qv.setAttribute("href",t);const n=Qv.pathname;return"/"===n.charAt(0)?n:`/${n}`}(e)}resetBaseElement(){h_=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return gE(document.cookie,n)}}let Qv,h_=null;const PE=new vt("TRANSITION_ID"),FR=[{provide:Sv,useFactory:function OR(t,n,e){return()=>{e.get(kv).donePromise.then(()=>{const r=iu(),l=n.querySelectorAll(`style[ng-transition="${t}"]`);for(let h=0;h<l.length;h++)r.remove(l[h])})}},deps:[PE,ki,xo],multi:!0}];let BR=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const Xv=new vt("EventManagerPlugins");let Kv=(()=>{class t{constructor(e,r){this._zone=r,this._eventNameToPlugin=new Map,e.forEach(l=>{l.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,l){return this._findPluginFor(r).addEventListener(e,r,l)}addGlobalEventListener(e,r,l){return this._findPluginFor(r).addGlobalEventListener(e,r,l)}getZone(){return this._zone}_findPluginFor(e){const r=this._eventNameToPlugin.get(e);if(r)return r;const l=this._plugins;for(let h=0;h<l.length;h++){const _=l[h];if(_.supports(e))return this._eventNameToPlugin.set(e,_),_}throw new Error(`No event manager plugin found for event ${e}`)}}return t.\u0275fac=function(e){return new(e||t)(mt(Xv),mt(tr))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();class RE{constructor(n){this._doc=n}addGlobalEventListener(n,e,r){const l=iu().getGlobalEventTarget(this._doc,n);if(!l)throw new Error(`Unsupported event target ${l} for event ${e}`);return this.addEventListener(l,e,r)}}let OE=(()=>{class t{constructor(){this.usageCount=new Map}addStyles(e){for(const r of e)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(e){for(const r of e)0===this.changeUsageCount(r,-1)&&this.onStyleRemoved(r)}onStyleRemoved(e){}onStyleAdded(e){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(e,r){const l=this.usageCount;let h=l.get(e)??0;return h+=r,h>0?l.set(e,h):l.delete(e),h}ngOnDestroy(){for(const e of this.getAllStyles())this.onStyleRemoved(e);this.usageCount.clear()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})(),d_=(()=>{class t extends OE{constructor(e){super(),this.doc=e,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(e){for(const r of this.hostNodes)this.addStyleToHost(r,e)}onStyleRemoved(e){const r=this.styleRef;r.get(e)?.forEach(h=>h.remove()),r.delete(e)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(e){this.hostNodes.add(e);for(const r of this.getAllStyles())this.addStyleToHost(e,r)}removeHost(e){this.hostNodes.delete(e)}addStyleToHost(e,r){const l=this.doc.createElement("style");l.textContent=r,e.appendChild(l);const h=this.styleRef.get(r);h?h.push(l):this.styleRef.set(r,[l])}resetHostNodes(){const e=this.hostNodes;e.clear(),e.add(this.doc.head)}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const nb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ib=/%COMP%/g,BE=new vt("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function NE(t,n){return n.flat(100).map(e=>e.replace(ib,t))}function zE(t){return n=>{if("__ngUnwrap__"===n)return t;!1===t(n)&&(n.preventDefault(),n.returnValue=!1)}}let rb=(()=>{class t{constructor(e,r,l,h){this.eventManager=e,this.sharedStylesHost=r,this.appId=l,this.removeStylesOnCompDestory=h,this.rendererByCompId=new Map,this.defaultRenderer=new ob(e)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;const l=this.getOrCreateRenderer(e,r);return l instanceof UE?l.applyToHost(e):l instanceof sb&&l.applyStyles(),l}getOrCreateRenderer(e,r){const l=this.rendererByCompId;let h=l.get(r.id);if(!h){const _=this.eventManager,C=this.sharedStylesHost,M=this.removeStylesOnCompDestory;switch(r.encapsulation){case ho.Emulated:h=new UE(_,C,r,this.appId,M);break;case ho.ShadowDom:return new HR(_,C,e,r);default:h=new sb(_,C,r,M)}h.onDestroy=()=>l.delete(r.id),l.set(r.id,h)}return h}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(mt(Kv),mt(d_),mt(r_),mt(BE))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();class ob{constructor(n){this.eventManager=n,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(n,e){return e?document.createElementNS(nb[e]||e,n):document.createElement(n)}createComment(n){return document.createComment(n)}createText(n){return document.createTextNode(n)}appendChild(n,e){(jE(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(jE(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){n&&n.removeChild(e)}selectRootElement(n,e){let r="string"==typeof n?document.querySelector(n):n;if(!r)throw new Error(`The selector "${n}" did not match any elements`);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,l){if(l){e=l+":"+e;const h=nb[l];h?n.setAttributeNS(h,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){const l=nb[r];l?n.removeAttributeNS(l,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,l){l&(ar.DashCase|ar.Important)?n.style.setProperty(e,r,l&ar.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&ar.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n[e]=r}setValue(n,e){n.nodeValue=e}listen(n,e,r){return"string"==typeof n?this.eventManager.addGlobalEventListener(n,e,zE(r)):this.eventManager.addEventListener(n,e,zE(r))}}function jE(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class HR extends ob{constructor(n,e,r,l){super(n),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const h=NE(l.id,l.styles);for(const _ of h){const C=document.createElement("style");C.textContent=_,this.shadowRoot.appendChild(C)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(this.nodeOrShadowRoot(n),e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class sb extends ob{constructor(n,e,r,l,h=r.id){super(n),this.sharedStylesHost=e,this.removeStylesOnCompDestory=l,this.rendererUsageCount=0,this.styles=NE(h,r.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class UE extends sb{constructor(n,e,r,l,h){const _=l+"-"+r.id;super(n,e,r,h,_),this.contentAttr=function jR(t){return"_ngcontent-%COMP%".replace(ib,t)}(_),this.hostAttr=function UR(t){return"_nghost-%COMP%".replace(ib,t)}(_)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){const r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}}let $R=(()=>{class t extends RE{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,l){return e.addEventListener(r,l,!1),()=>this.removeEventListener(e,r,l)}removeEventListener(e,r,l){return e.removeEventListener(r,l)}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const GE=["alt","control","meta","shift"],qR={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},WR={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let ZR=(()=>{class t extends RE{constructor(e){super(e)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,r,l){const h=t.parseEventName(r),_=t.eventCallback(h.fullKey,l,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>iu().onAndCancel(e,h.domEventName,_))}static parseEventName(e){const r=e.toLowerCase().split("."),l=r.shift();if(0===r.length||"keydown"!==l&&"keyup"!==l)return null;const h=t._normalizeKey(r.pop());let _="",C=r.indexOf("code");if(C>-1&&(r.splice(C,1),_="code."),GE.forEach(P=>{const B=r.indexOf(P);B>-1&&(r.splice(B,1),_+=P+".")}),_+=h,0!=r.length||0===h.length)return null;const M={};return M.domEventName=l,M.fullKey=_,M}static matchEventFullKeyCode(e,r){let l=qR[e.key]||e.key,h="";return r.indexOf("code.")>-1&&(l=e.code,h="code."),!(null==l||!l)&&(l=l.toLowerCase()," "===l?l="space":"."===l&&(l="dot"),GE.forEach(_=>{_!==l&&(0,WR[_])(e)&&(h+=_+".")}),h+=l,h===r)}static eventCallback(e,r,l){return h=>{t.matchEventFullKeyCode(h,e)&&l.runGuarded(()=>r(h))}}static _normalizeKey(e){return"esc"===e?"escape":e}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const YR=zC(Sk,"browser",[{provide:o_,useValue:EE},{provide:TC,useValue:function QR(){tb.makeCurrent()},multi:!0},{provide:ki,useFactory:function KR(){return function Si(t){Zm=t}(document),document},deps:[]}]),qE=new vt(""),WE=[{provide:Pv,useClass:class LR{addToWindow(n){ei.getAngularTestability=(r,l=!0)=>{const h=n.findTestabilityInTree(r,l);if(null==h)throw new Error("Could not find testability for element.");return h},ei.getAllAngularTestabilities=()=>n.getAllTestabilities(),ei.getAllAngularRootElements=()=>n.getAllRootElements(),ei.frameworkStabilizers||(ei.frameworkStabilizers=[]),ei.frameworkStabilizers.push(r=>{const l=ei.getAllAngularTestabilities();let h=l.length,_=!1;const C=function(M){_=_||M,h--,0==h&&r(_)};l.forEach(function(M){M.whenStable(C)})})}findTestabilityInTree(n,e,r){return null==e?null:n.getTestability(e)??(r?iu().isShadowRoot(e)?this.findTestabilityInTree(n,e.host,!0):this.findTestabilityInTree(n,e.parentElement,!0):null)}},deps:[]},{provide:OC,useClass:Cx,deps:[tr,Ex,Pv]},{provide:Cx,useClass:Cx,deps:[tr,Ex,Pv]}],ZE=[{provide:pg,useValue:"root"},{provide:el,useFactory:function XR(){return new el},deps:[]},{provide:Xv,useClass:$R,multi:!0,deps:[ki,tr,o_]},{provide:Xv,useClass:ZR,multi:!0,deps:[ki]},{provide:rb,useClass:rb,deps:[Kv,d_,r_,BE]},{provide:Dy,useExisting:rb},{provide:OE,useExisting:d_},{provide:d_,useClass:d_,deps:[ki]},{provide:Kv,useClass:Kv,deps:[Xv,tr]},{provide:ME,useClass:BR,deps:[]},[]];let JR=(()=>{class t{constructor(e){}static withServerTransition(e){return{ngModule:t,providers:[{provide:r_,useValue:e.appId},{provide:PE,useExisting:r_},FR]}}}return t.\u0275fac=function(e){return new(e||t)(mt(qE,12))},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({providers:[...ZE,...WE],imports:[CE,kk]}),t})(),QE=(()=>{class t{constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:function(e){let r=null;return r=e?new e:function tO(){return new QE(mt(ki))}(),r},providedIn:"root"}),t})();typeof window<"u"&&window;let p_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(e){let r=null;return r=e?new(e||t):mt(YE),r},providedIn:"root"}),t})(),YE=(()=>{class t extends p_{constructor(e){super(),this._doc=e}sanitize(e,r){if(null==r)return null;switch(e){case Zn.NONE:return r;case Zn.HTML:return Ao(r,"HTML")?vo(r):rg(this._doc,String(r)).toString();case Zn.STYLE:return Ao(r,"Style")?vo(r):r;case Zn.SCRIPT:if(Ao(r,"Script"))return vo(r);throw new Error("unsafe value used in a script context");case Zn.URL:return Ao(r,"URL")?vo(r):Zp(String(r));case Zn.RESOURCE_URL:if(Ao(r,"ResourceURL"))return vo(r);throw new Error(`unsafe value used in a resource URL context (see ${ns})`);default:throw new Error(`Unexpected SecurityContext ${e} (see ${ns})`)}}bypassSecurityTrustHtml(e){return function Jm(t){return new Cd(t)}(e)}bypassSecurityTrustStyle(e){return function u0(t){return new Xm(t)}(e)}bypassSecurityTrustScript(e){return function eg(t){return new Km(t)}(e)}bypassSecurityTrustUrl(e){return function tg(t){return new Ym(t)}(e)}bypassSecurityTrustResourceUrl(e){return function Wp(t){return new l0(t)}(e)}}return t.\u0275fac=function(e){return new(e||t)(mt(ki))},t.\u0275prov=Mt({token:t,factory:function(e){let r=null;return r=e?new e:function sO(t){return new YE(t.get(ki))}(mt(xo)),r},providedIn:"root"}),t})();function Ft(...t){return An(t,ra(t))}class ul extends nr{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){const e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){const{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}}const Yv=Bh(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:aO}=Array,{getPrototypeOf:lO,prototype:cO,keys:uO}=Object;function JE(t){if(1===t.length){const n=t[0];if(aO(n))return{args:n,keys:null};if(function hO(t){return t&&"object"==typeof t&&lO(t)===cO}(n)){const e=uO(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}const{isArray:dO}=Array;function eI(t){return ct(n=>function pO(t,n){return dO(n)?t(...n):t(n)}(t,n))}function tI(t,n){return t.reduce((e,r,l)=>(e[r]=n[l],e),{})}function cb(...t){const n=ra(t),e=fu(t),{args:r,keys:l}=JE(t);if(0===r.length)return An([],n);const h=new pn(function fO(t,n,e=Ko){return r=>{nI(n,()=>{const{length:l}=t,h=new Array(l);let _=l,C=l;for(let M=0;M<l;M++)nI(n,()=>{const P=An(t[M],n);let B=!1;P.subscribe(Jn(r,G=>{h[M]=G,B||(B=!0,C--),C||r.next(e(h.slice()))},()=>{--_||r.complete()}))},r)},r)}}(r,n,l?_=>tI(l,_):Ko));return e?h.pipe(eI(e)):h}function nI(t,n,e){t?$i(e,t,n):n()}function Jv(...t){return function mO(){return Do(1)}()(An(t,ra(t)))}function iI(t){return new pn(n=>{Rt(t()).subscribe(n)})}function zf(t,n){const e=ri(t)?t:()=>t,r=l=>l.error(e());return new pn(n?l=>n.schedule(r,0,l):r)}function ub(){return hi((t,n)=>{let e=null;t._refCount++;const r=Jn(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount)return void(e=null);const l=t._connection,h=e;e=null,l&&(!h||l===h)&&l.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}class rI extends pn{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,Yo(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){const n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new je;const e=this.getSubject();n.add(this.source.subscribe(Jn(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=je.EMPTY)}return n}refCount(){return ub()(this)}}function hl(t,n){return hi((e,r)=>{let l=null,h=0,_=!1;const C=()=>_&&!l&&r.complete();e.subscribe(Jn(r,M=>{l?.unsubscribe();let P=0;const B=h++;Rt(t(M,B)).subscribe(l=Jn(r,G=>r.next(n?n(M,G,B,P++):G),()=>{l=null,C()}))},()=>{_=!0,C()}))})}function Qd(t){return t<=0?()=>Jo:hi((n,e)=>{let r=0;n.subscribe(Jn(e,l=>{++r<=t&&(e.next(l),t<=r&&e.complete())}))})}function oI(...t){const n=ra(t);return hi((e,r)=>{(n?Jv(t,e,n):Jv(t,e)).subscribe(r)})}function Yl(t,n){return hi((e,r)=>{let l=0;e.subscribe(Jn(r,h=>t.call(n,h,l++)&&r.next(h)))})}function eA(t){return hi((n,e)=>{let r=!1;n.subscribe(Jn(e,l=>{r=!0,e.next(l)},()=>{r||e.next(t),e.complete()}))})}function sI(t=gO){return hi((n,e)=>{let r=!1;n.subscribe(Jn(e,l=>{r=!0,e.next(l)},()=>r?e.complete():e.error(t())))})}function gO(){return new Yv}function Mh(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Yl((l,h)=>t(l,h,r)):Ko,Qd(1),e?eA(n):sI(()=>new Yv))}function Th(t,n){return ri(n)?zn(t,n,1):zn(t,1)}function Dr(t,n,e){const r=ri(t)||n||e?{next:t,error:n,complete:e}:t;return r?hi((l,h)=>{var _;null===(_=r.subscribe)||void 0===_||_.call(r);let C=!0;l.subscribe(Jn(h,M=>{var P;null===(P=r.next)||void 0===P||P.call(r,M),h.next(M)},()=>{var M;C=!1,null===(M=r.complete)||void 0===M||M.call(r),h.complete()},M=>{var P;C=!1,null===(P=r.error)||void 0===P||P.call(r,M),h.error(M)},()=>{var M,P;C&&(null===(M=r.unsubscribe)||void 0===M||M.call(r)),null===(P=r.finalize)||void 0===P||P.call(r)}))}):Ko}function Jl(t){return hi((n,e)=>{let h,r=null,l=!1;r=n.subscribe(Jn(e,void 0,void 0,_=>{h=Rt(t(_,Jl(t)(n))),r?(r.unsubscribe(),r=null,h.subscribe(e)):l=!0})),l&&(r.unsubscribe(),r=null,h.subscribe(e))})}function aI(t,n){return hi(function _O(t,n,e,r,l){return(h,_)=>{let C=e,M=n,P=0;h.subscribe(Jn(_,B=>{const G=P++;M=C?t(M,B,G):(C=!0,B),r&&_.next(M)},l&&(()=>{C&&_.next(M),_.complete()})))}}(t,n,arguments.length>=2,!0))}function hb(t){return t<=0?()=>Jo:hi((n,e)=>{let r=[];n.subscribe(Jn(e,l=>{r.push(l),t<r.length&&r.shift()},()=>{for(const l of r)e.next(l);e.complete()},void 0,()=>{r=null}))})}function lI(t,n){const e=arguments.length>=2;return r=>r.pipe(t?Yl((l,h)=>t(l,h,r)):Ko,hb(1),e?eA(n):sI(()=>new Yv))}function tA(t){return hi((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}const _n="primary",f_=Symbol("RouteTitle");class AO{constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){const e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function Vf(t){return new AO(t)}function xO(t,n,e){const r=e.path.split("/");if(r.length>t.length||"full"===e.pathMatch&&(n.hasChildren()||r.length<t.length))return null;const l={};for(let h=0;h<r.length;h++){const _=r[h],C=t[h];if(_.startsWith(":"))l[_.substring(1)]=C;else if(_!==C.path)return null}return{consumed:t.slice(0,r.length),posParams:l}}function ec(t,n){const e=t?Object.keys(t):void 0,r=n?Object.keys(n):void 0;if(!e||!r||e.length!=r.length)return!1;let l;for(let h=0;h<e.length;h++)if(l=e[h],!cI(t[l],n[l]))return!1;return!0}function cI(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;const e=[...t].sort(),r=[...n].sort();return e.every((l,h)=>r[h]===l)}return t===n}function uI(t){return Array.prototype.concat.apply([],t)}function hI(t){return t.length>0?t[t.length-1]:null}function oo(t,n){for(const e in t)t.hasOwnProperty(e)&&n(t[e],e)}function Dh(t){return Ir(t)?t:ai(t)?An(Promise.resolve(t)):Ft(t)}const nA=!1,wO={exact:function fI(t,n,e){if(!Xd(t.segments,n.segments)||!iA(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(const r in n.children)if(!t.children[r]||!fI(t.children[r],n.children[r],e))return!1;return!0},subset:mI},dI={exact:function CO(t,n){return ec(t,n)},subset:function EO(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>cI(t[e],n[e]))},ignored:()=>!0};function pI(t,n,e){return wO[e.paths](t.root,n.root,e.matrixParams)&&dI[e.queryParams](t.queryParams,n.queryParams)&&!("exact"===e.fragment&&t.fragment!==n.fragment)}function mI(t,n,e){return gI(t,n,n.segments,e)}function gI(t,n,e,r){if(t.segments.length>e.length){const l=t.segments.slice(0,e.length);return!(!Xd(l,e)||n.hasChildren()||!iA(l,e,r))}if(t.segments.length===e.length){if(!Xd(t.segments,e)||!iA(t.segments,e,r))return!1;for(const l in n.children)if(!t.children[l]||!mI(t.children[l],n.children[l],r))return!1;return!0}{const l=e.slice(0,t.segments.length),h=e.slice(t.segments.length);return!!(Xd(t.segments,l)&&iA(t.segments,l,r)&&t.children[_n])&&gI(t.children[_n],n,h,r)}}function iA(t,n,e){return n.every((r,l)=>dI[e](t[l].parameters,r.parameters))}class Sh{constructor(n=new Mn([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Vf(this.queryParams)),this._queryParamMap}toString(){return TO.serialize(this)}}class Mn{constructor(n,e){this.segments=n,this.children=e,this.parent=null,oo(e,(r,l)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return rA(this)}}class m_{constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=Vf(this.parameters)),this._parameterMap}toString(){return vI(this)}}function Xd(t,n){return t.length===n.length&&t.every((e,r)=>e.path===n[r].path)}let g_=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return new db},providedIn:"root"}),t})();class db{parse(n){const e=new BO(n);return new Sh(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){const e=`/${__(n.root,!0)}`,r=function kO(t){const n=Object.keys(t).map(e=>{const r=t[e];return Array.isArray(r)?r.map(l=>`${oA(e)}=${oA(l)}`).join("&"):`${oA(e)}=${oA(r)}`}).filter(e=>!!e);return n.length?`?${n.join("&")}`:""}(n.queryParams);return`${e}${r}${"string"==typeof n.fragment?`#${function DO(t){return encodeURI(t)}(n.fragment)}`:""}`}}const TO=new db;function rA(t){return t.segments.map(n=>vI(n)).join("/")}function __(t,n){if(!t.hasChildren())return rA(t);if(n){const e=t.children[_n]?__(t.children[_n],!1):"",r=[];return oo(t.children,(l,h)=>{h!==_n&&r.push(`${h}:${__(l,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}{const e=function MO(t,n){let e=[];return oo(t.children,(r,l)=>{l===_n&&(e=e.concat(n(r,l)))}),oo(t.children,(r,l)=>{l!==_n&&(e=e.concat(n(r,l)))}),e}(t,(r,l)=>l===_n?[__(t.children[_n],!1)]:[`${l}:${__(r,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[_n]?`${rA(t)}/${e[0]}`:`${rA(t)}/(${e.join("//")})`}}function _I(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function oA(t){return _I(t).replace(/%3B/gi,";")}function pb(t){return _I(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function sA(t){return decodeURIComponent(t)}function yI(t){return sA(t.replace(/\+/g,"%20"))}function vI(t){return`${pb(t.path)}${function SO(t){return Object.keys(t).map(n=>`;${pb(n)}=${pb(t[n])}`).join("")}(t.parameters)}`}const PO=/^[^\/()?;=#]+/;function aA(t){const n=t.match(PO);return n?n[0]:""}const RO=/^[^=?&#]+/,FO=/^[^&#]+/;class BO{constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Mn([],{}):new Mn([],this.parseChildren())}parseQueryParams(){const n={};if(this.consumeOptional("?"))do{this.parseQueryParam(n)}while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[_n]=new Mn(n,e)),r}parseSegment(){const n=aA(this.remaining);if(""===n&&this.peekStartsWith(";"))throw new rt(4009,nA);return this.capture(n),new m_(sA(n),this.parseMatrixParams())}parseMatrixParams(){const n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){const e=aA(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const l=aA(this.remaining);l&&(r=l,this.capture(r))}n[sA(e)]=sA(r)}parseQueryParam(n){const e=function OO(t){const n=t.match(RO);return n?n[0]:""}(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){const _=function LO(t){const n=t.match(FO);return n?n[0]:""}(this.remaining);_&&(r=_,this.capture(r))}const l=yI(e),h=yI(r);if(n.hasOwnProperty(l)){let _=n[l];Array.isArray(_)||(_=[_],n[l]=_),_.push(h)}else n[l]=h}parseParens(n){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=aA(this.remaining),l=this.remaining[r.length];if("/"!==l&&")"!==l&&";"!==l)throw new rt(4010,nA);let h;r.indexOf(":")>-1?(h=r.slice(0,r.indexOf(":")),this.capture(h),this.capture(":")):n&&(h=_n);const _=this.parseChildren();e[h]=1===Object.keys(_).length?_[_n]:new Mn([],_),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return!!this.peekStartsWith(n)&&(this.remaining=this.remaining.substring(n.length),!0)}capture(n){if(!this.consumeOptional(n))throw new rt(4011,nA)}}function fb(t){return t.segments.length>0?new Mn([],{[_n]:t}):t}function lA(t){const n={};for(const r of Object.keys(t.children)){const h=lA(t.children[r]);(h.segments.length>0||h.hasChildren())&&(n[r]=h)}return function NO(t){if(1===t.numberOfChildren&&t.children[_n]){const n=t.children[_n];return new Mn(t.segments.concat(n.segments),n.children)}return t}(new Mn(t.segments,n))}function Kd(t){return t instanceof Sh}const mb=!1;function zO(t,n,e,r,l){if(0===e.length)return jf(n.root,n.root,n.root,r,l);const h=function CI(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new wI(!0,0,t);let n=0,e=!1;const r=t.reduce((l,h,_)=>{if("object"==typeof h&&null!=h){if(h.outlets){const C={};return oo(h.outlets,(M,P)=>{C[P]="string"==typeof M?M.split("/"):M}),[...l,{outlets:C}]}if(h.segmentPath)return[...l,h.segmentPath]}return"string"!=typeof h?[...l,h]:0===_?(h.split("/").forEach((C,M)=>{0==M&&"."===C||(0==M&&""===C?e=!0:".."===C?n++:""!=C&&l.push(C))}),l):[...l,h]},[]);return new wI(e,n,r)}(e);return h.toRoot()?jf(n.root,n.root,new Mn([],{}),r,l):function _(M){const P=function jO(t,n,e,r){if(t.isAbsolute)return new Uf(n.root,!0,0);if(-1===r)return new Uf(e,e===n.root,0);return function EI(t,n,e){let r=t,l=n,h=e;for(;h>l;){if(h-=l,r=r.parent,!r)throw new rt(4005,mb&&"Invalid number of '../'");l=r.segments.length}return new Uf(r,!1,l-h)}(e,r+(y_(t.commands[0])?0:1),t.numberOfDoubleDots)}(h,n,t.snapshot?._urlSegment,M),B=P.processChildren?Gf(P.segmentGroup,P.index,h.commands):gb(P.segmentGroup,P.index,h.commands);return jf(n.root,P.segmentGroup,B,r,l)}(t.snapshot?._lastPathIndex)}function y_(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function v_(t){return"object"==typeof t&&null!=t&&t.outlets}function jf(t,n,e,r,l){let _,h={};r&&oo(r,(M,P)=>{h[P]=Array.isArray(M)?M.map(B=>`${B}`):`${M}`}),_=t===n?e:bI(t,n,e);const C=fb(lA(_));return new Sh(C,h,l)}function bI(t,n,e){const r={};return oo(t.children,(l,h)=>{r[h]=l===n?e:bI(l,n,e)}),new Mn(t.segments,r)}class wI{constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&y_(r[0]))throw new rt(4003,mb&&"Root segment cannot have matrix parameters");const l=r.find(v_);if(l&&l!==hI(r))throw new rt(4004,mb&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Uf{constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}}function gb(t,n,e){if(t||(t=new Mn([],{})),0===t.segments.length&&t.hasChildren())return Gf(t,n,e);const r=function GO(t,n,e){let r=0,l=n;const h={match:!1,pathIndex:0,commandIndex:0};for(;l<t.segments.length;){if(r>=e.length)return h;const _=t.segments[l],C=e[r];if(v_(C))break;const M=`${C}`,P=r<e.length-1?e[r+1]:null;if(l>0&&void 0===M)break;if(M&&P&&"object"==typeof P&&void 0===P.outlets){if(!MI(M,P,_))return h;r+=2}else{if(!MI(M,{},_))return h;r++}l++}return{match:!0,pathIndex:l,commandIndex:r}}(t,n,e),l=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const h=new Mn(t.segments.slice(0,r.pathIndex),{});return h.children[_n]=new Mn(t.segments.slice(r.pathIndex),t.children),Gf(h,0,l)}return r.match&&0===l.length?new Mn(t.segments,{}):r.match&&!t.hasChildren()?_b(t,n,e):r.match?Gf(t,0,l):_b(t,n,e)}function Gf(t,n,e){if(0===e.length)return new Mn(t.segments,{});{const r=function UO(t){return v_(t[0])?t[0].outlets:{[_n]:t}}(e),l={};if(!r[_n]&&t.children[_n]&&1===t.numberOfChildren&&0===t.children[_n].segments.length){const h=Gf(t.children[_n],n,e);return new Mn(t.segments,h.children)}return oo(r,(h,_)=>{"string"==typeof h&&(h=[h]),null!==h&&(l[_]=gb(t.children[_],n,h))}),oo(t.children,(h,_)=>{void 0===r[_]&&(l[_]=h)}),new Mn(t.segments,l)}}function _b(t,n,e){const r=t.segments.slice(0,n);let l=0;for(;l<e.length;){const h=e[l];if(v_(h)){const M=HO(h.outlets);return new Mn(r,M)}if(0===l&&y_(e[0])){r.push(new m_(t.segments[n].path,II(e[0]))),l++;continue}const _=v_(h)?h.outlets[_n]:`${h}`,C=l<e.length-1?e[l+1]:null;_&&C&&y_(C)?(r.push(new m_(_,II(C))),l+=2):(r.push(new m_(_,{})),l++)}return new Mn(r,{})}function HO(t){const n={};return oo(t,(e,r)=>{"string"==typeof e&&(e=[e]),null!==e&&(n[r]=_b(new Mn([],{}),0,e))}),n}function II(t){const n={};return oo(t,(e,r)=>n[r]=`${e}`),n}function MI(t,n,e){return t==e.path&&ec(n,e.parameters)}const A_="imperative";class tc{constructor(n,e){this.id=n,this.url=e}}class yb extends tc{constructor(n,e,r="imperative",l=null){super(n,e),this.type=0,this.navigationTrigger=r,this.restoredState=l}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Yd extends tc{constructor(n,e,r){super(n,e),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class cA extends tc{constructor(n,e,r,l){super(n,e),this.reason=r,this.code=l,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class uA extends tc{constructor(n,e,r,l){super(n,e),this.reason=r,this.code=l,this.type=16}}class vb extends tc{constructor(n,e,r,l){super(n,e),this.error=r,this.target=l,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class $O extends tc{constructor(n,e,r,l){super(n,e),this.urlAfterRedirects=r,this.state=l,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class qO extends tc{constructor(n,e,r,l){super(n,e),this.urlAfterRedirects=r,this.state=l,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class WO extends tc{constructor(n,e,r,l,h){super(n,e),this.urlAfterRedirects=r,this.state=l,this.shouldActivate=h,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class ZO extends tc{constructor(n,e,r,l){super(n,e),this.urlAfterRedirects=r,this.state=l,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class QO extends tc{constructor(n,e,r,l){super(n,e),this.urlAfterRedirects=r,this.state=l,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class XO{constructor(n){this.route=n,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class KO{constructor(n){this.route=n,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class YO{constructor(n){this.snapshot=n,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class JO{constructor(n){this.snapshot=n,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eF{constructor(n){this.snapshot=n,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class tF{constructor(n){this.snapshot=n,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class TI{constructor(n,e,r){this.routerEvent=n,this.position=e,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let rF=(()=>{class t{createUrlTree(e,r,l,h,_,C){return zO(e||r.root,l,h,_,C)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})(),sF=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(n){return rF.\u0275fac(n)},providedIn:"root"}),t})();class DI{constructor(n){this._root=n}get root(){return this._root.value}parent(n){const e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){const e=Ab(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){const e=Ab(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){const e=xb(n,this._root);return e.length<2?[]:e[e.length-2].children.map(l=>l.value).filter(l=>l!==n)}pathFromRoot(n){return xb(n,this._root).map(e=>e.value)}}function Ab(t,n){if(t===n.value)return n;for(const e of n.children){const r=Ab(t,e);if(r)return r}return null}function xb(t,n){if(t===n.value)return[n];for(const e of n.children){const r=xb(t,e);if(r.length)return r.unshift(n),r}return[]}class su{constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}}function Hf(t){const n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}class SI extends DI{constructor(n,e){super(n),this.snapshot=e,bb(this,n)}toString(){return this.snapshot.toString()}}function kI(t,n){const e=function aF(t,n){const _=new hA([],{},{},"",{},_n,n,null,t.root,-1,{});return new RI("",new su(_,[]))}(t,n),r=new ul([new m_("",{})]),l=new ul({}),h=new ul({}),_=new ul({}),C=new ul(""),M=new kh(r,l,_,C,h,_n,n,e.root);return M.snapshot=e.root,new SI(new su(M,[]),e)}class kh{constructor(n,e,r,l,h,_,C,M){this.url=n,this.params=e,this.queryParams=r,this.fragment=l,this.data=h,this.outlet=_,this.component=C,this.title=this.data?.pipe(ct(P=>P[f_]))??Ft(void 0),this._futureSnapshot=M}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(ct(n=>Vf(n)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(ct(n=>Vf(n)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function PI(t,n="emptyOnly"){const e=t.pathFromRoot;let r=0;if("always"!==n)for(r=e.length-1;r>=1;){const l=e[r],h=e[r-1];if(l.routeConfig&&""===l.routeConfig.path)r--;else{if(h.component)break;r--}}return function lF(t){return t.reduce((n,e)=>({params:{...n.params,...e.params},data:{...n.data,...e.data},resolve:{...e.data,...n.resolve,...e.routeConfig?.data,...e._resolvedData}}),{params:{},data:{},resolve:{}})}(e.slice(r))}class hA{get title(){return this.data?.[f_]}constructor(n,e,r,l,h,_,C,M,P,B,G){this.url=n,this.params=e,this.queryParams=r,this.fragment=l,this.data=h,this.outlet=_,this.component=C,this.routeConfig=M,this._urlSegment=P,this._lastPathIndex=B,this._resolve=G}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Vf(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Vf(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class RI extends DI{constructor(n,e){super(e),this.url=n,bb(this,e)}toString(){return OI(this._root)}}function bb(t,n){n.value._routerState=t,n.children.forEach(e=>bb(t,e))}function OI(t){const n=t.children.length>0?` { ${t.children.map(OI).join(", ")} } `:"";return`${t.value}${n}`}function wb(t){if(t.snapshot){const n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ec(n.queryParams,e.queryParams)||t.queryParams.next(e.queryParams),n.fragment!==e.fragment&&t.fragment.next(e.fragment),ec(n.params,e.params)||t.params.next(e.params),function bO(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ec(t[e],n[e]))return!1;return!0}(n.url,e.url)||t.url.next(e.url),ec(n.data,e.data)||t.data.next(e.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Cb(t,n){const e=ec(t.params,n.params)&&function IO(t,n){return Xd(t,n)&&t.every((e,r)=>ec(e.parameters,n[r].parameters))}(t.url,n.url);return e&&!(!t.parent!=!n.parent)&&(!t.parent||Cb(t.parent,n.parent))}function x_(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){const r=e.value;r._futureSnapshot=n.value;const l=function uF(t,n,e){return n.children.map(r=>{for(const l of e.children)if(t.shouldReuseRoute(r.value,l.value.snapshot))return x_(t,r,l);return x_(t,r)})}(t,n,e);return new su(r,l)}{if(t.shouldAttach(n.value)){const h=t.retrieve(n.value);if(null!==h){const _=h.route;return _.value._futureSnapshot=n.value,_.children=n.children.map(C=>x_(t,C)),_}}const r=function hF(t){return new kh(new ul(t.url),new ul(t.params),new ul(t.queryParams),new ul(t.fragment),new ul(t.data),t.outlet,t.component,t)}(n.value),l=n.children.map(h=>x_(t,h));return new su(r,l)}}const Eb="ngNavigationCancelingError";function FI(t,n){const{redirectTo:e,navigationBehaviorOptions:r}=Kd(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,l=LI(!1,0,n);return l.url=e,l.navigationBehaviorOptions=r,l}function LI(t,n,e){const r=new Error("NavigationCancelingError: "+(t||""));return r[Eb]=!0,r.cancellationCode=n,e&&(r.url=e),r}function BI(t){return NI(t)&&Kd(t.url)}function NI(t){return t&&t[Eb]}class dF{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new b_,this.attachRef=null}}let b_=(()=>{class t{constructor(){this.contexts=new Map}onChildOutletCreated(e,r){const l=this.getOrCreateContext(e);l.outlet=r,this.contexts.set(e,l)}onChildOutletDestroyed(e){const r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new dF,this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const dA=!1;let Ib=(()=>{class t{constructor(){this.activated=null,this._activatedRoute=null,this.name=_n,this.activateEvents=new ii,this.deactivateEvents=new ii,this.attachEvents=new ii,this.detachEvents=new ii,this.parentContexts=$t(b_),this.location=$t(sl),this.changeDetector=$t(Lf),this.environmentInjector=$t(xa)}ngOnChanges(e){if(e.name){const{firstChange:r,previousValue:l}=e.name;if(r)return;this.isTrackedInParentContexts(l)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(l)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new rt(4012,dA);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new rt(4012,dA);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new rt(4012,dA);this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new rt(4013,dA);this._activatedRoute=e;const l=this.location,_=e.snapshot.component,C=this.parentContexts.getOrCreateContext(this.name).children,M=new pF(e,C,l.injector);if(r&&function fF(t){return!!t.resolveComponentFactory}(r)){const P=r.resolveComponentFactory(_);this.activated=l.createComponent(P,l.length,M)}else this.activated=l.createComponent(_,{index:l.length,injector:M,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Bt({type:t,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ji]}),t})();class pF{constructor(n,e,r){this.route=n,this.childContexts=e,this.parent=r}get(n,e){return n===kh?this.route:n===b_?this.childContexts:this.parent.get(n,e)}}let Mb=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_r({type:t,selectors:[["ng-component"]],standalone:!0,features:[G1],decls:1,vars:0,template:function(e,r){1&e&&St(0,"router-outlet")},dependencies:[Ib],encapsulation:2}),t})();function zI(t,n){return t.providers&&!t._injector&&(t._injector=Cv(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Db(t){const n=t.children&&t.children.map(Db),e=n?{...t,children:n}:{...t};return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==_n&&(e.component=Mb),e}function Ma(t){return t.outlet||_n}function VI(t,n){const e=t.filter(r=>Ma(r)===n);return e.push(...t.filter(r=>Ma(r)!==n)),e}function w_(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){const e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}class vF{constructor(n,e,r,l){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=l}activate(n){const e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),wb(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){const l=Hf(e);n.children.forEach(h=>{const _=h.value.outlet;this.deactivateRoutes(h,l[_],r),delete l[_]}),oo(l,(h,_)=>{this.deactivateRouteAndItsChildren(h,r)})}deactivateRoutes(n,e,r){const l=n.value,h=e?e.value:null;if(l===h)if(l.component){const _=r.getContext(l.outlet);_&&this.deactivateChildRoutes(n,e,_.children)}else this.deactivateChildRoutes(n,e,r);else h&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){const r=e.getContext(n.value.outlet),l=r&&n.value.component?r.children:e,h=Hf(n);for(const _ of Object.keys(h))this.deactivateRouteAndItsChildren(h[_],l);if(r&&r.outlet){const _=r.outlet.detach(),C=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:_,route:n,contexts:C})}}deactivateRouteAndOutlet(n,e){const r=e.getContext(n.value.outlet),l=r&&n.value.component?r.children:e,h=Hf(n);for(const _ of Object.keys(h))this.deactivateRouteAndItsChildren(h[_],l);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(n,e,r){const l=Hf(e);n.children.forEach(h=>{this.activateRoutes(h,l[h.value.outlet],r),this.forwardEvent(new tF(h.value.snapshot))}),n.children.length&&this.forwardEvent(new JO(n.value.snapshot))}activateRoutes(n,e,r){const l=n.value,h=e?e.value:null;if(wb(l),l===h)if(l.component){const _=r.getOrCreateContext(l.outlet);this.activateChildRoutes(n,e,_.children)}else this.activateChildRoutes(n,e,r);else if(l.component){const _=r.getOrCreateContext(l.outlet);if(this.routeReuseStrategy.shouldAttach(l.snapshot)){const C=this.routeReuseStrategy.retrieve(l.snapshot);this.routeReuseStrategy.store(l.snapshot,null),_.children.onOutletReAttached(C.contexts),_.attachRef=C.componentRef,_.route=C.route.value,_.outlet&&_.outlet.attach(C.componentRef,C.route.value),wb(C.route.value),this.activateChildRoutes(n,null,_.children)}else{const C=w_(l.snapshot),M=C?.get(hh)??null;_.attachRef=null,_.route=l,_.resolver=M,_.injector=C,_.outlet&&_.outlet.activateWith(l,_.injector),this.activateChildRoutes(n,null,_.children)}}else this.activateChildRoutes(n,null,r)}}class jI{constructor(n){this.path=n,this.route=this.path[this.path.length-1]}}class pA{constructor(n,e){this.component=n,this.route=e}}function AF(t,n,e){const r=t._root;return C_(r,n?n._root:null,e,[r.value])}function $f(t,n){const e=Symbol(),r=n.get(t,e);return r===e?"function"!=typeof t||function sm(t){return null!==Ba(t)}(t)?n.get(t):t:r}function C_(t,n,e,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const h=Hf(n);return t.children.forEach(_=>{(function bF(t,n,e,r,l={canDeactivateChecks:[],canActivateChecks:[]}){const h=t.value,_=n?n.value:null,C=e?e.getContext(t.value.outlet):null;if(_&&h.routeConfig===_.routeConfig){const M=function wF(t,n,e){if("function"==typeof e)return e(t,n);switch(e){case"pathParamsChange":return!Xd(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Xd(t.url,n.url)||!ec(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Cb(t,n)||!ec(t.queryParams,n.queryParams);default:return!Cb(t,n)}}(_,h,h.routeConfig.runGuardsAndResolvers);M?l.canActivateChecks.push(new jI(r)):(h.data=_.data,h._resolvedData=_._resolvedData),C_(t,n,h.component?C?C.children:null:e,r,l),M&&C&&C.outlet&&C.outlet.isActivated&&l.canDeactivateChecks.push(new pA(C.outlet.component,_))}else _&&E_(n,C,l),l.canActivateChecks.push(new jI(r)),C_(t,null,h.component?C?C.children:null:e,r,l)})(_,h[_.value.outlet],e,r.concat([_.value]),l),delete h[_.value.outlet]}),oo(h,(_,C)=>E_(_,e.getContext(C),l)),l}function E_(t,n,e){const r=Hf(t),l=t.value;oo(r,(h,_)=>{E_(h,l.component?n?n.children.getContext(_):null:n,e)}),e.canDeactivateChecks.push(new pA(l.component&&n&&n.outlet&&n.outlet.isActivated?n.outlet.component:null,l))}function I_(t){return"function"==typeof t}function Sb(t){return t instanceof Yv||"EmptyError"===t?.name}const fA=Symbol("INITIAL_VALUE");function qf(){return hl(t=>cb(t.map(n=>n.pipe(Qd(1),oI(fA)))).pipe(ct(n=>{for(const e of n)if(!0!==e){if(e===fA)return fA;if(!1===e||e instanceof Sh)return e}return!0}),Yl(n=>n!==fA),Qd(1)))}function UI(t){return function cn(...t){return ka(t)}(Dr(n=>{if(Kd(n))throw FI(0,n)}),ct(n=>!0===n))}const kb={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function GI(t,n,e,r,l){const h=Pb(t,n,e);return h.matched?function VF(t,n,e,r){const l=n.canMatch;return l&&0!==l.length?Ft(l.map(_=>{const C=$f(_,t);return Dh(function DF(t){return t&&I_(t.canMatch)}(C)?C.canMatch(n,e):t.runInContext(()=>C(n,e)))})).pipe(qf(),UI()):Ft(!0)}(r=zI(n,r),n,e).pipe(ct(_=>!0===_?h:{...kb})):Ft(h)}function Pb(t,n,e){if(""===n.path)return"full"===n.pathMatch&&(t.hasChildren()||e.length>0)?{...kb}:{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};const l=(n.matcher||xO)(e,t,n);if(!l)return{...kb};const h={};oo(l.posParams,(C,M)=>{h[M]=C.path});const _=l.consumed.length>0?{...h,...l.consumed[l.consumed.length-1].parameters}:h;return{matched:!0,consumedSegments:l.consumed,remainingSegments:e.slice(l.consumed.length),parameters:_,positionalParamSegments:l.posParams??{}}}function mA(t,n,e,r){if(e.length>0&&function GF(t,n,e){return e.some(r=>gA(t,n,r)&&Ma(r)!==_n)}(t,e,r)){const h=new Mn(n,function UF(t,n,e,r){const l={};l[_n]=r,r._sourceSegment=t,r._segmentIndexShift=n.length;for(const h of e)if(""===h.path&&Ma(h)!==_n){const _=new Mn([],{});_._sourceSegment=t,_._segmentIndexShift=n.length,l[Ma(h)]=_}return l}(t,n,r,new Mn(e,t.children)));return h._sourceSegment=t,h._segmentIndexShift=n.length,{segmentGroup:h,slicedSegments:[]}}if(0===e.length&&function HF(t,n,e){return e.some(r=>gA(t,n,r))}(t,e,r)){const h=new Mn(t.segments,function jF(t,n,e,r,l){const h={};for(const _ of r)if(gA(t,e,_)&&!l[Ma(_)]){const C=new Mn([],{});C._sourceSegment=t,C._segmentIndexShift=n.length,h[Ma(_)]=C}return{...l,...h}}(t,n,e,r,t.children));return h._sourceSegment=t,h._segmentIndexShift=n.length,{segmentGroup:h,slicedSegments:e}}const l=new Mn(t.segments,t.children);return l._sourceSegment=t,l._segmentIndexShift=n.length,{segmentGroup:l,slicedSegments:e}}function gA(t,n,e){return(!(t.hasChildren()||n.length>0)||"full"!==e.pathMatch)&&""===e.path}function HI(t,n,e,r){return!!(Ma(t)===r||r!==_n&&gA(n,e,t))&&("**"===t.path||Pb(n,t,e).matched)}function $I(t,n,e){return 0===n.length&&!t.children[e]}const _A=!1;class yA{constructor(n){this.segmentGroup=n||null}}class qI{constructor(n){this.urlTree=n}}function M_(t){return zf(new yA(t))}function WI(t){return zf(new qI(t))}class ZF{constructor(n,e,r,l,h){this.injector=n,this.configLoader=e,this.urlSerializer=r,this.urlTree=l,this.config=h,this.allowRedirects=!0}apply(){const n=mA(this.urlTree.root,[],[],this.config).segmentGroup,e=new Mn(n.segments,n.children);return this.expandSegmentGroup(this.injector,this.config,e,_n).pipe(ct(h=>this.createUrlTree(lA(h),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Jl(h=>{if(h instanceof qI)return this.allowRedirects=!1,this.match(h.urlTree);throw h instanceof yA?this.noMatchError(h):h}))}match(n){return this.expandSegmentGroup(this.injector,this.config,n.root,_n).pipe(ct(l=>this.createUrlTree(lA(l),n.queryParams,n.fragment))).pipe(Jl(l=>{throw l instanceof yA?this.noMatchError(l):l}))}noMatchError(n){return new rt(4002,_A)}createUrlTree(n,e,r){const l=fb(n);return new Sh(l,e,r)}expandSegmentGroup(n,e,r,l){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(n,e,r).pipe(ct(h=>new Mn([],h))):this.expandSegment(n,r,e,r.segments,l,!0)}expandChildren(n,e,r){const l=[];for(const h of Object.keys(r.children))"primary"===h?l.unshift(h):l.push(h);return An(l).pipe(Th(h=>{const _=r.children[h],C=VI(e,h);return this.expandSegmentGroup(n,C,_,h).pipe(ct(M=>({segment:M,outlet:h})))}),aI((h,_)=>(h[_.outlet]=_.segment,h),{}),lI())}expandSegment(n,e,r,l,h,_){return An(r).pipe(Th(C=>this.expandSegmentAgainstRoute(n,e,r,C,l,h,_).pipe(Jl(P=>{if(P instanceof yA)return Ft(null);throw P}))),Mh(C=>!!C),Jl((C,M)=>{if(Sb(C))return $I(e,l,h)?Ft(new Mn([],{})):M_(e);throw C}))}expandSegmentAgainstRoute(n,e,r,l,h,_,C){return HI(l,e,h,_)?void 0===l.redirectTo?this.matchSegmentAgainstRoute(n,e,l,h,_):C&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(n,e,r,l,h,_):M_(e):M_(e)}expandSegmentAgainstRouteUsingRedirect(n,e,r,l,h,_){return"**"===l.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(n,r,l,_):this.expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,l,h,_)}expandWildCardWithParamsAgainstRouteUsingRedirect(n,e,r,l){const h=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?WI(h):this.lineralizeSegments(r,h).pipe(zn(_=>{const C=new Mn(_,{});return this.expandSegment(n,C,e,_,l,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(n,e,r,l,h,_){const{matched:C,consumedSegments:M,remainingSegments:P,positionalParamSegments:B}=Pb(e,l,h);if(!C)return M_(e);const G=this.applyRedirectCommands(M,l.redirectTo,B);return l.redirectTo.startsWith("/")?WI(G):this.lineralizeSegments(l,G).pipe(zn(ie=>this.expandSegment(n,e,r,ie.concat(P),_,!1)))}matchSegmentAgainstRoute(n,e,r,l,h){return"**"===r.path?(n=zI(r,n),r.loadChildren?(r._loadedRoutes?Ft({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(n,r)).pipe(ct(C=>(r._loadedRoutes=C.routes,r._loadedInjector=C.injector,new Mn(l,{})))):Ft(new Mn(l,{}))):GI(e,r,l,n).pipe(hl(({matched:_,consumedSegments:C,remainingSegments:M})=>_?this.getChildConfig(n=r._injector??n,r,l).pipe(zn(B=>{const G=B.injector??n,ie=B.routes,{segmentGroup:ue,slicedSegments:ve}=mA(e,C,M,ie),Le=new Mn(ue.segments,ue.children);if(0===ve.length&&Le.hasChildren())return this.expandChildren(G,ie,Le).pipe(ct(Je=>new Mn(C,Je)));if(0===ie.length&&0===ve.length)return Ft(new Mn(C,{}));const qe=Ma(r)===h;return this.expandSegment(G,Le,ie,ve,qe?_n:h,!0).pipe(ct(bt=>new Mn(C.concat(bt.segments),bt.children)))})):M_(e)))}getChildConfig(n,e,r){return e.children?Ft({routes:e.children,injector:n}):e.loadChildren?void 0!==e._loadedRoutes?Ft({routes:e._loadedRoutes,injector:e._loadedInjector}):function zF(t,n,e,r){const l=n.canLoad;return void 0===l||0===l.length?Ft(!0):Ft(l.map(_=>{const C=$f(_,t);return Dh(function EF(t){return t&&I_(t.canLoad)}(C)?C.canLoad(n,e):t.runInContext(()=>C(n,e)))})).pipe(qf(),UI())}(n,e,r).pipe(zn(l=>l?this.configLoader.loadChildren(n,e).pipe(Dr(h=>{e._loadedRoutes=h.routes,e._loadedInjector=h.injector})):function qF(t){return zf(LI(_A,3))}())):Ft({routes:[],injector:n})}lineralizeSegments(n,e){let r=[],l=e.root;for(;;){if(r=r.concat(l.segments),0===l.numberOfChildren)return Ft(r);if(l.numberOfChildren>1||!l.children[_n])return n.redirectTo,zf(new rt(4e3,_A));l=l.children[_n]}}applyRedirectCommands(n,e,r){return this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r)}applyRedirectCreateUrlTree(n,e,r,l){const h=this.createSegmentGroup(n,e.root,r,l);return new Sh(h,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){const r={};return oo(n,(l,h)=>{if("string"==typeof l&&l.startsWith(":")){const C=l.substring(1);r[h]=e[C]}else r[h]=l}),r}createSegmentGroup(n,e,r,l){const h=this.createSegments(n,e.segments,r,l);let _={};return oo(e.children,(C,M)=>{_[M]=this.createSegmentGroup(n,C,r,l)}),new Mn(h,_)}createSegments(n,e,r,l){return e.map(h=>h.path.startsWith(":")?this.findPosParam(n,h,l):this.findOrReturn(h,r))}findPosParam(n,e,r){const l=r[e.path.substring(1)];if(!l)throw new rt(4001,_A);return l}findOrReturn(n,e){let r=0;for(const l of e){if(l.path===n.path)return e.splice(r),l;r++}return n}}class XF{}class JF{constructor(n,e,r,l,h,_,C){this.injector=n,this.rootComponentType=e,this.config=r,this.urlTree=l,this.url=h,this.paramsInheritanceStrategy=_,this.urlSerializer=C}recognize(){const n=mA(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,n,_n).pipe(ct(e=>{if(null===e)return null;const r=new hA([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},_n,this.rootComponentType,null,this.urlTree.root,-1,{}),l=new su(r,e),h=new RI(this.url,l);return this.inheritParamsAndData(h._root),h}))}inheritParamsAndData(n){const e=n.value,r=PI(e,this.paramsInheritanceStrategy);e.params=Object.freeze(r.params),e.data=Object.freeze(r.data),n.children.forEach(l=>this.inheritParamsAndData(l))}processSegmentGroup(n,e,r,l){return 0===r.segments.length&&r.hasChildren()?this.processChildren(n,e,r):this.processSegment(n,e,r,r.segments,l)}processChildren(n,e,r){return An(Object.keys(r.children)).pipe(Th(l=>{const h=r.children[l],_=VI(e,l);return this.processSegmentGroup(n,_,h,l)}),aI((l,h)=>l&&h?(l.push(...h),l):null),function yO(t,n=!1){return hi((e,r)=>{let l=0;e.subscribe(Jn(r,h=>{const _=t(h,l++);(_||n)&&r.next(h),!_&&r.complete()}))})}(l=>null!==l),eA(null),lI(),ct(l=>{if(null===l)return null;const h=QI(l);return function eL(t){t.sort((n,e)=>n.value.outlet===_n?-1:e.value.outlet===_n?1:n.value.outlet.localeCompare(e.value.outlet))}(h),h}))}processSegment(n,e,r,l,h){return An(e).pipe(Th(_=>this.processSegmentAgainstRoute(_._injector??n,_,r,l,h)),Mh(_=>!!_),Jl(_=>{if(Sb(_))return $I(r,l,h)?Ft([]):Ft(null);throw _}))}processSegmentAgainstRoute(n,e,r,l,h){if(e.redirectTo||!HI(e,r,l,h))return Ft(null);let _;if("**"===e.path){const C=l.length>0?hI(l).parameters:{},M=KI(r)+l.length;_=Ft({snapshot:new hA(l,C,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,YI(e),Ma(e),e.component??e._loadedComponent??null,e,XI(r),M,JI(e)),consumedSegments:[],remainingSegments:[]})}else _=GI(r,e,l,n).pipe(ct(({matched:C,consumedSegments:M,remainingSegments:P,parameters:B})=>{if(!C)return null;const G=KI(r)+M.length;return{snapshot:new hA(M,B,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,YI(e),Ma(e),e.component??e._loadedComponent??null,e,XI(r),G,JI(e)),consumedSegments:M,remainingSegments:P}}));return _.pipe(hl(C=>{if(null===C)return Ft(null);const{snapshot:M,consumedSegments:P,remainingSegments:B}=C;n=e._injector??n;const G=e._loadedInjector??n,ie=function tL(t){return t.children?t.children:t.loadChildren?t._loadedRoutes:[]}(e),{segmentGroup:ue,slicedSegments:ve}=mA(r,P,B,ie.filter(qe=>void 0===qe.redirectTo));if(0===ve.length&&ue.hasChildren())return this.processChildren(G,ie,ue).pipe(ct(qe=>null===qe?null:[new su(M,qe)]));if(0===ie.length&&0===ve.length)return Ft([new su(M,[])]);const Le=Ma(e)===h;return this.processSegment(G,ie,ue,ve,Le?_n:h).pipe(ct(qe=>null===qe?null:[new su(M,qe)]))}))}}function nL(t){const n=t.value.routeConfig;return n&&""===n.path&&void 0===n.redirectTo}function QI(t){const n=[],e=new Set;for(const r of t){if(!nL(r)){n.push(r);continue}const l=n.find(h=>r.value.routeConfig===h.value.routeConfig);void 0!==l?(l.children.push(...r.children),e.add(l)):n.push(r)}for(const r of e){const l=QI(r.children);n.push(new su(r.value,l))}return n.filter(r=>!e.has(r))}function XI(t){let n=t;for(;n._sourceSegment;)n=n._sourceSegment;return n}function KI(t){let n=t,e=n._segmentIndexShift??0;for(;n._sourceSegment;)n=n._sourceSegment,e+=n._segmentIndexShift??0;return e-1}function YI(t){return t.data||{}}function JI(t){return t.resolve||{}}function eM(t){return"string"==typeof t.title||null===t.title}function Rb(t){return hl(n=>{const e=t(n);return e?An(e).pipe(ct(()=>n)):Ft(n)})}const Wf=new vt("ROUTES");let Ob=(()=>{class t{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=$t(DC)}loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Ft(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);const r=Dh(e.loadComponent()).pipe(ct(nM),Dr(h=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=h}),tA(()=>{this.componentLoaders.delete(e)})),l=new rI(r,()=>new nr).pipe(ub());return this.componentLoaders.set(e,l),l}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ft({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const h=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(ct(C=>{this.onLoadEndListener&&this.onLoadEndListener(r);let M,P,B=!1;Array.isArray(C)?P=C:(M=C.create(e).injector,P=uI(M.get(Wf,[],Lt.Self|Lt.Optional)));return{routes:P.map(Db),injector:M}}),tA(()=>{this.childrenLoaders.delete(r)})),_=new rI(h,()=>new nr).pipe(ub());return this.childrenLoaders.set(r,_),_}loadModuleFactoryOrRoutes(e){return Dh(e()).pipe(ct(nM),zn(r=>r instanceof j1||Array.isArray(r)?Ft(r):An(this.compiler.compileModuleAsync(r))))}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function nM(t){return function uL(t){return t&&"object"==typeof t&&"default"in t}(t)?t.default:t}let AA=(()=>{class t{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new nr,this.configLoader=$t(Ob),this.environmentInjector=$t(xa),this.urlSerializer=$t(g_),this.rootContexts=$t(b_),this.navigationId=0,this.afterPreactivation=()=>Ft(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=l=>this.events.next(new KO(l)),this.configLoader.onLoadStartListener=l=>this.events.next(new XO(l))}complete(){this.transitions?.complete()}handleNavigationRequest(e){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...e,id:r})}setupNavigations(e){return this.transitions=new ul({id:0,targetPageId:0,currentUrlTree:e.currentUrlTree,currentRawUrl:e.currentUrlTree,extractedUrl:e.urlHandlingStrategy.extract(e.currentUrlTree),urlAfterRedirects:e.urlHandlingStrategy.extract(e.currentUrlTree),rawUrl:e.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:A_,restoredState:null,currentSnapshot:e.routerState.snapshot,targetSnapshot:null,currentRouterState:e.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Yl(r=>0!==r.id),ct(r=>({...r,extractedUrl:e.urlHandlingStrategy.extract(r.rawUrl)})),hl(r=>{let l=!1,h=!1;return Ft(r).pipe(Dr(_=>{this.currentNavigation={id:_.id,initialUrl:_.rawUrl,extractedUrl:_.extractedUrl,trigger:_.source,extras:_.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),hl(_=>{const C=e.browserUrlTree.toString(),M=!e.navigated||_.extractedUrl.toString()!==C||C!==e.currentUrlTree.toString();if(!M&&"reload"!==(_.extras.onSameUrlNavigation??e.onSameUrlNavigation)){const B="";return this.events.next(new uA(_.id,e.serializeUrl(r.rawUrl),B,0)),e.rawUrlTree=_.rawUrl,_.resolve(null),Jo}if(e.urlHandlingStrategy.shouldProcessUrl(_.rawUrl))return iM(_.source)&&(e.browserUrlTree=_.extractedUrl),Ft(_).pipe(hl(B=>{const G=this.transitions?.getValue();return this.events.next(new yb(B.id,this.urlSerializer.serialize(B.extractedUrl),B.source,B.restoredState)),G!==this.transitions?.getValue()?Jo:Promise.resolve(B)}),function QF(t,n,e,r){return hl(l=>function WF(t,n,e,r,l){return new ZF(t,n,e,r,l).apply()}(t,n,e,l.extractedUrl,r).pipe(ct(h=>({...l,urlAfterRedirects:h}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,e.config),Dr(B=>{this.currentNavigation={...this.currentNavigation,finalUrl:B.urlAfterRedirects},r.urlAfterRedirects=B.urlAfterRedirects}),function rL(t,n,e,r,l){return zn(h=>function YF(t,n,e,r,l,h,_="emptyOnly"){return new JF(t,n,e,r,l,_,h).recognize().pipe(hl(C=>null===C?function KF(t){return new pn(n=>n.error(t))}(new XF):Ft(C)))}(t,n,e,h.urlAfterRedirects,r.serialize(h.urlAfterRedirects),r,l).pipe(ct(_=>({...h,targetSnapshot:_}))))}(this.environmentInjector,this.rootComponentType,e.config,this.urlSerializer,e.paramsInheritanceStrategy),Dr(B=>{if(r.targetSnapshot=B.targetSnapshot,"eager"===e.urlUpdateStrategy){if(!B.extras.skipLocationChange){const ie=e.urlHandlingStrategy.merge(B.urlAfterRedirects,B.rawUrl);e.setBrowserUrl(ie,B)}e.browserUrlTree=B.urlAfterRedirects}const G=new $O(B.id,this.urlSerializer.serialize(B.extractedUrl),this.urlSerializer.serialize(B.urlAfterRedirects),B.targetSnapshot);this.events.next(G)}));if(M&&e.urlHandlingStrategy.shouldProcessUrl(e.rawUrlTree)){const{id:B,extractedUrl:G,source:ie,restoredState:ue,extras:ve}=_,Le=new yb(B,this.urlSerializer.serialize(G),ie,ue);this.events.next(Le);const qe=kI(G,this.rootComponentType).snapshot;return Ft(r={..._,targetSnapshot:qe,urlAfterRedirects:G,extras:{...ve,skipLocationChange:!1,replaceUrl:!1}})}{const B="";return this.events.next(new uA(_.id,e.serializeUrl(r.extractedUrl),B,1)),e.rawUrlTree=_.rawUrl,_.resolve(null),Jo}}),Dr(_=>{const C=new qO(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(C)}),ct(_=>r={..._,guards:AF(_.targetSnapshot,_.currentSnapshot,this.rootContexts)}),function kF(t,n){return zn(e=>{const{targetSnapshot:r,currentSnapshot:l,guards:{canActivateChecks:h,canDeactivateChecks:_}}=e;return 0===_.length&&0===h.length?Ft({...e,guardsResult:!0}):function PF(t,n,e,r){return An(t).pipe(zn(l=>function NF(t,n,e,r,l){const h=n&&n.routeConfig?n.routeConfig.canDeactivate:null;return h&&0!==h.length?Ft(h.map(C=>{const M=w_(n)??l,P=$f(C,M);return Dh(function TF(t){return t&&I_(t.canDeactivate)}(P)?P.canDeactivate(t,n,e,r):M.runInContext(()=>P(t,n,e,r))).pipe(Mh())})).pipe(qf()):Ft(!0)}(l.component,l.route,e,n,r)),Mh(l=>!0!==l,!0))}(_,r,l,t).pipe(zn(C=>C&&function CF(t){return"boolean"==typeof t}(C)?function RF(t,n,e,r){return An(n).pipe(Th(l=>Jv(function FF(t,n){return null!==t&&n&&n(new YO(t)),Ft(!0)}(l.route.parent,r),function OF(t,n){return null!==t&&n&&n(new eF(t)),Ft(!0)}(l.route,r),function BF(t,n,e){const r=n[n.length-1],h=n.slice(0,n.length-1).reverse().map(_=>function xF(t){const n=t.routeConfig?t.routeConfig.canActivateChild:null;return n&&0!==n.length?{node:t,guards:n}:null}(_)).filter(_=>null!==_).map(_=>iI(()=>Ft(_.guards.map(M=>{const P=w_(_.node)??e,B=$f(M,P);return Dh(function MF(t){return t&&I_(t.canActivateChild)}(B)?B.canActivateChild(r,t):P.runInContext(()=>B(r,t))).pipe(Mh())})).pipe(qf())));return Ft(h).pipe(qf())}(t,l.path,e),function LF(t,n,e){const r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||0===r.length)return Ft(!0);const l=r.map(h=>iI(()=>{const _=w_(n)??e,C=$f(h,_);return Dh(function IF(t){return t&&I_(t.canActivate)}(C)?C.canActivate(n,t):_.runInContext(()=>C(n,t))).pipe(Mh())}));return Ft(l).pipe(qf())}(t,l.route,e))),Mh(l=>!0!==l,!0))}(r,h,t,n):Ft(C)),ct(C=>({...e,guardsResult:C})))})}(this.environmentInjector,_=>this.events.next(_)),Dr(_=>{if(r.guardsResult=_.guardsResult,Kd(_.guardsResult))throw FI(0,_.guardsResult);const C=new WO(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot,!!_.guardsResult);this.events.next(C)}),Yl(_=>!!_.guardsResult||(e.restoreHistory(_),this.cancelNavigationTransition(_,"",3),!1)),Rb(_=>{if(_.guards.canActivateChecks.length)return Ft(_).pipe(Dr(C=>{const M=new ZO(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(M)}),hl(C=>{let M=!1;return Ft(C).pipe(function oL(t,n){return zn(e=>{const{targetSnapshot:r,guards:{canActivateChecks:l}}=e;if(!l.length)return Ft(e);let h=0;return An(l).pipe(Th(_=>function sL(t,n,e,r){const l=t.routeConfig,h=t._resolve;return void 0!==l?.title&&!eM(l)&&(h[f_]=l.title),function aL(t,n,e,r){const l=function lL(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}(t);if(0===l.length)return Ft({});const h={};return An(l).pipe(zn(_=>function cL(t,n,e,r){const l=w_(n)??r,h=$f(t,l);return Dh(h.resolve?h.resolve(n,e):l.runInContext(()=>h(n,e)))}(t[_],n,e,r).pipe(Mh(),Dr(C=>{h[_]=C}))),hb(1),function vO(t){return ct(()=>t)}(h),Jl(_=>Sb(_)?Jo:zf(_)))}(h,t,n,r).pipe(ct(_=>(t._resolvedData=_,t.data=PI(t,e).resolve,l&&eM(l)&&(t.data[f_]=l.title),null)))}(_.route,r,t,n)),Dr(()=>h++),hb(1),zn(_=>h===l.length?Ft(e):Jo))})}(e.paramsInheritanceStrategy,this.environmentInjector),Dr({next:()=>M=!0,complete:()=>{M||(e.restoreHistory(C),this.cancelNavigationTransition(C,"",2))}}))}),Dr(C=>{const M=new QO(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(M)}))}),Rb(_=>{const C=M=>{const P=[];M.routeConfig?.loadComponent&&!M.routeConfig._loadedComponent&&P.push(this.configLoader.loadComponent(M.routeConfig).pipe(Dr(B=>{M.component=B}),ct(()=>{})));for(const B of M.children)P.push(...C(B));return P};return cb(C(_.targetSnapshot.root)).pipe(eA(),Qd(1))}),Rb(()=>this.afterPreactivation()),ct(_=>{const C=function cF(t,n,e){const r=x_(t,n._root,e?e._root:void 0);return new SI(r,n)}(e.routeReuseStrategy,_.targetSnapshot,_.currentRouterState);return r={..._,targetRouterState:C}}),Dr(_=>{e.currentUrlTree=_.urlAfterRedirects,e.rawUrlTree=e.urlHandlingStrategy.merge(_.urlAfterRedirects,_.rawUrl),e.routerState=_.targetRouterState,"deferred"===e.urlUpdateStrategy&&(_.extras.skipLocationChange||e.setBrowserUrl(e.rawUrlTree,_),e.browserUrlTree=_.urlAfterRedirects)}),((t,n,e)=>ct(r=>(new vF(n,r.targetRouterState,r.currentRouterState,e).activate(t),r)))(this.rootContexts,e.routeReuseStrategy,_=>this.events.next(_)),Qd(1),Dr({next:_=>{l=!0,this.lastSuccessfulNavigation=this.currentNavigation,e.navigated=!0,this.events.next(new Yd(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(e.currentUrlTree))),e.titleStrategy?.updateTitle(_.targetRouterState.snapshot),_.resolve(!0)},complete:()=>{l=!0}}),tA(()=>{l||h||this.cancelNavigationTransition(r,"",1),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Jl(_=>{if(h=!0,NI(_)){BI(_)||(e.navigated=!0,e.restoreHistory(r,!0));const C=new cA(r.id,this.urlSerializer.serialize(r.extractedUrl),_.message,_.cancellationCode);if(this.events.next(C),BI(_)){const M=e.urlHandlingStrategy.merge(_.url,e.rawUrlTree),P={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===e.urlUpdateStrategy||iM(r.source)};e.scheduleNavigation(M,A_,null,P,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{e.restoreHistory(r,!0);const C=new vb(r.id,this.urlSerializer.serialize(r.extractedUrl),_,r.targetSnapshot??void 0);this.events.next(C);try{r.resolve(e.errorHandler(_))}catch(M){r.reject(M)}}return Jo}))}))}cancelNavigationTransition(e,r,l){const h=new cA(e.id,this.urlSerializer.serialize(e.extractedUrl),r,l);this.events.next(h),e.resolve(!1)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function iM(t){return t!==A_}let rM=(()=>{class t{buildTitle(e){let r,l=e.root;for(;void 0!==l;)r=this.getResolvedTitleForRoute(l)??r,l=l.children.find(h=>h.outlet===_n);return r}getResolvedTitleForRoute(e){return e.data[f_]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return $t(hL)},providedIn:"root"}),t})(),hL=(()=>{class t extends rM{constructor(e){super(),this.title=e}updateTitle(e){const r=this.buildTitle(e);void 0!==r&&this.title.setTitle(r)}}return t.\u0275fac=function(e){return new(e||t)(mt(QE))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),dL=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return $t(fL)},providedIn:"root"}),t})();class pL{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}}let fL=(()=>{class t extends pL{}return t.\u0275fac=function(){let n;return function(r){return(n||(n=wr(t)))(r||t)}}(),t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const xA=new vt("",{providedIn:"root",factory:()=>({})});let gL=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:function(){return $t(_L)},providedIn:"root"}),t})(),_L=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function yL(t){throw t}function vL(t,n,e){return n.parse("/")}const AL={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},xL={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Xs=(()=>{class t{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=$t(K2),this.isNgZoneEnabled=!1,this.options=$t(xA,{optional:!0})||{},this.errorHandler=this.options.errorHandler||yL,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||vL,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=$t(gL),this.routeReuseStrategy=$t(dL),this.urlCreationStrategy=$t(sF),this.titleStrategy=$t(rM),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=uI($t(Wf,{optional:!0})??[]),this.navigationTransitions=$t(AA),this.urlSerializer=$t(g_),this.location=$t(Lx),this.isNgZoneEnabled=$t(tr)instanceof tr&&tr.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Sh,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=kI(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(e=>{this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId},e=>{this.console.warn(`Unhandled Navigation Error: ${e}`)})}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const e=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),A_,e)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const r="popstate"===e.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{this.navigateToSyncWithBrowser(e.url,r,e.state)},0)}))}navigateToSyncWithBrowser(e,r,l){const h={replaceUrl:!0},_=l?.navigationId?l:null;if(l){const M={...l};delete M.navigationId,delete M.\u0275routerPageId,0!==Object.keys(M).length&&(h.state=M)}const C=this.parseUrl(e);this.scheduleNavigation(C,r,_,h)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(e){this.config=e.map(Db),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,r={}){const{relativeTo:l,queryParams:h,fragment:_,queryParamsHandling:C,preserveFragment:M}=r,P=M?this.currentUrlTree.fragment:_;let B=null;switch(C){case"merge":B={...this.currentUrlTree.queryParams,...h};break;case"preserve":B=this.currentUrlTree.queryParams;break;default:B=h||null}return null!==B&&(B=this.removeEmptyProps(B)),this.urlCreationStrategy.createUrlTree(l,this.routerState,this.currentUrlTree,e,B,P??null)}navigateByUrl(e,r={skipLocationChange:!1}){const l=Kd(e)?e:this.parseUrl(e),h=this.urlHandlingStrategy.merge(l,this.rawUrlTree);return this.scheduleNavigation(h,A_,null,r)}navigate(e,r={skipLocationChange:!1}){return function bL(t){for(let n=0;n<t.length;n++){const e=t[n];if(null==e)throw new rt(4008,false)}}(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let r;try{r=this.urlSerializer.parse(e)}catch(l){r=this.malformedUriErrorHandler(l,this.urlSerializer,e)}return r}isActive(e,r){let l;if(l=!0===r?{...AL}:!1===r?{...xL}:r,Kd(e))return pI(this.currentUrlTree,e,l);const h=this.parseUrl(e);return pI(this.currentUrlTree,h,l)}removeEmptyProps(e){return Object.keys(e).reduce((r,l)=>{const h=e[l];return null!=h&&(r[l]=h),r},{})}scheduleNavigation(e,r,l,h,_){if(this.disposed)return Promise.resolve(!1);let C,M,P,B;return _?(C=_.resolve,M=_.reject,P=_.promise):P=new Promise((G,ie)=>{C=G,M=ie}),B="computed"===this.canceledNavigationResolution?l&&l.\u0275routerPageId?l.\u0275routerPageId:h.replaceUrl||h.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:B,source:r,restoredState:l,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:h,resolve:C,reject:M,promise:P,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),P.catch(G=>Promise.reject(G))}setBrowserUrl(e,r){const l=this.urlSerializer.serialize(e),h={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(l)||r.extras.replaceUrl?this.location.replaceState(l,"",h):this.location.go(l,"",h)}restoreHistory(e,r=!1){if("computed"===this.canceledNavigationResolution){const l=this.currentPageId-e.targetPageId;"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===l?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===l&&(this.resetState(e),this.browserUrlTree=e.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(l)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=e.currentRouterState,this.currentUrlTree=e.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return"computed"===this.canceledNavigationResolution?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),bA=(()=>{class t{constructor(e,r,l,h,_,C){this.router=e,this.route=r,this.tabIndexAttribute=l,this.renderer=h,this.el=_,this.locationStrategy=C,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new nr;const M=_.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===M||"area"===M,this.isAnchorElement?this.subscription=e.events.subscribe(P=>{P instanceof Yd&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(e){this._preserveFragment=Bf(e)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(e){this._skipLocationChange=Bf(e)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(e){this._replaceUrl=Bf(e)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(e){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(e){null!=e?(this.commands=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(e,r,l,h,_){return!!(null===this.urlTree||this.isAnchorElement&&(0!==e||r||l||h||_||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const e=null===this.href?null:function og(t,n,e){return function v0(t,n){return"src"===n&&("embed"===t||"frame"===t||"iframe"===t||"media"===t||"script"===t)||"href"===n&&("base"===t||"link"===t)?Jp:Aa}(n,e)(t)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",e)}applyAttributeValue(e,r){const l=this.renderer,h=this.el.nativeElement;null!==r?l.setAttribute(h,e,r):l.removeAttribute(h,e)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return t.\u0275fac=function(e){return new(e||t)(He(Xs),He(kh),function Tp(t){return function Gu(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const e=t.attrs;if(e){const r=e.length;let l=0;for(;l<r;){const h=e[l];if(Dn(h))break;if(0===h)l+=2;else if("number"==typeof h)for(l++;l<r&&"string"==typeof e[l];)l++;else{if(h===n)return e[l+1];l+=2}}}return null}(fi(),t)}("tabindex"),He(Ja),He(Vr),He(Wd))},t.\u0275dir=Bt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(e,r){1&e&&ft("click",function(h){return r.onClick(h.button,h.ctrlKey,h.shiftKey,h.altKey,h.metaKey)}),2&e&&xe("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[ji]}),t})();class oM{}let EL=(()=>{class t{constructor(e,r,l,h,_){this.router=e,this.injector=l,this.preloadingStrategy=h,this.loader=_}setUpPreloading(){this.subscription=this.router.events.pipe(Yl(e=>e instanceof Yd),Th(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,r){const l=[];for(const h of r){h.providers&&!h._injector&&(h._injector=Cv(h.providers,e,`Route: ${h.path}`));const _=h._injector??e,C=h._loadedInjector??_;(h.loadChildren&&!h._loadedRoutes&&void 0===h.canLoad||h.loadComponent&&!h._loadedComponent)&&l.push(this.preloadConfig(_,h)),(h.children||h._loadedRoutes)&&l.push(this.processRoutes(C,h.children??h._loadedRoutes))}return An(l).pipe(Do())}preloadConfig(e,r){return this.preloadingStrategy.preload(r,()=>{let l;l=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(e,r):Ft(null);const h=l.pipe(zn(_=>null===_?Ft(void 0):(r._loadedRoutes=_.routes,r._loadedInjector=_.injector,this.processRoutes(_.injector??e,_.routes))));return r.loadComponent&&!r._loadedComponent?An([h,this.loader.loadComponent(r)]).pipe(Do()):h})}}return t.\u0275fac=function(e){return new(e||t)(mt(Xs),mt(DC),mt(xa),mt(oM),mt(Ob))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Lb=new vt("");let sM=(()=>{class t{constructor(e,r,l,h,_={}){this.urlSerializer=e,this.transitions=r,this.viewportScroller=l,this.zone=h,this.options=_,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},_.scrollPositionRestoration=_.scrollPositionRestoration||"disabled",_.anchorScrolling=_.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof yb?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof Yd&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.urlSerializer.parse(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(e=>{e instanceof TI&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new TI(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return t.\u0275fac=function(e){!function Qc(){throw new Error("invalid")}()},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();var Ks=(()=>((Ks=Ks||{})[Ks.COMPLETE=0]="COMPLETE",Ks[Ks.FAILED=1]="FAILED",Ks[Ks.REDIRECTING=2]="REDIRECTING",Ks))();const Zf=!1;function Ph(t,n){return{\u0275kind:t,\u0275providers:n}}const Bb=new vt("",{providedIn:"root",factory:()=>!1});function lM(){const t=$t(xo);return n=>{const e=t.get(Rv);if(n!==e.components[0])return;const r=t.get(Xs),l=t.get(cM);1===t.get(Nb)&&r.initialNavigation(),t.get(uM,null,Lt.Optional)?.setUpPreloading(),t.get(Lb,null,Lt.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),l.closed||(l.next(),l.complete(),l.unsubscribe())}}const cM=new vt(Zf?"bootstrap done indicator":"",{factory:()=>new nr}),Nb=new vt(Zf?"initial navigation":"",{providedIn:"root",factory:()=>1});function SL(){let t=[];return t=Zf?[{provide:jl,multi:!0,useFactory:()=>{const n=$t(Xs);return()=>n.events.subscribe(e=>{console.group?.(`Router Event: ${e.constructor.name}`),console.log(function nF(t){if(!("type"in t))return`Unknown Router Event: ${t.constructor.name}`;switch(t.type){case 14:return`ActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${t.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${t.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state}, shouldActivate: ${t.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 2:return`NavigationCancel(id: ${t.id}, url: '${t.url}')`;case 16:return`NavigationSkipped(id: ${t.id}, url: '${t.url}')`;case 1:return`NavigationEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${t.id}, url: '${t.url}', error: ${t.error})`;case 0:return`NavigationStart(id: ${t.id}, url: '${t.url}')`;case 6:return`ResolveEnd(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 5:return`ResolveStart(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 10:return`RouteConfigLoadEnd(path: ${t.route.path})`;case 9:return`RouteConfigLoadStart(path: ${t.route.path})`;case 4:return`RoutesRecognized(id: ${t.id}, url: '${t.url}', urlAfterRedirects: '${t.urlAfterRedirects}', state: ${t.state})`;case 15:return`Scroll(anchor: '${t.anchor}', position: '${t.position?`${t.position[0]}, ${t.position[1]}`:null}')`}}(e)),console.log(e),console.groupEnd?.()})}}]:[],Ph(1,t)}const uM=new vt(Zf?"router preloader":"");function kL(t){return Ph(0,[{provide:uM,useExisting:EL},{provide:oM,useExisting:t}])}const T_=!1,hM=new vt(T_?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),PL=[Lx,{provide:g_,useClass:db},Xs,b_,{provide:kh,useFactory:function aM(t){return t.routerState.root},deps:[Xs]},Ob,T_?{provide:Bb,useValue:!0}:[]];function RL(){return new BC("Router",Xs)}let dM=(()=>{class t{constructor(e){}static forRoot(e,r){return{ngModule:t,providers:[PL,T_&&r?.enableTracing?SL().\u0275providers:[],{provide:Wf,multi:!0,useValue:e},{provide:hM,useFactory:BL,deps:[[Xs,new sr,new ni]]},{provide:xA,useValue:r||{}},r?.useHash?{provide:Wd,useClass:Nk}:{provide:Wd,useClass:sE},{provide:Lb,useFactory:()=>{const t=$t(nR),n=$t(tr),e=$t(xA),r=$t(AA),l=$t(g_);return e.scrollOffset&&t.setOffset(e.scrollOffset),new sM(l,r,t,n,e)}},r?.preloadingStrategy?kL(r.preloadingStrategy).\u0275providers:[],{provide:BC,multi:!0,useFactory:RL},r?.initialNavigation?NL(r):[],[{provide:pM,useFactory:lM},{provide:LC,multi:!0,useExisting:pM}]]}}static forChild(e){return{ngModule:t,providers:[{provide:Wf,multi:!0,useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)(mt(hM,8))},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[Mb]}),t})();function BL(t){if(T_&&t)throw new rt(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function NL(t){return["disabled"===t.initialNavigation?Ph(3,[{provide:Sv,multi:!0,useFactory:()=>{const n=$t(Xs);return()=>{n.setUpLocationChangeListener()}}},{provide:Nb,useValue:2}]).\u0275providers:[],"enabledBlocking"===t.initialNavigation?Ph(2,[{provide:Nb,useValue:0},{provide:Sv,multi:!0,deps:[xo],useFactory:n=>{const e=n.get(Lk,Promise.resolve());return()=>e.then(()=>new Promise(r=>{const l=n.get(Xs),h=n.get(cM);(function IL(t,n){t.events.pipe(Yl(e=>e instanceof Yd||e instanceof cA||e instanceof vb||e instanceof uA),ct(e=>e instanceof Yd||e instanceof uA?Ks.COMPLETE:e instanceof cA&&(0===e.code||1===e.code)?Ks.REDIRECTING:Ks.FAILED),Yl(e=>e!==Ks.REDIRECTING),Qd(1)).subscribe(()=>{n()})})(l,()=>{r(!0)}),n.get(AA).afterPreactivation=()=>(r(!0),h.closed?Ft(void 0):h),l.initialNavigation()}))}}]).\u0275providers:[]]}const pM=new vt(T_?"Router Initializer":""),VL=JSON.parse('[{"capital":"Tirana","country":"Albania","favourite":false,"visited":false,"planned":false,"url":"https://cebraarchitecture.dk/cebra-architecture/wp-content/uploads/2022/10/15-mount-tirana.jpg","description":"Tirana is the capital and largest city of Albania. It is located in the center of the country, on the Ishm River. Tirana has a population of over 410,000 people. The city was founded in the 17th century by the Ottoman Turks. It became the capital of Albania in 1920.Tirana is a modern city with a mix of old and new architecture. The city center is home to many government buildings, museums, and theaters. There are also many parks and green spaces in Tirana. The city is a popular tourist destination, with many historical and cultural attractions.","images":["https://cdn.britannica.com/36/195936-050-7CF4E835/Tirana-Albania.jpg","https://theholisticbackpacker.com/wp-content/uploads/2022/08/MG_1858.jpg","https://sp-ao.shortpixel.ai/client/to_webp,q_lossless,ret_img,w_1080,h_720/https://drivemefoody.com/wp-content/uploads/albania-tirana-sunset-view-sky-tower-1080x720.jpg","https://travellingbalkans.com/wp-content/uploads/2019/09/DJI_0853-HDR-1150x862.jpg"]},{"capital":"Andorra la Vella","country":"Andorra","favourite":false,"visited":false,"planned":false,"url":"https://images.lucasfox.com/location/4x3_1600w/050EB433EF.jpg","description":"Andorra la Vella is the capital of Andorra, a small country located in the Pyrenees Mountains between France and Spain. It is the highest capital city in Europe, at an elevation of 1,023 meters (3,356 feet).Andorra la Vella is a small city, with a population of just over 22,000 people. The city is home to the Andorran government, as well as a number of shops, restaurants, and hotels.","images":["https://mediaim.expedia.com/destination/2/40fb4f1cc18151717167e3b334236a09.jpg","https://d19tiqumqauva7.cloudfront.net/var/andorra/storage/images/www.andorra.ad/multimedia/galeria/cultura/itineraris-culturals/itinerari-cultural-andorra-la-vella/1906x960_itinerari-cultural-andorra-la-vella/24104076-1-cat-ES/1906x960_itinerari-cultural-andorra-la-vella.jpg","https://www.collinsdictionary.com/images/full/andorralavella_317791925_1000.jpg","https://www.worldatlas.com/r/w1200/upload/97/4b/c8/shutterstock-64114618.jpg"]},{"capital":"Vienna","country":"Austria","favourite":false,"visited":false,"planned":false,"url":"https://www.travelandleisure.com/thmb/zFpjulihpXjpUV7gKNHzydvJANA=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/vienna-austria-VIENNATG0621-ecb0ee926c2d49c4bce610db594f7405.jpg","description":"Vienna is the capital of Austria and the largest city in the country. It is located in the east of Austria, on the Danube River. Vienna has a population of over 1.9 million people. The city is a major center for culture, education, and politics in Austria. Vienna is a beautiful city with a rich history. The city center is home to many historical landmarks, including the Hofburg Palace, the Sch\xf6nbrunn Palace, and the St. Stephen\'s Cathedral. Vienna is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://i2-prod.manchestereveningnews.co.uk/incoming/article16169571.ece/ALTERNATES/s1200c/0_Vienna-central.jpg","https://d3vonci41uckcv.cloudfront.net/old-images/original/3762e33f-6ff4-4d13-a254-96d3b68fee4c.austria-vienna-danube.jpg","https://www.kkhotels.com/wp-content/uploads/2018/12/2020-02-12-13_52_04-Vienna-Sunset.jpg-IrfanView-Selection_-94-0-800-x-630-1.270.png","https://www.travelanddestinations.com/wp-content/uploads/2016/04/Vienna-Austria-Best-things-to-do.jpg"]},{"capital":"Minsk","country":"Belarus","favourite":false,"visited":false,"planned":false,"url":"https://www.intrepidtravel.com/adventures/wp-content/uploads/2019/06/shutterstock_1282471396.jpg","description":"\\nMinsk is the capital and largest city of Belarus. It is located on the Svisloch River, in the central part of the country. Minsk has a population of over 2 million people. The city was founded in the 11th century and has been the capital of Belarus since 1919. Minsk is a modern city with a mix of old and new architecture. The city center is home to many government buildings, museums, and theaters. There are also many parks and green spaces in Minsk. The city is a popular tourist destination, with many historical and cultural attractions.","images":["https://thumbs.dreamstime.com/b/panorama-paysage-urbain-de-minsk-belarus-%C3%A9t%C3%A9-64569970.jpg","https://www.reisepassnummer.de/assets/images/2018/05/06/minsk/minsk-2677096_1920_klein.jpg","https://belarus24.by/upload/medialibrary/1ff/1ffdf19f8814695789d4b9e5f752d561.jpg","https://vetliva.com/upload/resize_cache/iblock/10c/1170_640_23ee4b948f86b68649480f85209bcab9f/10c2348146dd2cf572624e5635662c93.jpg"]},{"capital":"Brussels","country":"Belgium","favourite":false,"visited":false,"planned":false,"url":"https://www.visit.brussels/en/visitors/_jcr_content/root/container/content_1226746056_c/multicolumn/teaser_2005755142.coreimg.jpeg/1675354196799/grand-place-4212-%C2%A9-visit.brussels---jean-michel-byl.jpeg","description":"\\nBrussels is the capital of Belgium and of the Brussels-Capital Region. It is a major European center of finance, diplomacy, and culture, with headquarters of many of the world\'s biggest international organizations, including NATO and the European Union. Brussels is a beautiful city with a rich history. The city center is home to many historical landmarks, including the Grand Place, the Manneken Pis, and the Atomium. Brussels is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://c0.wallpaperflare.com/preview/396/1004/936/belgium-bruxelles-atomium.jpg","https://c0.wallpaperflare.com/preview/705/114/463/grand-place-brussels-belgium-travel.jpg","https://c0.wallpaperflare.com/preview/907/665/188/belgium-brussels-parc-du-cinquantenaire-europe.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Grand-Place%2C_Brussels_-_panorama%2C_June_2018.jpg/1024px-Grand-Place%2C_Brussels_-_panorama%2C_June_2018.jpg"]},{"capital":"Sarajevo","country":"Bosnia and Herzegovina","favourite":false,"visited":false,"planned":false,"url":"https://www.flydubai.com/en/media/Sarajevo_710x473_tcm8-5999.jpg","description":"\\nSarajevo is the capital and largest city of Bosnia and Herzegovina. It is located in the heart of the country, at the confluence of the Miljacka and Bosna rivers. Sarajevo has a population of over 275,000 people. Sarajevo is a beautiful city with a mix of old and new architecture. The city center is home to many historical landmarks, including the Gazi Husrev-bey Mosque, the Vije\u0107nica (City Hall), and the Latin Bridge. Sarajevo is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://e0.pxfuel.com/wallpapers/431/272/desktop-wallpaper-stari-grad-old-town-sarajevo-bosnia-and-herzegovina.jpg","https://w0.peakpx.com/wallpaper/145/898/HD-wallpaper-gazi-husrev-beg-s-mosque-sarajevo-bosnia-bosnia-mosque-bascarsija-sarajevo-classic-ottoman.jpg","https://c1.wallpaperflare.com/preview/560/490/360/bosnia-and-herzegovina-bosnia-sarajevo-miljacka.jpg","https://c0.wallpaperflare.com/preview/55/401/192/bosnia-and-herzegovina-sarajevo-vrelo-bosne.jpg"]},{"capital":"Sofia","country":"Bulgaria","favourite":false,"visited":false,"planned":false,"url":"https://tourscanner.com/blog/wp-content/uploads/2022/07/things-to-do-in-Sofia.jpg","description":"Sofia is the capital of Bulgaria and the largest city in the country. It is located in the western part of Bulgaria, at the foot of Vitosha Mountain. Sofia has a population of over 1.2 million people. Sofia is a beautiful city with a mix of old and new architecture. The city center is home to many historical landmarks, including the Alexander Nevsky Cathedral, the Boyana Church, and the National Historical Museum. Sofia is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://c4.wallpaperflare.com/wallpaper/499/728/926/alexander-nevsky-cathedral-sofia-bulgaria-wallpaper-preview.jpg","https://c0.wallpaperflare.com/preview/884/117/291/sofia-bulgaria-crowd-mountain.jpg","https://c1.wallpaperflare.com/preview/335/230/440/bulgaria-national-assembly-sofia-parliament.jpg","https://c0.wallpaperflare.com/preview/970/196/870/sofia-bulgaria-architecture-cathedral.jpg"]},{"capital":"Zagreb","country":"Croatia","favourite":false,"visited":false,"planned":false,"url":"https://static.nationalgeographic.co.uk/files/styles/image_3200/public/zagrebgettyimages-1144074611hr.jpg?w=1900&h=1267","description":"Zagreb is the capital and largest city of Croatia. It is located in the northwest of the country, at the confluence of the Sava and Krka rivers. Zagreb has a population of over 800,000 people. Zagreb is a beautiful city with a mix of old and new architecture. The city center is home to many historical landmarks, including the Zagreb Cathedral, the Lotr\u0161\u010dak Tower, and the Stone Gate. Zagreb is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://c1.wallpaperflare.com/preview/115/346/484/zagreb-cathedral-europe-croatia.jpg","https://c1.wallpaperflare.com/preview/866/699/781/zagreb-jarun-park-bright-sunny.jpg","https://c0.wallpaperflare.com/preview/625/570/420/croatia-zagreb-ban-josip-jela%C4%8Di%C4%87-square.jpg","https://c1.wallpaperflare.com/preview/128/677/163/ban-jela%C4%8Di%C4%87-building-croatia-photo.jpg"]},{"capital":"Nicosia","country":"Cyprus","favourite":false,"visited":false,"planned":false,"url":"https://www.visitnicosia.com.cy/wp-content/uploads/2021/08/inner_teaser-1024x683.jpg","description":"Nicosia (Greek: \u039b\u03b5\u03c5\u03ba\u03c9\u03c3\u03af\u03b1, Lefkosia; Turkish: Lefko\u015fa) is the capital and largest city of Cyprus. It is located in the centre of the Mesaoria Plain, on the banks of the Pedieos River. Nicosia is the seat of the government of the Republic of Cyprus, as well as the seat of the Turkish Cypriot community\'s self-declared capital, North Nicosia. Nicosia is also a modern city with a vibrant economy. The city is home to many businesses, banks, and universities. Nicosia is a popular tourist destination, with something to offer everyone. Whether you\'re interested in history, culture, or nightlife, you\'re sure to find something to enjoy in Nicosia.","images":["https://c1.wallpaperflare.com/preview/190/232/905/cyprus-nicosia-square-sculpture-city-building.jpg","https://w0.peakpx.com/wallpaper/714/928/HD-wallpaper-selimiye-mosque-city-of-edirne.jpg","https://w0.peakpx.com/wallpaper/356/150/HD-wallpaper-kykkos-monastery-in-cyprus-christianity-europe-cyprus-monastery.jpg","https://e1.pxfuel.com/desktop-wallpaper/827/318/desktop-wallpaper-of-cyprus-nicosia-nicosia.jpg"]},{"capital":"Prague","country":"Czech Republic","favourite":false,"visited":false,"planned":false,"url":"https://static.independent.co.uk/s3fs-public/thumbnails/image/2018/06/20/09/prague-overview.jpg","description":"Prague, the capital of the Czech Republic, is a beautiful city with a rich history. It is located on the Vltava River in the central part of the country. Prague has a population of over 1.2 million people. Prague is a beautiful city with a mix of old and new architecture. The city center is home to many historical landmarks, including the Charles Bridge, the Prague Castle, and the Old Town Square. Prague is also home to many museums, art galleries, and theaters. The city is a popular tourist destination, with something to offer everyone.","images":["https://c4.wallpaperflare.com/wallpaper/902/457/184/prague-charles-bridge-czech-republic-river-vltava-evening-lights-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/49/957/162/architecture-building-evening-lights-wallpaper-preview.jpg","https://w0.peakpx.com/wallpaper/335/817/HD-wallpaper-dancing-house-in-prague-building-city-dance-prague.jpg","https://media.tacdn.com/media/attractions-splice-spp-674x446/0b/e1/1b/2c.jpg"]},{"capital":"Copenhagen","country":"Denmark","favourite":false,"visited":false,"planned":false,"url":"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/28/74/c2/dc/caption.jpg?w=700&h=500&s=1","description":"Copenhagen is the capital of Denmark and one of the most popular tourist destinations in Europe. The city is known for its beautiful architecture, its vibrant nightlife, and its many green spaces. Copenhagen is home to a number of world-famous landmarks, including the Amalienborg Palace, the Rosenborg Castle, and the Round Tower. The city also has a number of museums, including the National Museum of Denmark, the Royal Danish Academy of Fine Arts, and the Copenhagen Museum. In addition to its cultural attractions, Copenhagen is also a great place to enjoy the outdoors. The city has a number of parks and gardens, including the Rosenborg Castle Gardens, the Amalienborg Palace Gardens, and the Copenhagen Botanical Garden. Copenhagen is also home to a number of beaches, including the Langelinie Beach and the Islands Brygge Beach.","images":["https://www.travelandleisure.com/thmb/G5hwSYQUTvgGQISOXymFUYYr-Iw=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/copenhagen-dk-COPENHAGENTG0721-4a481cb6025b43d1a781b1571b144f46.jpg","https://a.cdn-hotels.com/gdcs/production28/d1675/f55e58c8-c184-4198-a75d-4b146892de4c.jpg","https://www.visitcopenhagen.com/sites/visitcopenhagen.com/files/2023-02/Bike%20city%20-%20photo%20credits%20VisitCopenhagen%2028.jpg","https://www.staysure.co.uk/wp-content/uploads/2015/07/copenhagen_skyline.jpg"]},{"capital":"Tallinn","country":"Estonia","favourite":false,"visited":false,"planned":false,"url":"https://static.visitestonia.com/images/3560295/1600_900_false_false_82b4d1c3132c5a4824361d0abbf38603.jpg","description":"Tallinn is the capital of Estonia and is located on the coast of the Gulf of Finland. It is a beautiful city with a rich history dating back to the 13th century. Tallinn is a popular tourist destination and is known for its well-preserved medieval Old Town. Tallinn is a great place to visit for a weekend getaway or a longer vacation. With its rich history, culture, and nightlife, there\'s something for everyone in Tallinn.","images":["https://lp-cms-production.imgix.net/features/2015/12/tallinn-old-town-1500-cs.jpg","https://file.visittallinn.ee/w1u4r7/detail-tallinnchristmasmarkett2020kaupokalda3.jpg","https://c4.wallpaperflare.com/wallpaper/472/513/107/tallinn-estonia-old-town-road-houses-wallpaper-preview.jpg","https://w0.peakpx.com/wallpaper/473/100/HD-wallpaper-tallinn-town-hall-raekoja-plats-town-hall-square-evening-square-tallinn-cityscape-estonia.jpg"]},{"capital":"T\xf3rshavn","country":"Faroe Islands","favourite":false,"visited":false,"planned":false,"url":"https://upload.wikimedia.org/wikipedia/commons/1/18/Vestaravag_torshavn%2C_faroe_islands%2C_feb_2005.jpg","description":"Torshavn is a small city with a population of around 17,000 people. It is located on the Streymoy Island, the largest of the Faroe Islands. Torshavn is a popular tourist destination, known for its beautiful scenery, charming old town, and vibrant cultural scene. Torshavn is a great place to visit for a weekend getaway or a longer vacation. With its beautiful scenery, charming old town, and vibrant cultural scene, there\'s something for everyone in Torshavn.","images":["https://www.iwanderlista.com/wp-content/uploads/2022/03/Torshavn-6.jpg","https://cdn.britannica.com/88/141188-050-E9E53A17/Torshavn-Faroe-Islands-Den.jpg","https://handluggageonly.co.uk/wp-content/uploads/2016/07/13305200_10154232920874784_2219183897590260675_o.jpg","https://questo.imgix.net/misc/5abd05ec-6874-4e73-bf71-e2b4b17d2a7f.jpeg"]},{"capital":"Helsinki","country":"Finland","favourite":false,"visited":false,"planned":false,"url":"https://a.cdn-hotels.com/gdcs/production0/d1589/6d9eed40-c31d-11e8-9739-0242ac110006.jpg","description":"Helsinki is the capital of Finland and the most populous city in the Nordic countries. It is located on a peninsula in the Gulf of Finland, with a population of over 600,000 people. Helsinki is a modern city with a rich history, dating back to the 16th century. The city is home to many historical landmarks, including the Senate Square, the Helsinki Cathedral, and the Uspenski Cathedral. Helsinki is also a popular tourist destination, known for its beautiful scenery, vibrant cultural scene, and excellent public transportation system.","images":["https://c1.wallpaperflare.com/preview/382/764/980/helsinki-cathedral-cathedral-church-helsinki-finland-architecture.jpg","https://c1.wallpaperflare.com/preview/146/591/743/suomenlinna-viapori-kustaanmiekka-island.jpg","https://c0.wallpaperflare.com/preview/521/839/733/finland-helsinki-uspenski-cathedral-russian-church.jpg","https://c4.wallpaperflare.com/wallpaper/871/289/283/finland-fortress-helsinki-island-suomenlinna-hd-wallpaper-preview.jpg"]},{"capital":"Paris","country":"France","favourite":false,"visited":false,"planned":false,"url":"https://travellersworldwide.com/wp-content/uploads/2022/12/Shutterstock_2045606852.jpg","description":"Paris is the capital of France and one of the most popular tourist destinations in the world. The city is located on the Seine River in the north-central part of France. Paris has a population of over 2.2 million people and is the most populous city in France. Paris is a city with a rich history dating back to the Roman era. The city has been home to many important events in history, including the French Revolution and the World Wars. Paris is also a city of art and culture, and is home to many famous landmarks, including the Eiffel Tower, the Louvre Museum, and the Notre Dame Cathedral.","images":["https://c4.wallpaperflare.com/wallpaper/930/781/157/eiffel-tower-paris-hd-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/54/118/440/louvre-paris-france-pyramid-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/851/252/967/paris-france-notre-dame-de-paris-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/572/901/228/the-sky-france-paris-the-evening-wallpaper-preview.jpg"]},{"capital":"Berlin","country":"Germany","favourite":false,"visited":false,"planned":false,"url":"https://media.timeout.com/images/105303515/750/422/image.jpg","description":"Berlin is the capital and largest city of Germany. It is located in northeastern Germany, on the River Spree. Berlin is a major center for culture, politics, media, and science. The city has a population of over 3.5 million people.\\n\\nBerlin is a city with a rich history. The city was founded in the 13th century and has been the capital of Germany since 1871. Berlin was heavily damaged during World War II, but it was rebuilt and has since become a thriving metropolis.\\n\\nBerlin is a city of contrasts. The city is home to many historical landmarks, such as the Brandenburg Gate and the Reichstag, but it is also home to a vibrant and diverse cultural scene. Berlin is a city that is constantly changing and evolving, and it is a great place to visit for a weekend getaway or a longer vacation.","images":["https://c4.wallpaperflare.com/wallpaper/492/1012/59/monuments-brandenburg-gate-berlin-germany-wallpaper-preview.jpg","https://c0.wallpaperflare.com/preview/512/220/946/berlin-reichstag-building-germany.jpg","https://e0.pxfuel.com/wallpapers/866/265/desktop-wallpaper-berlin-wall-berlin-street.jpg","https://c4.wallpaperflare.com/wallpaper/958/325/226/berlin-museum-island-wallpaper-preview.jpg"]},{"capital":"Gibraltar","country":"Gibraltar","favourite":false,"visited":false,"planned":false,"url":"https://cdn.britannica.com/61/191561-050-1507BA4F/Gibraltar.jpg","description":"Gibraltar is a British overseas territory located on the southern tip of the Iberian Peninsula. It is bordered to the north by Spain and has an area of 6.7 square kilometers. Gibraltar is a popular tourist destination, known for its beautiful scenery, its strategic location on the Strait of Gibraltar, and its history as a British outpost.\\n\\nThe Rock of Gibraltar is the most prominent feature of the territory. It is a limestone massif that rises to a height of 426 meters above sea level. The Rock is home to a variety of plant and animal life, including Barbary apes, which are the only wild monkeys in Europe.","images":["https://theplanetd.com/images/Rock-of-Gibraltar.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/b/b5/Catalan_Bay_Gibraltar.jpg/1024px-Catalan_Bay_Gibraltar.jpg","https://cdn.britannica.com/61/191561-050-1507BA4F/Gibraltar.jpg","https://ichef.bbci.co.uk/news/976/mcs/media/images/73969000/jpg/_73969578_gibraltar_peninsular_g.jpg"]},{"capital":"Athens","country":"Greece","favourite":false,"visited":false,"planned":false,"url":"https://cdn.britannica.com/66/102266-050-FBDEFCA1/acropolis-city-state-Greece-Athens.jpg","description":"Athens is the capital of Greece and is one of the oldest cities in Europe. It is located on the Attica peninsula, and has a population of over 3.7 million people. Athens is a major center for culture, politics, and education. It is home to the National Archaeological Museum, which houses a collection of artifacts from ancient Greece, and the University of Athens, which is the oldest university in Greece. Athens is also a popular tourist destination. The city is home to many historical landmarks, including the Acropolis, the Parthenon, and the Temple of Olympian Zeus. The Acropolis is a hilltop citadel that was once the center of ancient Athens. The Parthenon is a temple that was built on the Acropolis in the 5th century BC. The Temple of Olympian Zeus was a temple that was built in the 2nd century AD.","images":["https://c4.wallpaperflare.com/wallpaper/732/34/491/greece-athens-acropolis-parthenon-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/836/388/907/europe-parthenon-greece-athen-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/607/836/982/ancient-history-tourism-ruins-temple-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/257/14/559/architecture-old-building-lights-evening-wallpaper-preview.jpg"]},{"capital":"St Peter Port","country":"Guernsey","favourite":false,"visited":false,"planned":false,"url":"https://www.pocruises.com/content/dam/po/inventory-assets/ports/GCI/GCI.jpg.1591372901030.image.750.563.low.jpg","description":"St Peter Port is the capital of Guernsey, a British Crown dependency in the English Channel. It is a small, charming town with a population of around 20,000 people. St Peter Port is located on the east coast of Guernsey and is the island\'s main port. The town has a long and rich history. It was founded by the Normans in the 11th century and has been the capital of Guernsey since the 13th century. St Peter Port was heavily damaged during World War II, but it has been rebuilt and is now a thriving town. St Peter Port is a popular tourist destination. The town has a beautiful harbor, a historic old town, and a variety of shops, restaurants, and cafes. St Peter Port is also a popular destination for walkers and cyclists.","images":["https://c1.wallpaperflare.com/preview/275/677/80/castle-island-castle-cornet-drone.jpg","https://c4.wallpaperflare.com/wallpaper/173/772/919/castles-castle-cornet-architecture-bailiwick-of-guernsey-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/273/418/521/colors-of-dawn-in-guernsey-channel-isls-wallpaper-preview.jpg","https://c0.wallpaperflare.com/preview/703/699/820/guernsey-torteval-drone-pleinmont.jpg"]},{"capital":"Budapest","country":"Hungary","favourite":false,"visited":false,"planned":false,"url":"https://www.tripsavvy.com/thmb/YZCXPivyMUxMidbeyv7VLEizlEE=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/the-hungarian-parliament-on-the-danube-river-at-sunset-in-budapest--hungary-945207010-23afbc9012d54bc4bb7c8a1f8c90075b.jpg","description":"\\nBudapest is the capital of Hungary and is one of the most beautiful cities in Europe. It is located on the banks of the Danube River and is divided into two parts: Buda and Pest. Buda is the older part of the city and is home to many historical landmarks, including the Buda Castle, the Matthias Church, and the Fisherman\'s Bastion. Pest is the newer part of the city and is home to many cultural attractions, including the Hungarian Parliament Building, the Great Market Hall, and the House of Terror.","images":["https://c1.wallpaperflare.com/preview/788/723/600/buda-castle-buda-castle-at-night-budapest-hungary.jpg","https://c1.wallpaperflare.com/preview/919/653/201/budapest-hungary-bastion-fisherman-s.jpg","https://c4.wallpaperflare.com/wallpaper/786/863/822/chain-bridge-budapest-hungary-europe-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/128/698/536/the-sky-the-city-lights-construction-the-evening-hd-wallpaper-preview.jpg"]},{"capital":"Reykjav\xedk","country":"Iceland","favourite":false,"visited":false,"planned":false,"url":"https://cdn.britannica.com/71/73371-050-9DFAEC1E/Reykjavik-Iceland.jpg","description":"Reykjavik is the northernmost capital city in the world. It is located on the southwestern coast of Iceland, on a peninsula that juts into Faxa Bay. The city has a population of around 120,000 people, making it the largest city in Iceland. Reykjavik is a young city, founded in 874 AD by Ing\xf3lfur Arnarson. The city grew slowly for many years, but it began to grow rapidly in the 20th century. Today, Reykjavik is a major center for business, culture, and tourism.","images":["https://e0.pxfuel.com/wallpapers/695/604/desktop-wallpaper-magnificent-hallgrimskirkja-church-reykjavik-iceland-statue-modern.jpg","https://c1.wallpaperflare.com/preview/971/362/540/iceland-harpa-concert-hall-reykjavik-architecture-building.jpg","https://c1.wallpaperflare.com/preview/731/853/104/iceland-sun-voyager-reykjavik-monument.jpg","https://cdn.britannica.com/71/73371-050-9DFAEC1E/Reykjavik-Iceland.jpg"]},{"capital":"Dublin","country":"Ireland","favourite":false,"visited":false,"planned":false,"url":"https://upload.wikimedia.org/wikipedia/commons/4/42/Samuel_Beckett_Bridge_At_Sunset_Dublin_Ireland_%2897037639%29_%28cropped%29.jpeg","description":"Dublin is the capital and largest city of Ireland. It is located on the east coast of Ireland, at the mouth of the River Liffey. The city has a population of 1,348,300 (2016) and is the center of the Dublin metropolitan area, which has a population of 1,906,228 (2016). Dublin is a vibrant and cosmopolitan city with something to offer everyone. The city has a thriving arts scene, with theaters, museums, and galleries. Dublin is also home to many festivals, including the Dublin Film Festival, the Dublin Theatre Festival, and the Dublin City Marathon.","images":["https://c4.wallpaperflare.com/wallpaper/557/474/428/library-books-trinity-college-library-dublin-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/291/749/265/ha-penny-bridge-and-river-liffey-at-night-dublin-ireland-wallpaper-preview.jpg","https://c1.wallpaperflare.com/preview/724/161/76/dublin-st-patrick-st-patrick-s-cathedral-cathedral-irish-architecture.jpg","https://tetu.com/wp-content/uploads/2016/04/irlande12-1024x768.jpg"]},{"capital":"Douglas","country":"Isle of Man","favourite":false,"visited":false,"planned":false,"url":"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/10/50/fb/04/the-steam-packet.jpg?w=600&h=400&s=1","description":"Douglas is the capital and largest town of the Isle of Man, a self-governing British Crown dependency in the Irish Sea. It is located on the east coast of the island, at the mouth of the River Douglas. Douglas is a popular tourist destination, with a mild climate and a variety of attractions, including the Isle of Man Steam Railway, the Manx Museum, and the Villa Marina Theatre. The town is also home to a number of festivals and events, including the Isle of Man TT Races and the Manx Grand Prix.","images":["https://www.placenorthwest.co.uk/wp-content/uploads/Douglas-generic-c-John-Hall-for-Culture-Vannin-CC-BY-SA-2.0-bit.ly-SLASH-3MAAIEH-650x460.jpg","https://c.files.bbci.co.uk/10AD/production/_107096240_horsetram20192.jpg","https://qtxasset.com/quartz/qcloud1/media/image/luxurytraveladvisor/1522955978/DouglasIsleofManPanmauleiStockGettyImagesPlusGettyImages.jpg/DouglasIsleofManPanmauleiStockGettyImagesPlusGettyImages.jpg?VersionId=bLKAfz_fMgvQFT07HSWacf.xBN.LVnBt","https://media.istockphoto.com/id/1065171108/photo/panorama-of-douglas-on-the-isle-of-man.jpg?s=612x612&w=0&k=20&c=NURXguKbrET0TTLIEbs2se66M-Kuy1wb_iFgRPy0m2o="]},{"capital":"Rome","country":"Italy","favourite":false,"visited":false,"planned":false,"url":"https://lp-cms-production.imgix.net/2021-03/500pxRF_77415821.jpg?auto=format&w=1440&h=810&fit=crop&q=75","description":"Rome is the capital of Italy and one of the most popular tourist destinations in the world. The city is home to a wealth of historical and cultural attractions, including the Colosseum, the Roman Forum, and the Vatican City. Rome was founded in the 8th century BC by the Romans, who made it the capital of their empire. The city reached its peak in the 1st century AD, when it was the largest and most powerful city in the world. Rome continued to be an important center of culture and learning throughout the Middle Ages and Renaissance.","images":["https://c4.wallpaperflare.com/wallpaper/265/778/338/colosseum-amphitheatre-ancient-colosseum-amphitheatre-wallpaper-preview.jpg","https://c1.wallpaperflare.com/preview/259/924/891/italy-rome-trevi-fountain-sculpture.jpg","https://c4.wallpaperflare.com/wallpaper/648/386/575/building-home-area-rome-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/45/849/224/pantheon-rome-italy-wallpaper-preview.jpg"]},{"capital":"Saint Helier","country":"Jersey","favourite":false,"visited":false,"planned":false,"url":"https://www.seabourn.com/content/dam/sbn65/inventory-assets/ports/em/sh2/port-st-helier-jersey.jpg","description":"Saint Helier is the capital of Jersey, a self-governing British Crown dependency in the English Channel. The town is located on the south coast of Jersey, on the eastern end of St Aubin\'s Bay. It is the most populated parish of Jersey, with a population of over 35,000. Saint Helier is a thriving commercial center, with a wide variety of shops, restaurants, and bars. The town is also home to a number of historical and cultural attractions, including the Elizabeth Castle, the Jersey Museum & Art Gallery, and the Royal Square. Saint Helier is a popular tourist destination, with a mild climate and a beautiful setting. The town is also a popular destination for business travelers, with a number of hotels and conference facilities.","images":["https://c4.wallpaperflare.com/wallpaper/226/115/694/nature-landscape-beach-sea-wallpaper-preview.jpg","https://www.britain-magazine.com/wp-content/uploads/JerseyCastle.jpg","https://cdn.britannica.com/84/126384-050-3671F8F9/Hermitage-Saint-Helier-LIslet-Jersey-Channel-Islands.jpg","https://previews.123rf.com/images/ambeon/ambeon2103/ambeon210300009/165231986-saint-helier-capital-city-panorama-with-port-and-marina-in-the-foreground-bailiwick-of-jersey.jpg"]},{"capital":"Pristina","country":"Kosovo","favourite":false,"visited":false,"planned":false,"url":"https://i.pinimg.com/originals/15/50/e1/1550e1defd089b0e1b6b0028d52d6399.jpg","description":"Pristina is the capital and largest city of Kosovo. It is located in the north-eastern part of the country, close to the Goljak mountains. The city has a population of over 200,000 people, and is the center of government, business, and culture in Kosovo. Pristina has a long and rich history. The city was founded in the 11th century, and has been ruled by a number of different empires, including the Ottomans, the Austrians, and the Serbians. Pristina was heavily damaged during the Kosovo War in the 1990s, but has since been rebuilt. Today, Pristina is a modern city with a mix of old and new architecture. The city is home to a number of universities, museums, and cultural institutions. Pristina is also a popular tourist destination, with a number of historical and cultural attractions, including the Grand Mosque, the Mother Teresa Cathedral, and the Pristina Fortress.","images":["https://cdn.getyourguide.com/img/location/5a1d57c05dcf5.jpeg/75.jpg","https://wander-lush.org/wp-content/uploads/2019/05/Emily-Lush-Prishtina-Kosovo-37.jpg","https://www.ncronline.org/files/webRNS-KOSOVO2-09052017.jpg","https://solohappy.com/wp-content/uploads/2022/12/Best-places-to-visit-in-Pristina-Kosovo-1200x640.jpg"]},{"capital":"Riga","country":"Latvia","favourite":false,"visited":false,"planned":false,"url":"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a9/Vistas_desde_la_iglesia_de_San_Pedro%2C_Riga%2C_Letonia%2C_2012-08-07%2C_DD_04_%28cropped%29.JPG/1200px-Vistas_desde_la_iglesia_de_San_Pedro%2C_Riga%2C_Letonia%2C_2012-08-07%2C_DD_04_%28cropped%29.JPG","description":"Riga is the capital of Latvia, located on the Baltic Sea. It is the largest city in the Baltic states with a population of over 600,000 people. Riga has a long and rich history, dating back to the 13th century. The city has been ruled by a number of different empires, including the Germans, the Swedes, and the Russians. Riga was heavily damaged during World War II, but has since been rebuilt. Riga is a beautiful city with a lot to offer visitors. The city is home to a number of historical and cultural attractions, including the Riga Cathedral, the House of the Black Heads, and the Central Market. Riga is also a popular tourist destination for its vibrant nightlife and its many restaurants and bars.","images":["https://c4.wallpaperflare.com/wallpaper/442/996/899/town-lights-architecture-church-wallpaper-preview.jpg","https://cdn.britannica.com/78/115478-050-71EB889C/Old-Town-Latvia-Riga-Daugava-River.jpg","https://www.spectator.co.uk/wp-content/uploads/2022/09/iStock-615926196.jpg","https://cdn.getyourguide.com/img/location/538cab118c1d7.jpeg/75.jpg"]},{"capital":"Vaduz","country":"Liechtenstein","favourite":false,"visited":false,"planned":false,"url":"https://upload.wikimedia.org/wikipedia/commons/e/e3/Vaduz.jpg","description":"Vaduz is the capital and largest city of Liechtenstein, a small German-speaking alpine country located between Switzerland and Austria. It is situated on the Rhine River, at the foot of the Alps. The city has a population of around 5,000 people. Vaduz is a charming city with a medieval feel. The main street, St\xe4dtle, is lined with shops, restaurants, and cafes. The city is also home to a number of historical buildings, including Vaduz Castle, the seat of the Liechtenstein government.","images":["https://c4.wallpaperflare.com/wallpaper/237/22/441/two-white-and-gray-kitten-beside-wooden-surface-cats-cats-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/875/550/429/snow-mountains-landscape-nature-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/530/538/361/towns-vaduz-liechtenstein-wallpaper-preview.jpg","https://upload.wikimedia.org/wikipedia/commons/e/e3/Vaduz.jpg"]},{"capital":"Vilnius","country":"Lithuania","favourite":false,"visited":false,"planned":false,"url":"https://www.roadaffair.com/wp-content/uploads/2020/03/aerial-view-hot-air-balloon-vilnius-lithuania-shutterstock_1288741006.jpg","description":"Vilnius is the capital of Lithuania, a country located in Eastern Europe. It is the largest city in Lithuania, with a population of over 500,000 people. Vilnius is a beautiful city with a rich history and culture. It is home to many historical and cultural landmarks, including the Vilnius Cathedral, the Gediminas Castle Tower, and the Hill of Three Crosses. Vilnius is also a popular tourist destination, with many things to see and do.","images":["https://c1.wallpaperflare.com/preview/708/842/390/lithuania-vilnius-cathedral.jpg","https://c1.wallpaperflare.com/preview/497/55/820/lithuania-vilnius-churches-cathedral.jpg","https://c1.wallpaperflare.com/preview/513/992/856/lithuania-vilnius-st-catherine-s-church-historically-mirroring-cathedral.jpg","https://c1.wallpaperflare.com/preview/798/9/297/vilnius-lithuania-europe-city.jpg"]},{"capital":"Luxembourg","country":"Luxembourg","favourite":false,"visited":false,"planned":false,"url":"https://static.euronews.com/articles/stories/05/66/80/50/1440x810_cmsv2_82112269-e4ca-5196-bb34-92241777d094-5668050.jpg","description":"Luxembourg is a small country in Western Europe, bordered by Belgium to the west and north, France to the south, and Germany to the east. The capital and largest city of Luxembourg is Luxembourg City. The country has a population of about 640,000 people. Luxembourg is a constitutional monarchy, with Grand Duke Henri as the head of state. The current prime minister is Xavier Bettel. The official languages of Luxembourg are Luxembourgish, French, and German.","images":["https://c1.wallpaperflare.com/preview/632/826/542/luxembourg-ville-haute-city-architecture.jpg","https://c1.wallpaperflare.com/preview/17/341/229/luxembourg-city-landscape-cityscape.jpg","https://c1.wallpaperflare.com/preview/553/221/159/architecture-building-castle-photos.jpg","https://cdn.britannica.com/08/178008-050-93B5F493/Alzette-River-city-Luxembourg.jpg"]},{"capital":"Skopje","country":"Macedonia","favourite":false,"visited":false,"planned":false,"url":"https://www.staysure.co.uk/wp-content/uploads/2016/09/Alexander-the-Great-Monument-in-Skopje.jpg","description":"Skopje is the capital and largest city of North Macedonia. It is located in the central part of the country, on the banks of the Vardar River. The city has a population of about 546,000 people. Today, Skopje is a modern city with a mix of old and new architecture. The city is home to a number of historical and cultural landmarks, including the Old Bazaar, the Kale Fortress, and the Mother Teresa Memorial House. Skopje is also a popular tourist destination, known for its vibrant nightlife and its delicious food.","images":["https://explore.mk/wp-content/uploads/2020/02/shutterstock_173849720.jpg","https://explore.mk/wp-content/uploads/2020/02/shutterstock_142027141aaa.png","https://www.golivegotravel.nl/wp-content/uploads/2018/12/Statues-Skopje.jpeg","https://freesofiatour.com/wp-content/uploads/2020/01/how-to-get-to-skopje-e1579877405853.jpg"]},{"capital":"Valletta","country":"Malta","favourite":false,"visited":false,"planned":false,"url":"https://a.cdn-hotels.com/gdcs/production38/d1036/f7b5ecf3-139d-4c55-b89f-a79f655e2224.jpg","description":"Valletta is the capital of Malta, a small island nation in the Mediterranean Sea. It is a walled city that was founded in the 16th century by the Knights of St. John, a Roman Catholic military order. Valletta is known for its Baroque architecture, its many museums and palaces, and its stunning views of the Mediterranean Sea. Valletta was named a UNESCO World Heritage Site in 1980. It is the smallest capital city in the European Union, with a population of just over 5,000 people.","images":["https://e1.pxfuel.com/desktop-wallpaper/666/906/desktop-wallpaper-valletta-capital-of-malta-grand-harbour-old-valletta.jpg","https://image.geo.de/30128698/t/jk/v4/w1440/r0/-/valetta-f-105026194-jpg--73015-.jpg","https://www.weseektravel.com/wp-content/uploads/2022/11/things-to-do-in-valletta-malta-1.jpg","https://www.travellingking.com/wp-content/uploads/2022/10/Valletta-Aerial-view-of-Valletta-city-capital-of-Malta-country.-.jpg"]},{"capital":"Chi\u015fin\u0103u","country":"Moldova","favourite":false,"visited":false,"planned":false,"url":"https://t3.ftcdn.net/jpg/02/31/19/22/360_F_231192271_RypDJREDSkBdnBbp1rvLN8qBu5awRubi.jpg","description":"Chisinau, also known as Kishinev, is the capital of Moldova. It is located in the central part of the country, on the B\xe2c River. The city has a population of over 600,000 people.\\n\\nChisinau is a relatively young city, founded in 1752. The city was originally named Kishinev, after the name of a nearby village. In 1812, Kishinev was annexed by the Russian Empire and renamed Chisinau.\\n\\nChisinau is a major cultural and economic center in Moldova. The city is home to a number of universities, museums, and theaters. Chisinau is also a major industrial center, with a number of factories producing wine, food, and textiles.","images":["https://static.independent.co.uk/2021/09/24/16/iStock-1066138896.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/Arch_of_Triumph%2C_Chisinau%2C_Republic_of_Moldova_%2851160304626_cropped%29.jpg/1200px-Arch_of_Triumph%2C_Chisinau%2C_Republic_of_Moldova_%2851160304626_cropped%29.jpg","https://d1bvpoagx8hqbg.cloudfront.net/originals/experience-chisinau-moldova-alexandra-20a84e1dbde81963ff3323a47fe83978.jpg","https://img.ev.mu/images/attractions/7282/960x640/753308.jpg"]},{"capital":"Monaco","country":"Monaco","favourite":false,"visited":false,"planned":false,"url":"https://static.euronews.com/articles/stories/06/17/95/94/1440x810_cmsv2_2f761865-3d02-59bc-9c7f-06158b32b00d-6179594.jpg","description":"Monaco, officially the Principality of Monaco, is a sovereign city-state and microstate on the French Riviera a few kilometres west of the Italian region of Liguria, in Western Europe, on the Mediterranean Sea. It is bordered by France to the north, east and west. Monaco is the second smallest country in the world, after Vatican City. It is also the most densely populated country in the world, with a population of over 38,000 people living in an area of just 0.78 square miles.","images":["https://e1.pxfuel.com/desktop-wallpaper/242/882/desktop-wallpaper-the-monte-carlo-casino-monte-carlo-monaco-widescreen-monaco.jpg","https://c4.wallpaperflare.com/wallpaper/194/592/15/cities-monaco-cruise-ship-museum-wallpaper-preview.jpg","https://img.bekiaviajes.com/articulos/portada/79000/79686.jpg","https://hips.hearstapps.com/hmg-prod/images/ferraris-monegasque-driver-charles-leclerc-drives-during-news-photo-1650649175.jpg"]},{"capital":"Podgorica","country":"Montenegro","favourite":false,"visited":false,"planned":false,"url":"https://waytomonte.com/img/slider/8/1/7055/60f4ee3a5707e0c918a90da0dabf8a10_thumb.jpg","description":"Podgorica is the capital and largest city of Montenegro. It is located in the central part of the country, on the banks of the Mora\u010da River. The city has a population of about 198,000 people. Podgorica is a young city, with its current form dating back to the 19th century. However, the city has a long and rich history, dating back to the 7th century BC. Podgorica was once the capital of the Kingdom of Duklja, and it was also an important center of the Roman Empire and the Ottoman Empire.","images":["https://c1.wallpaperflare.com/preview/87/646/512/podgorica-montenegro-city-capital.jpg","https://cdn.britannica.com/43/145343-050-5042276C/Podgorica-Monte.jpg","https://thumbs.dreamstime.com/b/podgorica-panoramic-view-capital-largest-city-montenegro-residential-commercial-part-podgori-sunny-winter-day-172944566.jpg","https://www.bhfieldschool.org/uploaded/gallery/BH%20Field%20School%20Towns%20-%20Podgorica.1-6961.JPG"]},{"capital":"Amsterdam","country":"Netherlands","favourite":false,"visited":false,"planned":false,"url":"https://media.timeout.com/images/105504583/750/422/image.jpg","description":"Amsterdam is the capital of the Netherlands, located in the province of North Holland. It is the most populous city in the Netherlands, with a population of over 870,000 people. Amsterdam is a popular tourist destination, known for its canals, museums, and vibrant nightlife. The city is built on a series of canals, which are used for transportation and recreation. The canals are lined with beautiful 17th-century houses, which give the city a unique charm. Amsterdam is home to a number of museums, including the Rijksmuseum, the Van Gogh Museum, and the Anne Frank House. The Rijksmuseum houses a collection of Dutch art, including works by Rembrandt and Vermeer. The Van Gogh Museum houses a collection of Van Gogh\'s paintings, including \\"The Starry Night\\" and \\"Sunflowers.\\" The Anne Frank House is a museum dedicated to the life of Anne Frank, a Jewish girl who hid from the Nazis during World War II.","images":["https://static.independent.co.uk/2021/10/08/17/iStock-516188849.jpg","https://a.cdn-hotels.com/gdcs/production82/d1440/1c5a8da3-35c4-48ce-a6a8-bbedc5fd013e.jpg","https://a.cdn-hotels.com/gdcs/production92/d539/dde53919-277b-4cdc-90fc-dfae0846b282.jpg","https://cdn-ffeol.nitrocdn.com/XvtpqXVmEaOeVBUbzBMDShrhLDOERTbY/assets/static/optimized/rev-a667f81/wp-content/uploads/2021/02/Prettiest-Amsterdam-streets.jpg"]},{"capital":"Oslo","country":"Norway","favourite":false,"visited":false,"planned":false,"url":"https://a.cdn-hotels.com/gdcs/production106/d1597/5303351b-a7d2-4775-994a-348002ea13d2.jpg","description":"Oslo is the capital and most populous city of Norway. It is located in southeastern Norway, on the Oslofjord. The city has a population of about 672,000 people. Oslo is a modern city with a mix of old and new architecture. The city is home to a number of historical and cultural landmarks, including the Akershus Fortress, the Royal Palace, and the Oslo Opera House. Oslo is also a popular tourist destination, known for its vibrant nightlife and its delicious food.","images":["https://c1.wallpaperflare.com/preview/662/779/806/city-urban-bridge-sunset.jpg","https://c1.wallpaperflare.com/preview/19/136/953/oslo-opera-house-norway-opera.jpg","https://c1.wallpaperflare.com/preview/539/76/845/akershus-fortress-at-night-norway.jpg","https://c1.wallpaperflare.com/preview/707/1009/149/oslo-castle-norway-royal-castle.jpg"]},{"capital":"Warsaw","country":"Poland","favourite":false,"visited":false,"planned":false,"url":"https://s.inyourpocket.com/img/text/poland/warsaw/warsaw-city-centre_drone-in-warsaw-2.jpg","description":"Warsaw is the capital and largest city of Poland. It is located on the Vistula River in east-central Poland, and its population is officially estimated at 1.765 million as of 2017. Warsaw is the most populous city in Poland and the 9th most populous city in the European Union. Warsaw is a popular tourist destination, known for its historical and cultural landmarks, including the Old Town, the Royal Castle, and the Palace of Culture and Science. Warsaw is also home to a number of museums and art galleries, including the National Museum, the Warsaw Uprising Museum, and the Copernicus Science Centre.","images":["https://e0.pxfuel.com/wallpapers/952/644/desktop-wallpaper-palace-of-culture-and-science-warsaw-poland-%E2%9D%A4-ultra-culture.jpg","https://c4.wallpaperflare.com/wallpaper/599/175/739/dusk-eu-europe-poland-wallpaper-preview.jpg","https://c0.wallpaperflare.com/preview/359/442/555/poland-warsaw-%C5%82azienki-park-park.jpg","https://dag08uxs564ub.cloudfront.net/images/warsaw-the-old-town.max-1280x768.jpg"]},{"capital":"Lisbon","country":"Portugal","favourite":false,"visited":false,"planned":false,"url":"https://www.back-packer.org/wp-content/uploads/best-things-to-do-in-lisbon-portugal-title.jpg","description":"\\nLisbon is the capital and largest city of Portugal, with a population of approximately 505,000 within its administrative limits. It is located on the western coast of the Iberian Peninsula, on the Tagus River estuary. Lisbon is a beautiful city with a lot to offer visitors. The city is home to a number of historical and cultural landmarks, including the S\xe3o Jorge Castle, the Bel\xe9m Tower, and the Jer\xf3nimos Monastery. Lisbon is also home to a number of museums, art galleries, and theaters.","images":["https://c1.wallpaperflare.com/preview/1012/802/545/jeronimos-monastery-monastery-church-religion-lisbon-portugal.jpg","https://c1.wallpaperflare.com/preview/689/804/980/lisbon-portugal-castle-of-sao-jorge-castle.jpg","https://c4.wallpaperflare.com/wallpaper/306/557/199/castle-belem-tower-lisbon-portugal-wallpaper-preview.jpg","https://c4.wallpaperflare.com/wallpaper/681/364/897/rossio-square-lisbon-portugal-wallpaper-preview.jpg"]},{"capital":"Bucharest","country":"Romania","favourite":false,"visited":false,"planned":false,"url":"https://img.traveltriangle.com/blog/wp-content/uploads/2019/01/Cover-for-Summer-In-Bucharest.jpg","description":"Bucharest is the capital and largest city of Romania. It is located in the south of the country, on the banks of the D\xe2mbovi\u021ba River. The city has a population of over 1.9 million people. Bucharest is a city with a long and rich history. It was founded in the 14th century and was the capital of the Principality of Wallachia from 1459 to 1861. In 1861, Bucharest became the capital of the United Principalities of Romania.","images":["https://romaniatourstore.com/wp-content/uploads/2016/09/Triumphant-Arch-Bucharest-2.jpg","https://romaniatourstore.com/wp-content/uploads/2015/10/The-Palace-of-Parliament.jpg","https://romaniatourstore.com/wp-content/uploads/2014/03/shutterstock_493813045.jpg","https://media.tacdn.com/media/attractions-splice-spp-674x446/07/16/cc/43.jpg"]},{"capital":"San Marino","country":"San Marino","favourite":false,"visited":false,"planned":false,"url":"https://www.solosophie.com/wp-content/uploads/2023/04/san-marino-guide_1381614365.jpeg","description":"San Marino is a small country located in the central part of Italy. It is completely surrounded by Italy and has an area of only 61 square kilometers. The capital of San Marino is also called San Marino. San Marino is the fifth smallest country in the world and the third smallest country in Europe. It has a population of about 33,000 people. The official language of San Marino is Italian. San Marino is a microstate, which means that it is a sovereign state that is very small in size. It is the oldest surviving republic in the world, having been founded in 301 AD.","images":["https://cdn.britannica.com/02/141002-050-7B946D16/one-fortresses-Guaita-city-San-Marino.jpg","https://www.beerandcroissants.com/wp-content/uploads/2017/12/city-of-san-marino.jpg","https://s27363.pcdn.co/wp-content/uploads/2017/10/San-Marino-in-Rain.jpg.optimal.jpg","https://cdn.britannica.com/54/142954-050-C5675BFB/Borgo-Maggiore-San-Marino.jpg"]},{"capital":"Belgrade","country":"Serbia","favourite":false,"visited":false,"planned":false,"url":"https://deih43ym53wif.cloudfront.net/sava-river-belgrade-serbia-shutterstock_695817301_6e9c75d6d4.jpeg","description":"Belgrade is the capital and largest city of Serbia. It is located at the confluence of the Sava and Danube rivers, in the central part of the country. The city has a population of over 1.2 million people. Belgrade is a beautiful and vibrant city with a lot to offer visitors. The city is home to a number of historical and cultural landmarks, including the Belgrade Fortress, the National Assembly of Serbia, and the Temple of Saint Sava. Belgrade is also home to a number of museums, art galleries, and theaters.","images":["https://lp-cms-production.imgix.net/features/2017/09/Belgrade-Knez-Mihailova-street-af958c3aa30c.jpg","https://cdn.britannica.com/57/96057-050-BD18B6F6/Boats-Danube-River-Belgrade-Serbia.jpg","https://efs-belgrade2022.org/wp-content/uploads/2022/09/Knez.png","https://www.nationsonline.org/gallery/Serbia/Aerial-view-of-Belgrade.jpg"]},{"capital":"Bratislava","country":"Slovakia","favourite":false,"visited":false,"planned":false,"url":"https://sacr3-files.s3-eu-west-1.amazonaws.com/_processed_/csm_Bratislavsky%2520hrad_94d492b936.jpg","description":"\\nBratislava is the capital of Slovakia and the country\'s largest city. It is located at the confluence of the Danube and Morava rivers, on the western edge of the Carpathian Mountains. The city has a population of about 430,000 people. Bratislava is a beautiful and vibrant city with a lot to offer visitors. The city is home to a number of historical and cultural landmarks, including the Bratislava Castle, the Old Town, and the Primatial Palace. Bratislava is also home to a number of museums, art galleries, and theaters.","images":["https://33traveltips.com/wp-content/uploads/Facts-about-Bratislava.jpg","https://d2bgjx2gb489de.cloudfront.net/gbb-blogs/wp-content/uploads/2020/07/01093015/Bratislava.jpg","https://www.gastrotravelogue.com/wp-content/uploads/2017/09/Old-Town.jpg","https://www.novo-monde.com/app/uploads/2022/10/musee-histoire-1024x768.jpg"]},{"capital":"Ljubljana","country":"Slovenia","favourite":false,"visited":false,"planned":false,"url":"https://cdn.britannica.com/79/124479-050-DD359499/Ljubljana-Slovenia.jpg","description":"Ljubljana is the capital and largest city of Slovenia. It is located in the central part of the country, on the banks of the Ljubljanica River. The city has a population of about 293,000 people. Ljubljana is a beautiful and vibrant city with a lot to offer visitors. The city is home to a number of historical and cultural landmarks, including the Ljubljana Castle, the Triple Bridge, and the Pre\u0161eren Square. Ljubljana is also home to a number of museums, art galleries, and theaters.","images":["https://cdn.britannica.com/79/124479-050-DD359499/Ljubljana-Slovenia.jpg","https://cdn.britannica.com/68/93068-050-E7C71026/Ljubljana-Ljubljanica-River-Slovenia.jpg","https://www.iwanderlista.com/wp-content/uploads/2019/08/Ljubljana-18.jpg","https://esacroatia.com/app/uploads/2012/06/Ljubljanabynight-1024x721.jpg"]},{"capital":"Madrid","country":"Spain","favourite":false,"visited":false,"planned":false,"url":"https://dynamic-media-cdn.tripadvisor.com/media/photo-o/28/6a/f5/4c/caption.jpg?w=500&h=300&s=1","description":"Madrid is a city of contrasts. It is a modern city with a rich history. It is a city of culture and nightlife. It is a city of art and architecture. It is a city of parks and gardens. It is a city of people from all over the world. Madrid is a city that has something to offer everyone. Whether you are interested in history, culture, art, food, or nightlife, you are sure to find something to enjoy in Madrid.","images":["https://upload.wikimedia.org/wikipedia/commons/thumb/9/92/Gran_V%C3%ADa_%28Madrid%29_1.jpg/1200px-Gran_V%C3%ADa_%28Madrid%29_1.jpg","https://deih43ym53wif.cloudfront.net/cibeles-fountain-madrid-spain-shutterstock_556870582_cf4a306a5b.jpeg","https://a.cdn-hotels.com/gdcs/production196/d170/348659c0-9beb-11e8-a1b5-0242ac110053.jpg","https://media.gq-magazine.co.uk/photos/5d1396399fa60179288385ed/4:3/w_1704,h_1278,c_limit/Madrid-02-GQ-17May17_b.jpg"]},{"capital":"Longyearbyen","country":"Svalbard and Jan Mayen","favourite":false,"visited":false,"planned":false,"url":"https://ychef.files.bbci.co.uk/live/624x351/p04qw8tg.jpg","description":"Longyearbyen is the world\'s northernmost settlement with a population greater than 1,000 and the largest inhabited area of Svalbard, Norway. It stretches along the foot of the left bank of the Longyear Valley and on the shore of Adventfjorden, the short estuary leading into Isfjorden on the west coast of Spitsbergen, the island\'s broadest inlet. As of 2002 Longyearbyen Community Council became an official Norwegian municipality.","images":["https://www.meganstarr.com/wp-content/uploads/2020/02/What-to-know-before-visiting-Svalbard-tips-for-Spitsbergen-and-beyond-4.jpg","https://previews.123rf.com/images/aleksandrlutcenko/aleksandrlutcenko1602/aleksandrlutcenko160200114/53971447-a-city-details-of-longyearbyen-the-most-northern-settlement-in-the-world-spitsbergen-svalbard.jpg","https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Longyearbyen-as-of-2022.jpg/1200px-Longyearbyen-as-of-2022.jpg","https://upload.wikimedia.org/wikipedia/commons/1/1c/Longyearbyen4.jpg"]},{"capital":"Stockholm","country":"Sweden","favourite":false,"visited":false,"planned":false,"url":"https://i2-prod.mirror.co.uk/incoming/article6088198.ece/ALTERNATES/s1200b/Riddarholmen-Old-Town-in-Stockholm.jpg","description":"Stockholm is the capital of Sweden and the most populous city in the Nordic countries. It is built on 14 islands in central Sweden on the Baltic Sea coast, an ideal location for trade. The city has a population of about 975,000 people, and its metropolitan area is home to over 2.3 million people. Stockholm is a beautiful and historic city with a lot to offer visitors. The city is home to a number of historical and cultural landmarks, including the Royal Palace, the Gamla Stan (Old Town), and the Vasa Museum. Stockholm is also home to a number of museums, art galleries, and theaters.","images":["https://s3-eu-north-1.amazonaws.com/py3.visitsweden.com/images/Trygg_Sthlm_Heli_2_352_High-res-CMSTemplate_g.width-1650.jpg","https://i2-prod.mirror.co.uk/incoming/article6088198.ece/ALTERNATES/s1200b/Riddarholmen-Old-Town-in-Stockholm.jpg","https://www.meganstarr.com/wp-content/uploads/2023/02/Best-things-to-do-in-Stockholm_2090319031.jpg","https://www.stockholmfreetour.com/wp-content/uploads/2017/01/The-Royale-Palace.jpg"]},{"capital":"Berne","country":"Switzerland","favourite":false,"visited":false,"planned":false,"url":"https://media.istockphoto.com/id/475439326/photo/bern.jpg?s=612x612&w=0&k=20&c=CMhqdUyCazMsEiDq9SdNIZDUCZQj_ODadTYmwRV-emk=","description":"Berne (Swiss German: B\xe4rn, pronounced [\u02c8b\u025b\u02d0rn]) is the de facto capital of Switzerland and the capital of the canton of Bern. It is located in the west-central part of Switzerland, on the Aare River in the foothills of the Alps. The city has a population of about 133,000 people (as of 2022), and its metropolitan area is home to over 660,000 people. Bern was founded in the 12th century by the Dukes of Z\xe4hringen. The city grew rapidly in the 13th and 14th centuries, and became a major center of trade and commerce. In 1353, Bern joined the Swiss Confederacy, and became its capital in 1848.","images":["https://www.alibabuy.com/photos/library/1500/13008.jpg","https://www.chateauberne.com/wp-content/uploads/2021/10/2-A-drone-hotel-@droneyourproperty-1000x700.png","https://www.swisscaution.ch/wp-content/uploads/Berne-1100x733-2.jpeg","https://c1.wallpaperflare.com/preview/925/12/916/swiss-berne-the-old-town.jpg"]},{"capital":"Kyiv","country":"Ukraine","favourite":false,"visited":false,"planned":false,"url":"https://cdnp.flypgs.com/files/Sehirler-long-tail/Kyiv/kyiv-bag_ms_zl_k-anit.jpg","description":"Kyiv is the capital and most populous city of Ukraine. It is in north-central Ukraine along the Dnieper River. As of 1 January 2022, its population was 2,952,301, making Kyiv the seventh-most populous city in Europe. Kyiv is an important industrial, scientific, educational, and cultural center in Eastern Europe. It is home to many high-tech industries, higher education institutions, and historical landmarks. The city has an extensive system of public transport and infrastructure, including the Kyiv Metro. Kyiv is a very old city, with a history dating back to the 9th century. It was founded by the Slavic people and was the capital of the first Slavic state, Kievan Rus. Kyiv was a major center of trade and culture in the Middle Ages and was home to many important religious and cultural institutions. The city was also a major center of the Cossack movement in the 17th and 18th centuries.","images":["https://gdb.rferl.org/fc06b200-8659-4f79-8184-874ceb34616e_w1080_r0_s.jpg","https://upload.wikimedia.org/wikipedia/uk/a/a8/Kiev_Independence_Square_cropped.jpg","https://c4.wallpaperflare.com/wallpaper/252/246/522/golden-gate-kiev-ukraine-zoloti-vorota-wallpaper-preview.jpg","https://static.dw.com/image/62926482_605.jpeg"]},{"capital":"London","country":"United Kingdom","favourite":false,"visited":false,"planned":false,"url":"https://planetofhotels.com/guide/sites/default/files/styles/node__blog_post__bp_banner/public/live_banner/London-1.jpg","description":"London is the capital of England and the United Kingdom. It is the most populous city in the United Kingdom, with a metropolitan area of over 13 million inhabitants. London is a global city, with strengths in finance, banking, commerce, entertainment, the arts, fashion, research, technology, education, and tourism. London has been a major settlement for two millennia. Its core, the ancient City of London, largely retains its square-mile medieval boundaries. Today, the City of London is a major financial, commercial and cultural centre, with an independent economy. The bulk of London\'s more than 2.9 million residents live in the surrounding metropolitan area, which extends beyond Greater London.","images":["https://cdn.britannica.com/38/242638-050-D96EB78F/Buckingham-Palace-Victoria-Memorial-Tulips-London-England.jpg","https://c4.wallpaperflare.com/wallpaper/246/582/347/evening-europe-tower-bridge-london-wallpaper-preview.jpg","https://c1.wallpaperflare.com/preview/53/944/1005/big-ben-clock-lights-reflection.jpg","https://e0.pxfuel.com/wallpapers/622/355/desktop-wallpaper-london-eye-ferris-wheel-awesome-aesthetic-london.jpg"]},{"capital":"Vatican","country":"Vatican","favourite":false,"visited":false,"planned":false,"url":"https://mamalovesrome.com/wp-content/uploads/2021/05/Vatican-City-St-Peter-basilica-DP.jpg","description":"The Vatican City is a walled enclave within the city of Rome. It is the smallest internationally recognized independent state in the world by both area and population, having an area of approximately 49 hectares (121 acres) and a population of just over 800 people. Vatican City is the seat of the Roman Catholic Church, the world\'s largest Christian church. The Pope is the head of state of the Vatican City and the supreme leader of the Catholic Church. The Vatican City was established in 1929 with the signing of the Lateran Treaty between the Holy See and Italy. The treaty ended the Roman Question, a dispute between the papacy and Italy that had lasted for over half a century. The Vatican City is a sovereign state and is not part of Italy. It has its own flag, currency, and postal service.","images":["https://cdn.britannica.com/38/242638-050-D96EB78F/Buckingham-Palace-Victoria-Memorial-Tulips-London-England.jpg","https://cdn.britannica.com/96/175196-050-EA0EF9D1/St-Peters-Basilica-Vatican-City.jpg","https://media.tacdn.com/media/attractions-splice-spp-674x446/0f/ba/c1/d8.jpg","https://assets.editorial.aetnd.com/uploads/2023/03/vatican-city-GettyImages-1097352500.jpg"]}]');class wA{}class zb{}class au{constructor(n){this.normalizedNames=new Map,this.lazyUpdate=null,n?this.lazyInit="string"==typeof n?()=>{this.headers=new Map,n.split("\n").forEach(e=>{const r=e.indexOf(":");if(r>0){const l=e.slice(0,r),h=l.toLowerCase(),_=e.slice(r+1).trim();this.maybeSetNormalizedName(l,h),this.headers.has(h)?this.headers.get(h).push(_):this.headers.set(h,[_])}})}:()=>{this.headers=new Map,Object.keys(n).forEach(e=>{let r=n[e];const l=e.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(l,r),this.maybeSetNormalizedName(e,l))})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();const e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof au?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){const e=new au;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof au?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){const e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(n.name,e);const l=("a"===n.op?this.headers.get(e):void 0)||[];l.push(...r),this.headers.set(e,l);break;case"d":const h=n.value;if(h){let _=this.headers.get(e);if(!_)return;_=_.filter(C=>-1===h.indexOf(C)),0===_.length?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,_)}else this.headers.delete(e),this.normalizedNames.delete(e)}}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}}class jL{encodeKey(n){return fM(n)}encodeValue(n){return fM(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}}const GL=/%(\d[a-f0-9])/gi,HL={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function fM(t){return encodeURIComponent(t).replace(GL,(n,e)=>HL[e]??n)}function CA(t){return`${t}`}class Rh{constructor(n={}){if(this.updates=null,this.cloneFrom=null,this.encoder=n.encoder||new jL,n.fromString){if(n.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function UL(t,n){const e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(l=>{const h=l.indexOf("="),[_,C]=-1==h?[n.decodeKey(l),""]:[n.decodeKey(l.slice(0,h)),n.decodeValue(l.slice(h+1))],M=e.get(_)||[];M.push(C),e.set(_,M)}),e}(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{const r=n.fromObject[e],l=Array.isArray(r)?r.map(CA):[CA(r)];this.map.set(e,l)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();const e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){const e=[];return Object.keys(n).forEach(r=>{const l=n[r];Array.isArray(l)?l.forEach(h=>{e.push({param:r,value:h,op:"a"})}):e.push({param:r,value:l,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{const e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>""!==n).join("&")}clone(n){const e=new Rh({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":const e=("a"===n.op?this.map.get(n.param):void 0)||[];e.push(CA(n.value)),this.map.set(n.param,e);break;case"d":if(void 0===n.value){this.map.delete(n.param);break}{let r=this.map.get(n.param)||[];const l=r.indexOf(CA(n.value));-1!==l&&r.splice(l,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}}}),this.cloneFrom=this.updates=null)}}class $L{constructor(){this.map=new Map}set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}}function mM(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function gM(t){return typeof Blob<"u"&&t instanceof Blob}function _M(t){return typeof FormData<"u"&&t instanceof FormData}class D_{constructor(n,e,r,l){let h;if(this.url=e,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=n.toUpperCase(),function qL(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||l?(this.body=void 0!==r?r:null,h=l):h=r,h&&(this.reportProgress=!!h.reportProgress,this.withCredentials=!!h.withCredentials,h.responseType&&(this.responseType=h.responseType),h.headers&&(this.headers=h.headers),h.context&&(this.context=h.context),h.params&&(this.params=h.params)),this.headers||(this.headers=new au),this.context||(this.context=new $L),this.params){const _=this.params.toString();if(0===_.length)this.urlWithParams=e;else{const C=e.indexOf("?");this.urlWithParams=e+(-1===C?"?":C<e.length-1?"&":"")+_}}else this.params=new Rh,this.urlWithParams=e}serializeBody(){return null===this.body?null:mM(this.body)||gM(this.body)||_M(this.body)||function WL(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof Rh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||_M(this.body)?null:gM(this.body)?this.body.type||null:mM(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Rh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(n={}){const e=n.method||this.method,r=n.url||this.url,l=n.responseType||this.responseType,h=void 0!==n.body?n.body:this.body,_=void 0!==n.withCredentials?n.withCredentials:this.withCredentials,C=void 0!==n.reportProgress?n.reportProgress:this.reportProgress;let M=n.headers||this.headers,P=n.params||this.params;const B=n.context??this.context;return void 0!==n.setHeaders&&(M=Object.keys(n.setHeaders).reduce((G,ie)=>G.set(ie,n.setHeaders[ie]),M)),n.setParams&&(P=Object.keys(n.setParams).reduce((G,ie)=>G.set(ie,n.setParams[ie]),P)),new D_(e,r,h,{params:P,headers:M,context:B,reportProgress:C,responseType:l,withCredentials:_})}}var Sr=(()=>((Sr=Sr||{})[Sr.Sent=0]="Sent",Sr[Sr.UploadProgress=1]="UploadProgress",Sr[Sr.ResponseHeader=2]="ResponseHeader",Sr[Sr.DownloadProgress=3]="DownloadProgress",Sr[Sr.Response=4]="Response",Sr[Sr.User=5]="User",Sr))();class Vb{constructor(n,e=200,r="OK"){this.headers=n.headers||new au,this.status=void 0!==n.status?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}}class jb extends Vb{constructor(n={}){super(n),this.type=Sr.ResponseHeader}clone(n={}){return new jb({headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class EA extends Vb{constructor(n={}){super(n),this.type=Sr.Response,this.body=void 0!==n.body?n.body:null}clone(n={}){return new EA({body:void 0!==n.body?n.body:this.body,headers:n.headers||this.headers,status:void 0!==n.status?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}}class yM extends Vb{constructor(n){super(n,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${n.url||"(unknown url)"}`:`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}}function Ub(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let Qf=(()=>{class t{constructor(e){this.handler=e}request(e,r,l={}){let h;if(e instanceof D_)h=e;else{let M,P;M=l.headers instanceof au?l.headers:new au(l.headers),l.params&&(P=l.params instanceof Rh?l.params:new Rh({fromObject:l.params})),h=new D_(e,r,void 0!==l.body?l.body:null,{headers:M,context:l.context,params:P,reportProgress:l.reportProgress,responseType:l.responseType||"json",withCredentials:l.withCredentials})}const _=Ft(h).pipe(Th(M=>this.handler.handle(M)));if(e instanceof D_||"events"===l.observe)return _;const C=_.pipe(Yl(M=>M instanceof EA));switch(l.observe||"body"){case"body":switch(h.responseType){case"arraybuffer":return C.pipe(ct(M=>{if(null!==M.body&&!(M.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return M.body}));case"blob":return C.pipe(ct(M=>{if(null!==M.body&&!(M.body instanceof Blob))throw new Error("Response is not a Blob.");return M.body}));case"text":return C.pipe(ct(M=>{if(null!==M.body&&"string"!=typeof M.body)throw new Error("Response is not a string.");return M.body}));default:return C.pipe(ct(M=>M.body))}case"response":return C;default:throw new Error(`Unreachable: unhandled observe type ${l.observe}}`)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:(new Rh).append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,l={}){return this.request("PATCH",e,Ub(l,r))}post(e,r,l={}){return this.request("POST",e,Ub(l,r))}put(e,r,l={}){return this.request("PUT",e,Ub(l,r))}}return t.\u0275fac=function(e){return new(e||t)(mt(wA))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();function vM(t,n){return n(t)}function ZL(t,n){return(e,r)=>n.intercept(e,{handle:l=>t(l,r)})}const XL=new vt("HTTP_INTERCEPTORS"),S_=new vt("HTTP_INTERCEPTOR_FNS");function KL(){let t=null;return(n,e)=>(null===t&&(t=($t(XL,{optional:!0})??[]).reduceRight(ZL,vM)),t(n,e))}let AM=(()=>{class t extends wA{constructor(e,r){super(),this.backend=e,this.injector=r,this.chain=null}handle(e){if(null===this.chain){const r=Array.from(new Set(this.injector.get(S_)));this.chain=r.reduceRight((l,h)=>function QL(t,n,e){return(r,l)=>e.runInContext(()=>n(r,h=>t(h,l)))}(l,h,this.injector),vM)}return this.chain(e,r=>this.backend.handle(r))}}return t.\u0275fac=function(e){return new(e||t)(mt(zb),mt(xa))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const tB=/^\)\]\}',?\n/;let bM=(()=>{class t{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new pn(r=>{const l=this.xhrFactory.build();if(l.open(e.method,e.urlWithParams),e.withCredentials&&(l.withCredentials=!0),e.headers.forEach((ue,ve)=>l.setRequestHeader(ue,ve.join(","))),e.headers.has("Accept")||l.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const ue=e.detectContentTypeHeader();null!==ue&&l.setRequestHeader("Content-Type",ue)}if(e.responseType){const ue=e.responseType.toLowerCase();l.responseType="json"!==ue?ue:"text"}const h=e.serializeBody();let _=null;const C=()=>{if(null!==_)return _;const ue=l.statusText||"OK",ve=new au(l.getAllResponseHeaders()),Le=function nB(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(l)||e.url;return _=new jb({headers:ve,status:l.status,statusText:ue,url:Le}),_},M=()=>{let{headers:ue,status:ve,statusText:Le,url:qe}=C(),tt=null;204!==ve&&(tt=typeof l.response>"u"?l.responseText:l.response),0===ve&&(ve=tt?200:0);let bt=ve>=200&&ve<300;if("json"===e.responseType&&"string"==typeof tt){const Je=tt;tt=tt.replace(tB,"");try{tt=""!==tt?JSON.parse(tt):null}catch(Xt){tt=Je,bt&&(bt=!1,tt={error:Xt,text:tt})}}bt?(r.next(new EA({body:tt,headers:ue,status:ve,statusText:Le,url:qe||void 0})),r.complete()):r.error(new yM({error:tt,headers:ue,status:ve,statusText:Le,url:qe||void 0}))},P=ue=>{const{url:ve}=C(),Le=new yM({error:ue,status:l.status||0,statusText:l.statusText||"Unknown Error",url:ve||void 0});r.error(Le)};let B=!1;const G=ue=>{B||(r.next(C()),B=!0);let ve={type:Sr.DownloadProgress,loaded:ue.loaded};ue.lengthComputable&&(ve.total=ue.total),"text"===e.responseType&&l.responseText&&(ve.partialText=l.responseText),r.next(ve)},ie=ue=>{let ve={type:Sr.UploadProgress,loaded:ue.loaded};ue.lengthComputable&&(ve.total=ue.total),r.next(ve)};return l.addEventListener("load",M),l.addEventListener("error",P),l.addEventListener("timeout",P),l.addEventListener("abort",P),e.reportProgress&&(l.addEventListener("progress",G),null!==h&&l.upload&&l.upload.addEventListener("progress",ie)),l.send(h),r.next({type:Sr.Sent}),()=>{l.removeEventListener("error",P),l.removeEventListener("abort",P),l.removeEventListener("load",M),l.removeEventListener("timeout",P),e.reportProgress&&(l.removeEventListener("progress",G),null!==h&&l.upload&&l.upload.removeEventListener("progress",ie)),l.readyState!==l.DONE&&l.abort()}})}}return t.\u0275fac=function(e){return new(e||t)(mt(ME))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const Gb=new vt("XSRF_ENABLED"),wM=new vt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),CM=new vt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class EM{}let oB=(()=>{class t{constructor(e,r,l){this.doc=e,this.platform=r,this.cookieName=l,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=gE(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return t.\u0275fac=function(e){return new(e||t)(mt(ki),mt(o_),mt(wM))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();function sB(t,n){const e=t.url.toLowerCase();if(!$t(Gb)||"GET"===t.method||"HEAD"===t.method||e.startsWith("http://")||e.startsWith("https://"))return n(t);const r=$t(EM).getToken(),l=$t(CM);return null!=r&&!t.headers.has(l)&&(t=t.clone({headers:t.headers.set(l,r)})),n(t)}var dr=(()=>((dr=dr||{})[dr.Interceptors=0]="Interceptors",dr[dr.LegacyInterceptors=1]="LegacyInterceptors",dr[dr.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",dr[dr.NoXsrfProtection=3]="NoXsrfProtection",dr[dr.JsonpSupport=4]="JsonpSupport",dr[dr.RequestsMadeViaParent=5]="RequestsMadeViaParent",dr))();function Xf(t,n){return{\u0275kind:t,\u0275providers:n}}function aB(...t){const n=[Qf,bM,AM,{provide:wA,useExisting:AM},{provide:zb,useExisting:bM},{provide:S_,useValue:sB,multi:!0},{provide:Gb,useValue:!0},{provide:EM,useClass:oB}];for(const e of t)n.push(...e.\u0275providers);return function by(t){return{\u0275providers:t}}(n)}const IM=new vt("LEGACY_INTERCEPTOR_FN");let cB=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({providers:[aB(Xf(dr.LegacyInterceptors,[{provide:IM,useFactory:KL},{provide:S_,useExisting:IM,multi:!0}]))]}),t})(),IA=(()=>{class t{constructor(e){this.http=e,this.API_KEY="e5cdd4eb059c0c34a3f8a7e01fd6758e",this.API_URL="https://api.openweathermap.org/data/2.5/",this.API_URL_GEO="https://api.openweathermap.org/geo/1.0/"}getWeather(e){return this.http.get(`${this.API_URL}weather?q=${e.toLowerCase()}&units=metric&appid=${this.API_KEY}`).pipe(ct(r=>({temp:r.main.temp,icon:`https://openweathermap.org/img/wn/${r.weather[0].icon}@2x.png`})),Jl(r=>Ft({temp:-1e4,message:r.error.message})))}getGeo(e){const r=`${this.API_URL_GEO}direct?q=${e.toLowerCase()}&limit=5&appid=${this.API_KEY}`;return this.http.get(r).pipe(ct(l=>{const h=l[0];return{lat:h.lat,lon:h.lon}}))}getWeatherForecast(e){const r=`${this.API_URL}forecast?q=${e.toLowerCase()}&units=metric&appid=${this.API_KEY}`;return this.http.get(r).pipe(ct(l=>{const h=[];for(let _=0;_<l.list.length;_+=8)h.push({date:l.list[_].dt_txt,temperature:l.list[_].main.temp,description:l.list[_].weather[0].description,pressure:l.list[_].main.pressure,wind:l.list[_].wind.speed,humidity:l.list[_].main.humidity,feelsLike:l.list[_].main.feels_like,icon:`https://openweathermap.org/img/wn/${l.list[_].weather[0].icon}@2x.png`});return h}))}}return t.\u0275fac=function(e){return new(e||t)(mt(Qf))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),k_=(()=>{class t{constructor(e,r){this.weatherService=e,this.http=r,this.capitals=VL,this.min=1e3,this.max=-1e3,this.temperature=-1,this.dialogValue=!1,this.searchValueSubject=new nr,this.capitalIdSubject=new nr}ngOnInit(){for(let e=0;e<this.capitals.length;e++)this.capitals[e].id=e}getMinValue(){this.min=this.capitals[0].temperature;for(let e=0;e<this.capitals.length;e++)this.min>this.capitals[e].temperature&&(this.min=this.capitals[e].temperature);return this.min}getMaxValue(){this.max=this.capitals[0].temperature;for(let e=0;e<this.capitals.length;e++)this.max<this.capitals[e].temperature&&(this.max=this.capitals[e].temperature);return this.max}updateCapitals(e){this.capitals=e}dialog(){this.dialogValue=!this.dialogValue,console.log(this.dialogValue)}}return t.\u0275fac=function(e){return new(e||t)(mt(IA),mt(Qf))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function uB(t,n){1&t&&St(0,"app-add-capital")}const Hb=function(t,n){return{"fav-active":t,"filled-star":n}},hB=function(t){return["/capitals",t]};function dB(t,n){if(1&t){const e=Gt();ke(0,"div",37)(1,"div",38)(2,"div",39)(3,"button",40),ft("click",function(){const h=In(e).$implicit;return gn(Ot().onclickFavourite(h))}),ke(4,"div",41),St(5,"i",42),Ve()(),ke(6,"button",43),ft("click",function(){const h=In(e).$implicit;return gn(Ot().onclickPlanned(h))}),ke(7,"div",41),St(8,"i",42),Ve()(),ke(9,"button",44),ft("click",function(){const h=In(e).$implicit;return gn(Ot().onclickVisited(h))}),ke(10,"div",41),St(11,"i",42),Ve()()(),ke(12,"div",45),St(13,"div",46)(14,"img",47),Ve(),ke(15,"div",48)(16,"div",49)(17,"h2",50),At(18),Ve(),St(19,"img",51),Ve(),ke(20,"h4",52),At(21),Ve(),ke(22,"h6",53),At(23),Ve()(),ke(24,"div",54)(25,"button",55),ft("click",function(){const h=In(e).$implicit;return gn(Ot().deleteCapital(h.id))}),ke(26,"div",41),St(27,"i",56),Ve()(),ke(28,"div",57)(29,"button",58),ft("click",function(){return In(e),gn(Ot().scrollTop())}),At(30,"Show more"),Ve()()()()()}if(2&t){const e=n.$implicit,r=Ot();ut(1),Df("background",r.getCapitalColor(e.temperature)),ut(2),ot("ngClass",eu(16,Hb,e.favourite,e.favourite)),ut(2),ot("ngClass",e.favourite?"bi-star-fill":"bi-star"),ut(1),ot("ngClass",eu(19,Hb,e.planned,e.planned)),ut(2),ot("ngClass",e.planned?"bi-calendar-check":"bi-calendar"),ut(1),ot("ngClass",eu(22,Hb,e.visited,e.visited)),ut(2),ot("ngClass",e.visited?"bi-eye-fill":"bi-eye"),ut(2),Df("background",r.getCapitalColorTransition()),ut(1),Yc("src",e.url,Aa),ut(4),ro("",e.temperature,"\xb0C"),ut(1),Yc("src",e.icon,Aa),ut(2),Jc(e.capital),ut(2),Jc(e.country),ut(6),ot("routerLink",Qs(25,hB,e.id))}}let $b=(()=>{class t{constructor(e,r){this.helper=e,this.weatherService=r,this.originalCapitals=[],this.capitals=[],this.searchValue="",this.sortOrder="temp",this.showParameter="null",this.capitalColor="",this.dialogValue=!1}ngOnInit(){this.originalCapitals=[...this.helper.capitals];const e=localStorage.getItem("capitals");this.capitals=e?JSON.parse(e):[...this.originalCapitals],this.helper.capitalIdSubject.next(-1),this.helper.searchValueSubject.subscribe(r=>{this.searchValue=r});for(let r=0;r<this.capitals.length;r++)this.capitals[r].id=r;console.log(this.capitals[5].id),this.helper.updateCapitals(this.capitals),this.helper.getMaxValue(),this.helper.getMinValue()}updateWeatherData(){for(let e=0;e<this.capitals.length;e++)this.weatherService.getWeather(this.capitals[e].capital).subscribe(r=>{this.capitals[e].temperature=Math.round(10*r.temp)/10,this.capitals[e].icon=r.icon})}get filteredCapitals(){let e=this.capitals.filter(r=>r.capital.toLowerCase().includes(this.searchValue.toLowerCase()));return"capital"===this.sortOrder?e=e.sort((r,l)=>r.capital.localeCompare(l.capital)):"-capital"===this.sortOrder?e=e.sort((r,l)=>l.capital.localeCompare(r.capital)):"temp"===this.sortOrder?e=e.sort((r,l)=>l.temperature-r.temperature):"-temp"===this.sortOrder?e=e.sort((r,l)=>r.temperature-l.temperature):"country"===this.sortOrder?e=e.sort((r,l)=>r.country.localeCompare(l.country)):"-country"===this.sortOrder&&(e=e.sort((r,l)=>l.country.localeCompare(r.country))),"visited"==this.showParameter?e=e.filter(r=>r.visited):"planned"==this.showParameter?e=e.filter(r=>r.planned):"favourite"==this.showParameter&&(e=e.filter(r=>r.favourite)),e}onChangeFilter(e){this.showParameter=e}onChangeSort(e){console.log(this.sortOrder),this.sortOrder=e}getCapitalColor(e){const r=(e+this.helper.min)/(this.helper.max+this.helper.min);let l,h,_;if(r<.5)l=205+Math.round(100*r),h=230+Math.round(100*r),_=255;else{const C=(e+this.helper.min)/(this.helper.max+this.helper.min);l=255,h=Math.round(150/C),_=Math.round(150/C)}return this.capitalColor=`rgba(${l},${h},${_},1)`,this.capitalColor}getCapitalColorTransition(){return`linear-gradient(rgba(255,255,255,0)50%, ${this.capitalColor})`}onclickFavourite(e){e.favourite=!e.favourite}onclickVisited(e){e.visited=!e.visited}onclickPlanned(e){e.planned=!e.planned}deleteCapital(e){for(let r=0;r<this.helper.capitals.length;r++)this.helper.capitals[r].id==e&&this.helper.capitals.splice(r,1);this.capitals=[...this.helper.capitals],this.helper.getMaxValue(),this.helper.getMinValue()}restoreCapital(){this.capitals=[...this.originalCapitals],this.updateWeatherData(),this.helper.updateCapitals(this.capitals),this.helper.getMaxValue(),this.helper.getMinValue()}scrollTop(){document.getElementById("home").scrollIntoView({behavior:"auto",block:"start",inline:"nearest"})}ngOnDestroy(){localStorage.setItem("capitals",JSON.stringify(this.capitals))}unloadHandler(){localStorage.setItem("capitals",JSON.stringify(this.capitals))}onAdd(){this.helper.dialog()}}return t.\u0275fac=function(e){return new(e||t)(He(k_),He(IA))},t.\u0275cmp=_r({type:t,selectors:[["app-test"]],hostBindings:function(e,r){1&e&&ft("beforeunload",function(h){return r.unloadHandler(h)},0,Td)},decls:54,vars:2,consts:[["id","home"],[4,"ngIf"],["id","capitals"],[1,"container","main-container","px-0","my-5"],[1,"row","restore-container","w-100","mx-auto","py-3","px-4","px-lg-5"],[1,"col-6","col-sm-4","col-lg-4","px-1"],[1,"row"],[1,"col-4","col-sm-4","col-md-3","col-lg-4","col-xl-3","px-0"],[1,"my-auto","text-top"],[1,"col-8","col-sm-8","col-md-7","col-lg-6","col-xl-5","my-auto"],[1,"select-filter","w-100",3,"change"],["filter",""],["value","null"],["value","visited"],["value","planned"],["value","favourite"],[1,"col-6","col-sm-4","col-lg-4","col-xl-4","px-1"],[1,"row","h-100"],[1,"col-4","col-sm-4","col-md-3","col-lg-4","col-xl-3","px-1","my-auto"],[1,"col-8","col-sm-8","col-md-7","col-lg-6","col-xl-5","px-2","my-auto"],["sort",""],["value","temp"],["value","-temp"],["value","capital"],["value","-capital"],["value","country"],["value","-country"],[1,"col-sm-4","col-lg-4","col-xl-4","px-1","my-auto"],[1,"row","flex-row-reverse","mt-2","mt-sm-0"],[1,"col-8","col-sm-7","col-xl-5","px-2","px-sm-0","px-md-2","my-auto"],["type","button",1,"btn","btn-success","btn-restore",3,"click"],[1,"col-4","col-sm-4","px-2","my-auto"],["type","button",1,"btn","btn-top","btn-add","py-0",3,"click"],[1,"btn-add-text-big"],[1,"btn-add-text-small"],[1,"row","cards","mx-0","cards-container"],["class","col-12 col-sm-12 col-md-6 col-lg-4 col-xl-3 px-2",4,"ngFor","ngForOf"],[1,"col-12","col-sm-12","col-md-6","col-lg-4","col-xl-3","px-2"],[1,"card","mx-auto","mb-4","position-relative"],[1,"row","flex-row-reverse","row-buttons"],[1,"text-body","favourite",3,"ngClass","click"],[1,"icon"],[1,"bi",3,"ngClass"],[1,"text-body","planned",3,"ngClass","click"],[1,"text-body","visited",3,"ngClass","click"],[1,"img-container","position-relative","top-0","start-0"],[1,"img-transition","position-absolute"],["alt","Card image cap",1,"card-img-top",3,"src"],[1,"card-body"],[1,"title-container"],[1,"card-title","text-body","my-auto","h-25"],[1,"my-auto","weather-icon",3,"src"],[1,"card-text","mt-3"],[1,"card-text"],[1,"card-body","p-0","py-2","px-3"],[1,"del","text-danger","position-absolute","bottom-0","end-0","py-1","px-1","bg-transparent",3,"click"],[1,"bi","bi-trash3"],[1,"btn-container","w-100","mb-1"],[1,"btn","btn-more","py-0","px-0",3,"routerLink","click"]],template:function(e,r){if(1&e){const l=Gt();St(0,"app-hello",0),yt(1,uB,1,0,"app-add-capital",1),ke(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"div",7)(8,"p",8),At(9,"Filter:"),Ve()(),ke(10,"div",9)(11,"select",10,11),ft("change",function(){In(l);const _=Nn(12);return gn(r.onChangeFilter(_.value))}),ke(13,"option",12),At(14,"None"),Ve(),ke(15,"option",13),At(16,"Visited"),Ve(),ke(17,"option",14),At(18,"Planned"),Ve(),ke(19,"option",15),At(20,"Favourite"),Ve()()()()(),ke(21,"div",16)(22,"div",17)(23,"div",18)(24,"p",8),At(25,"Sort:"),Ve()(),ke(26,"div",19)(27,"select",10,20),ft("change",function(){In(l);const _=Nn(28);return gn(r.onChangeSort(_.value))}),ke(29,"option",21),At(30,"Temp High"),Ve(),ke(31,"option",22),At(32,"Temp Low"),Ve(),ke(33,"option",23),At(34,"Capital A-z"),Ve(),ke(35,"option",24),At(36,"Capital z-A"),Ve(),ke(37,"option",25),At(38,"Country A-z"),Ve(),ke(39,"option",26),At(40,"Country z-A"),Ve()()()()(),ke(41,"div",27)(42,"div",28)(43,"div",29)(44,"button",30),ft("click",function(){return r.restoreCapital()}),At(45,"Restore"),Ve()(),ke(46,"div",31)(47,"button",32),ft("click",function(){return r.onAdd()}),ke(48,"span",33),At(49,"+"),Ve(),ke(50,"span",34),At(51,"Add"),Ve()()()()()(),ke(52,"div",35),yt(53,dB,31,27,"div",36),Ve()()()}2&e&&(ut(1),ot("ngIf",r.helper.dialogValue),ut(52),ot("ngForOf",r.filteredCapitals))},styles:["#capitals[_ngcontent-%COMP%]{padding-top:90px}.main-container[_ngcontent-%COMP%]{margin-top:0!important;margin-bottom:0!important;overflow:hidden;width:100%;background-color:#fff6;border-radius:1rem;border:rgb(255,255,255) 3px solid;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:#63636333 0 1px 5px}.add-container[_ngcontent-%COMP%]{transition:transform .1s ease;transform:scale(var(--ggs, 0))}.add-container.open[_ngcontent-%COMP%]{transform:scale(1)}.restore-container[_ngcontent-%COMP%]{background-color:#fff6;border-bottom:white 3px solid}.text-top[_ngcontent-%COMP%]{vertical-align:bottom;padding:15px;font-weight:500}.btn-top[_ngcontent-%COMP%]{width:100%;background-color:#fafafa;border-radius:1rem;padding:5px;font-size:.9rem;font-weight:500;color:#333;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.btn-top[_ngcontent-%COMP%]:hover{border:#333333 1px solid}.btn-restore[_ngcontent-%COMP%]{width:100%;border-radius:2rem;font-weight:500}.btn-add[_ngcontent-%COMP%]{border-radius:2rem;font-size:1.5rem;width:40px;float:right;height:40px;background:#e4c3ff;border:3px solid transparent!important;box-sizing:border-box;position:relative}.btn-add[_ngcontent-%COMP%]:hover{border:3px solid white!important}.cards-container[_ngcontent-%COMP%]{padding:25px}.cards[_ngcontent-%COMP%]{overflow:hidden}.card[_ngcontent-%COMP%]{overflow:hidden;border:rgb(255,255,255) 3px solid}.card-weather[_ngcontent-%COMP%]{width:90%!important;box-shadow:#63636333 0 1px 5px;overflow:hidden;background-color:#fafafa;border:3px white solid}.card-img-top[_ngcontent-%COMP%]{height:180px}.card-body[_ngcontent-%COMP%]{z-index:2}.img-transition[_ngcontent-%COMP%]{background:linear-gradient(rgba(255,255,255,0) 50%,rgb(255,255,255));height:100%;width:100%;z-index:1;margin-bottom:-2px}.card-title[_ngcontent-%COMP%]{font-weight:600;font-size:3rem}.title-container[_ngcontent-%COMP%]{margin-top:-77px;display:flex}.weather-icon[_ngcontent-%COMP%]{width:70px;height:70px;filter:drop-shadow(2px 3px 2px rgba(0,0,0,.3))}a[_ngcontent-%COMP%]{text-decoration:none}.row-buttons[_ngcontent-%COMP%]{overflow:hidden;position:absolute;top:-1px;right:12px;z-index:4;background-color:#fffc;border-bottom-left-radius:.5rem;border-left:3px white solid;border-bottom:3px white solid}.favourite[_ngcontent-%COMP%], .visited[_ngcontent-%COMP%], .planned[_ngcontent-%COMP%]{width:45px;padding:0;background:transparent}.del[_ngcontent-%COMP%], .favourite[_ngcontent-%COMP%], .visited[_ngcontent-%COMP%], .planned[_ngcontent-%COMP%]{border:none}.icon[_ngcontent-%COMP%]{height:48px;width:48px;font-size:2rem;text-align:center}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:color .1s}.bi-calendar-check[_ngcontent-%COMP%], .bi-calendar[_ngcontent-%COMP%]:hover{color:#23c26b}.bi-eye-fill[_ngcontent-%COMP%], .bi-eye[_ngcontent-%COMP%]:hover{color:#1e90ff}.bi-star[_ngcontent-%COMP%]{color:#333;margin-top:0;padding-top:0}.bi-star-fill[_ngcontent-%COMP%], .bi-star[_ngcontent-%COMP%]:hover{color:#fdda18}.bi-trash3[_ngcontent-%COMP%]{color:#24292e;transition:.1s}.bi-trash3[_ngcontent-%COMP%]:hover{color:red}.s-field[_ngcontent-%COMP%]{background-color:#fff;height:100%;padding-top:10px;padding-bottom:10px}.form-inline[_ngcontent-%COMP%]{width:90%}.btn-more[_ngcontent-%COMP%]{height:40px;padding:.375rem 10px!important;border-radius:2rem;border:transparent 3px solid;font-weight:500;box-sizing:inherit;background-color:#9696961a}.btn-more[_ngcontent-%COMP%]:hover, .btn-success[_ngcontent-%COMP%]:hover{border:white 3px solid}.add-capital[_ngcontent-%COMP%]{position:fixed;top:0;left:0}.select-filter[_ngcontent-%COMP%]{background-color:#fafafa;border:none;border-radius:1rem;padding:7px 20px 7px 7px;font-size:.9rem;font-weight:500;color:#333;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;cursor:pointer}.select-filter[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.7)}.options[_ngcontent-%COMP%]{margin-top:5px;cursor:pointer}.btn-add-text-small[_ngcontent-%COMP%], .btn-add-text-big[_ngcontent-%COMP%]{font-size:1rem;position:absolute;top:6px;left:0;right:0;width:100%}.btn-add-text-big[_ngcontent-%COMP%]{top:-5px;font-size:1.7rem}.bi-arrow-down[_ngcontent-%COMP%]{width:20px;height:20px}@media (max-width: 992px){#capitals[_ngcontent-%COMP%]{padding-top:60px}}@media (min-width: 576px){.btn-add-text-small[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px){.btn-add-text-big[_ngcontent-%COMP%]{display:none}.btn-add-text-small[_ngcontent-%COMP%]{display:inline;top:6px}.btn-add[_ngcontent-%COMP%]{width:100%}}@media (max-width: 576px){.btn-top[_ngcontent-%COMP%], .btn-success[_ngcontent-%COMP%], .btn-add[_ngcontent-%COMP%], .btn-restore[_ngcontent-%COMP%]{margin-top:5px}.main-container[_ngcontent-%COMP%]{width:98%}.btn-add[_ngcontent-%COMP%]{width:100%;padding-top:0}.btn-add-text-big[_ngcontent-%COMP%]{display:none}}"]}),t})();var MM=cu(898);let DM=(()=>{class t{constructor(e,r){this._renderer=e,this._elementRef=r,this.onChange=l=>{},this.onTouched=()=>{}}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return t.\u0275fac=function(e){return new(e||t)(He(Ja),He(Vr))},t.\u0275dir=Bt({type:t}),t})(),Jd=(()=>{class t extends DM{}return t.\u0275fac=function(){let n;return function(r){return(n||(n=wr(t)))(r||t)}}(),t.\u0275dir=Bt({type:t,features:[Kn]}),t})();const nc=new vt("NgValueAccessor"),fB={provide:nc,useExisting:yn(()=>ep),multi:!0},gB=new vt("CompositionEventMode");let ep=(()=>{class t extends DM{constructor(e,r,l){super(e,r),this._compositionMode=l,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function mB(){const t=iu()?iu().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(e){this.setProperty("value",e??"")}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return t.\u0275fac=function(e){return new(e||t)(He(Ja),He(Vr),He(gB,8))},t.\u0275dir=Bt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,r){1&e&&ft("input",function(h){return r._handleInput(h.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(h){return r._compositionEnd(h.target.value)})},features:[Fi([fB]),Kn]}),t})();const _B=!1,Co=new vt("NgValidators"),Fh=new vt("NgAsyncValidators");function VM(t){return null!=t}function jM(t){const n=ai(t)?An(t):t;if(_B&&!Ir(n)){let e="Expected async validator to return Promise or Observable.";throw"object"==typeof t&&(e+=" Are you using a synchronous validator where an async validator is expected?"),new rt(-1101,e)}return n}function UM(t){let n={};return t.forEach(e=>{n=null!=e?{...n,...e}:n}),0===Object.keys(n).length?null:n}function GM(t,n){return n.map(e=>e(t))}function HM(t){return t.map(n=>function vB(t){return!t.validate}(n)?n:e=>n.validate(e))}function qb(t){return null!=t?function $M(t){if(!t)return null;const n=t.filter(VM);return 0==n.length?null:function(e){return UM(GM(e,n))}}(HM(t)):null}function qM(t){if(!t)return null;const n=t.filter(VM);return 0==n.length?null:function(e){return function TM(...t){const n=fu(t),{args:e,keys:r}=JE(t),l=new pn(h=>{const{length:_}=e;if(!_)return void h.complete();const C=new Array(_);let M=_,P=_;for(let B=0;B<_;B++){let G=!1;Rt(e[B]).subscribe(Jn(h,ie=>{G||(G=!0,P--),C[B]=ie},()=>M--,void 0,()=>{(!M||!G)&&(P||h.next(r?tI(r,C):C),h.complete())}))}});return n?l.pipe(eI(n)):l}(GM(e,n).map(jM)).pipe(ct(UM))}}function Wb(t){return null!=t?qM(HM(t)):null}function WM(t,n){return null===t?[n]:Array.isArray(t)?[...t,n]:[t,n]}function Zb(t){return t?Array.isArray(t)?t:[t]:[]}function TA(t,n){return Array.isArray(t)?t.includes(n):t===n}function XM(t,n){const e=Zb(n);return Zb(t).forEach(l=>{TA(e,l)||e.push(l)}),e}function KM(t,n){return Zb(n).filter(e=>!TA(t,e))}class YM{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=qb(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=Wb(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n){this.control&&this.control.reset(n)}hasError(n,e){return!!this.control&&this.control.hasError(n,e)}getError(n,e){return this.control?this.control.getError(n,e):null}}class Qo extends YM{get formDirective(){return null}get path(){return null}}class Lh extends YM{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class JM{constructor(n){this._cd=n}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}}let P_=(()=>{class t extends JM{constructor(e){super(e)}}return t.\u0275fac=function(e){return new(e||t)(He(Lh,2))},t.\u0275dir=Bt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,r){2&e&&Sf("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[Kn]}),t})(),Qb=(()=>{class t extends JM{constructor(e){super(e)}}return t.\u0275fac=function(e){return new(e||t)(He(Qo,10))},t.\u0275dir=Bt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(e,r){2&e&&Sf("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)("ng-submitted",r.isSubmitted)},features:[Kn]}),t})();function eT(t,n){return t?`with name: '${n}'`:`at index: ${n}`}const Yb=!1,R_="VALID",SA="INVALID",Kf="PENDING",O_="DISABLED";function Jb(t){return(kA(t)?t.validators:t)||null}function ew(t,n){return(kA(n)?n.asyncValidators:t)||null}function kA(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class iT{constructor(n,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get valid(){return this.status===R_}get invalid(){return this.status===SA}get pending(){return this.status==Kf}get disabled(){return this.status===O_}get enabled(){return this.status!==O_}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(XM(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(XM(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(KM(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(KM(n,this._rawAsyncValidators))}hasValidator(n){return TA(this._rawValidators,n)}hasAsyncValidator(n){return TA(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){this.touched=!0,this._parent&&!n.onlySelf&&this._parent.markAsTouched(n)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(n=>n.markAllAsTouched())}markAsUntouched(n={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}markAsDirty(n={}){this.pristine=!1,this._parent&&!n.onlySelf&&this._parent.markAsDirty(n)}markAsPristine(n={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}markAsPending(n={}){this.status=Kf,!1!==n.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!n.onlySelf&&this._parent.markAsPending(n)}disable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=O_,this.errors=null,this._forEachChild(r=>{r.disable({...n,onlySelf:!0})}),this._updateValue(),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!0))}enable(n={}){const e=this._parentMarkedDirty(n.onlySelf);this.status=R_,this._forEachChild(r=>{r.enable({...n,onlySelf:!0})}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors({...n,skipPristineCheck:e}),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===R_||this.status===Kf)&&this._runAsyncValidator(n.emitEvent)),!1!==n.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(n)}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?O_:R_}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n){if(this.asyncValidator){this.status=Kf,this._hasOwnPendingAsyncValidator=!0;const e=jM(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:n})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(!1!==e.emitEvent)}get(n){let e=n;return null==e||(Array.isArray(e)||(e=e.split(".")),0===e.length)?null:e.reduce((r,l)=>r&&r._find(l),this)}getError(n,e){const r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(n)}_initObservables(){this.valueChanges=new ii,this.statusChanges=new ii}_calculateStatus(){return this._allControlsDisabled()?O_:this.errors?SA:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Kf)?Kf:this._anyControlsHaveStatus(SA)?SA:R_}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n={}){this.pristine=!this._anyControlsDirty(),this._parent&&!n.onlySelf&&this._parent._updatePristine(n)}_updateTouched(n={}){this.touched=this._anyControlsTouched(),this._parent&&!n.onlySelf&&this._parent._updateTouched(n)}_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){kA(n)&&null!=n.updateOn&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){return!n&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=function IB(t){return Array.isArray(t)?qb(t):t||null}(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=function MB(t){return Array.isArray(t)?Wb(t):t||null}(this._rawAsyncValidators)}}class tw extends iT{constructor(n,e,r){super(Jb(e),ew(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){(function nT(t,n,e){t._forEachChild((r,l)=>{if(void 0===e[l])throw new rt(1002,Yb?function EB(t,n){return`Must supply a value for form control ${eT(t,n)}`}(n,l):"")})})(this,!0,n),Object.keys(n).forEach(r=>{(function tT(t,n,e){const r=t.controls;if(!(n?Object.keys(r):r).length)throw new rt(1e3,Yb?function wB(t){return`\n    There are no form controls registered with this ${t?"group":"array"} yet. If you're using ngModel,\n    you may want to check next tick (e.g. use setTimeout).\n  `}(n):"");if(!r[e])throw new rt(1001,Yb?function CB(t,n){return`Cannot find form control ${eT(t,n)}`}(n,e):"")})(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){null!=n&&(Object.keys(n).forEach(r=>{const l=this.controls[r];l&&l.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,l)=>{r.reset(n[l],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>!!r._syncPendingControls()||e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{const r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(const[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){return this._reduceChildren({},(e,r,l)=>((r.enabled||this.disabled)&&(e[l]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((l,h)=>{r=e(r,l,h)}),r}_allControlsDisabled(){for(const n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}}const Yf=new vt("CallSetDisabledState",{providedIn:"root",factory:()=>PA}),PA="always";function F_(t,n,e=PA){nw(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||"always"===e)&&n.valueAccessor.setDisabledState?.(t.disabled),function SB(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&rT(t,n)})}(t,n),function PB(t,n){const e=(r,l)=>{n.valueAccessor.writeValue(r),l&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}(t,n),function kB(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&rT(t,n),"submit"!==t.updateOn&&t.markAsTouched()})}(t,n),function DB(t,n){if(n.valueAccessor.setDisabledState){const e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}(t,n)}function FA(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function nw(t,n){const e=function ZM(t){return t._rawValidators}(t);null!==n.validator?t.setValidators(WM(e,n.validator)):"function"==typeof e&&t.setValidators([e]);const r=function QM(t){return t._rawAsyncValidators}(t);null!==n.asyncValidator?t.setAsyncValidators(WM(r,n.asyncValidator)):"function"==typeof r&&t.setAsyncValidators([r]);const l=()=>t.updateValueAndValidity();FA(n._rawValidators,l),FA(n._rawAsyncValidators,l)}function rT(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}const BB={provide:Qo,useExisting:yn(()=>B_)},L_=(()=>Promise.resolve())();let B_=(()=>{class t extends Qo{constructor(e,r,l){super(),this.callSetDisabledState=l,this.submitted=!1,this._directives=new Set,this.ngSubmit=new ii,this.form=new tw({},qb(e),Wb(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){L_.then(()=>{const r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),F_(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){L_.then(()=>{const r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){L_.then(()=>{const r=this._findContainer(e.path),l=new tw({});(function oT(t,n){nw(t,n)})(l,e),r.registerControl(e.name,l),l.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){L_.then(()=>{const r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){L_.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,function sT(t,n){t._syncPendingControls(),n.forEach(e=>{const r=e.control;"submit"===r.updateOn&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}(this.form,this._directives),this.ngSubmit.emit(e),"dialog"===e?.target?.method}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return t.\u0275fac=function(e){return new(e||t)(He(Co,10),He(Fh,10),He(Yf,8))},t.\u0275dir=Bt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,r){1&e&&ft("submit",function(h){return r.onSubmit(h)})("reset",function(){return r.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Fi([BB]),Kn]}),t})();function aT(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function lT(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}const cT=class extends iT{constructor(n=null,e,r){super(Jb(e),ew(r,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),kA(e)&&(e.nonNullable||e.initialValueIsDefault)&&(this.defaultValue=lT(n)?n.value:n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(r=>r(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){aT(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){aT(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(n){lT(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}},VB={provide:Lh,useExisting:yn(()=>Jf)},dT=(()=>Promise.resolve())();let Jf=(()=>{class t extends Lh{constructor(e,r,l,h,_,C){super(),this._changeDetectorRef=_,this.callSetDisabledState=C,this.control=new cT,this._registered=!1,this.update=new ii,this._parent=e,this._setValidators(r),this._setAsyncValidators(l),this.valueAccessor=function ow(t,n){if(!n)return null;let e,r,l;return Array.isArray(n),n.forEach(h=>{h.constructor===ep?e=h:function FB(t){return Object.getPrototypeOf(t.constructor)===Jd}(h)?r=h:l=h}),l||r||e||null}(0,h)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){const r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),function rw(t,n){if(!t.hasOwnProperty("model"))return!1;const e=t.model;return!!e.isFirstChange()||!Object.is(n,e.currentValue)}(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){F_(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(e){dT.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){const r=e.isDisabled.currentValue,l=0!==r&&Bf(r);dT.then(()=>{l&&!this.control.disabled?this.control.disable():!l&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?function RA(t,n){return[...n.path,t]}(e,this._parent):[e]}}return t.\u0275fac=function(e){return new(e||t)(He(Qo,9),He(Co,10),He(Fh,10),He(nc,10),He(Lf,8),He(Yf,8))},t.\u0275dir=Bt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Fi([VB]),Kn,ji]}),t})(),sw=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=Bt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),fT=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({}),t})();const XB={provide:nc,useExisting:yn(()=>uw),multi:!0};function xT(t,n){return null==t?`${n}`:(n&&"object"==typeof n&&(n="Object"),`${t}: ${n}`.slice(0,50))}let uw=(()=>{class t extends Jd{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;const l=xT(this._getOptionId(e),e);this.setProperty("value",l)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){const r=function KB(t){return t.split(":")[0]}(e);return this._optionMap.has(r)?this._optionMap.get(r):e}}return t.\u0275fac=function(){let n;return function(r){return(n||(n=wr(t)))(r||t)}}(),t.\u0275dir=Bt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(e,r){1&e&&ft("change",function(h){return r.onChange(h.target.value)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fi([XB]),Kn]}),t})(),bT=(()=>{class t{constructor(e,r,l){this._element=e,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption())}set ngValue(e){null!=this._select&&(this._select._optionMap.set(this.id,e),this._setElementValue(xT(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(e){return new(e||t)(He(Vr),He(Ja),He(uw,9))},t.\u0275dir=Bt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const YB={provide:nc,useExisting:yn(()=>hw),multi:!0};function wT(t,n){return null==t?`${n}`:("string"==typeof n&&(n=`'${n}'`),n&&"object"==typeof n&&(n="Object"),`${t}: ${n}`.slice(0,50))}let hw=(()=>{class t extends Jd{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){let r;if(this.value=e,Array.isArray(e)){const l=e.map(h=>this._getOptionId(h));r=(h,_)=>{h._setSelected(l.indexOf(_.toString())>-1)}}else r=(l,h)=>{l._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{const l=[],h=r.selectedOptions;if(void 0!==h){const _=h;for(let C=0;C<_.length;C++){const P=this._getOptionValue(_[C].value);l.push(P)}}else{const _=r.options;for(let C=0;C<_.length;C++){const M=_[C];if(M.selected){const P=this._getOptionValue(M.value);l.push(P)}}}this.value=l,e(l)}}_registerOption(e){const r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(const r of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){const r=function JB(t){return t.split(":")[0]}(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}}return t.\u0275fac=function(){let n;return function(r){return(n||(n=wr(t)))(r||t)}}(),t.\u0275dir=Bt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(e,r){1&e&&ft("change",function(h){return r.onChange(h.target)})("blur",function(){return r.onTouched()})},inputs:{compareWith:"compareWith"},features:[Fi([YB]),Kn]}),t})(),CT=(()=>{class t{constructor(e,r,l){this._element=e,this._renderer=r,this._select=l,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){null!=this._select&&(this._value=e,this._setElementValue(wT(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(wT(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(e){return new(e||t)(He(Vr),He(Ja),He(hw,9))},t.\u0275dir=Bt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})(),lN=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[fT]}),t})(),uN=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Yf,useValue:e.callSetDisabledState??PA}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[lN]}),t})();const OT=function(t){return{ratio:t}};function hN(t,n){if(1&t){const e=Gt();ke(0,"img",7),ft("load",function(){return In(e),gn(Ot(2).imageLoading=!1)}),Ve()}if(2&t){const e=Ot(2);ot("ngClass",Qs(5,OT,e.ratio))("src",e.fileUrl,Aa)("alt",e.alt)("title",e.title),xe("loading",1==e.lazy?"lazy":null)}}function dN(t,n){if(1&t&&St(0,"iframe",8),2&t){const e=Ot(2);ot("src",e.fileUrl,Jp),xe("loading",1==e.lazy?"lazy":null)}}function pN(t,n){if(1&t){const e=Gt();ke(0,"video",9),ft("click",function(l){return In(e),gn(Ot(2).videoClickHandler(l))}),St(1,"source",10),At(2," Your browser does not support the video tag. "),Ve()}if(2&t){const e=Ot(2);ot("id","video_"+e.imageIndex)("ngClass",Qs(5,OT,e.ratio))("autoplay",e.videoAutoPlay),xe("controls",e.showVideoControls?e.showVideoControls:null),ut(1),ot("src",e.fileUrl,Aa)}}function fN(t,n){1&t&&(ke(0,"div",11),At(1,"Invalid file format"),Ve()),2&t&&ot("dir",Ot(2).direction)}function mN(t,n){1&t&&St(0,"span",12)}const gN=function(t){return{"ng-fullimage-loading":t}};function _N(t,n){if(1&t&&(ke(0,"div",1),yt(1,hN,1,7,"img",2),yt(2,dN,1,2,"iframe",3),yt(3,pN,3,7,"video",4),yt(4,fN,2,1,"div",5),yt(5,mN,1,0,"span",6),Ve()),2&t){const e=Ot();ot("ngClass",Qs(6,gN,e.imageLoading)),ut(1),ot("ngIf",e.type===e.IMAGE&&e.fileUrl),ut(1),ot("ngIf",e.type===e.YOUTUBE&&e.fileUrl),ut(1),ot("ngIf",e.type===e.VIDEO),ut(1),ot("ngIf",!e.fileUrl),ut(1),ot("ngIf",e.type===e.YOUTUBE||e.type===e.VIDEO||e.isVideo)}}const yN=["lightboxDiv"],vN=["lightboxImageDiv"];function AN(t,n){1&t&&(ke(0,"div",13),St(1,"div",14),Ve())}const xN=function(t){return{width:t}};function bN(t,n){if(1&t){const e=Gt();ke(0,"div",15,16),ft("touchstart",function(l){return In(e),gn(Ot(2).swipeLightboxImg(l,"start"))})("touchend",function(l){return In(e),gn(Ot(2).swipeLightboxImg(l,"end"))}),ke(2,"div",17),ft("click",function(){return In(e),gn(Ot(2).closeLightbox())}),Ve(),St(3,"custom-img",18),Ve()}if(2&t){const e=n.$implicit,r=n.index,l=Ot(2);ot("ngStyle",Qs(13,xN,l.popupWidth+"px")),xe("id","ng-lightbox-image-"+r),ut(3),ot("imageUrl",(null==e?null:e.image)||(null==e?null:e.video))("isVideo",!!(null!=e&&e.posterImage||null!=e&&e.video))("currentImageIndex",l.currentImageIndex)("imageIndex",r)("speed",l.speed)("videoAutoPlay",l.videoAutoPlay&&r==l.currentImageIndex)("showVideoControls",l.showVideoControls?1:0)("alt",(null==e?null:e.alt)||(null==e?null:e.title)||"")("title",(null==e?null:e.title)||(null==e?null:e.alt)||"")("showVideo",!0)("direction",l.direction)}}const BA=function(t){return{disable:t}};function wN(t,n){if(1&t){const e=Gt();ke(0,"a",19),ft("click",function(){return In(e),gn(Ot(2).prevImageLightbox())}),At(1,"\u2039"),Ve()}if(2&t){const e=Ot(2);ot("ngClass",Qs(1,BA,e.lightboxPrevDisable))}}function CN(t,n){if(1&t){const e=Gt();ke(0,"a",20),ft("click",function(){return In(e),gn(Ot(2).nextImageLightbox())}),At(1,"\u203a"),Ve()}if(2&t){const e=Ot(2);ot("ngClass",Qs(1,BA,e.lightboxNextDisable))}}function EN(t,n){if(1&t&&(ke(0,"div",21),At(1),Ve()),2&t){const e=Ot(2);ut(1),vv("",e.currentImageIndex+1," of ",e.totalImages,"")}}const IN=function(t,n,e){return{"margin-left":t,"grid-template-columns":n,transition:e}},MN=function(t,n){return{show:t,hide:n}};function TN(t,n){if(1&t){const e=Gt();ke(0,"div",1)(1,"div",2)(2,"a",3),ft("click",function(){return In(e),gn(Ot().closeLightbox())}),Ve(),ke(3,"div",4,5),yt(5,AN,2,0,"div",6),ke(6,"div",7),yt(7,bN,4,15,"div",8),Ve(),ke(8,"div",9),At(9),Ve(),yt(10,wN,2,3,"a",10),yt(11,CN,2,3,"a",11),Ve()(),yt(12,EN,2,2,"div",12),Ve()}if(2&t){const e=Ot();ut(5),ot("ngIf",e.showLoading),ut(1),ot("ngStyle",Iv(9,IN,e.marginLeft+"px","repeat("+e.images.length+",1fr)",e.effectStyle)),ut(1),ot("ngForOf",e.images),ut(1),ot("dir",e.direction)("ngClass",eu(13,MN,e.title,!e.title)),ut(1),Jc(e.title),ut(1),ot("ngIf",e.images.length>1),ut(1),ot("ngIf",e.images.length>1),ut(1),ot("ngIf",e.paginationShow)}}const DN=["sliderMain"],SN=["imageDiv"];function kN(t,n){if(1&t&&(ke(0,"div",16),At(1),Ve()),2&t){const e=Ot().$implicit;ot("dir",Ot(2).textDirection),ut(1),Jc(null==e?null:e.title)}}const PN=function(t,n){return{"image-popup":t,"selected-image":n}},RN=function(t,n,e){return{width:t,"margin-left":n,"margin-right":e}};function ON(t,n){if(1&t){const e=Gt();ke(0,"div",12,13),ft("click",function(){const h=In(e).$implicit;return gn(Ot(2).imageOnClick(h.index))})("mouseenter",function(){In(e);const l=Ot(2);return gn(l.stopSlideOnHover&&l.imageMouseEnterHandler())})("mouseleave",function(){In(e);const l=Ot(2);return gn(l.stopSlideOnHover&&l.imageAutoSlide())}),St(2,"custom-img",14),yt(3,kN,2,2,"div",15),Ve()}if(2&t){const e=n.$implicit,r=n.index,l=Ot(2);ot("ngClass",eu(10,PN,l.imagePopup,l.activeImageIndex==r))("ngStyle",Iv(13,RN,l.sliderImageWidth+"px",l.imageMargin+"px",l.imageMargin+"px")),ut(2),ot("imageUrl",(null==e?null:e.thumbImage)||(null==e?null:e.posterImage)||(null==e?null:e.video))("isVideo",!!(null!=e&&e.posterImage||null!=e&&e.video))("alt",(null==e?null:e.alt)||(null==e?null:e.title)||"")("title",(null==e?null:e.title)||(null==e?null:e.alt)||"")("direction",l.textDirection)("ratio",l.manageImageRatio)("lazy",l.lazyLoading),ut(1),ot("ngIf",null==e?null:e.title)}}const FN=function(t){return{"with-ng-main-pagination":t}},LN=function(t,n,e){return{"margin-left":t,width:n,transition:e}};function BN(t,n){if(1&t){const e=Gt();ke(0,"div",10),ft("touchstart",function(l){return In(e),gn(Ot().swipe(l,"start"))})("touchend",function(l){return In(e),gn(Ot().swipe(l,"end"))}),yt(1,ON,4,17,"div",11),Ve()}if(2&t){const e=Ot();ot("ngClass",Qs(3,FN,e.paginationShow))("ngStyle",Iv(5,LN,e.leftPos+"px",e.imageParentDivWidth+"px",e.effectStyle)),ut(1),ot("ngForOf",e.imageObj)}}function NN(t,n){1&t&&(ke(0,"div",17),St(1,"span",18),Ve())}function zN(t,n){if(1&t){const e=Gt();ke(0,"a",19),ft("click",function(){return In(e),gn(Ot().prev())})("mouseenter",function(){In(e);const l=Ot();return gn(l.stopSlideOnHover&&l.imageMouseEnterHandler())})("mouseleave",function(){In(e);const l=Ot();return gn(l.stopSlideOnHover&&l.imageAutoSlide())}),At(1,"\u2039"),Ve()}if(2&t){const e=Ot();ot("ngClass",Qs(1,BA,e.sliderPrevDisable))}}function VN(t,n){if(1&t){const e=Gt();ke(0,"a",20),ft("click",function(){return In(e),gn(Ot().next())})("mouseenter",function(){return In(e),gn(Ot().imageMouseEnterHandler())})("mouseleave",function(){return In(e),gn(Ot().imageAutoSlide())}),At(1,"\u203a"),Ve()}if(2&t){const e=Ot();ot("ngClass",Qs(1,BA,e.sliderNextDisable))}}function jN(t,n){if(1&t&&(ke(0,"div",21),At(1),Ve()),2&t){const e=Ot();ut(1),vv("",e.visiableImageIndex+1," of ",e.totalImages,"")}}function UN(t,n){if(1&t){const e=Gt();ke(0,"div")(1,"slider-lightbox",22),ft("prevImage",function(l){return In(e),gn(Ot().lightboxArrowClickHandler(l))})("nextImage",function(l){return In(e),gn(Ot().lightboxArrowClickHandler(l))})("close",function(){return In(e),gn(Ot().close())}),Ve()()}if(2&t){const e=Ot();ut(1),ot("paginationShow",e.paginationShow)("showVideoControls",e.showVideoControls)("arrowKeyMove",e.arrowKeyMove)("images",e.ligthboxImageObj)("infinite",e.infinite)("animationSpeed",e.speed)("imageIndex",e.activeImageIndex)("show",e.ligthboxShow)("direction",e.textDirection)("videoAutoPlay",e.videoAutoPlay)}}const FT=function(t){return{height:t}};let pw=(()=>{class t{constructor(){}isBase64(e){return/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)}base64FileExtension(e){return e.substring(11,e.indexOf(";base64"))}orderArray(e=[],r="ASC"){return e?.length&&r?e.sort((l,h)=>null!==l.order&&l.order?null!==h.order&&h.order?l.order>h.order?"DESC"===r?-1:1:l.order<h.order?"DESC"===r?1:-1:void 0:-1:1):e}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Mt({token:t,factory:t.\u0275fac}),t})();const HN=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/,BT=["jpeg","jpg","gif","png"],NT=["mp4"];let zT=(()=>{class t{constructor(e,r,l){this.imageSliderService=e,this.sanitizer=r,this.YOUTUBE="youtube",this.IMAGE="image",this.VIDEO="video",this.fileUrl="",this.fileExtension="",this.type=this.IMAGE,this.imageLoading=!0,this.showVideo=!1,this.videoAutoPlay=!1,this.showVideoControls=1,this.speed=1,this.isVideo=!1,this.alt="",this.title="",this.direction="ltr",this.ratio=!1,this.lazy=!1}ngOnChanges(e){this.imageUrl&&this.imageUrl&&this.imageUrl&&"string"==typeof this.imageUrl&&(e.imageUrl&&e.imageUrl.firstChange||this.videoAutoPlay)&&this.setUrl()}setUrl(){const e=this.imageUrl;this.imageLoading=!0,this.fileUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e),this.fileExtension=e.split(".").pop().split(/\#|\?/)[0],this.imageSliderService.base64FileExtension(e)&&(BT.indexOf(this.imageSliderService.base64FileExtension(e).toLowerCase())>-1||NT.indexOf(this.imageSliderService.base64FileExtension(e).toLowerCase())>-1)&&(this.fileExtension=this.imageSliderService.base64FileExtension(e));const r=e.match(HN);if(r&&11===r[2].length)this.showVideo?(this.type=this.YOUTUBE,this.fileUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`https://www.youtube.com/embed/${r[2]}${this.videoAutoPlay?"?autoplay=1&enablejsapi=1":"?autoplay=0&enablejsapi=1"}&controls=${this.showVideoControls}`)):(this.type=this.IMAGE,this.fileUrl=this.sanitizer.bypassSecurityTrustResourceUrl(`https://img.youtube.com/vi/${r[2]}/0.jpg`));else if(this.fileExtension&&BT.indexOf(this.fileExtension.toLowerCase())>-1)this.type=this.IMAGE;else if(this.fileExtension&&NT.indexOf(this.fileExtension.toLowerCase())>-1&&(this.type=this.VIDEO,this.videoAutoPlay&&document.getElementById(`video_${this.imageIndex}`))){const l=document.getElementById(`video_${this.imageIndex}`);setTimeout(()=>{l.play()},1e3*this.speed)}}videoClickHandler(e){e&&e.srcElement&&!this.showVideoControls&&(e.srcElement.paused?e.srcElement.play():e.srcElement.pause())}}return t.\u0275fac=function(e){return new(e||t)(He(pw),He(p_),He(ki))},t.\u0275cmp=_r({type:t,selectors:[["custom-img"]],inputs:{showVideo:"showVideo",videoAutoPlay:"videoAutoPlay",showVideoControls:"showVideoControls",currentImageIndex:"currentImageIndex",imageIndex:"imageIndex",speed:"speed",imageUrl:"imageUrl",isVideo:"isVideo",alt:"alt",title:"title",direction:"direction",ratio:"ratio",lazy:"lazy"},features:[ji],decls:1,vars:1,consts:[["class","custom-image-main",3,"ngClass",4,"ngIf"],[1,"custom-image-main",3,"ngClass"],["class","image",3,"ngClass","src","alt","title","load",4,"ngIf"],["class","youtube","frameborder","0","allow","autoplay","allowfullscreen","",3,"src",4,"ngIf"],["class","video","type","video/mp4","controlsList","nodownload",3,"id","ngClass","autoplay","click",4,"ngIf"],["class","invalid-msg",3,"dir",4,"ngIf"],["class","youtube-icon",4,"ngIf"],[1,"image",3,"ngClass","src","alt","title","load"],["frameborder","0","allow","autoplay","allowfullscreen","",1,"youtube",3,"src"],["type","video/mp4","controlsList","nodownload",1,"video",3,"id","ngClass","autoplay","click"],["type","video/mp4",3,"src"],[1,"invalid-msg",3,"dir"],[1,"youtube-icon"]],template:function(e,r){1&e&&yt(0,_N,6,8,"div",0),2&e&&ot("ngIf",r.fileUrl)},dependencies:[Nf,Zd],encapsulation:2}),t})(),WN=(()=>{class t{constructor(e,r,l,h){this.cdRef=e,this.sanitizer=r,this.elRef=l,this.document=h,this.totalImages=0,this.nextImageIndex=-1,this.popupWidth=1200,this.marginLeft=0,this.imageFullscreenView=!1,this.lightboxPrevDisable=!1,this.lightboxNextDisable=!1,this.showLoading=!0,this.effectStyle="none",this.speed=1,this.title="",this.currentImageIndex=0,this.images=[],this.videoAutoPlay=!1,this.direction="ltr",this.paginationShow=!1,this.infinite=!1,this.arrowKeyMove=!0,this.showVideoControls=!0,this.close=new ii,this.prevImage=new ii,this.nextImage=new ii}set imageIndex(e){void 0!==e&&e>-1&&e<this.images.length&&(this.currentImageIndex=e),this.nextPrevDisable()}set show(e){this.imageFullscreenView=e,this.elRef.nativeElement.ownerDocument.body.style.overflow="",!0===e&&(this.elRef.nativeElement.ownerDocument.body.style.overflow="hidden",this.setPopupSliderWidth())}set animationSpeed(e){e&&"number"==typeof e&&e>=.1&&e<=5&&(this.speed=e)}onResize(e){this.effectStyle="none",this.setPopupSliderWidth()}handleKeyboardEvent(e){e&&e.key&&this.arrowKeyMove&&("arrowright"===e.key.toLowerCase()&&this.nextImageLightbox(),"arrowleft"===e.key.toLowerCase()&&this.prevImageLightbox(),"escape"===e.key.toLowerCase()&&this.closeLightbox())}ngOnInit(){}ngAfterViewInit(){}ngOnDestroy(){this.resetState()}setPopupSliderWidth(){window&&window.innerWidth&&(this.popupWidth=window.innerWidth,this.totalImages=this.images.length,"number"==typeof this.currentImageIndex&&void 0!==this.currentImageIndex&&(this.marginLeft=-1*this.popupWidth*this.currentImageIndex,this.getImageData(),this.nextPrevDisable(),setTimeout(()=>{this.showLoading=!1},500)))}closeLightbox(){this.close.emit()}prevImageLightbox(){this.effectStyle=`all ${this.speed}s ease-in-out`,this.currentImageIndex>0&&!this.lightboxPrevDisable&&(this.currentImageIndex--,this.prevImage.emit("lightbox previous"),this.marginLeft=-1*this.popupWidth*this.currentImageIndex,this.getImageData(),this.nextPrevDisable())}nextImageLightbox(){this.effectStyle=`all ${this.speed}s ease-in-out`,this.currentImageIndex<this.images.length-1&&!this.lightboxNextDisable&&(this.currentImageIndex++,this.nextImage.emit("lightbox next"),this.marginLeft=-1*this.popupWidth*this.currentImageIndex,this.getImageData(),this.nextPrevDisable())}nextPrevDisable(){this.lightboxNextDisable=!0,this.lightboxPrevDisable=!0,setTimeout(()=>{this.applyButtonDisableCondition()},1e3*this.speed)}applyButtonDisableCondition(){this.lightboxNextDisable=!1,this.lightboxPrevDisable=!1,!this.infinite&&this.currentImageIndex>=this.images.length-1&&(this.lightboxNextDisable=!0),!this.infinite&&this.currentImageIndex<=0&&(this.lightboxPrevDisable=!0)}getImageData(){if(this.images&&this.images.length&&"number"==typeof this.currentImageIndex&&void 0!==this.currentImageIndex&&this.images[this.currentImageIndex]&&(this.images[this.currentImageIndex].image||this.images[this.currentImageIndex].video)){this.title=this.images[this.currentImageIndex].title||"",this.totalImages=this.images.length;for(const e in this.document.getElementsByTagName("iframe"))this.document.getElementsByTagName("iframe")[e]&&this.document.getElementsByTagName("iframe")[e].contentWindow&&this.document.getElementsByTagName("iframe")[e].contentWindow.postMessage&&this.document.getElementsByTagName("iframe")[e].contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*");for(const e in this.document.getElementsByTagName("video"))this.document.getElementsByTagName("video")[e]&&this.document.getElementsByTagName("video")[e].pause&&this.document.getElementsByTagName("video")[e].pause()}}resetState(){this.images=[]}swipeLightboxImg(e,r){const l=[e.changedTouches[0].pageX,e.changedTouches[0].pageY],h=(new Date).getTime();if("start"===r)this.swipeLightboxImgCoord=l,this.swipeLightboxImgTime=h;else if("end"===r){const _=[l[0]-this.swipeLightboxImgCoord[0],l[1]-this.swipeLightboxImgCoord[1]];h-this.swipeLightboxImgTime<1e3&&Math.abs(_[0])>30&&Math.abs(_[0])>Math.abs(3*_[1])&&(_[0]<0?this.nextImageLightbox():this.prevImageLightbox())}}}return t.\u0275fac=function(e){return new(e||t)(He(Lf),He(p_),He(Vr),He(ki))},t.\u0275cmp=_r({type:t,selectors:[["slider-lightbox"]],viewQuery:function(e,r){if(1&e&&($d(yN,5),$d(vN,5)),2&e){let l;wh(l=Ch())&&(r.lightboxDiv=l.first),wh(l=Ch())&&(r.lightboxImageDiv=l.first)}},hostBindings:function(e,r){1&e&&ft("resize",function(h){return r.onResize(h)},0,Td)("keyup",function(h){return r.handleKeyboardEvent(h)},!1,af)},inputs:{images:"images",imageIndex:"imageIndex",show:"show",videoAutoPlay:"videoAutoPlay",direction:"direction",paginationShow:"paginationShow",animationSpeed:"animationSpeed",infinite:"infinite",arrowKeyMove:"arrowKeyMove",showVideoControls:"showVideoControls"},outputs:{close:"close",prevImage:"prevImage",nextImage:"nextImage"},decls:1,vars:1,consts:[["class","ng-image-fullscreen-view",4,"ngIf"],[1,"ng-image-fullscreen-view"],[1,"lightbox-wrapper"],[1,"close",3,"click"],[1,"lightbox-div"],["lightboxDiv",""],["class","pre-loader",4,"ngIf"],[1,"lightbox-image-main",3,"ngStyle"],["class","lightbox-image",3,"ngStyle","touchstart","touchend",4,"ngFor","ngForOf"],[1,"caption",3,"dir","ngClass"],["class","prev icons prev-icon",3,"ngClass","click",4,"ngIf"],["class","next icons next-icon",3,"ngClass","click",4,"ngIf"],["class","popup-pagination",4,"ngIf"],[1,"pre-loader"],[1,"mnml-spinner"],[1,"lightbox-image",3,"ngStyle","touchstart","touchend"],["lightboxImageDiv",""],[1,"close-outside",3,"click"],[3,"imageUrl","isVideo","currentImageIndex","imageIndex","speed","videoAutoPlay","showVideoControls","alt","title","showVideo","direction"],[1,"prev","icons","prev-icon",3,"ngClass","click"],[1,"next","icons","next-icon",3,"ngClass","click"],[1,"popup-pagination"]],template:function(e,r){1&e&&yt(0,TN,13,16,"div",0),2&e&&ot("ngIf",r.imageFullscreenView)},dependencies:[Nf,c_,Zd,Qx,zT],encapsulation:2}),t})(),XN=(()=>{class t{constructor(e,r,l,h){this.cdRef=e,this.platformId=r,this.imageSliderService=l,this.elRef=h,this.sliderMainDivWidth=0,this.imageParentDivWidth=0,this.imageObj=[],this.ligthboxImageObj=[],this.totalImages=0,this.leftPos=0,this.effectStyle="all 1s ease-in-out",this.speed=1,this.sliderPrevDisable=!1,this.sliderNextDisable=!1,this.slideImageCount=1,this.sliderImageWidth=205,this.sliderImageReceivedWidth=205,this.sliderImageHeight=200,this.sliderImageReceivedHeight=205,this.sliderImageSizeWithPadding=211,this.autoSlideCount=0,this.stopSlideOnHover=!0,this.showArrowButton=!0,this.textDirection="ltr",this.imageMargin=3,this.sliderOrderType="ASC",this.ligthboxShow=!1,this.activeImageIndex=-1,this.visiableImageIndex=0,this.infinite=!1,this.imagePopup=!0,this.images=[],this.videoAutoPlay=!1,this.paginationShow=!1,this.arrowKeyMove=!0,this.manageImageRatio=!1,this.showVideoControls=!0,this.lazyLoading=!1,this.imageClick=new ii,this.arrowClick=new ii,this.lightboxArrowClick=new ii,this.lightboxClose=new ii}set imageSize(e){e&&"object"==typeof e&&(e.hasOwnProperty("space")&&"number"==typeof e.space&&e.space>-1&&(this.imageMargin=e.space),e.hasOwnProperty("width")&&("number"==typeof e.width||"string"==typeof e.width)&&(this.sliderImageReceivedWidth=e.width),e.hasOwnProperty("height")&&("number"==typeof e.height||"string"==typeof e.height)&&(this.sliderImageReceivedHeight=e.height))}set direction(e){e&&(this.textDirection=e)}set animationSpeed(e){e&&"number"==typeof e&&e>=.1&&e<=5&&(this.speed=e,this.effectStyle=`all ${this.speed}s ease-in-out`)}set slideImage(e){e&&"number"==typeof e&&(this.slideImageCount=Math.round(e))}set autoSlide(e){e&&("number"==typeof e||"boolean"==typeof e||"object"==typeof e)&&("number"==typeof e&&e>=1&&e<=5?e=Math.round(e):"boolean"==typeof e?e=1:"object"==typeof e&&e.hasOwnProperty("interval")&&Math.round(e.interval)&&Math.round(e.interval)>=1&&Math.round(e.interval)<=5&&(this.stopSlideOnHover=!e.hasOwnProperty("stopOnHover")||e.stopOnHover,e=Math.round(e.interval)),this.autoSlideCount=1e3*e)}set showArrow(e){void 0!==e&&"boolean"==typeof e&&(this.showArrowButton=e)}set orderType(e){void 0!==e&&"string"==typeof e&&(this.sliderOrderType=e.toUpperCase())}set defaultActiveImage(e){"number"==typeof e&&e>-1&&(this.activeImageIndex=e)}onResize(e){this.setSliderWidth()}handleKeyboardEvent(e){e&&e.key&&("arrowright"===e.key.toLowerCase()&&!this.ligthboxShow&&this.arrowKeyMove&&this.next(),"arrowleft"===e.key.toLowerCase()&&!this.ligthboxShow&&this.arrowKeyMove&&this.prev(),"escape"===e.key.toLowerCase()&&this.ligthboxShow&&this.close())}ngOnInit(){if(this.infinite){this.effectStyle="none",this.leftPos=-1*this.sliderImageSizeWithPadding*this.slideImageCount;for(let e=1;e<=this.slideImageCount;e++)this.imageObj.unshift(this.imageObj[this.imageObj.length-e])}}ngAfterViewInit(){this.setSliderWidth(),this.cdRef.detectChanges(),Yx(this.platformId)&&this.imageAutoSlide()}ngOnDestroy(){this.autoSlideInterval&&clearInterval(this.autoSlideInterval),!0===this.ligthboxShow&&this.close()}ngOnChanges(e){if(e.images&&e.images.hasOwnProperty("previousValue")&&e.images.hasOwnProperty("currentValue")&&e.images.previousValue!=e.images.currentValue&&this.setSliderImages(e.images.currentValue),e&&e.imageSize){const r=e.imageSize;r&&r.previousValue&&r.currentValue&&r.previousValue.width&&r.previousValue.height&&r.currentValue.width&&r.currentValue.height&&(r.previousValue.width!==r.currentValue.width||r.previousValue.height!==r.currentValue.height)&&this.setSliderWidth()}}ngDoCheck(){this.images&&this.ligthboxImageObj&&this.images.length!==this.ligthboxImageObj.length&&this.setSliderImages(this.images)}setSliderImages(e){e&&e instanceof Array&&e.length?(e.find(l=>{if(l.hasOwnProperty("order"))return!0})&&(e=this.imageSliderService.orderArray(e,this.sliderOrderType.toUpperCase())),this.imageObj=e.map((l,h)=>(l.index=h,l)),this.ligthboxImageObj=[...this.imageObj],this.totalImages=this.imageObj.length):(this.imageObj=[],this.ligthboxImageObj=[],this.totalImages=0,this.imageParentDivWidth=0,this.activeImageIndex=0),this.setSliderWidth()}setSliderWidth(){this.sliderMain&&this.sliderMain.nativeElement&&this.sliderMain.nativeElement.offsetWidth&&(this.sliderMainDivWidth=this.sliderMain.nativeElement.offsetWidth),this.sliderMainDivWidth&&this.sliderImageReceivedWidth&&("number"==typeof this.sliderImageReceivedWidth?this.sliderImageWidth=this.sliderImageReceivedWidth:"string"==typeof this.sliderImageReceivedWidth&&(this.sliderImageReceivedWidth.indexOf("px")>=0?this.sliderImageWidth=parseFloat(this.sliderImageReceivedWidth):this.sliderImageReceivedWidth.indexOf("%")>=0?this.sliderImageWidth=+(this.sliderMainDivWidth*parseFloat(this.sliderImageReceivedWidth)/100).toFixed(2):parseFloat(this.sliderImageReceivedWidth)&&(this.sliderImageWidth=parseFloat(this.sliderImageReceivedWidth)))),Yx(this.platformId)&&window&&window.innerHeight&&this.sliderImageReceivedHeight&&("number"==typeof this.sliderImageReceivedHeight?this.sliderImageHeight=this.sliderImageReceivedHeight:"string"==typeof this.sliderImageReceivedHeight&&(this.sliderImageReceivedHeight.indexOf("px")>=0?this.sliderImageHeight=parseFloat(this.sliderImageReceivedHeight):this.sliderImageReceivedHeight.indexOf("%")>=0?this.sliderImageHeight=+(window.innerHeight*parseFloat(this.sliderImageReceivedHeight)/100).toFixed(2):parseFloat(this.sliderImageReceivedHeight)&&(this.sliderImageHeight=parseFloat(this.sliderImageReceivedHeight)))),this.sliderImageSizeWithPadding=this.sliderImageWidth+2*this.imageMargin,this.imageParentDivWidth=this.imageObj.length*this.sliderImageSizeWithPadding,this.imageDiv&&this.imageDiv.nativeElement&&this.imageDiv.nativeElement.offsetWidth&&(this.leftPos=this.infinite?-1*this.sliderImageSizeWithPadding*this.slideImageCount:0-(this.sliderImageSizeWithPadding*this.visiableImageIndex+2*this.imageMargin)),this.nextPrevSliderButtonDisable()}imageOnClick(e){this.activeImageIndex=e,this.imagePopup&&this.showLightbox(),this.imageClick.emit(e)}imageAutoSlide(){this.infinite&&this.autoSlideCount&&!this.ligthboxShow&&(this.autoSlideInterval=setInterval(()=>{this.next()},this.autoSlideCount))}imageMouseEnterHandler(){this.infinite&&this.autoSlideCount&&this.autoSlideInterval&&clearInterval(this.autoSlideInterval)}prev(){this.sliderPrevDisable||(this.infinite?this.infinitePrevImg():this.prevImg(),this.sliderArrowDisableTeam("previous"),this.getVisiableIndex())}next(){this.sliderNextDisable||(this.infinite?this.infiniteNextImg():this.nextImg(),this.sliderArrowDisableTeam("next"),this.getVisiableIndex())}prevImg(){0>=this.leftPos+this.sliderImageSizeWithPadding*this.slideImageCount?this.leftPos+=this.sliderImageSizeWithPadding*this.slideImageCount:this.leftPos=0}nextImg(){this.imageParentDivWidth+this.leftPos-this.sliderMainDivWidth>this.sliderImageSizeWithPadding*this.slideImageCount?this.leftPos-=this.sliderImageSizeWithPadding*this.slideImageCount:this.imageParentDivWidth+this.leftPos-this.sliderMainDivWidth>0&&(this.leftPos-=this.imageParentDivWidth+this.leftPos-this.sliderMainDivWidth)}infinitePrevImg(){this.effectStyle=`all ${this.speed}s ease-in-out`,this.leftPos=0,setTimeout(()=>{this.effectStyle="none",this.leftPos=-1*this.sliderImageSizeWithPadding*this.slideImageCount;for(let e=0;e<this.slideImageCount;e++)this.imageObj.unshift(this.imageObj[this.imageObj.length-this.slideImageCount-1]),this.imageObj.pop()},1e3*this.speed)}infiniteNextImg(){this.effectStyle=`all ${this.speed}s ease-in-out`,this.leftPos=-2*this.sliderImageSizeWithPadding*this.slideImageCount,setTimeout(()=>{this.effectStyle="none";for(let e=0;e<this.slideImageCount;e++)this.imageObj.push(this.imageObj[this.slideImageCount]),this.imageObj.shift();this.leftPos=-1*this.sliderImageSizeWithPadding*this.slideImageCount},1e3*this.speed)}getVisiableIndex(){const e=Math.round((Math.abs(this.leftPos)+this.sliderImageWidth)/this.sliderImageWidth);this.imageObj[e-1]&&void 0!==this.imageObj[e-1].index&&(this.visiableImageIndex=this.imageObj[e-1].index)}sliderArrowDisableTeam(e){this.sliderNextDisable=!0,this.sliderPrevDisable=!0,setTimeout(()=>{this.nextPrevSliderButtonDisable(e)},1e3*this.speed)}nextPrevSliderButtonDisable(e){this.sliderNextDisable=!1,this.sliderPrevDisable=!1;const r={};this.infinite||(this.imageParentDivWidth+this.leftPos<=this.sliderMainDivWidth&&(this.sliderNextDisable=!0),this.leftPos>=0&&(this.sliderPrevDisable=!0),r.prevDisable=this.sliderPrevDisable,r.nextDisable=this.sliderNextDisable),e&&this.arrowClick.emit({action:e,...r})}showLightbox(){this.imageObj.length&&(this.imageMouseEnterHandler(),this.ligthboxShow=!0,this.elRef.nativeElement.ownerDocument.body.style.overflow="hidden")}close(){this.ligthboxShow=!1,this.elRef.nativeElement.ownerDocument.body.style.overflow="",this.lightboxClose.emit(),this.imageAutoSlide()}lightboxArrowClickHandler(e){this.lightboxArrowClick.emit(e)}swipe(e,r){const l=[e.changedTouches[0].pageX,e.changedTouches[0].pageY],h=(new Date).getTime();if("start"===r)this.swipeCoord=l,this.swipeTime=h;else if("end"===r){const _=[l[0]-this.swipeCoord[0],l[1]-this.swipeCoord[1]];h-this.swipeTime<1e3&&Math.abs(_[0])>30&&Math.abs(_[0])>Math.abs(3*_[1])&&(_[0]<0?this.next():this.prev())}}}return t.\u0275fac=function(e){return new(e||t)(He(Lf),He(o_),He(pw),He(Vr))},t.\u0275cmp=_r({type:t,selectors:[["ng-image-slider"]],viewQuery:function(e,r){if(1&e&&($d(DN,5),$d(SN,5)),2&e){let l;wh(l=Ch())&&(r.sliderMain=l.first),wh(l=Ch())&&(r.imageDiv=l.first)}},hostBindings:function(e,r){1&e&&ft("resize",function(h){return r.onResize(h)},0,Td)("keyup",function(h){return r.handleKeyboardEvent(h)},!1,af)},inputs:{imageSize:"imageSize",infinite:"infinite",imagePopup:"imagePopup",direction:"direction",animationSpeed:"animationSpeed",images:"images",slideImage:"slideImage",autoSlide:"autoSlide",showArrow:"showArrow",orderType:"orderType",videoAutoPlay:"videoAutoPlay",paginationShow:"paginationShow",arrowKeyMove:"arrowKeyMove",manageImageRatio:"manageImageRatio",showVideoControls:"showVideoControls",defaultActiveImage:"defaultActiveImage",lazyLoading:"lazyLoading"},outputs:{imageClick:"imageClick",arrowClick:"arrowClick",lightboxArrowClick:"lightboxArrowClick",lightboxClose:"lightboxClose"},features:[ji],decls:10,vars:12,consts:[[1,"ng-image-slider",3,"ngStyle"],[1,"ng-image-slider-container"],[1,"main",3,"ngStyle"],["sliderMain",""],["class","main-inner",3,"ngClass","ngStyle","touchstart","touchend",4,"ngIf"],["class","ng-image-slider-error",4,"ngIf"],["class","prev icons prev-icon",3,"ngClass","click","mouseenter","mouseleave",4,"ngIf"],["class","next icons next-icon",3,"ngClass","click","mouseenter","mouseleave",4,"ngIf"],["class","ng-main-pagination",4,"ngIf"],[4,"ngIf"],[1,"main-inner",3,"ngClass","ngStyle","touchstart","touchend"],["class","img-div",3,"ngClass","ngStyle","click","mouseenter","mouseleave",4,"ngFor","ngForOf"],[1,"img-div",3,"ngClass","ngStyle","click","mouseenter","mouseleave"],["imageDiv",""],[3,"imageUrl","isVideo","alt","title","direction","ratio","lazy"],["class","caption",3,"dir",4,"ngIf"],[1,"caption",3,"dir"],[1,"ng-image-slider-error"],[1,"ng-image-slider-loader"],[1,"prev","icons","prev-icon",3,"ngClass","click","mouseenter","mouseleave"],[1,"next","icons","next-icon",3,"ngClass","click","mouseenter","mouseleave"],[1,"ng-main-pagination"],[3,"paginationShow","showVideoControls","arrowKeyMove","images","infinite","animationSpeed","imageIndex","show","direction","videoAutoPlay","prevImage","nextImage","close"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"div",1)(2,"div",2,3),yt(4,BN,2,9,"div",4),yt(5,NN,2,0,"div",5),yt(6,zN,2,3,"a",6),yt(7,VN,2,3,"a",7),Ve(),yt(8,jN,2,2,"div",8),Ve()(),yt(9,UN,2,10,"div",9)),2&e&&(ot("ngStyle",Qs(8,FT,r.sliderImageHeight+"px")),ut(2),ot("ngStyle",Qs(10,FT,r.sliderImageHeight+"px")),ut(2),ot("ngIf",r.imageObj.length),ut(1),ot("ngIf",!r.imageObj.length),ut(1),ot("ngIf",r.showArrowButton&&r.imageObj.length>1),ut(1),ot("ngIf",r.showArrowButton&&r.imageObj.length>1),ut(1),ot("ngIf",r.imageObj.length&&r.paginationShow),ut(1),ot("ngIf",r.ligthboxShow))},dependencies:[Nf,c_,Zd,Qx,zT,WN],styles:[".ng-image-slider{display:inline-block;position:relative;width:100%}.ng-image-slider .ng-image-slider-container .main{overflow:hidden;position:absolute;height:200px;width:100%}.ng-image-slider .ng-image-slider-container .main .main-inner{width:1760px;padding:0;height:100%}.ng-image-slider .ng-image-slider-container .main .main-inner.with-ng-main-pagination{height:calc(100% - 30px)}.ng-image-slider .ng-image-slider-container .main .main-inner .full-screen{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAAF+klEQVRoge2Yz28UyRXHv6+q50d7ftqDl42wrU1QFIXVkuAZD5pEzoYrihIhuERw2D8gl1UOKFeiaBfBIZGQIkVKGHGIQHsmspQoillgBfE4vpgQy4pFTIAdPB6Pe365u7peDsx4Z8z0/GDtS3Y+Uh+66vWr963u11X1gCFDhgz5qiEymYy5X86oW2c6nU4w8zcAxJhZaa2tZh8zK8MwLK11XAgRdF3360KIdxYWFn7VzWcqlfoJM38C4B8ASgC2WrpNZg4CgBCCAPiYeZOIfrOwsPC3Tv4Mr4GOHz8ecl13JRQKfS6ldJVSkpnJcZwQABARGYZRJiImIg4Gg/VCoTABoKsAZqZIJPKvy5cvjxQKBVEqlcJ7bUzTlOFw2ACA27dv6/n5+Z8BGEyAaZphpZR/fn7+290CavLkyZMnZ8+eVb3smNk1DEOl0+nv9uM3n89/dufOnddENvEUoJQ6YhjGFgDPhzugexkIIfxCiJ52TY4ePRoBEPDq9xTAzEoI4fY7UDAY9HUbqMVvvVwux69du/ZpIpEw4vG4b2JiInL48OF4IpEYk1L6Wu2LxeIOM5ffREBJKRXa237z5s17d+/edV6+fGmUSqVAtVoNO44TUkpFiejTXgLq9fqfiegP169f/xYRjTHzKBFpAAzAPX369L1Lly79sGlfKBRsIrK8/HUVoLWOtLY9f/786dWrV98D8DEzbwghiq7rFqWUm1LKlw8ePPhvLwHLy8s2PBJ9enr6R/fv3/9la9vm5qZi5uLAApaWlraTyaTftm3H7/f7AMC2bReAlcvlPuoV6JsghBBSyrb8KBaLmog8BYgu/jSAsmVZu9+fbdsKQN95MShEVK3Vam15VKlUGEDN6xnPN9BAK6V2f42FQqECQH6pKLuglKo015m9cXg900sAM/PuzdbW1g5eJduBIIQoa60H2mb0EtBGuVxW6PI6vyxSyrLruv7WNq01iMhz0np+Qo8ePVq3bbsOACsrK1Uiqu5DrF5sA4icOXPms3A47FarVfnixYtJZvZc4btu5qanp28Q0ffxSmgAwCYz/25xcfHX+xv3F8zMzHxPa/1NZg4IIbYBOMz8l1wuVzqoMYcMGTLkK0zXdeDkyZMTWmu/67phrXXNcZzny8vLnoeL/eDEiRM/kFJ+wMzNk6AiomWvYoGngFQq9VNm/r1hGBtSSsd1XZ9SalxKeezhw4drBxI9gGQy+dvJycnvnDt3jqWUtLGxobLZ7GypVAqurq7u7LXvdqB569ixYw9v3LjxfrMtk8msKaXGARyYACIKz87O2ufPn38feLUXymaznvbdzgOvYRiGo7Ue5JA/MMwcCoVCr30Z4+PjHWPtKoCI2hwZhmELIQ5UAIBwLBbre5fsKYCZCXv2/qZp1luS60Bg5lAikdjdUjfmkCuVysBvwBcIBNoEhMNhh5k7nZj2DSIKRCIRX8s9AFRM0+w4cZ6vioii8Xi8TQAzY5CiVD9kMhmzXq+PGoYx6rruGICo67qVVhshhLWzsxMF8Pne57t9a7FYLNaWA1NTU/ba2tovpqenf0xERSIqNkoeRQD/zuVyf0IfR85UKvUhM38IYNy27aAQoiaE2BgZGdmampp6kU6n0632Pp+vqpSKdfLVVcDo6GibgCtXrszmcrl/Pnv27O319fXRp0+futvb22RZllhZWXknmUz+PJfLfdJLADN/cPHixfVTp04FI5EIBwIBE8Bk43oNv99fq9VqgwsYGxtr6xdCiJmZmXc7GV+4cOHe48eP3+4VfAN15MiRkUOHDo33YyyldKWUHXPAM4mJqJ7P53tWm5s4jiPQ/4Gfte4/larVahTAfzr1dVuJC/l8/i3LsrZ1YzTLsqpa693CVjQaDRGRME0z2Kgc9Pv/ltlsdvvWrVvzlmV1nES/369N0wQzw7bt48zcsT7a7S/017m5uTNzc3NBAH4AFQCtNZsKgHqjzQcgxcx/7FPA35eWlhSA1Ubl2Wn4aI4tAUQbt1Vm/mhxcXG1T99vhEgmkyeTyeTXDnKQIUOG/B/yP/QEm5iXakbiAAAAAElFTkSuQmCC);background-size:40px 40px;background-repeat:no-repeat;position:absolute;z-index:8;display:block;height:40px;width:40px;top:4px;right:8px;opacity:.4;transition:all .5s ease-in-out;cursor:pointer}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:205px;height:100%;margin-right:3px;margin-left:3px;position:relative;display:inline-block;box-shadow:inset 0 0 1px #0000003d,0 0 2px #0000001f;border-radius:5px}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div.image-popup{cursor:pointer}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div img,.ng-image-slider .ng-image-slider-container .main .main-inner .img-div video{position:absolute;margin:auto;height:100%;width:100%;inset:0;border-radius:5px}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div img.ratio,.ng-image-slider .ng-image-slider-container .main .main-inner .img-div video.ratio{width:auto;height:auto;max-width:100%;max-height:100%}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div .youtube-icon{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAUAAAAC0CAMAAADSOgUjAAAAA3NCSVQICAjb4U/gAAAC9FBMVEX///+vr6+lpaWPj498fHx4eHh2dnZ0dHRvb29sbGxqampmZmZiYmJeXl5aWlpYWFhUVFRSUlJQUFBMTExKSkpISEhERERCQkJAQEA+Pj44ODg2NjYzMzMwMDAuLi4sLCwqKiooKCgkJCQiIiIgICAYGBgUFBQSEhIODg4MDAwKCgoICAgGBgYEBAQAAADj4+PV1dXBwcG/v7+9vb23t7ezs7Ovr6+rq6ulpaWhoaGPj4+Li4uJiYmHh4eDg4OBgYF+fn58fHx4eHhycnJvb29sbGxmZmZiYmJeXl5aWlpWVlZUVFRSUlJQUFBOTk5KSkpISEhGRkZERERCQkI+Pj47Ozs4ODg2NjYzMzMwMDAuLi4oKCgkJCQiIiIgICAeHh4cHBwUFBQSEhIODg4ICAgEBAQAAADl5eWrq6unp6ejo6OhoaGdnZ2ZmZmVlZWTk5OPj4+Li4uJiYmHh4eBgYF+fn58fHx4eHh0dHRycnJsbGxqampmZmZiYmJWVlYiIiIaGhoAAADMzMzDw8PBwcG/v7+9vb27u7u5ubm3t7e1tbWzs7OxsbGvr6+tra2pqamnp6elpaWhoaGfn5+dnZ2ZmZmVlZWTk5ORkZGJiYlISEjv7+/p6enj4+PT09PPz8/MzMzJycnHx8fFxcXDw8PBwcG/v7+9vb27u7u5ubm3t7ezs7Ovr6+Li4vf39/Z2dnX19fV1dXT09PR0dHPz8/MzMzJycnHx8e9vb3t7e3l5eXj4+Pf39/d3d3b29vZ2dnX19fV1dXT09PR0dHPz8/MzMzp6enn5+fl5eXj4+Ph4eHf39/d3d3X19fT09O9vb3v7+/t7e3r6+vp6enn5+fl5eXj4+Pf39/Z2dnT09PHx8f19fXz8/Px8fHv7+/t7e3r6+vp6enn5+fl5eXj4+P5+fn39/f19fXz8/Px8fHv7+/t7e3f39/7+/v5+fn39/f19fXz8/Px8fHv7+/////7+/v5+fn39/fz8/P////7+/v///9a1shPAAAA/HRSTlMAERERERERERERERERERERERERERERERERERERERERERERERERERERERERERERESIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiIiMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzRERERERERERERERERERERERERERERERERFVVVVVVVVVVVVVVVVVVVVVVVVVmZmZmZmZmZmZmZnd3d3d3d3d3d3d3d3eIiIiIiIiIiIiImZmZmZmZmZmZmZmqqqqqqqqqqqqqu7u7u7u7u7vMzMzMzMzM3d3d3d3u7v9/AAjkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFnRFWHRDcmVhdGlvbiBUaW1lADA2LzEyLzE09BLGOQAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNXG14zYAAA/MSURBVHic7Z15fBTlGcenhz20rbWXKHhU5RDhra22ilal0IpC1VJb1IKlVpmiRUBiuBEBFWIQMXgfAUtIREAIgciVBIpCLjUXeITdRITsJrqHurPp7PzTea+59pjZza7JOzu/z8eoO7PvO893n+d933nned/hOEeOHDly5MiRI0eOHDly5MiRI0eOsAAAvX0JbApAdFpxDkirAonU2xfX15UQngMxsSzBcyDGU1L4HIRGmQByECZUTDLg+1f/+pe/+JesSy+/8rvngpgnOgy5KCryJ6OWvvRyXbPbGwx2h8Pd3YGgx9VWve+lV6YOiQM7m2Xk8WDh7gaPPyJCSaKEJGIJgWMNe/KnOAg10nEAY/P3tfoEUVWISPOJ4G/cmTPJQYikY/D7R/d0aLmJemk/CzVsnfFDB6HW/u9N3+cRJcJJyy0SiRgxouD2NRZfmeUINaYPyGsSZHwqvJAQCLpr6g8eLC8p2bjhrbf217Z4A35B64uS6Cmdms0ENU3fskbofBSf4GmvK189lzd2FROe23ig2uXXOqK/YjqXpQQ1Ri9zK/gkMdxWWZhLDvE64c/uzN9W97ncNxOEUqBqdFYiVC0ecUjANEKSFOp6a/nYKHIGjBy4YtPRIA14SQpuzcIwVg1+w6/Eo7d29WgDPeX/tB/L51wwq7wlRBFGGvOyjKBq7fJW3J5BfG8u0NIzNoD6qJb/647n63z0y769t2QTQsXQG/eGCAHBU3SbSicePcKQnAemzD7sRwjlPx1Z5ISKmf92YXxS5Nha1fcSwjM6Yu7hIAlk4b9naDsmG0sxcq1fwm3Y59sBlxQ+FSHgprVEJPwzNF+ZFQSphT/bE8H8hNoxHEgOnhYi4Io6CcHgo+qh3jYzY6L2XdtIwte7SfGm5IUJjqsP4bKEnUBpP3vb0AyJWvcrL/GalpHx8RkeY0Y95lQQgtcDuLhQpc0JUtuWEYOF8v5x+MUtwUgRf3t6Gy5QrLE1QWr0I6j7kId+BTHxWS5H44Q/rYpgl27qb70c1kQNy/Nhb2keE6PzSLIsihCAInRLI0qN/exKkFr1BOFXMymKXyrlKU6Yj9oFuVm90KZRTGy6l/CrB0Z+KZaoELzPgwiKtUo7mAErek/EpBEeSe4tRfEg7UF7FG/6MH7Ai9vWCq5HhfZNEYtOd2MveTst/IwE53YigpF19msGqUHV+Obf6H9pKBkRzMU+GH7Cds0gsWY75lefPn4GgjOCiKDnOpu5IDFmqYD4HRmq45em0jHB/DCqoukiWxEktlzzBXIP923p5acjyK3FP9J+O3Uk1JQW1IH4Z6abn94HK1EzEV5uI4LEkPW4ASzW8kt3HXLBk9vgQFPqvNA2AIkdN5xENwq1GeGnJZjrQxUdTE8f1QdErDiMHKNrHMgIPy3BjcjVhedsApAYgXtg4akMOaAWIKhBd4uNU+wxGMQ2DIZPkETxQMb4aQnmBOGPFVpvi3tiYkIhnK+Tum7KVACrVUGC/0FB3HqHHQhiCy6Ed6liZFMm+akEQb+PYXXiVo59gMQA6BKi1AwsAkzRYtUFn0Utrqcf8y5ITOrnhh4hFHAW+CmjjxSsVlwQHJUH7WLkVY71foRcfQlqkxo0PYjZV1KEqLjg09AFJfclrLsgvvpT25ADrjYPYDC4ZwRVF2yGLii+lro39w3hq39UdUATfuC03btP6QlCSpB7DE7LSG2MA8QXP6AFpSGYO6B84Dut0smt3wAGJVuj7ILDYe4D8nqWCeJrH4FuTt13W+AHftIqieLJslFA22GnRLBYgB1//TCWXZBcehmK4F3AAj9w1jEJ5vt53p5vfGqXXKXyFztgrR0jWQ5ifOXnozFMYJElgP1d+Mma9MWBkakhVFxwG5o9W84wQHLl02EES/XAZAiDj53jRh4Is8e/rJpvTP1IolqefwjGsFh3FrsEyXWXotuqzdYAnteGAaI1D1+886Ix8dJytfKXGqELBq5lHeCwJuiA3pGWIhhMxABp6nnw3YeSRqjEcDmak1nJbj+Mr/sPfhiQ7w8GJjch2OpJFCBF6H930T1JIqQAn0cxXHExqwCJuXloIrDYzAE5HHeT2hWAdPVS97uz/2lMg7NSMRgPey/J9VdWY5hcdgUEGLzMUgTz/N8/1gDEEEUp/OELyQSyclIVbH39sxkH6IIO2D7eLNkiHkD8KA8itJ7NRc/YRJ2fZYATYBMoVlmKYPmkydEAEUGp+4MXLCfE0eMzAzCGqxgFSIx40gcBFnLWmkD+H8ejASoInzF6YeKqwSloFqglvQ/xvzKRa94G0wH9eRb7kDgA0dBaRvh+gbW2kBwcWgPntLx/YRrgIWi7Z4HZIMYUIF4TFz6+ZYoFhPTYTli5bw7TABugDW2g5wAJQuGTZyfqEcatG4AV6EtPs9kI4mse5oamN5tGsBWAdGHxic1m+V34c567NAxDv4RlgNd7rXXCCsBPEgAkjaEUObFJhzBO3QBcHiRP85kFyE0NQJvLTSOYAnzYFCAaWkdOFE9JNDtBAI5E+RA1TLaB5JKXwWGg8Fo6AWKE4sdv8vHXMxBi49vh6S2ARYLkigvhDb2wCpiOxZIBiOcZIl27JsYplFY2tAWe3chkyjm54lcgQP/z5iYkBZB0J5HOdadzCQnWwhA+Zu7/fVDkil+OQIC56Q1hJZBFsWPbt7gY5VKAaCbDwy5AnnsJAZybbg9UA1n0vfGD+ABhwrTYweTaLy3AwMKMACQT/w2/iQ+wCgI8ybwHZgygjK/r5UQhvF8PkCGCgABEbWBgTiYAoh0/tp4fsxfRhbCHxWXsOoD+B9MOELV/4XfmcKTkmNUrnQiDAPXDmOfSP4yR/7y/hY/XulGA7A9jlqKB9JPpBYjwfbplsTopE7t2ANBA2s0yQHwrtzHN98Ki+OWuxfyS+PmahN+ZTfALLSwDVCYT0uWBqPH733sv8ksS8KMAr0OTCbUMAwQ3oOmsynTdCyN83R9CfEt4UwcEl+mns1gECNCE6mEuPSGMBs6fbVmyJDE/xf/xhOoGJgFGTemnASDk9+nmJUZ+8QGugIMocQ2Ld3LKrQh+qLTI1AksAJTx4caP4DPjB0A5SvOdyzBAwJXCcYwv3yrAeFP6eKu8jxZFu1+Ch0oDq+FjTc94lgGCVYYH64lOjwsQz/6d2KLBl7BXIoe+iXJjm6ew2Amrs+o+/FTJzAsowFhP5RC+Ty3jU+p+QJ/awSZA4III2m/tAUA0cH7vYWvRq617U0iXXMQowAqUaHu5leysWADxwPkj3HdYw6fOxaD0tlxGAaoJlhBBkcX0NgNAPGX64bxY0WsK8M8owdI9kc0+RDFjIUrxrbvYxAzigZMNAOV/Pkui8dPVPAst8KkbyqgDUjPuQUnmnaNNXJB4oC4/ELrul5sXJ9H4aSsG61GS+WZWI1ixAy1zMLWDAFQyVEN01iCp4NXWfDda5hC8ilmAlCBeultnJUuf5+9sp+tE4A7xusbPIj2l3vloAHX0bDZHgVDEkP5oONthdjeHAU6iAOWR3ydJN36aaulSrxJ2HVCJYbzY0MwSbDZeJ4JmnHelhE+tthWNn5gdxHCqJfehHSDaEsw+qWfDlUrocdvbt8cY+VmCgH8JLk+gS/SYBUgJ/vwI2jb/mcS+gA+dCz1QEj6YzfOp4aOV4nk0YQ2Ts9FU1PDlKIYbTWxBh85xS6J4HKbjk9hNeqM84oBT8ZL/gQxHMKcQnIB3PVlpwQXPapW8JbcBnk8Rn/KjHUL7nhQz7YDaIS3sFw6ZtEfwwI8O7fl2D/ApAXxfN3T6rrsYB0jt+Rtchy6G8xPvgwMPDBwEtG9OSjr86DfQVGpknfmzmD4uCmC9svWTaRBHK/n6QAHq+DtvYt0BlUHtALz52EoTj+ghPqWAwU1olfx20wVmfV+EILdORFsxDbAymk4Zn+LwG1C33zGWeQdUXfDMY+jGaoe1hf+p4VO+PMqDRuNFTA+iqagLrsBbgN5vYVyWss0UYI1Eb32Yd0DFKB4cQpvQuq/P3MiW8ivCm9A+bQsHVIN4rh+/7eOSTBGkFc0MoBSG/Wb7rLAixQXfRI4R2pAhx6D+d44bb8Q9xiYOqFo25CjeCn52ZlyQlrkX9ffC47bhp7rgOPy+FJfZWKYntXDrI6il2Gllt1FWRAlyq/CbFjLx8jda3jQBDaGPDLGPA2pckCsV6bsqkp8msFAD4K4jL2S5MbP7LX/VUggOasYEd6SXIC0KjEIvKhWFAnvx0xC81YUJbgdpJKjwG+PCr7wqsxs/DcHpHpztUnqxSrBnRiqlgDkuXPY++/FTAPJguR9bWTkoPQTVMmaS36ZmeMLsVUZFzZQJhvEmnzUXaF+m3sNi5QLWBPDzvCN3pTKT3fcVRVBqPoNL9olb/EK5R7pxqccvALbkp4libiMh6L6XS23eXl8i6o/eiOAym86wYQOIpfGWFYRgYC3QhnFKk89Io5tIJubRHwN7BjCUhuDjHST95fBYoFeSZWE91kH41d9uY34agjyY6SYmux4fYkBoOfuKnn5zpYALE0oHpfQolB1pCN5cHSFWV/xWH8cmthtxD1t6jPwWQd0b6+zIT9/sl/nxi+Ulz9oBRiqYgJ5B1PvpkabWRsj76dtzU9x9nylpCHJPdRGCYvuG2HQSSmbFXVNJfwWhMtW3FzAm1X4ejKuLUIRtxUM4wBsjOSE+jrt2b5Am8n/+WJbw0xMEhV6JbBYdcRUO5KLawvjiuHv3BET8bUmsuUrX/NmZn54g97t6ge63HfHuzrHugYUNAYmmUneWDM8ifjqCPLhkTWOIbuIk+lvL5k02ZTd8QsGeDoEuYhL9ZTeBrOKnHYlAs+8uaY0oNERfY9mqBefHp/enGRtqO0Kiiq96oQGf/flxRoRgnSuixKMohTzNFa+ufuBrp1Ec6N8Xff2KGa+V1rh9dBEJ7HsCh3Os729uKwEdQg4sawyTHgHtuS2Jgt/bVFtRVlael59XvGPHgbpqd9APX9OiniR6D9zPGbwvW/gZfFDuTcC0eq/MhDoXhCjpVm1K6AN6VJTCbUU301TMLOTHGZ1Q/vvHotqAssqLcNIv3FQ+FdwHCkDU1vpZhY/T39USENNer/MIouJqRkHPE0P+9p0rx8XAl238jPMCGMfgES/srHYHQqIkGiVz9XmbKjZffWoselnIjzMgVNqz8ybMW/Xq/pomb4ffBycNI4Lf73W11JeVPDvu7GFKDjqf9fig9E6kzc/n77r1oQXzcmbl5MyaPX/hLbfz2hOSmP+yvUCUYkJS145E3zD3tgm9rWiEOl58InYOPqRYXBBGQDvouPM0vX3pfUXx+Jioty+7T8mh12M5+NIgB14a5MBLhxx2aZIDzpEjR44cOXLkyJEjR44cOXLkyJGjdOr/ODCzC5DKTiMAAAAASUVORK5CYII=);background-size:140px 80px;background-repeat:no-repeat;position:absolute;z-index:6;display:block;height:100%;width:100%;top:0;left:0;background-position:center center}.ng-image-slider .ng-image-slider-container .main .main-inner .img-div .caption{position:absolute;bottom:0;padding:5px;color:#fff;background-image:linear-gradient(to right,rgba(0,0,0,.1),rgba(0,0,0,.25),rgba(0,0,0,.5),rgba(0,0,0,.25),rgba(0,0,0,.1));width:100%;text-align:center;box-sizing:border-box;border-radius:0 0 5px 5px}.ng-image-slider .ng-image-slider-container .main .main-inner:hover .full-screen{transition:all .5s ease-in-out;opacity:1}.ng-image-slider .ng-image-slider-container .main .next,.ng-image-slider .ng-image-slider-container .main .prev{position:absolute;right:10px;top:50%;background-color:#fff;border-radius:50%;cursor:pointer;margin-top:-16px;outline:0;width:35px;height:35px;font-size:35px;line-height:30px;z-index:8;transition:all .5s ease-in-out;text-align:center}.ng-image-slider .ng-image-slider-container .main .next:hover,.ng-image-slider .ng-image-slider-container .main .prev:hover{background-color:#d4cdcd;background-position:-192px -415px}.ng-image-slider .ng-image-slider-container .main .next.disable,.ng-image-slider .ng-image-slider-container .main .prev.disable{color:#bbb;background-color:#fff;opacity:.5;cursor:default}.ng-image-slider .ng-image-slider-container .main .prev{left:10px}.ng-image-slider .ng-image-slider-container .main .prev:hover{background-position:-194px -450px}.ng-image-slider .ng-image-slider-container .ng-main-pagination{background-color:inherit;color:inherit;position:absolute;height:30px;width:calc(100% - 6px);text-align:center;bottom:0;font-size:16px;line-height:30px;border-radius:0 0 5px 5px;margin:0 3px}.ng-image-slider .ng-image-slider-error{height:100%;position:relative;display:flex;justify-content:center;align-items:center}.ng-image-slider .ng-image-slider-error .ng-image-slider-loader{background-image:url(data:image/gif;base64,R0lGODlhQABAAKUAAAQCBISChMTCxDQ2NOzq7KyqrExOTBweHJSSlNTW1PT29FxaXLS2tCwqLAwKDIyKjMzKzERCRPTy9FRWVCQmJJyanNze3Pz+/GRiZLy+vExKTAQGBISGhMTGxOzu7KyurFRSVCQiJJSWlNza3Pz6/FxeXLy6vCwuLAwODIyOjMzOzERGRAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAsACwAAAAAQABAAAAG/kCWcEgsGo/IpHLJbDqf0CgRtXg8FiipdjshXL4XwmRLdk7A6Mu4zD6ivOkvIduuCzFxNMbOHCwWA0opeWApfEkgI2gWIEgPhF8Ph0cBhAFHJZAXe0gHHBkmHAdaZ5BrUx6EHnRGGhJoChpRABaaFgBGpXELna9pEqNPA5pfgUYLcHKnRg8keZJPeMScRiglViWsRwKEAlDSmtRkGd1Qw8TGZY/PULS2uGwHvmjAUbp5vHUaCrCyUpV5LvE58EBAhgfBSNUCY2HZpDoDSpRI97CixYsYM2pkgoICBW0bo0Rg4OwCCQYRQkLZIIJQBXgql1TQhCDmkhXELqwIeaCA/gcJBRIOIUcsw8YGyS54CEHEQUlNJBxo/BDnA5ETOb+c0DgPjAQiDbJe2Jqx65evQ5zmjDq1ahGimoxqRIrGA4UiEXKm3NhTAlChQ2ZCqmlTyQbBcSpsKMwkgomSJEzsZdzEAYUGUilr3sw5yYkUCSR4SJCCbGciLJ+CISFi8WkWG+DmyeC6c0tiIk43UE2IRAM+FJhKuZ0zd5sQEL5AEP4kgdgEdZKDgRCFNyQSx+PcfWK9dxsK2qE4zwq9jXTlUYjjrhNCxRcVzJ2c6J7GN/DfWhBDqpBkgwEDmWXkADeQCFBbEQ64d4EKAWLEEiGtIYJGIyE1gEBoEoyAAH4SG4JB4WtGbCAdBAeCSAQABoAAk4kstujii00EAQAh+QQJCQApACwAAAAAQABAAIUEAgSEgoTEwsREQkSsrqwcGhzk5uRsamyUkpT09vQMDgxcWlwkJiR0dnTMysxMSky8urycmpwMCgyMiowkIiTs7ux0cnT8/vwEBgTExsRERkS0trQcHhzs6uxsbmyUlpT8+vwUFhQsLix8fnzMzsxMTky8vrycnpyMjowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCUcEgsGo/IpHLJbDqf0Kh0Sl0uMheQY1HtOj+XsPjjLSMX4vSFa24LHWqxw90GgOJhEICeFE02GxMiSQAJeFl7fEUAE3dpE4lGcHhzikUThxNnh2xIEiMZGSMSUyKHYYNHCHERSgokaSQKUpinmmeTW0sBcQFSEKcXEG1YapVQwKfDZpNpx08owShtvGq+UaanqWWvsbNS0XjTbhIBGQ4BpFMA4WkokZZdIigQGyjb8fn6+/z9/v8AAxLB8MCDhwcYBD7x0CFNhQMKmZw4dCJikgPBPASkwMBThWAV1PHjkIuCkRLBwmjw1+zCMyEWUl5o0I9CnI5EYqakyY/B/s0iKFM+YOnMiISPp0L64wDrAgmTRjwEgwiQAU4kE/FUtJjEAtIwFSxwXSKhoIUHIseqXcu2bRIFVr+5JTJggyMQGwbMTYEBDJ4I8NRGCIagrQaZK9eakGnCTYgGFkJIkeAoGIi0AylQSMikgIEwBgpgk4nKyAMIdyGUWDIizYjRpPFJIHCIgFwjrcW8hkJZ5uUhGAQEE8DZSIGGFzqIjrI4ZeMhtYLdOvK4wfIoA2TqFRKi8qkEki0NPlV4CEbSVBVhGM+qeAr2KbfGG4A6D4TtRGiTJsBPQlwk8AUjn0XnyZSeRQV4dwgI4Y0V3SnjqCVBMYc4gBlXCugXh217CZVgwl0mrOZGEAAh+QQJCQAyACwAAAAAQABAAIUEAgSEgoREQkTEwsQkIiSkoqRsamzk4uT08vQUFhRUVlQ0MjS0srSUlpR0dnQMCgxMSkzU0tSsqqzs6uz8+vw8OjzMyswsLix0cnQcHhxcXly8vrycnpwEBgSEhoRERkTExsQkJiSkpqRsbmzk5uT09vQcGhxcWlw0NjS0trScmpx8fnwMDgxMTkysrqzs7uz8/vw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCZcEgsGo/IpHLJbDqf0Kh0Sq1ar8lLilJKXbBg5AUBK8MQ37BamDKbU2s1gOIuUwBxZYdA6CwBJXUwd3lHDwETZS8BD0ptdXCFRR0bght+SAtkZmhNHXhVAYJlAUpaFBQpC0wsHAglHCxTHYmjE5hgIm4iUyGjZiFhD3RmFLhPvr8wwWAdxHbHTrS/t2oSbhJUHr8eaywFrwWyswOCA9FgAKBVDx4vZQiMkmEAIX3z+Pn6+/z9/v8AA06p0AAECBUVBDLpwEEQB3QKhzQcxSHikRjKYMTwl8ABhgRIJv6qyM8EiTIkTByxkNFCvxVuVqxs+TLmEZEU+5moNUGl/hGMyjb26+jA55ECvwpYPNIBaZ0CEJfKiKHCoAqhUrNq3cq1q8IKATgUCJCwSgcII0ZAiEoFBcs6FlBMGVFLkYEwCp7VKXEiCk43JK2g0CuIglwnBjKOsAIgQsYyEdYpefBO2YtGVAQ8NiOgSYvNH6ps2wyjGxMMmx0gAYDixAkUkodcI53tdGojAAwccEPCQGxdtD1vhjDJxS8Xx0ZvNr2EcsbLRVRkbEDkA2kYnZuMyHiXyALCglYJabw58pO/ZgIPkf5YBZEK4N1QKPsEQ2V4i404fhyhSN5fFPQlxQNoYbAWErs9doARbgkSFz77ZdQfbjF4UEABHsQQWx4NKWzmnlQobHaYVOi58WFWHTDwCwNsCZTbSWZM4JtXMgBQgQYaVLDhFUEAACH5BAkJACoALAAAAABAAEAAhQQCBISChDw6PMTGxOTm5CQiJFRWVKSipNTW1CwuLAwODJSWlERGRGxqbMzOzPT29LS2tNze3AwKDERCRCwqLGRiZDQ2NJyenPz+/AQGBISGhDw+PMzKzCQmJFxaXKyqrNza3DQyNBQWFJyanExKTGxubNTS1Pz6/Ly6vOTi5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJVwSCwaj8ikcslsOp/QqHRKrVqvS0oHy10WHBiMqdAtF03hsMPM7qTTFHaZ8g7H5UqRyIlOm/BJJH0IJEwFfWOARwx1GAxNFHdNEgYeElYIjQhsEpkYCJdTIo1he2UVbxVUo6SmXahpqlQgjSBsCp4gClWMdYWcHpZXJLQYIL+KXHrJzM3Oz9DR0tPUzgIBFwcBAtVMFhyNHBZJEiEhGdEGJ6QYDx5GGRoPYQ8a6M0C8+wYJ+NDCn3eONiVDEDAfSYADFnAbgGzCfvqTBCiQF+jBwQBaYj4RoOQEBH9AfrAMc0HIRZCJiNZEsNJFQrWkToRSmNLDB6FMCTlMFn+r5ITKR4MYyIjIIMlExKJJ/OEPWsy2Z3gZkSChRA1namT+q7bkW/hRHo1AmCDhgMHNGxQOLat27djJVSAAAIBhAb3pghYMGDACKpdLKRolEKskwwXGl3IayUfuweAnSQmdQGLhMH7UjBesiHihisNSjZ4MpldZSsoSqJ4Am4fhysRSkZgHfE1kgQBPqRNgCQ2x9mSI54uImHnmxGbVaTmuNpJ532fiwBY3ggF2yElSpaAcoDdgSOh940mIoFAxBRGmWToXudAchW+2QEnMsFinalTNozoOyK6kQIlkVGEAJi9kUJkcoDEkWFCSNAAXSCgUEFWeADIkYBuxUdKCnAgqRAeO+O9lQF1dVjXoQqINYLciUOEoMEHH2gQAovQBAEAIfkECQkAMAAsAAAAAEAAQACFBAIEhIKEREJExMbEJCIk5ObkbGpsrKqsFBIUNDI09Pb03NrcVFJUdHZ0tLa0DAoMlJKULCos7O7sHBocPDo8zM7MtLK0/P785OLkXFpcfH58BAYEhIaETEpMzMrMJCYk7OrsbG5srK6sFBYUNDY0/Pr83N7cVFZUfHp8vLq8DA4MlJaULC4s9PL0HB4cPD48AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5AmHBILBqPyKRyyWw6n9CodEqtWq/YbHaiCUy0YCNBcrlICEwAi8FgAcJMTbkcUG5QhfmlgNrAkwF6GkkjA3p6AyN/R2NlZ0gbHoeHA35SGwIvD04TAV5JDSWTh4NRCSZlJglZAHmjeiBvTw+ocwWbVwmvkyRQL5MvWBm7hxm+wMLEesazrmW3WLrKZb1Qp6mrWBsg0yCWUA8CArhZDdOli1GRxB7f6VCFr4nvVHfccyB99FYACWwJsvYJHEiwoMEwDww4WLDAgQF3B5WQqKUHQ7UjAD58CDjwhahRCigcOYGhDIYTBGkRwwDxxCSUAg1MM0Ck1SQMHNOlmJaCyP6HVx8EUtxlwidQgSWVFR1i81CBnIt2KutJxGWxgTKVhTCSIenJlM5GYVCBMUIEqPQ8viohMqISCkkrtnVrRyHDFA/p6t3Lt69fOA/MkqvyIEECiFk+HFBQpsSBoFM2cGB8QQEHxFU6tJjUooMUFRUmVSCLJcJmkBGirHi1IssBYgegqPg4SQFpwrRHlRi8RNqri1RYTGPxhAQx4Ece8C4iXBlxJ7PXLhfyoMGCMgv0GXmQe9JuKKtHtT6CwNAhDwiOvN4VW3boQxXSHxHxysKRD6c5p47ygMPHEhxMB4NvoyAnhGaceUbFAyQkIKAQcuyCThERiPCfCPvRAwExEC8o8QALLDwIBwrEoPCXEMbtYiBfFtR34hAIvKdHfC8O8QAKtZiAgoh+qcBjjYsEAQAh+QQJCQAuACwAAAAAQABAAIUEAgSMioxEQkTMysxkYmTk5uQkIiSsqqxUUlT09vSUlpTc2tx0cnQcGhwsLiwMCgxMSkzU0tRsamzs7uxcWlyUkpQsKiy0trT8/vycnpwEBgSMjoxERkTMzsxkZmTs6uwkJiSsrqxUVlT8+vycmpzk4uR8enw0MjQMDgxMTkzU1tRsbmz08vRcXlwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCXcEgsGo8ayCYU2kAAx6h0Sp1yVJisdiGoer9fz0hLxowk4LR6yBmXy921nKrBvssqzXx/TN3vCHyCQxV/bxWDgxeGZRdHBisKFSsGiVOLjFqORA8kblkjGQ+WR4WZWYhDDwN/A6OkRAinWYFDCowZcycBGydRAHaMC1BCBp93I5VqDglZCQ5RbZlxQgynDGu3WgpSYn9nRSSnuWqmWdxSAgtvXEYZ42sObiPQUwBKTBVPR9aZ2GsnNvQiZYzRCBCwBL0zRC7hngcd/nR45XAPioVkMqComMgAAwUkGCjjSLKkyZMoU6o0+cCCBYorwYA40MzMAYQxvUBg8YYF/gQpKCBA2KjSAs87CSwcETAhywRqJw8wOmAERVMtE4iyrPkNpgs/ZVKgdHCq3hCwZMSePFG2iFUyWVE+OPZmhFcXAo6ygGpSqiGqR4IOXWn0DwulOafs7PkzMRULIeaFQOy4ygMHDu5W3sy5s+fPoCuioBAgAAWtcwCAAEEMlogPZD6I2COiRJYSs0mJ+JNbze4yvQWhgH3nA2ovAAq8KdGaDwFGBNSA+INT0AZGG6RTTxSAUQA1yd8UaG4EAAcTJjiQJ/LcUHTfbyhMARGBTATKbq++ibuGgm0MuE3RgHJlFNBAFL/FtwcALq1XhDZvoHMEBcRlIRtKBIo3BQoELpTWwnEcacCIHqFVWMYHoQkBYRkSgjbgGx8cmKILFgSDgQr4pWgeevvM6CNnQQAAIfkECQkAJgAsAAAAAEAAQACFBAIEhIaEREJExMbEJCIkZGJktLK07OrsnJqcVFZUDA4MNDI0/Pr8jI6M5OLkdHZ0TEpMzM7MLCosvL689PL0XF5cFBYUBAYEjIqMzMrMJCYkZGZk7O7snJ6cXFpcFBIUNDY0/P78lJKUfHp8TE5MxMLEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5Ak3BILBqPyKRyyWyaPo/BwTF4KJzYrBJyCHm/B4h2PIYwvugQQ0xuLxWcdJrzcduPI7l8dGcSAhkOBwMBBEcDemkDfUkAAWdpDBgARXGJXxSMRxcGlyEGlEMUnl6ZRgAFE1MTBRdaAaQhGESIpItFFrVoAxZYGpCeDBpDeaR8RAC6iq5NDbFeDUMflol0RQWeG04RzyERRGaXbEQlnhNOo8+mQwLUXxzjRO5yHE7zl+vSI1IHGSNXR9JV29btm5tyl841EdEtmpsN2Zz8isVAgh0AGRJlCNUEQ6xZdyxkTJOhFxZOngwwuwNgQ4kDB0ps4IgFAAZgXyTR1NRHQ/6ACDAjYDDEs6jRo0iTKl3KtKlTIQo8YMDgAeBTLQm6gElwNUuCRFyRgOiAAERXBVrlHLBKZEG6ilexXSpwBAGaDledXXJYpMPdqx4vgSyyABKDBVcreKJ7REKHDoivwqnGtmuSr3o8WHbiIW2IA2E3N1FQYGqFOqJTq17NurXr17Bj90kwgAGFAaHbKIAAoTIjhmlEuGnnhYOAopjl5MYy+Z1vNyPl3NJCQg4JTQBwomGws0n1NNcZARAYqTuT5sWft4muqI2AdBSOM1kwYoRZJcnTLM+yuzcTAH590YF5QwCHhnBOPSDHA0t4UBsDA2j2lANyOCCbEAAkQiBrFBqmYeGFJiiYBoMgAnjXhq6BUN99ILboYmxBAAAh+QQJCQAnACwAAAAAQABAAIUEAgSMiozExsRUUlQkIiSkpqTk5uQUEhQ0MjS0srT09vScmpx8enwMCgw8Ojzk4uRcWlwsKiysrqz08vQcHhy8urz8/vykoqQEBgSUkpTMzsxUVlQkJiSsqqzs6uwUFhQ0NjS0trT8+vycnpx8fnwMDgw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCTcEgsGo/IpHLJbA4PINDBSa02ESGRxSIKIazg8Gmj3ZpFG7GaiVCY39zIen4MweEhuhNDoWCSB2V3WyJTekkOEm4WChIORw6DcI+HRgABkgEARSCSb5RHBAMDHGKYngFFB55mhkUEFW8VBFYmrFsmRXaeFUcUBnceFFUJtxZ5RAiCcCJyRrGDvXuLrAp/RBDLhGlGHKylTd7GFuDJFWUiFV9HG6zcTOLG5aogDq5HA+572oMi12IEvlEpdisBHWh3pDmxdSvXHAIegtGqcirToQ8SZE2scinTpkqiSK1JhC4BqEooMRDwg7Kly5cnMHyEqcfBCGAWDIw4SdNK/oMCkgo06GmlhAZWGu4RXdLBWIelQjYIEKFAwDshkcbxfFnRTAYiQMcVIApB0jucxgwQFSBJwJBxZobCBMCP0Ee4W+S+BECN2ceI4zysbTskrLGxPcsOepfV2FaXGe58BesU6gkIU0UIgGDEKFK9lpWUaDqoA+jQSxxceLDlwYXHqJlg+Be7tu3buHPr3s3bSYQsCkI4UwNixAIQLiNMeDNhOJg2hJzr2fUGWZgFb0agpHtHxEwrI7Jv72tXjDJC6ypRN2M9TIQLI9JXUs5cOtEBBToMaPJbRBf7PTHwBgO9HVHCMiKUUGARCNwh34IHvpHggkUIaAYJFBoxQAf6CWXo4YcghmhEEAA7YnVPZzU3UnNDZXVsS2VVYlhjelFTNkFCd2NQbHA4Umg0WUJramlqdElnNVhRWVphVGtSTmNwSno1Zm5mZ0ZOWA==);background-repeat:no-repeat;background-position:center center;background-size:25px 25px;width:25px;height:25px}.close-outside{height:100%;width:100%;position:absolute;top:0;left:0}@media (max-width: 1199px){.ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:170px;max-width:100%}}@media (max-width: 991px){.ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:297px;max-width:100%}}@media (max-width: 768px){.ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:247px;max-width:100%}}@media (max-width: 576px){.ng-image-slider .ng-image-slider-container .main .main-inner .img-div{width:350px;max-width:100%}}.ng-image-fullscreen-view{position:fixed;z-index:1031;background-color:#0009;width:100%;height:100%;top:0;overflow:hidden;transition:all .5s ease-in-out;left:0;text-align:center}.ng-image-fullscreen-view.image-fullview-hide{display:none!important}.ng-image-fullscreen-view .lightbox-wrapper{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#1f1f1f;transition:all .5s ease;display:flex;justify-content:center;align-items:center}.ng-image-fullscreen-view .lightbox-wrapper.ng-ligthbox-pagination{height:calc(100% - 30px)}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div{width:100%;height:100%;border:1px solid;border-color:#00000059;position:relative;overflow:hidden}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .pre-loader{background-color:inherit;width:100%;height:100%}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .pre-loader .mnml-spinner{background-image:url(data:image/gif;base64,R0lGODlhQABAAKUAAAQCBISChMTCxDQ2NOzq7KyqrExOTBweHJSSlNTW1PT29FxaXLS2tCwqLAwKDIyKjMzKzERCRPTy9FRWVCQmJJyanNze3Pz+/GRiZLy+vExKTAQGBISGhMTGxOzu7KyurFRSVCQiJJSWlNza3Pz6/FxeXLy6vCwuLAwODIyOjMzOzERGRAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAsACwAAAAAQABAAAAG/kCWcEgsGo/IpHLJbDqf0CgRtXg8FiipdjshXL4XwmRLdk7A6Mu4zD6ivOkvIduuCzFxNMbOHCwWA0opeWApfEkgI2gWIEgPhF8Ph0cBhAFHJZAXe0gHHBkmHAdaZ5BrUx6EHnRGGhJoChpRABaaFgBGpXELna9pEqNPA5pfgUYLcHKnRg8keZJPeMScRiglViWsRwKEAlDSmtRkGd1Qw8TGZY/PULS2uGwHvmjAUbp5vHUaCrCyUpV5LvE58EBAhgfBSNUCY2HZpDoDSpRI97CixYsYM2pkgoICBW0bo0Rg4OwCCQYRQkLZIIJQBXgql1TQhCDmkhXELqwIeaCA/gcJBRIOIUcsw8YGyS54CEHEQUlNJBxo/BDnA5ETOb+c0DgPjAQiDbJe2Jqx65evQ5zmjDq1ahGimoxqRIrGA4UiEXKm3NhTAlChQ2ZCqmlTyQbBcSpsKMwkgomSJEzsZdzEAYUGUilr3sw5yYkUCSR4SJCCbGciLJ+CISFi8WkWG+DmyeC6c0tiIk43UE2IRAM+FJhKuZ0zd5sQEL5AEP4kgdgEdZKDgRCFNyQSx+PcfWK9dxsK2qE4zwq9jXTlUYjjrhNCxRcVzJ2c6J7GN/DfWhBDqpBkgwEDmWXkADeQCFBbEQ64d4EKAWLEEiGtIYJGIyE1gEBoEoyAAH4SG4JB4WtGbCAdBAeCSAQABoAAk4kstujii00EAQAh+QQJCQApACwAAAAAQABAAIUEAgSEgoTEwsREQkSsrqwcGhzk5uRsamyUkpT09vQMDgxcWlwkJiR0dnTMysxMSky8urycmpwMCgyMiowkIiTs7ux0cnT8/vwEBgTExsRERkS0trQcHhzs6uxsbmyUlpT8+vwUFhQsLix8fnzMzsxMTky8vrycnpyMjowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCUcEgsGo/IpHLJbDqf0Kh0Sl0uMheQY1HtOj+XsPjjLSMX4vSFa24LHWqxw90GgOJhEICeFE02GxMiSQAJeFl7fEUAE3dpE4lGcHhzikUThxNnh2xIEiMZGSMSUyKHYYNHCHERSgokaSQKUpinmmeTW0sBcQFSEKcXEG1YapVQwKfDZpNpx08owShtvGq+UaanqWWvsbNS0XjTbhIBGQ4BpFMA4WkokZZdIigQGyjb8fn6+/z9/v8AAxLB8MCDhwcYBD7x0CFNhQMKmZw4dCJikgPBPASkwMBThWAV1PHjkIuCkRLBwmjw1+zCMyEWUl5o0I9CnI5EYqakyY/B/s0iKFM+YOnMiISPp0L64wDrAgmTRjwEgwiQAU4kE/FUtJjEAtIwFSxwXSKhoIUHIseqXcu2bRIFVr+5JTJggyMQGwbMTYEBDJ4I8NRGCIagrQaZK9eakGnCTYgGFkJIkeAoGIi0AylQSMikgIEwBgpgk4nKyAMIdyGUWDIizYjRpPFJIHCIgFwjrcW8hkJZ5uUhGAQEE8DZSIGGFzqIjrI4ZeMhtYLdOvK4wfIoA2TqFRKi8qkEki0NPlV4CEbSVBVhGM+qeAr2KbfGG4A6D4TtRGiTJsBPQlwk8AUjn0XnyZSeRQV4dwgI4Y0V3SnjqCVBMYc4gBlXCugXh217CZVgwl0mrOZGEAAh+QQJCQAyACwAAAAAQABAAIUEAgSEgoREQkTEwsQkIiSkoqRsamzk4uT08vQUFhRUVlQ0MjS0srSUlpR0dnQMCgxMSkzU0tSsqqzs6uz8+vw8OjzMyswsLix0cnQcHhxcXly8vrycnpwEBgSEhoRERkTExsQkJiSkpqRsbmzk5uT09vQcGhxcWlw0NjS0trScmpx8fnwMDgxMTkysrqzs7uz8/vw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCZcEgsGo/IpHLJbDqf0Kh0Sq1ar8lLilJKXbBg5AUBK8MQ37BamDKbU2s1gOIuUwBxZYdA6CwBJXUwd3lHDwETZS8BD0ptdXCFRR0bght+SAtkZmhNHXhVAYJlAUpaFBQpC0wsHAglHCxTHYmjE5hgIm4iUyGjZiFhD3RmFLhPvr8wwWAdxHbHTrS/t2oSbhJUHr8eaywFrwWyswOCA9FgAKBVDx4vZQiMkmEAIX3z+Pn6+/z9/v8AA06p0AAECBUVBDLpwEEQB3QKhzQcxSHikRjKYMTwl8ABhgRIJv6qyM8EiTIkTByxkNFCvxVuVqxs+TLmEZEU+5moNUGl/hGMyjb26+jA55ECvwpYPNIBaZ0CEJfKiKHCoAqhUrNq3cq1q8IKATgUCJCwSgcII0ZAiEoFBcs6FlBMGVFLkYEwCp7VKXEiCk43JK2g0CuIglwnBjKOsAIgQsYyEdYpefBO2YtGVAQ8NiOgSYvNH6ps2wyjGxMMmx0gAYDixAkUkodcI53tdGojAAwccEPCQGxdtD1vhjDJxS8Xx0ZvNr2EcsbLRVRkbEDkA2kYnZuMyHiXyALCglYJabw58pO/ZgIPkf5YBZEK4N1QKPsEQ2V4i404fhyhSN5fFPQlxQNoYbAWErs9doARbgkSFz77ZdQfbjF4UEABHsQQWx4NKWzmnlQobHaYVOi58WFWHTDwCwNsCZTbSWZM4JtXMgBQgQYaVLDhFUEAACH5BAkJACoALAAAAABAAEAAhQQCBISChDw6PMTGxOTm5CQiJFRWVKSipNTW1CwuLAwODJSWlERGRGxqbMzOzPT29LS2tNze3AwKDERCRCwqLGRiZDQ2NJyenPz+/AQGBISGhDw+PMzKzCQmJFxaXKyqrNza3DQyNBQWFJyanExKTGxubNTS1Pz6/Ly6vOTi5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJVwSCwaj8ikcslsOp/QqHRKrVqvS0oHy10WHBiMqdAtF03hsMPM7qTTFHaZ8g7H5UqRyIlOm/BJJH0IJEwFfWOARwx1GAxNFHdNEgYeElYIjQhsEpkYCJdTIo1he2UVbxVUo6SmXahpqlQgjSBsCp4gClWMdYWcHpZXJLQYIL+KXHrJzM3Oz9DR0tPUzgIBFwcBAtVMFhyNHBZJEiEhGdEGJ6QYDx5GGRoPYQ8a6M0C8+wYJ+NDCn3eONiVDEDAfSYADFnAbgGzCfvqTBCiQF+jBwQBaYj4RoOQEBH9AfrAMc0HIRZCJiNZEsNJFQrWkToRSmNLDB6FMCTlMFn+r5ITKR4MYyIjIIMlExKJJ/OEPWsy2Z3gZkSChRA1namT+q7bkW/hRHo1AmCDhgMHNGxQOLat27djJVSAAAIBhAb3pghYMGDACKpdLKRolEKskwwXGl3IayUfuweAnSQmdQGLhMH7UjBesiHihisNSjZ4MpldZSsoSqJ4Am4fhysRSkZgHfE1kgQBPqRNgCQ2x9mSI54uImHnmxGbVaTmuNpJ532fiwBY3ggF2yElSpaAcoDdgSOh940mIoFAxBRGmWToXudAchW+2QEnMsFinalTNozoOyK6kQIlkVGEAJi9kUJkcoDEkWFCSNAAXSCgUEFWeADIkYBuxUdKCnAgqRAeO+O9lQF1dVjXoQqINYLciUOEoMEHH2gQAovQBAEAIfkECQkAMAAsAAAAAEAAQACFBAIEhIKEREJExMbEJCIk5ObkbGpsrKqsFBIUNDI09Pb03NrcVFJUdHZ0tLa0DAoMlJKULCos7O7sHBocPDo8zM7MtLK0/P785OLkXFpcfH58BAYEhIaETEpMzMrMJCYk7OrsbG5srK6sFBYUNDY0/Pr83N7cVFZUfHp8vLq8DA4MlJaULC4s9PL0HB4cPD48AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5AmHBILBqPyKRyyWw6n9CodEqtWq/YbHaiCUy0YCNBcrlICEwAi8FgAcJMTbkcUG5QhfmlgNrAkwF6GkkjA3p6AyN/R2NlZ0gbHoeHA35SGwIvD04TAV5JDSWTh4NRCSZlJglZAHmjeiBvTw+ocwWbVwmvkyRQL5MvWBm7hxm+wMLEesazrmW3WLrKZb1Qp6mrWBsg0yCWUA8CArhZDdOli1GRxB7f6VCFr4nvVHfccyB99FYACWwJsvYJHEiwoMEwDww4WLDAgQF3B5WQqKUHQ7UjAD58CDjwhahRCigcOYGhDIYTBGkRwwDxxCSUAg1MM0Ck1SQMHNOlmJaCyP6HVx8EUtxlwidQgSWVFR1i81CBnIt2KutJxGWxgTKVhTCSIenJlM5GYVCBMUIEqPQ8viohMqISCkkrtnVrRyHDFA/p6t3Lt69fOA/MkqvyIEECiFk+HFBQpsSBoFM2cGB8QQEHxFU6tJjUooMUFRUmVSCLJcJmkBGirHi1IssBYgegqPg4SQFpwrRHlRi8RNqri1RYTGPxhAQx4Ece8C4iXBlxJ7PXLhfyoMGCMgv0GXmQe9JuKKtHtT6CwNAhDwiOvN4VW3boQxXSHxHxysKRD6c5p47ygMPHEhxMB4NvoyAnhGaceUbFAyQkIKAQcuyCThERiPCfCPvRAwExEC8o8QALLDwIBwrEoPCXEMbtYiBfFtR34hAIvKdHfC8O8QAKtZiAgoh+qcBjjYsEAQAh+QQJCQAuACwAAAAAQABAAIUEAgSMioxEQkTMysxkYmTk5uQkIiSsqqxUUlT09vSUlpTc2tx0cnQcGhwsLiwMCgxMSkzU0tRsamzs7uxcWlyUkpQsKiy0trT8/vycnpwEBgSMjoxERkTMzsxkZmTs6uwkJiSsrqxUVlT8+vycmpzk4uR8enw0MjQMDgxMTkzU1tRsbmz08vRcXlwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCXcEgsGo8ayCYU2kAAx6h0Sp1yVJisdiGoer9fz0hLxowk4LR6yBmXy921nKrBvssqzXx/TN3vCHyCQxV/bxWDgxeGZRdHBisKFSsGiVOLjFqORA8kblkjGQ+WR4WZWYhDDwN/A6OkRAinWYFDCowZcycBGydRAHaMC1BCBp93I5VqDglZCQ5RbZlxQgynDGu3WgpSYn9nRSSnuWqmWdxSAgtvXEYZ42sObiPQUwBKTBVPR9aZ2GsnNvQiZYzRCBCwBL0zRC7hngcd/nR45XAPioVkMqComMgAAwUkGCjjSLKkyZMoU6o0+cCCBYorwYA40MzMAYQxvUBg8YYF/gQpKCBA2KjSAs87CSwcETAhywRqJw8wOmAERVMtE4iyrPkNpgs/ZVKgdHCq3hCwZMSePFG2iFUyWVE+OPZmhFcXAo6ygGpSqiGqR4IOXWn0DwulOafs7PkzMRULIeaFQOy4ygMHDu5W3sy5s+fPoCuioBAgAAWtcwCAAEEMlogPZD6I2COiRJYSs0mJ+JNbze4yvQWhgH3nA2ovAAq8KdGaDwFGBNSA+INT0AZGG6RTTxSAUQA1yd8UaG4EAAcTJjiQJ/LcUHTfbyhMARGBTATKbq++ibuGgm0MuE3RgHJlFNBAFL/FtwcALq1XhDZvoHMEBcRlIRtKBIo3BQoELpTWwnEcacCIHqFVWMYHoQkBYRkSgjbgGx8cmKILFgSDgQr4pWgeevvM6CNnQQAAIfkECQkAJgAsAAAAAEAAQACFBAIEhIaEREJExMbEJCIkZGJktLK07OrsnJqcVFZUDA4MNDI0/Pr8jI6M5OLkdHZ0TEpMzM7MLCosvL689PL0XF5cFBYUBAYEjIqMzMrMJCYkZGZk7O7snJ6cXFpcFBIUNDY0/P78lJKUfHp8TE5MxMLEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5Ak3BILBqPyKRyyWyaPo/BwTF4KJzYrBJyCHm/B4h2PIYwvugQQ0xuLxWcdJrzcduPI7l8dGcSAhkOBwMBBEcDemkDfUkAAWdpDBgARXGJXxSMRxcGlyEGlEMUnl6ZRgAFE1MTBRdaAaQhGESIpItFFrVoAxZYGpCeDBpDeaR8RAC6iq5NDbFeDUMflol0RQWeG04RzyERRGaXbEQlnhNOo8+mQwLUXxzjRO5yHE7zl+vSI1IHGSNXR9JV29btm5tyl841EdEtmpsN2Zz8isVAgh0AGRJlCNUEQ6xZdyxkTJOhFxZOngwwuwNgQ4kDB0ps4IgFAAZgXyTR1NRHQ/6ACDAjYDDEs6jRo0iTKl3KtKlTIQo8YMDgAeBTLQm6gElwNUuCRFyRgOiAAERXBVrlHLBKZEG6ilexXSpwBAGaDledXXJYpMPdqx4vgSyyABKDBVcreKJ7REKHDoivwqnGtmuSr3o8WHbiIW2IA2E3N1FQYGqFOqJTq17NurXr17Bj90kwgAGFAaHbKIAAoTIjhmlEuGnnhYOAopjl5MYy+Z1vNyPl3NJCQg4JTQBwomGws0n1NNcZARAYqTuT5sWft4muqI2AdBSOM1kwYoRZJcnTLM+yuzcTAH590YF5QwCHhnBOPSDHA0t4UBsDA2j2lANyOCCbEAAkQiBrFBqmYeGFJiiYBoMgAnjXhq6BUN99ILboYmxBAAAh+QQJCQAnACwAAAAAQABAAIUEAgSMiozExsRUUlQkIiSkpqTk5uQUEhQ0MjS0srT09vScmpx8enwMCgw8Ojzk4uRcWlwsKiysrqz08vQcHhy8urz8/vykoqQEBgSUkpTMzsxUVlQkJiSsqqzs6uwUFhQ0NjS0trT8+vycnpx8fnwMDgw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCTcEgsGo/IpHLJbA4PINDBSa02ESGRxSIKIazg8Gmj3ZpFG7GaiVCY39zIen4MweEhuhNDoWCSB2V3WyJTekkOEm4WChIORw6DcI+HRgABkgEARSCSb5RHBAMDHGKYngFFB55mhkUEFW8VBFYmrFsmRXaeFUcUBnceFFUJtxZ5RAiCcCJyRrGDvXuLrAp/RBDLhGlGHKylTd7GFuDJFWUiFV9HG6zcTOLG5aogDq5HA+572oMi12IEvlEpdisBHWh3pDmxdSvXHAIegtGqcirToQ8SZE2scinTpkqiSK1JhC4BqEooMRDwg7Kly5cnMHyEqcfBCGAWDIw4SdNK/oMCkgo06GmlhAZWGu4RXdLBWIelQjYIEKFAwDshkcbxfFnRTAYiQMcVIApB0jucxgwQFSBJwJBxZobCBMCP0Ee4W+S+BECN2ceI4zysbTskrLGxPcsOepfV2FaXGe58BesU6gkIU0UIgGDEKFK9lpWUaDqoA+jQSxxceLDlwYXHqJlg+Be7tu3buHPr3s3bSYQsCkI4UwNixAIQLiNMeDNhOJg2hJzr2fUGWZgFb0agpHtHxEwrI7Jv72tXjDJC6ypRN2M9TIQLI9JXUs5cOtEBBToMaPJbRBf7PTHwBgO9HVHCMiKUUGARCNwh34IHvpHggkUIaAYJFBoxQAf6CWXo4YcghmhEEAA7YnVPZzU3UnNDZXVsS2VVYlhjelFTNkFCd2NQbHA4Umg0WUJramlqdElnNVhRWVphVGtSTmNwSno1Zm5mZ0ZOWA==);background-repeat:no-repeat;background-position:center center;width:100%;height:100%}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main{display:grid;grid-template-columns:repeat(6,1fr);grid-template-rows:100%;grid-column-gap:0px;height:100%}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image{width:1299px;height:100%;position:relative}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image .custom-image-main.ng-fullimage-loading{background-image:url(data:image/gif;base64,R0lGODlhQABAAKUAAAQCBISChMTCxDQ2NOzq7KyqrExOTBweHJSSlNTW1PT29FxaXLS2tCwqLAwKDIyKjMzKzERCRPTy9FRWVCQmJJyanNze3Pz+/GRiZLy+vExKTAQGBISGhMTGxOzu7KyurFRSVCQiJJSWlNza3Pz6/FxeXLy6vCwuLAwODIyOjMzOzERGRAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAsACwAAAAAQABAAAAG/kCWcEgsGo/IpHLJbDqf0CgRtXg8FiipdjshXL4XwmRLdk7A6Mu4zD6ivOkvIduuCzFxNMbOHCwWA0opeWApfEkgI2gWIEgPhF8Ph0cBhAFHJZAXe0gHHBkmHAdaZ5BrUx6EHnRGGhJoChpRABaaFgBGpXELna9pEqNPA5pfgUYLcHKnRg8keZJPeMScRiglViWsRwKEAlDSmtRkGd1Qw8TGZY/PULS2uGwHvmjAUbp5vHUaCrCyUpV5LvE58EBAhgfBSNUCY2HZpDoDSpRI97CixYsYM2pkgoICBW0bo0Rg4OwCCQYRQkLZIIJQBXgql1TQhCDmkhXELqwIeaCA/gcJBRIOIUcsw8YGyS54CEHEQUlNJBxo/BDnA5ETOb+c0DgPjAQiDbJe2Jqx65evQ5zmjDq1ahGimoxqRIrGA4UiEXKm3NhTAlChQ2ZCqmlTyQbBcSpsKMwkgomSJEzsZdzEAYUGUilr3sw5yYkUCSR4SJCCbGciLJ+CISFi8WkWG+DmyeC6c0tiIk43UE2IRAM+FJhKuZ0zd5sQEL5AEP4kgdgEdZKDgRCFNyQSx+PcfWK9dxsK2qE4zwq9jXTlUYjjrhNCxRcVzJ2c6J7GN/DfWhBDqpBkgwEDmWXkADeQCFBbEQ64d4EKAWLEEiGtIYJGIyE1gEBoEoyAAH4SG4JB4WtGbCAdBAeCSAQABoAAk4kstujii00EAQAh+QQJCQApACwAAAAAQABAAIUEAgSEgoTEwsREQkSsrqwcGhzk5uRsamyUkpT09vQMDgxcWlwkJiR0dnTMysxMSky8urycmpwMCgyMiowkIiTs7ux0cnT8/vwEBgTExsRERkS0trQcHhzs6uxsbmyUlpT8+vwUFhQsLix8fnzMzsxMTky8vrycnpyMjowAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCUcEgsGo/IpHLJbDqf0Kh0Sl0uMheQY1HtOj+XsPjjLSMX4vSFa24LHWqxw90GgOJhEICeFE02GxMiSQAJeFl7fEUAE3dpE4lGcHhzikUThxNnh2xIEiMZGSMSUyKHYYNHCHERSgokaSQKUpinmmeTW0sBcQFSEKcXEG1YapVQwKfDZpNpx08owShtvGq+UaanqWWvsbNS0XjTbhIBGQ4BpFMA4WkokZZdIigQGyjb8fn6+/z9/v8AAxLB8MCDhwcYBD7x0CFNhQMKmZw4dCJikgPBPASkwMBThWAV1PHjkIuCkRLBwmjw1+zCMyEWUl5o0I9CnI5EYqakyY/B/s0iKFM+YOnMiISPp0L64wDrAgmTRjwEgwiQAU4kE/FUtJjEAtIwFSxwXSKhoIUHIseqXcu2bRIFVr+5JTJggyMQGwbMTYEBDJ4I8NRGCIagrQaZK9eakGnCTYgGFkJIkeAoGIi0AylQSMikgIEwBgpgk4nKyAMIdyGUWDIizYjRpPFJIHCIgFwjrcW8hkJZ5uUhGAQEE8DZSIGGFzqIjrI4ZeMhtYLdOvK4wfIoA2TqFRKi8qkEki0NPlV4CEbSVBVhGM+qeAr2KbfGG4A6D4TtRGiTJsBPQlwk8AUjn0XnyZSeRQV4dwgI4Y0V3SnjqCVBMYc4gBlXCugXh217CZVgwl0mrOZGEAAh+QQJCQAyACwAAAAAQABAAIUEAgSEgoREQkTEwsQkIiSkoqRsamzk4uT08vQUFhRUVlQ0MjS0srSUlpR0dnQMCgxMSkzU0tSsqqzs6uz8+vw8OjzMyswsLix0cnQcHhxcXly8vrycnpwEBgSEhoRERkTExsQkJiSkpqRsbmzk5uT09vQcGhxcWlw0NjS0trScmpx8fnwMDgxMTkysrqzs7uz8/vw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCZcEgsGo/IpHLJbDqf0Kh0Sq1ar8lLilJKXbBg5AUBK8MQ37BamDKbU2s1gOIuUwBxZYdA6CwBJXUwd3lHDwETZS8BD0ptdXCFRR0bght+SAtkZmhNHXhVAYJlAUpaFBQpC0wsHAglHCxTHYmjE5hgIm4iUyGjZiFhD3RmFLhPvr8wwWAdxHbHTrS/t2oSbhJUHr8eaywFrwWyswOCA9FgAKBVDx4vZQiMkmEAIX3z+Pn6+/z9/v8AA06p0AAECBUVBDLpwEEQB3QKhzQcxSHikRjKYMTwl8ABhgRIJv6qyM8EiTIkTByxkNFCvxVuVqxs+TLmEZEU+5moNUGl/hGMyjb26+jA55ECvwpYPNIBaZ0CEJfKiKHCoAqhUrNq3cq1q8IKATgUCJCwSgcII0ZAiEoFBcs6FlBMGVFLkYEwCp7VKXEiCk43JK2g0CuIglwnBjKOsAIgQsYyEdYpefBO2YtGVAQ8NiOgSYvNH6ps2wyjGxMMmx0gAYDixAkUkodcI53tdGojAAwccEPCQGxdtD1vhjDJxS8Xx0ZvNr2EcsbLRVRkbEDkA2kYnZuMyHiXyALCglYJabw58pO/ZgIPkf5YBZEK4N1QKPsEQ2V4i404fhyhSN5fFPQlxQNoYbAWErs9doARbgkSFz77ZdQfbjF4UEABHsQQWx4NKWzmnlQobHaYVOi58WFWHTDwCwNsCZTbSWZM4JtXMgBQgQYaVLDhFUEAACH5BAkJACoALAAAAABAAEAAhQQCBISChDw6PMTGxOTm5CQiJFRWVKSipNTW1CwuLAwODJSWlERGRGxqbMzOzPT29LS2tNze3AwKDERCRCwqLGRiZDQ2NJyenPz+/AQGBISGhDw+PMzKzCQmJFxaXKyqrNza3DQyNBQWFJyanExKTGxubNTS1Pz6/Ly6vOTi5AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAb+QJVwSCwaj8ikcslsOp/QqHRKrVqvS0oHy10WHBiMqdAtF03hsMPM7qTTFHaZ8g7H5UqRyIlOm/BJJH0IJEwFfWOARwx1GAxNFHdNEgYeElYIjQhsEpkYCJdTIo1he2UVbxVUo6SmXahpqlQgjSBsCp4gClWMdYWcHpZXJLQYIL+KXHrJzM3Oz9DR0tPUzgIBFwcBAtVMFhyNHBZJEiEhGdEGJ6QYDx5GGRoPYQ8a6M0C8+wYJ+NDCn3eONiVDEDAfSYADFnAbgGzCfvqTBCiQF+jBwQBaYj4RoOQEBH9AfrAMc0HIRZCJiNZEsNJFQrWkToRSmNLDB6FMCTlMFn+r5ITKR4MYyIjIIMlExKJJ/OEPWsy2Z3gZkSChRA1namT+q7bkW/hRHo1AmCDhgMHNGxQOLat27djJVSAAAIBhAb3pghYMGDACKpdLKRolEKskwwXGl3IayUfuweAnSQmdQGLhMH7UjBesiHihisNSjZ4MpldZSsoSqJ4Am4fhysRSkZgHfE1kgQBPqRNgCQ2x9mSI54uImHnmxGbVaTmuNpJ532fiwBY3ggF2yElSpaAcoDdgSOh940mIoFAxBRGmWToXudAchW+2QEnMsFinalTNozoOyK6kQIlkVGEAJi9kUJkcoDEkWFCSNAAXSCgUEFWeADIkYBuxUdKCnAgqRAeO+O9lQF1dVjXoQqINYLciUOEoMEHH2gQAovQBAEAIfkECQkAMAAsAAAAAEAAQACFBAIEhIKEREJExMbEJCIk5ObkbGpsrKqsFBIUNDI09Pb03NrcVFJUdHZ0tLa0DAoMlJKULCos7O7sHBocPDo8zM7MtLK0/P785OLkXFpcfH58BAYEhIaETEpMzMrMJCYk7OrsbG5srK6sFBYUNDY0/Pr83N7cVFZUfHp8vLq8DA4MlJaULC4s9PL0HB4cPD48AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5AmHBILBqPyKRyyWw6n9CodEqtWq/YbHaiCUy0YCNBcrlICEwAi8FgAcJMTbkcUG5QhfmlgNrAkwF6GkkjA3p6AyN/R2NlZ0gbHoeHA35SGwIvD04TAV5JDSWTh4NRCSZlJglZAHmjeiBvTw+ocwWbVwmvkyRQL5MvWBm7hxm+wMLEesazrmW3WLrKZb1Qp6mrWBsg0yCWUA8CArhZDdOli1GRxB7f6VCFr4nvVHfccyB99FYACWwJsvYJHEiwoMEwDww4WLDAgQF3B5WQqKUHQ7UjAD58CDjwhahRCigcOYGhDIYTBGkRwwDxxCSUAg1MM0Ck1SQMHNOlmJaCyP6HVx8EUtxlwidQgSWVFR1i81CBnIt2KutJxGWxgTKVhTCSIenJlM5GYVCBMUIEqPQ8viohMqISCkkrtnVrRyHDFA/p6t3Lt69fOA/MkqvyIEECiFk+HFBQpsSBoFM2cGB8QQEHxFU6tJjUooMUFRUmVSCLJcJmkBGirHi1IssBYgegqPg4SQFpwrRHlRi8RNqri1RYTGPxhAQx4Ece8C4iXBlxJ7PXLhfyoMGCMgv0GXmQe9JuKKtHtT6CwNAhDwiOvN4VW3boQxXSHxHxysKRD6c5p47ygMPHEhxMB4NvoyAnhGaceUbFAyQkIKAQcuyCThERiPCfCPvRAwExEC8o8QALLDwIBwrEoPCXEMbtYiBfFtR34hAIvKdHfC8O8QAKtZiAgoh+qcBjjYsEAQAh+QQJCQAuACwAAAAAQABAAIUEAgSMioxEQkTMysxkYmTk5uQkIiSsqqxUUlT09vSUlpTc2tx0cnQcGhwsLiwMCgxMSkzU0tRsamzs7uxcWlyUkpQsKiy0trT8/vycnpwEBgSMjoxERkTMzsxkZmTs6uwkJiSsrqxUVlT8+vycmpzk4uR8enw0MjQMDgxMTkzU1tRsbmz08vRcXlwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/kCXcEgsGo8ayCYU2kAAx6h0Sp1yVJisdiGoer9fz0hLxowk4LR6yBmXy921nKrBvssqzXx/TN3vCHyCQxV/bxWDgxeGZRdHBisKFSsGiVOLjFqORA8kblkjGQ+WR4WZWYhDDwN/A6OkRAinWYFDCowZcycBGydRAHaMC1BCBp93I5VqDglZCQ5RbZlxQgynDGu3WgpSYn9nRSSnuWqmWdxSAgtvXEYZ42sObiPQUwBKTBVPR9aZ2GsnNvQiZYzRCBCwBL0zRC7hngcd/nR45XAPioVkMqComMgAAwUkGCjjSLKkyZMoU6o0+cCCBYorwYA40MzMAYQxvUBg8YYF/gQpKCBA2KjSAs87CSwcETAhywRqJw8wOmAERVMtE4iyrPkNpgs/ZVKgdHCq3hCwZMSePFG2iFUyWVE+OPZmhFcXAo6ygGpSqiGqR4IOXWn0DwulOafs7PkzMRULIeaFQOy4ygMHDu5W3sy5s+fPoCuioBAgAAWtcwCAAEEMlogPZD6I2COiRJYSs0mJ+JNbze4yvQWhgH3nA2ovAAq8KdGaDwFGBNSA+INT0AZGG6RTTxSAUQA1yd8UaG4EAAcTJjiQJ/LcUHTfbyhMARGBTATKbq++ibuGgm0MuE3RgHJlFNBAFL/FtwcALq1XhDZvoHMEBcRlIRtKBIo3BQoELpTWwnEcacCIHqFVWMYHoQkBYRkSgjbgGx8cmKILFgSDgQr4pWgeevvM6CNnQQAAIfkECQkAJgAsAAAAAEAAQACFBAIEhIaEREJExMbEJCIkZGJktLK07OrsnJqcVFZUDA4MNDI0/Pr8jI6M5OLkdHZ0TEpMzM7MLCosvL689PL0XF5cFBYUBAYEjIqMzMrMJCYkZGZk7O7snJ6cXFpcFBIUNDY0/P78lJKUfHp8TE5MxMLEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABv5Ak3BILBqPyKRyyWyaPo/BwTF4KJzYrBJyCHm/B4h2PIYwvugQQ0xuLxWcdJrzcduPI7l8dGcSAhkOBwMBBEcDemkDfUkAAWdpDBgARXGJXxSMRxcGlyEGlEMUnl6ZRgAFE1MTBRdaAaQhGESIpItFFrVoAxZYGpCeDBpDeaR8RAC6iq5NDbFeDUMflol0RQWeG04RzyERRGaXbEQlnhNOo8+mQwLUXxzjRO5yHE7zl+vSI1IHGSNXR9JV29btm5tyl841EdEtmpsN2Zz8isVAgh0AGRJlCNUEQ6xZdyxkTJOhFxZOngwwuwNgQ4kDB0ps4IgFAAZgXyTR1NRHQ/6ACDAjYDDEs6jRo0iTKl3KtKlTIQo8YMDgAeBTLQm6gElwNUuCRFyRgOiAAERXBVrlHLBKZEG6ilexXSpwBAGaDledXXJYpMPdqx4vgSyyABKDBVcreKJ7REKHDoivwqnGtmuSr3o8WHbiIW2IA2E3N1FQYGqFOqJTq17NurXr17Bj90kwgAGFAaHbKIAAoTIjhmlEuGnnhYOAopjl5MYy+Z1vNyPl3NJCQg4JTQBwomGws0n1NNcZARAYqTuT5sWft4muqI2AdBSOM1kwYoRZJcnTLM+yuzcTAH590YF5QwCHhnBOPSDHA0t4UBsDA2j2lANyOCCbEAAkQiBrFBqmYeGFJiiYBoMgAnjXhq6BUN99ILboYmxBAAAh+QQJCQAnACwAAAAAQABAAIUEAgSMiozExsRUUlQkIiSkpqTk5uQUEhQ0MjS0srT09vScmpx8enwMCgw8Ojzk4uRcWlwsKiysrqz08vQcHhy8urz8/vykoqQEBgSUkpTMzsxUVlQkJiSsqqzs6uwUFhQ0NjS0trT8+vycnpx8fnwMDgw8PjwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAG/sCTcEgsGo/IpHLJbA4PINDBSa02ESGRxSIKIazg8Gmj3ZpFG7GaiVCY39zIen4MweEhuhNDoWCSB2V3WyJTekkOEm4WChIORw6DcI+HRgABkgEARSCSb5RHBAMDHGKYngFFB55mhkUEFW8VBFYmrFsmRXaeFUcUBnceFFUJtxZ5RAiCcCJyRrGDvXuLrAp/RBDLhGlGHKylTd7GFuDJFWUiFV9HG6zcTOLG5aogDq5HA+572oMi12IEvlEpdisBHWh3pDmxdSvXHAIegtGqcirToQ8SZE2scinTpkqiSK1JhC4BqEooMRDwg7Kly5cnMHyEqcfBCGAWDIw4SdNK/oMCkgo06GmlhAZWGu4RXdLBWIelQjYIEKFAwDshkcbxfFnRTAYiQMcVIApB0jucxgwQFSBJwJBxZobCBMCP0Ee4W+S+BECN2ceI4zysbTskrLGxPcsOepfV2FaXGe58BesU6gkIU0UIgGDEKFK9lpWUaDqoA+jQSxxceLDlwYXHqJlg+Be7tu3buHPr3s3bSYQsCkI4UwNixAIQLiNMeDNhOJg2hJzr2fUGWZgFb0agpHtHxEwrI7Jv72tXjDJC6ypRN2M9TIQLI9JXUs5cOtEBBToMaPJbRBf7PTHwBgO9HVHCMiKUUGARCNwh34IHvpHggkUIaAYJFBoxQAf6CWXo4YcghmhEEAA7YnVPZzU3UnNDZXVsS2VVYlhjelFTNkFCd2NQbHA4Umg0WUJramlqdElnNVhRWVphVGtSTmNwSno1Zm5mZ0ZOWA==);background-repeat:no-repeat;background-position:center center}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image.ng-image-slider-show{opacity:1;display:block}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image.ng-image-slider-hide{opacity:0;display:none}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image .custom-image-main{width:100%;height:100%}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image .custom-image-main img{transition:all .5s ease-in-out;width:auto;height:auto;max-height:100%;max-width:100%;position:absolute;z-index:11;margin:auto;inset:0}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image .custom-image-main iframe{inset:0;margin:auto;width:100%;height:100%;border:0}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .lightbox-image-main .lightbox-image .custom-image-main video{inset:0;margin:auto;width:100%;height:100%;border:0}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .caption{position:absolute;z-index:11;top:0;margin:auto;padding:5px;color:#fff;background-color:#00000059;max-width:100%;left:0;right:0}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .caption.show{display:block}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .caption.hide{display:none}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .next,.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .prev{position:absolute;right:10px;top:50%;background-color:#fff;border-radius:50%;cursor:pointer;margin-top:-16px;width:38px;height:38px;font-size:35px;z-index:12;line-height:30px;outline:0;color:#000;transition:all .3s ease-in-out}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .next:hover,.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .prev:hover{background-color:#d4cdcd}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .next.disable,.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .prev.disable{color:#bbb;background-color:#fff}.ng-image-fullscreen-view .lightbox-wrapper .lightbox-div .prev{left:10px}.ng-image-fullscreen-view .lightbox-wrapper .close{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAQK0lEQVRYCQEgEN/vAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIyMjLuvr60L8/Pwz/Pz8HAQEBBYAAAAA/Pz86gQEBOQEBATPFRUVvt3d3dAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPT09DNPT02T4+Php/v7+FgQEBLwBAQHHCAgI4AQEBO4AAAAA/Pz8Evn5+SD+/v43/Pz8RAICAu4ICAiZKysrmsXFxfIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVFRVcBQUF5wkJCcEYGBhOZGRkBgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY2NjBBgYGEwJCQm9BgYG6xQUFGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMTExDgwMDK0FBQXhGBgYSgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGRkZRgYGBt8LCwuvLCwsDgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAuLi4WBwcH0QsLC7EzMzMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADU1NQ4LCwutBwcH0ygoKBgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAwMA4ICAjRDQ0NnWxsbAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABycnICDQ0NlwcHB9UqKioQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsLC7ELCwuvcHBwBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAd3d3AgwMDKkLCwu3d3d3AgAAAAAAAAAAAAAAAAAAAAAAFBQUYgYGBt01NTUOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADk5OQwGBgbZFBQUagAAAAAAAAAAAAAAAAA3NzcQBgYG6xoaGkQAAAAAAAAAAAAAAAAAAAAACAgIkQMDA/sHBweZPz8/BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPz8/BAcHB5kDAwP7CAgIkwAAAAAAAAAAAAAAAAAAAAAaGho8BgYG7zIyMhQAAAAAAAAAAAAODg56CgoKuQAAAAAAAAAAAAAAAAAAAAAAAAAAAwMD+wAAAP8AAAD/BwcHoz8/PwQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/Pz8EBwcHowAAAP8AAAD/AgIC/QAAAAAAAAAAAAAAAAAAAAAAAAAACQkJsQ4ODoEAAAAAAHNzcwIHBwfjHBwcRAAAAAAAAAAAAAAAAAAAAAAAAAAABwcHmwAAAP8AAAD/AAAA/wcHB6M/Pz8EAAAAAAAAAAAAAAAAAAAAAD8/PwQHBwejAAAA/wAAAP8AAAD/BwcHmwAAAAAAAAAAAAAAAAAAAAAAAAAAHh4ePgYGBudqamoEACAgIDwGBgblbW1tAgAAAAAAAAAAAAAAAAAAAAAAAAAAOjo6BAcHB6UAAAD/AAAA/wAAAP8HBwejPz8/BAAAAAAAAAAAPz8/BAcHB6MAAAD/AAAA/wAAAP8HBwelOjo6BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcHB98cHBxCAA4ODn4LCwudAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADo6OgQHBwelAAAA/wAAAP8AAAD/BwcHoz8/PwQ/Pz8EBwcHowAAAP8AAAD/AAAA/wcHB6U6OjoEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwMDJcNDQ2FAAoKCrESEhJoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6OjoEBwcHpQAAAP8AAAD/AAAA/wcHB6MHBwejAAAA/wAAAP8AAAD/BwcHpTo6OgQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABISEmIICAi1AAkJCdUZGRlEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOjo6BAcHB6UAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8HBwelOjo6BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB0dHT4JCQnbAAUFBeElJSUyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADo6OgQHBwelAAAA/wAAAP8AAAD/AAAA/wcHB6U6OjoEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ODiQCAgLjAv///wD+/v7+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUFBQAAAAD+AAAAAAAAAAAAAAAAAAAAAAAAAP4FBQUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP7+/v4AAAACAAoKCtkcHBxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPz8/BAcHB6MAAAD/AAAA/wAAAP8AAAD/AAAA/wAAAP8HBwejPz8/BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACMjIzwJCQnfAAgICLcTExNgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/Pz8EBwcHowAAAP8AAAD/AAAA/wcHB6UHBwelAAAA/wAAAP8AAAD/BwcHoz8/PwQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQEFgHBwe7AA0NDYkMDAyTAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8/PwQHBwejAAAA/wAAAP8AAAD/BwcHpTo6OgQ6OjoEBwcHpQAAAP8AAAD/AAAA/wcHB6M/Pz8EAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwMDI0NDQ2PABcXF0YICAjZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPz8/BAcHB6MAAAD/AAAA/wAAAP8HBwelOjo6BAAAAAAAAAAAOjo6BAcHB6UAAAD/AAAA/wAAAP8HBwejPz8/BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgICNMVFRVOAFtbWwYFBQXtIiIiMgAAAAAAAAAAAAAAAAAAAAAAAAAABwcHmQAAAP8AAAD/AAAA/wcHB6U6OjoEAAAAAAAAAAAAAAAAAAAAADo6OgQHBwelAAAA/wAAAP8AAAD/BwcHmwAAAAAAAAAAAAAAAAAAAAAAAAAAJSUlLAYGBvFLS0sIAAAAAAAMDAyPCwsLowAAAAAAAAAAAAAAAAAAAAAAAAAAAwMD+wAAAP8AAAD/BwcHpTo6OgQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6OjoEBwcHpQAAAP8AAAD/AgIC/QAAAAAAAAAAAAAAAAAAAAAAAAAADAwMnQwMDJUAAAAAAAAAAAAnJyccBQUF8x8fHy4AAAAAAAAAAAAAAAAAAAAACAgIkwICAv0HBwebOjo6BAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOjo6BAcHB5sCAgL9CAgIlQAAAAAAAAAAAAAAAAAAAAAhISEoBQUF9SgoKCAAAAAAAAAAAAAAAAAAEBAQfggICMlaWloEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGpqagQJCQnDDw8PhQAAAAAAAAAAAAAAAAAAAAAASkpKBggICMsPDw+PAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8PD4cICAjPPz8/CAAAAAAAAAAAAAAAAAAAAAAAAAAAACIiIh4GBgbnEBAQcgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAExMTbgYGBukhISEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaGhooBgYG5xAQEItoaGgEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHBwcAQPDw+FBQUF6RkZGSwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIyMjIAgICM8JCQnDICAgJgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIyMjJAkJCb8HBwfRISEhIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEFBQQgODg6HBQUF9QwMDJcmJiYmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACYmJiIMDAyTBQUF9Q4ODo1BQUEKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIiIiJOnp6Xf7+/taAgIC1AUFBbgLCwvLDg4O3DExMfYAAAD+0NDQDPLy8iT09PQy+/v7R/7+/jAFBQWoGBgYid3d3doAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA3NzcM3t7eTvX19UH///8y/f39HgICAhQAAAAA/v7+7gMDA+ABAQHQCgoKvScnJ7TFxcXyAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAx6aIH59j4jkAAAAASUVORK5CYII=);background-repeat:no-repeat;background-position:center center;background-size:32px;position:absolute;top:10px;right:10px;color:#000;background-color:#fff;padding:0;opacity:1;border-radius:50%;height:36px;width:36px;z-index:12;cursor:pointer;transition:all .2s ease}.ng-image-fullscreen-view .lightbox-wrapper.error-msg{background-image:none}.ng-image-fullscreen-view .invalid-msg{color:#fff;font-size:18px;position:absolute;top:45%;left:45%}.ng-image-fullscreen-view .popup-pagination{background-color:#1f1f1f;color:#fff;position:absolute;height:30px;width:100%;text-align:center;bottom:0;font-size:16px;line-height:30px}@media (max-width: 768px){.ng-image-fullscreen-view .lightbox-wrapper{width:100%;height:100%}.ng-image-fullscreen-view .lightbox-wrapper.error-msg{background-image:none}}\n"],encapsulation:2}),t})(),KN=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({providers:[pw],imports:[CE]}),t})();function YN(t,n){if(1&t&&(ke(0,"div",39),St(1,"img",40),At(2),ke(3,"span",41),At(4,"C"),Ve(),ke(5,"div",42)(6,"div"),St(7,"i",43),At(8),ke(9,"span",44),At(10,"C"),Ve()(),ke(11,"div"),St(12,"i",45),At(13),ke(14,"span",44),At(15,"%"),Ve()(),ke(16,"div"),St(17,"i",46),At(18),ke(19,"span",44),At(20,"m/s"),Ve()(),ke(21,"div"),St(22,"i",47),At(23),ke(24,"span",44),At(25,"mmHg"),Ve()()(),ke(26,"div",48),At(27),Ve()()),2&t){const e=n.$implicit;ut(1),Yc("src",e.icon,Aa),ut(1),ro(" ",e.temperature,"\xb0"),ut(6),ro(": ",e.feelsLike,"\xb0"),ut(5),ro(": ",e.humidity,""),ut(5),ro(": ",e.wind,""),ut(5),ro(" ",e.pressure,""),ut(4),Jc(e.date)}}function JN(t,n){if(1&t&&(ke(0,"div",49)(1,"div",50),St(2,"img",40),At(3),ke(4,"span",41),At(5,"C"),Ve()(),ke(6,"div",51)(7,"div",52),At(8),Ve(),ke(9,"div",53),St(10,"i",43),At(11),ke(12,"span",44),At(13,"C"),Ve()(),ke(14,"div",53),St(15,"i",45),At(16),ke(17,"span",44),At(18,"%"),Ve()(),ke(19,"div",53),St(20,"i",46),At(21),ke(22,"span",44),At(23,"m/s"),Ve()(),ke(24,"div",54),St(25,"i",47),At(26),ke(27,"span",44),At(28,"mmHg"),Ve()()()()),2&t){const e=n.$implicit;ut(2),Yc("src",e.icon,Aa),ut(1),ro(" ",e.temperature,"\xb0"),ut(5),Jc(e.date),ut(3),ro(": ",e.feelsLike,"\xb0"),ut(5),ro(": ",e.humidity,""),ut(5),ro(": ",e.wind,""),ut(5),ro(" ",e.pressure,"")}}const fw=function(t,n){return{"fav-active":t,"filled-star":n}},ez=function(){return{width:"33%",height:300}},tz=function(){return{width:"50%",height:300}},nz=function(){return{width:"100%",height:300}},iz=[{path:"",redirectTo:"capitals",pathMatch:"full"},{path:"capitals",component:$b},{path:"capitals/:id",component:(()=>{class t{constructor(e,r,l){this.activatedRoute=e,this.helper=r,this.weatherService=l,this.imageObject=[{image:"https://mobilnist.kpi.ua/wp-content/uploads/2021/08/Kyiv-2.png",thumbImage:"https://mobilnist.kpi.ua/wp-content/uploads/2021/08/Kyiv-2.png"},{image:"https://content.r9cdn.net/rimg/dimg/27/bb/1e63bfbb-city-15139-1645cdf896a.jpg?width=1366&height=768&xhint=2663&yhint=911&crop=true",thumbImage:"https://content.r9cdn.net/rimg/dimg/27/bb/1e63bfbb-city-15139-1645cdf896a.jpg?width=1366&height=768&xhint=2663&yhint=911&crop=true"},{image:"https://thumbs.dreamstime.com/b/evening-aerial-scenery-kyiv-ukraine-scenic-summer-view-dnieper-river-pier-port-55234256.jpg",thumbImage:"https://thumbs.dreamstime.com/b/evening-aerial-scenery-kyiv-ukraine-scenic-summer-view-dnieper-river-pier-port-55234256.jpg"},{image:"https://emerging-europe.com/wp-content/uploads/2022/02/bigstock-kyiv-ukraine-nov-441124805.jpeg",thumbImage:"https://emerging-europe.com/wp-content/uploads/2022/02/bigstock-kyiv-ukraine-nov-441124805.jpeg"},{image:"https://cloudfront-us-east-1.images.arcpublishing.com/bostonglobe/XE6DBP72PVDO2I5ZGH2KJ3FMM4.jpg",thumbImage:"https://cloudfront-us-east-1.images.arcpublishing.com/bostonglobe/XE6DBP72PVDO2I5ZGH2KJ3FMM4.jpg"}],this.capitalId=-1,this.capitalsTemp=[],this.imgURL=""}ngOnInit(){this.capitalsFromLocalStorage=localStorage.getItem("capitals"),this.capitalsTemp=this.capitalsFromLocalStorage?JSON.parse(this.capitalsFromLocalStorage):[...this.helper.capitals];const e=this.activatedRoute.snapshot.paramMap.get("id");if(e){const r=Number(e);isNaN(r)||(this.capitalId=r)}this.capital=this.getCapitalById(this.capitalId),this.helper.capitalIdSubject.next(this.capitalId),this.getGeoPipe(),this.imageObject=this.transformToImageObject(this.capital.images)}addImg(){if(""!==this.imgURL.trim()){if(this.capital.images.length<4&&this.capital.images.includes("https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png")){const r=this.capital.images.indexOf("https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png");this.capital.images[r]=this.imgURL}else this.capital.images.push(this.imgURL);for(;this.capital.images.length<3;)this.capital.images.push("https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png");this.imageObject=this.transformToImageObject(this.capital.images);const e=this.capitalsTemp.find(r=>r.id===this.capitalId);e&&(e.images=this.capital.images),localStorage.setItem("capitals",JSON.stringify(this.capitalsTemp)),this.imgURL=""}}transformToImageObject(e){return e.map(r=>({image:r,thumbImage:r}))}getCapitalById(e){for(let r=0;r<this.capitalsTemp.length;r++)if(this.capitalsTemp[r].id==e)return this.capitalsTemp[r];return console.log(this.capitalsTemp[5].id),this.capitalsTemp[0]}replaceData(){const e=this.capitalsTemp.findIndex(r=>r.id===this.capitalId);-1!==e&&(this.capitalsTemp[e]=this.capital),localStorage.setItem("capitals",JSON.stringify(this.capitalsTemp))}getGeo(){return this.weatherService.getGeo(this.capital.capital).pipe(Dr(e=>{this.geos=e}))}getGeoPipe(){this.getGeo().pipe(hl(()=>this.weatherService.getWeatherForecast(this.capital.capital))).subscribe(e=>{this.days=e.map((r,l)=>({id:l,date:new Date(r.date).toLocaleDateString("en-GB",{month:"long",day:"numeric"}),temperature:Math.round(10*r.temperature)/10,humidity:r.humidity,weather:r.description,wind:Math.round(10*r.wind)/10,feelsLike:Math.round(10*r.feelsLike)/10,pressure:r.pressure,icon:r.icon})),this.getMap()})}getMap(){MM.accessToken="pk.eyJ1IjoiYXVndXNoYSIsImEiOiJjbGk2YWF6NG8wZDJyM2tsdWRjZmJ2M2U1In0.sPx40hp41fPkrVb0q9Esaw",new MM.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[this.geos.lon,this.geos.lat],zoom:9})}getGoogleMapsLink(){return`https://www.google.com/maps?q=${encodeURIComponent(this.capital.capital)}`}onclickFavourite(){this.capitalsTemp[this.capitalId].favourite=!this.capitalsTemp[this.capitalId].favourite,this.capital.favourite=this.capitalsTemp[this.capitalId].favourite}onclickVisited(){this.capitalsTemp[this.capitalId].visited=!this.capitalsTemp[this.capitalId].visited,this.capital.visited=this.capitalsTemp[this.capitalId].visited}onclickPlanned(){this.capitalsTemp[this.capitalId].planned=!this.capitalsTemp[this.capitalId].planned,this.capital.planned=this.capitalsTemp[this.capitalId].planned}ngOnDestroy(){this.replaceData()}unloadHandler(){this.replaceData()}}return t.\u0275fac=function(e){return new(e||t)(He(kh),He(k_),He(IA))},t.\u0275cmp=_r({type:t,selectors:[["app-capital-page"]],hostBindings:function(e,r){1&e&&ft("beforeunload",function(h){return r.unloadHandler(h)},0,Td)},decls:52,vars:40,consts:[[1,"container","main-container"],[1,"container","my-5","content","p-0"],[1,"row","info","px-2","py-0"],[1,"col-sm-12","title","position-relative","m-0","px-4","py-3"],[1,"capital"],[1,"country"],[1,"row","flex-row-reverse","row-buttons"],[1,"favourite",3,"ngClass","click"],[1,"icon"],[1,"bi",3,"ngClass"],[1,"planned",3,"ngClass","click"],[1,"visited",3,"ngClass","click"],[1,"row","add-image","add-image-small"],[1,"col-auto","add-image-text-container"],["placeholder","Image URL",1,"input-url","form-control",3,"ngModel","ngModelChange"],[1,"col-auto","icon","add","add-small",3,"click"],[1,"bi","bi-plus"],[1,"row","px-2","py-0","info-middle"],[1,"col-sm-12","flex-row-reverse","row","add-image","add-image-big"],[1,"col-2","icon","add",3,"click"],[1,"col-10","add-image-text-container","add-image-text-container-big"],["placeholder","Add image by URL",1,"form-control","input-url","input-url-big",3,"ngModel","ngModelChange"],[1,"col-sm-12","mx-auto","py-3","px-4","image-slider","slider-big"],["slideImage","1",3,"images","imagePopup","infinite","autoSlide","imageSize"],["nav",""],[1,"col-sm-12","mx-auto","py-3","px-4","image-slider","slider-mid"],["slideImage","1",3,"images","imagePopup","infinite","imageSize"],[1,"col-sm-12","mx-auto","py-3","px-4","image-slider","slider-small"],[1,"col-sm-12","col-lg-4","description","px-4","py-4"],[1,"text-description","mt-2"],[1,"col-sm-12","col-lg-8","m-0","p-0","cards-container"],[1,"row","p-0","m-0","cards-vertical"],["class","column card-weather",4,"ngFor","ngForOf"],[1,"row","p-0","m-0","cards-horizontal"],["class","card-weather row p-0 m-0",4,"ngFor","ngForOf"],[1,"row","px-2","py-0"],[1,"container","map-container"],["id","map",1,"map-window"],["target","\u201d_blank\u201d",1,"button","map-button",3,"href"],[1,"column","card-weather"],[1,"weather-icon",3,"src"],[1,"text-celsius"],[1,"details","my-4","py-4"],[1,"bi","bi-thermometer-half"],[1,"text-small"],[1,"bi","bi-moisture"],[1,"bi","bi-wind"],[1,"bi","bi-speedometer"],[1,"time","pb-4"],[1,"card-weather","row","p-0","m-0"],[1,"col-4","px-0"],[1,"col-8","row","details","my-0","py-0"],[1,"col-12","time","my-2"],[1,"col-12","px-3"],[1,"col-12","px-3","pb-1"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),At(5),Ve(),ke(6,"h2",5),At(7),Ve(),ke(8,"div",6)(9,"button",7),ft("click",function(){return r.onclickFavourite()}),ke(10,"div",8),St(11,"i",9),Ve()(),ke(12,"button",10),ft("click",function(){return r.onclickPlanned()}),ke(13,"div",8),St(14,"i",9),Ve()(),ke(15,"button",11),ft("click",function(){return r.onclickVisited()}),ke(16,"div",8),St(17,"i",9),Ve()()(),ke(18,"div",12)(19,"div",13)(20,"input",14),ft("ngModelChange",function(h){return r.imgURL=h}),Ve()(),ke(21,"div",15),ft("click",function(){return r.addImg()}),St(22,"i",16),Ve()()()(),ke(23,"div",17)(24,"div",18)(25,"div",19),ft("click",function(){return r.addImg()}),St(26,"i",16),Ve(),ke(27,"div",20)(28,"input",21),ft("ngModelChange",function(h){return r.imgURL=h}),Ve()()(),ke(29,"div",22),St(30,"ng-image-slider",23,24),Ve(),ke(32,"div",25),St(33,"ng-image-slider",26,24),Ve(),ke(35,"div",27),St(36,"ng-image-slider",23,24),Ve(),ke(38,"div",28)(39,"p",29),At(40),Ve()(),ke(41,"div",30)(42,"div",31),yt(43,YN,28,7,"div",32),Ve()(),ke(44,"div",30)(45,"div",33),yt(46,JN,29,7,"div",34),Ve()()(),ke(47,"div",35)(48,"div",36),St(49,"div",37),ke(50,"a",38),At(51,"Open with Google Maps"),Ve()()()()()),2&e&&(ut(5),Jc(r.capital.capital),ut(2),ro("",r.capital.country," "),ut(2),ot("ngClass",eu(28,fw,r.capital.favourite,r.capital.favourite)),ut(2),ot("ngClass",r.capital.favourite?"bi-star-fill":"bi-star"),ut(1),ot("ngClass",eu(31,fw,r.capital.planned,r.capital.planned)),ut(2),ot("ngClass",r.capital.planned?"bi-calendar-check":"bi-calendar"),ut(1),ot("ngClass",eu(34,fw,r.capital.visited,r.capital.visited)),ut(2),ot("ngClass",r.capital.visited?"bi-eye-fill":"bi-eye"),ut(3),ot("ngModel",r.imgURL),ut(8),ot("ngModel",r.imgURL),ut(2),ot("images",r.imageObject)("imagePopup",!1)("infinite",!0)("autoSlide",4)("imageSize",Ev(37,ez)),ut(3),ot("images",r.imageObject)("imagePopup",!1)("infinite",!0)("imageSize",Ev(38,tz)),ut(3),ot("images",r.imageObject)("imagePopup",!1)("infinite",!0)("autoSlide",4)("imageSize",Ev(39,nz)),ut(4),ro(" ",r.capital.description," "),ut(3),ot("ngForOf",r.days),ut(3),ot("ngForOf",r.days),ut(4),ot("href",r.getGoogleMapsLink(),Aa))},dependencies:[Nf,c_,ep,P_,Jf,XN],styles:[".main-container[_ngcontent-%COMP%]{margin-top:0!important;padding-top:150px;padding-right:0;padding-left:0;width:98%!important}.content[_ngcontent-%COMP%]{margin:0!important;width:100%!important;overflow:hidden;box-shadow:#63636333 0 -1px 5px;border-radius:1rem;background-color:#fff9;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:rgb(255,255,255) 3px solid}.capital[_ngcontent-%COMP%]{font-size:2.2rem}.description[_ngcontent-%COMP%]{border-top:white 3px solid;background:rgba(255,255,255,.5);overflow-y:scroll}.column[_ngcontent-%COMP%]{padding:10px 10px 0;width:20%}.cards[_ngcontent-%COMP%]{background-size:cover;background:linear-gradient(to left,rgba(255,255,255,0) 75%,rgba(255,255,255,.6));height:auto}.cards-container[_ngcontent-%COMP%]{background:rgba(255,255,255,.5)!important}.card-weather[_ngcontent-%COMP%]{margin:0;font-size:2rem;text-align:center;font-weight:400;border-left:rgb(255,255,255) 3px solid;border-top:white 3px solid;padding:0}.text-celsius[_ngcontent-%COMP%]{font-size:1.6rem}.weather[_ngcontent-%COMP%]{font-size:1.5rem}.weather-icon[_ngcontent-%COMP%]{width:120px;height:120px;filter:drop-shadow(0px 1px 6px #a9a9a9)}.details[_ngcontent-%COMP%]{font-size:1.2rem;border-bottom:rgba(255,255,255,.2) 3px solid;border-top:rgba(255,255,255,.2) 3px solid}.text-small[_ngcontent-%COMP%]{font-size:.9rem}.time[_ngcontent-%COMP%]{text-align:center;font-size:1.4rem}.info[_ngcontent-%COMP%]{padding:15px 15px 15px 30px;z-index:3;color:#333;height:125px}.info-middle[_ngcontent-%COMP%]{border-bottom:3px white solid}.title[_ngcontent-%COMP%]{border-bottom:3px white solid;background-color:#ffffff80}.country[_ngcontent-%COMP%]{font-size:1.5rem}button[_ngcontent-%COMP%]{border:none;background:transparent!important}.row-buttons[_ngcontent-%COMP%]{overflow:hidden;position:absolute;top:-1px;right:12px;z-index:4;background-color:#fffc;border-bottom-left-radius:.5rem;border-left:3px white solid;border-bottom:3px white solid}.add-image[_ngcontent-%COMP%]{text-align:center;background-color:#fffc;padding:5px 8px 5px 5px}.add-image-small[_ngcontent-%COMP%]{position:absolute;bottom:0;right:12px;border-right:3px white solid;border-top:3px white solid;border-top-left-radius:.5rem}.add-image-big[_ngcontent-%COMP%]{margin:0;width:100%;border-bottom:3px white solid;padding-right:12px}.bi-plus[_ngcontent-%COMP%]{max-height:32px!important;position:relative}.bi-plus[_ngcontent-%COMP%]:before{position:absolute;top:6px;right:-15px}.input-url[_ngcontent-%COMP%]{width:150px;height:100%;background-color:#eee;border:none;border-top-left-radius:.5rem;border-bottom-left-radius:.5rem;padding:7px 12px}.input-url-big[_ngcontent-%COMP%]{width:100%}.add-small[_ngcontent-%COMP%]{width:42px}.add[_ngcontent-%COMP%]{border-top-right-radius:.5rem;border-bottom-right-radius:.5rem;background-color:#1e90ff;padding:0;height:42px}.add-icon[_ngcontent-%COMP%]{width:100%}.add-image-text-container[_ngcontent-%COMP%]{padding-left:6px;padding-right:0;height:42px}.add-image-text[_ngcontent-%COMP%]{margin:0}.favourite[_ngcontent-%COMP%], .visited[_ngcontent-%COMP%], .planned[_ngcontent-%COMP%]{height:48px;width:48px;padding:0;background:transparent}.favourite[_ngcontent-%COMP%]{margin-right:5px}.bi-calendar-check[_ngcontent-%COMP%], .bi-calendar[_ngcontent-%COMP%]:hover{color:#23c26b}.bi-eye-fill[_ngcontent-%COMP%], .bi-eye[_ngcontent-%COMP%]:hover{color:#1e90ff}.bi-star-fill[_ngcontent-%COMP%], .bi-star[_ngcontent-%COMP%]:hover{color:#fdda18}.icon[_ngcontent-%COMP%]{font-size:2rem;text-align:center}.icon[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{transition:color .1s}.bi-star[_ngcontent-%COMP%]{color:#333;margin-top:0;padding-top:0}.text-description[_ngcontent-%COMP%]{font-size:1.1rem;text-align:start;text-indent:25px}.text-description-title[_ngcontent-%COMP%]{font-size:1.3rem}.info-bottom[_ngcontent-%COMP%]{border-top:3px white solid}.map-container[_ngcontent-%COMP%]{padding:5px 10px;height:300px;position:relative}.map-window[_ngcontent-%COMP%]{height:100%;width:100%;background:#cce7cf;border-radius:10px;overflow:hidden}.map-button[_ngcontent-%COMP%]{position:absolute;right:15px;top:10px;padding:5px 10px;border-radius:5px;background:rgba(255,255,255,.5)!important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:2px white solid;text-decoration:none;color:#333}.custom-slider[_ngcontent-%COMP%]   .nav-btn[_ngcontent-%COMP%]{background-color:red;color:#fff;font-size:24px}.custom-slider[_ngcontent-%COMP%]   .nav-btn[_ngcontent-%COMP%]:hover{background-color:#8b0000}@media (max-width: 992px){.slider-big[_ngcontent-%COMP%]{display:none}.content[_ngcontent-%COMP%]{max-height:100%}}@media (min-width: 992px){.slider-mid[_ngcontent-%COMP%]{display:none}.description[_ngcontent-%COMP%]{max-height:445px;overflow-y:auto}}@media (max-width: 768px){.content[_ngcontent-%COMP%]{max-width:570px}.card-weather[_ngcontent-%COMP%]{width:20%!important}.ng-image-slider[_ngcontent-%COMP%]   .ng-image-slider-wrapper[_ngcontent-%COMP%]   .ng-image-slider-content[_ngcontent-%COMP%]   .ng-image-slider-content-wrapper[_ngcontent-%COMP%]{width:50%}.weather-icon[_ngcontent-%COMP%]{width:80px;height:80px}.slider-mid[_ngcontent-%COMP%]{display:none}}@media (min-width: 768px){.slider-small[_ngcontent-%COMP%]{display:none}}@media (min-width: 576px){.cards-horizontal[_ngcontent-%COMP%], .add-image-big[_ngcontent-%COMP%]{display:none}}@media (max-width: 576px){.content[_ngcontent-%COMP%]{width:95%}.cards-vertical[_ngcontent-%COMP%], .add-image-small[_ngcontent-%COMP%]{display:none!important}.card-weather[_ngcontent-%COMP%]{width:100%!important;display:flex}.details[_ngcontent-%COMP%]{border:none;text-align:right;margin:0;padding:0;border-left:rgba(255,255,255,.4) 3px solid}.time[_ngcontent-%COMP%]{border-bottom:rgba(255,255,255,.4) 3px solid;margin:0 auto}.weather-icon[_ngcontent-%COMP%]{width:100px;height:100px}}"]}),t})()}];let rz=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[dM.forRoot(iz),dM]}),t})(),oz=(()=>{class t{constructor(e){this.helper=e,this.isOpen=!1,this.enteredSearchValue=""}toggleMenu(){setTimeout(()=>{this.isOpen=!this.isOpen},100)}onSearchTextChanged(){this.helper.searchValueSubject.next(this.enteredSearchValue)}scrollTo(e){document.getElementById(e).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}}return t.\u0275fac=function(e){return new(e||t)(He(k_))},t.\u0275cmp=_r({type:t,selectors:[["app-dropdown"]],decls:20,vars:5,consts:[[1,"menu-container"],[1,"menu-toggler",3,"click"],[1,"bi","bi-list"],[1,"background",3,"click"],[1,"menu"],[1,"menu-item"],[1,"form-inline","mx-2"],[1,"input-group"],["type","search","placeholder","Search","name","something",1,"form-control","s-field",3,"ngModel","ngModelChange","keyup","emptied"],["type","submit",1,"btn","bg-success",2,"color","#f0f4ff",3,"click"],[1,"menu-item",3,"click"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"div",1),ft("click",function(){return r.toggleMenu()}),St(2,"i",2),Ve(),ke(3,"div",3),ft("click",function(){return r.toggleMenu()}),Ve(),ke(4,"div",4)(5,"div",5)(6,"form",6)(7,"div",7)(8,"input",8),ft("ngModelChange",function(h){return r.enteredSearchValue=h})("keyup",function(){return r.onSearchTextChanged()})("emptied",function(){return r.onSearchTextChanged()}),Ve(),ke(9,"button",9),ft("click",function(){return r.onSearchTextChanged()}),At(10,"Search"),Ve()()()(),ke(11,"div",10),ft("click",function(){return r.scrollTo("home")}),ke(12,"a"),At(13,"Home"),Ve()(),ke(14,"div",10),ft("click",function(){return r.scrollTo("capitals")}),ke(15,"a"),At(16,"Capitals"),Ve()(),ke(17,"div",10),ft("click",function(){return r.scrollTo("about")}),ke(18,"a"),At(19,"About"),Ve()()()()),2&e&&(ut(3),Sf("open",r.isOpen),ut(1),Sf("open",r.isOpen),ut(4),ot("ngModel",r.enteredSearchValue))},dependencies:[sw,ep,P_,Qb,Jf,B_],styles:[".menu-container[_ngcontent-%COMP%]{position:relative}.background[_ngcontent-%COMP%]{position:fixed;top:85px;left:0;right:0;width:100vw!important;height:0;background-color:#0000;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:20}.menu-toggler[_ngcontent-%COMP%]{margin:0;padding:0 8px;background:white;border-radius:2rem;cursor:pointer;z-index:100}.bi-list[_ngcontent-%COMP%]{margin:0 auto;text-align:center;font-size:2rem;font-weight:1200}.menu[_ngcontent-%COMP%]{width:200px;margin:0;top:80px;right:0;background:rgba(255,255,255,.8);border:3px white solid;border-radius:15px;position:absolute;z-index:-1;transition:transform .1s ease;transform:scale(var(--ggs, 0));box-shadow:#32325d40 0 50px 100px -20px,#0000004d 0 30px 60px -30px;z-index:100}.menu.open[_ngcontent-%COMP%]{transform:scale(1)}.background.open[_ngcontent-%COMP%]{transform:scale(1);height:100vh}.menu-item[_ngcontent-%COMP%]{padding:10px 0;color:#323232;text-align:center;border-bottom:3px white solid;width:100%}.menu-item[_ngcontent-%COMP%]:last-child{border:none}.s-field[_ngcontent-%COMP%]{border:none}.input-group[_ngcontent-%COMP%]{border-radius:2rem}"]}),t})();function sz(t,n){if(1&t){const e=Gt();ke(0,"form",11)(1,"div",12)(2,"input",13),ft("ngModelChange",function(l){return In(e),gn(Ot().enteredSearchValue=l)})("keyup",function(){return In(e),gn(Ot().onSearchTextChanged())})("emptied",function(){return In(e),gn(Ot().onSearchTextChanged())}),Ve(),ke(3,"button",14),ft("click",function(){return In(e),gn(Ot().onSearchTextChanged())}),At(4,"Search"),Ve()()()}if(2&t){const e=Ot();ut(2),ot("ngModel",e.enteredSearchValue)}}let mw,az=(()=>{class t{constructor(e,r){this.route=e,this.helper=r,this.enteredSearchValue="",this.capitalId=-1,this.searchTextChanged=new ii}ngOnInit(){this.helper.capitalIdSubject.subscribe(e=>{this.capitalId=e})}onSearchTextChanged(){this.helper.searchValueSubject.next(this.enteredSearchValue)}scrollTo(e){document.getElementById(e).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}}return t.\u0275fac=function(e){return new(e||t)(He(kh),He(k_))},t.\u0275cmp=_r({type:t,selectors:[["app-header"]],outputs:{searchTextChanged:"searchTextChanged"},decls:19,vars:1,consts:[[1,"navbar","navbar-expand-lg","mx-0"],[1,"container"],["href","#",1,"navbar-brand","px-3"],["id","navbarSupportedContent",1,"collapse","navbar-collapse"],[1,"navbar-nav","ms-auto"],[1,"nav-item","active"],["class","form-inline",4,"ngIf"],[1,"nav-item","active","px-2"],[1,"nav-link","current",3,"click"],[1,"nav-item","px-2"],[1,"nav-link",3,"click"],[1,"form-inline"],[1,"input-group"],["type","search","placeholder","Search here","name","something",1,"form-control","s-field",3,"ngModel","ngModelChange","keyup","emptied"],["type","submit",1,"btn","bg-success",2,"color","#f0f4ff",3,"click"]],template:function(e,r){1&e&&(ke(0,"header")(1,"nav",0)(2,"div",1)(3,"a",2),At(4,"European capitals"),Ve(),St(5,"app-dropdown"),ke(6,"div",3)(7,"ul",4)(8,"li",5),yt(9,sz,5,1,"form",6),Ve(),ke(10,"li",7)(11,"a",8),ft("click",function(){return r.scrollTo("home")}),At(12,"Home"),Ve()(),ke(13,"li",9)(14,"a",10),ft("click",function(){return r.scrollTo("capitals")}),At(15,"Capitals"),Ve()(),ke(16,"li",9)(17,"a",10),ft("click",function(){return r.scrollTo("about")}),At(18,"About"),Ve()()()()()()()),2&e&&(ut(9),ot("ngIf",-1==r.capitalId))},dependencies:[Zd,sw,ep,P_,Qb,Jf,B_,oz],styles:["header[_ngcontent-%COMP%]{font-weight:500}.navbar[_ngcontent-%COMP%]{width:100%;height:85px;background-color:#ffffff80;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);box-shadow:#63636333 0 1px 5px;z-index:9999;position:fixed;top:0;border-bottom:rgb(255,255,255) 3px solid}.menu[_ngcontent-%COMP%]{border-radius:2rem;border:none;padding:8px 10px}.navbar-brand[_ngcontent-%COMP%]{color:#24292e;font-size:2rem;font-weight:bolder;background:rgba(255,255,255,.9);border-radius:2rem;transition:.3s}.navbar-brand[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.5)}.nav-item[_ngcontent-%COMP%]{margin-left:15px;border-radius:2em;transition:.3s;background:rgba(255,255,255,.8);overflow:hidden;cursor:pointer}.nav-item[_ngcontent-%COMP%]:hover{background:rgba(255,255,255,.5)}.s-field[_ngcontent-%COMP%]{background:rgba(255,255,255,.9);border:none;height:100%;padding-top:10px;padding-bottom:10px}.s-field[_ngcontent-%COMP%]:focus{box-shadow:none;background:rgba(255,255,255,.6);outline:0}.bg-success[_ngcontent-%COMP%]:hover{background:#207044!important}[_ngcontent-%COMP%]::placeholder{color:#80818f}.nav-link[_ngcontent-%COMP%]{color:#24292e}@media (max-width: 576px){.navbar-brand[_ngcontent-%COMP%]{font-size:1.5rem;margin-right:0}.navbar[_ngcontent-%COMP%]{margin-left:5px}}@media (min-width: 992px){app-dropdown[_ngcontent-%COMP%]{display:none}}"]}),t})(),lz=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_r({type:t,selectors:[["app-about"]],decls:5,vars:0,consts:[["id","about",1,"container"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"h1"),At(2,"About Us:"),Ve(),ke(3,"h2"),At(4," At \"European Capitals\", we are dedicated to helping you plan the perfect European weekend getaway. Our platform provides detailed weather and temperature information for various European capitals, allowing you to make informed decisions about your destination. Whether you're seeking a cultural adventure, culinary delights, or simply a relaxing escape, we're here to assist you in curating a memorable experience. Explore our site, discover your ideal European capital, and embark on a weekend getaway like never before."),Ve()())},styles:[".container[_ngcontent-%COMP%]{text-align:center;margin-bottom:50px;margin-top:25px;color:#323232;overflow:hidden;width:98%;background-color:#ffffffb3;border-radius:1rem;border:rgb(255,255,255) 3px solid;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:#63636333 0 1px 5px;padding-top:25px;padding-bottom:25px}h2[_ngcontent-%COMP%]{font-size:1.1rem;width:90%;margin:0 auto;line-height:1.5em}@media (max-width: 576px){h2[_ngcontent-%COMP%]{font-size:1rem;width:100%}}"]}),t})(),cz=(()=>{class t{constructor(){this.title="my-app",this.images=["https://s1.it.atcdn.net/wp-content/uploads/2019/12/Vilnius-hero.jpg","https://d10mzz35brm2m8.cloudfront.net//sitecore/media%20library/PriorityPass/Images/february-2023-content-5-1c15b085-7298-4e73-b55a-3ba1ebef2a61.jpg","https://cdn.kimkim.com/files/a/images/0fb396488cca12f8626efb22722a4074556ca535/big-862477076899f85eafbb423590a3d120.jpg","https://www.nationsonline.org/gallery/Switzerland/Sunrise-on-the-Matterhorn.jpg","https://cdn.i-scmp.com/sites/default/files/d8/images/methode/2019/10/10/078b97ea-eb5a-11e9-9e8e-4022fb9638c4_image_hires_203601.jpg","https://travellersworldwide.com/wp-content/uploads/2022/12/Shutterstock_2045606852.jpg"]}ngOnInit(){this.currentIndex=0,this.currentImage=this.images[this.currentIndex],this.preloadNextImage(),this.changeBackgroundImage()}preloadNextImage(){this.nextImage=this.images[(this.currentIndex+1)%this.images.length],(new Image).src=this.nextImage}changeBackgroundImage(){setInterval(()=>{this.previousImage=this.currentImage,this.currentIndex=(this.currentIndex+1)%this.images.length,this.currentImage=this.images[this.currentIndex],this.preloadNextImage()},8e3)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_r({type:t,selectors:[["app-root"]],decls:6,vars:4,consts:[[1,"background-fade"],["role","main",1,"all-content"]],template:function(e,r){1&e&&(ke(0,"div",0),St(1,"div"),ke(2,"div",1),St(3,"app-header")(4,"router-outlet")(5,"app-about"),Ve()()),2&e&&(ut(1),Df("background-image","url("+r.nextImage+")"),ut(1),Df("background-image","url("+r.currentImage+")"))},dependencies:[Ib,az,lz],styles:['.all-content[_ngcontent-%COMP%]{background-image:url("https://www.travelandleisure.com/thmb/Etq4zWgOW-z9H7ZScs5_6WDcDvQ=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/berlin-germany-aerial-lead-BERLINTG0921-475e3a333c7f4fdea7743c6fc2f261af.jpg");padding-bottom:10px;background-attachment:fixed;background-size:cover;background-position:center;min-height:100vh;padding-top:0;transition:background-image 3s ease}.background-fade[_ngcontent-%COMP%]{opacity:1;background-color:#fff}.background-fade.ng-leave[_ngcontent-%COMP%]{opacity:0}']}),t})();try{mw=typeof Intl<"u"&&Intl.v8BreakIterator}catch{mw=!1}let N_,VT=(()=>{class t{constructor(e){this._platformId=e,this.isBrowser=this._platformId?Yx(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!mw)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return t.\u0275fac=function(e){return new(e||t)(mt(o_))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function NA(t){return function uz(){if(null==N_&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>N_=!0}))}finally{N_=N_||!1}return N_}()?t:!!t.capture}function UT(t){return Array.isArray(t)?t:[t]}function GT(t){return t instanceof Vr?t.nativeElement:t}class xz extends je{constructor(n,e){super()}schedule(n,e=0){return this}}const VA={setInterval(t,n,...e){const{delegate:r}=VA;return r?.setInterval?r.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){const{delegate:n}=VA;return(n?.clearInterval||clearInterval)(t)},delegate:void 0},HT={now:()=>(HT.delegate||Date).now(),delegate:void 0};class z_{constructor(n,e=z_.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,r){return new this.schedulerActionCtor(this,n).schedule(r,e)}}z_.now=HT.now;const Cz=new class wz extends z_{constructor(n,e=z_.now){super(n,e),this.actions=[],this._active=!1}flush(n){const{actions:e}=this;if(this._active)return void e.push(n);let r;this._active=!0;do{if(r=n.execute(n.state,n.delay))break}while(n=e.shift());if(this._active=!1,r){for(;n=e.shift();)n.unsubscribe();throw r}}}(class bz extends xz{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var r;if(this.closed)return this;this.state=n;const l=this.id,h=this.scheduler;return null!=l&&(this.id=this.recycleAsyncId(h,l,e)),this.pending=!0,this.delay=e,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(h,this.id,e),this}requestAsyncId(n,e,r=0){return VA.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,e,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return e;null!=e&&VA.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(n,e);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let l,r=!1;try{this.work(n)}catch(h){r=!0,l=h||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),l}unsubscribe(){if(!this.closed){const{id:n,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,p(r,this),null!=n&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}});function Iz(t){return hi((n,e)=>{Rt(t).subscribe(Jn(e,()=>e.complete(),Eo)),!e.closed&&n.subscribe(e)})}const $T=new Set;let tm,Mz=(()=>{class t{constructor(e){this._platform=e,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Dz}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&function Tz(t){if(!$T.has(t))try{tm||(tm=document.createElement("style"),tm.setAttribute("type","text/css"),document.head.appendChild(tm)),tm.sheet&&(tm.sheet.insertRule(`@media ${t} {body{ }}`,0),$T.add(t))}catch(n){console.error(n)}}(e),this._matchMedia(e)}}return t.\u0275fac=function(e){return new(e||t)(mt(VT))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Dz(t){return{matches:"all"===t||""===t,media:t,addListener:()=>{},removeListener:()=>{}}}let Sz=(()=>{class t{constructor(e,r){this._mediaMatcher=e,this._zone=r,this._queries=new Map,this._destroySubject=new nr}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return qT(UT(e)).some(l=>this._registerQuery(l).mql.matches)}observe(e){let h=cb(qT(UT(e)).map(_=>this._registerQuery(_).observable));return h=Jv(h.pipe(Qd(1)),h.pipe(function Az(t){return Yl((n,e)=>t<=e)}(1),function Ez(t,n=Cz){return hi((e,r)=>{let l=null,h=null,_=null;const C=()=>{if(l){l.unsubscribe(),l=null;const P=h;h=null,r.next(P)}};function M(){const P=_+t,B=n.now();if(B<P)return l=this.schedule(void 0,P-B),void r.add(l);C()}e.subscribe(Jn(r,P=>{h=P,_=n.now(),l||(l=n.schedule(M,t),r.add(l))},()=>{C(),r.complete()},void 0,()=>{h=l=null}))})}(0))),h.pipe(ct(_=>{const C={matches:!1,breakpoints:{}};return _.forEach(({matches:M,query:P})=>{C.matches=C.matches||M,C.breakpoints[P]=M}),C}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);const r=this._mediaMatcher.matchMedia(e),h={observable:new pn(_=>{const C=M=>this._zone.run(()=>_.next(M));return r.addListener(C),()=>{r.removeListener(C)}}).pipe(oI(r),ct(({matches:_})=>({query:e,matches:_})),Iz(this._destroySubject)),mql:r};return this._queries.set(e,h),h}}return t.\u0275fac=function(e){return new(e||t)(mt(Mz),mt(tr))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function qT(t){return t.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}const XT="cdk-high-contrast-black-on-white",KT="cdk-high-contrast-white-on-black",_w="cdk-high-contrast-active";let jz=(()=>{class t{constructor(e,r){this._platform=e,this._document=r,this._breakpointSubscription=$t(Sz).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const r=this._document.defaultView||window,l=r&&r.getComputedStyle?r.getComputedStyle(e):null,h=(l&&l.backgroundColor||"").replace(/ /g,"");switch(e.remove(),h){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return 2;case"rgb(255,255,255)":case"rgb(255,250,239)":return 1}return 0}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(_w,XT,KT),this._hasCheckedHighContrastMode=!0;const r=this.getHighContrastMode();1===r?e.add(_w,XT):2===r&&e.add(_w,KT)}}}return t.\u0275fac=function(e){return new(e||t)(mt(VT),mt(ki))},t.\u0275prov=Mt({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),YT=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({}),t})();const $z=new vt("mat-sanity-checks",{providedIn:"root",factory:function Hz(){return!0}});let tD=(()=>{class t{constructor(e,r,l){this._sanityChecks=r,this._document=l,this._hasDoneGlobalChecks=!1,e._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(e){return!function pz(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}()&&("boolean"==typeof this._sanityChecks?this._sanityChecks:!!this._sanityChecks[e])}}return t.\u0275fac=function(e){return new(e||t)(mt(jz),mt($z,8),mt(ki))},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[YT,YT]}),t})();class Wz{constructor(n,e,r,l=!1){this._renderer=n,this.element=e,this.config=r,this._animationForciblyDisabledThroughCss=l,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const nD=NA({passive:!0,capture:!0});class Zz{constructor(){this._events=new Map,this._delegateEventHandler=n=>{const e=function dz(t){return t.composedPath?t.composedPath()[0]:t.target}(n);e&&this._events.get(n.type)?.forEach((r,l)=>{(l===e||l.contains(e))&&r.forEach(h=>h.handleEvent(n))})}}addHandler(n,e,r,l){const h=this._events.get(e);if(h){const _=h.get(r);_?_.add(l):h.set(r,new Set([l]))}else this._events.set(e,new Map([[r,new Set([l])]])),n.runOutsideAngular(()=>{document.addEventListener(e,this._delegateEventHandler,nD)})}removeHandler(n,e,r){const l=this._events.get(n);if(!l)return;const h=l.get(e);h&&(h.delete(r),0===h.size&&l.delete(e),0===l.size&&(this._events.delete(n),document.removeEventListener(n,this._delegateEventHandler,nD)))}}const iD={enterDuration:225,exitDuration:150},rD=NA({passive:!0,capture:!0}),oD=["mousedown","touchstart"],sD=["mouseup","mouseleave","touchend","touchcancel"];class jA{constructor(n,e,r,l){this._target=n,this._ngZone=e,this._platform=l,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,l.isBrowser&&(this._containerElement=GT(r))}fadeInRipple(n,e,r={}){const l=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),h={...iD,...r.animation};r.centered&&(n=l.left+l.width/2,e=l.top+l.height/2);const _=r.radius||function Xz(t,n,e){const r=Math.max(Math.abs(t-e.left),Math.abs(t-e.right)),l=Math.max(Math.abs(n-e.top),Math.abs(n-e.bottom));return Math.sqrt(r*r+l*l)}(n,e,l),C=n-l.left,M=e-l.top,P=h.enterDuration,B=document.createElement("div");B.classList.add("mat-ripple-element"),B.style.left=C-_+"px",B.style.top=M-_+"px",B.style.height=2*_+"px",B.style.width=2*_+"px",null!=r.color&&(B.style.backgroundColor=r.color),B.style.transitionDuration=`${P}ms`,this._containerElement.appendChild(B);const G=window.getComputedStyle(B),ue=G.transitionDuration,ve="none"===G.transitionProperty||"0s"===ue||"0s, 0s"===ue||0===l.width&&0===l.height,Le=new Wz(this,B,r,ve);B.style.transform="scale3d(1, 1, 1)",Le.state=0,r.persistent||(this._mostRecentTransientRipple=Le);let qe=null;return!ve&&(P||h.exitDuration)&&this._ngZone.runOutsideAngular(()=>{const tt=()=>this._finishRippleTransition(Le),bt=()=>this._destroyRipple(Le);B.addEventListener("transitionend",tt),B.addEventListener("transitioncancel",bt),qe={onTransitionEnd:tt,onTransitionCancel:bt}}),this._activeRipples.set(Le,qe),(ve||!P)&&this._finishRippleTransition(Le),Le}fadeOutRipple(n){if(2===n.state||3===n.state)return;const e=n.element,r={...iD,...n.config.animation};e.style.transitionDuration=`${r.exitDuration}ms`,e.style.opacity="0",n.state=2,(n._animationForciblyDisabledThroughCss||!r.exitDuration)&&this._finishRippleTransition(n)}fadeOutAll(){this._getActiveRipples().forEach(n=>n.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(n=>{n.config.persistent||n.fadeOut()})}setupTriggerEvents(n){const e=GT(n);!this._platform.isBrowser||!e||e===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=e,oD.forEach(r=>{jA._eventManager.addHandler(this._ngZone,r,e,this)}))}handleEvent(n){"mousedown"===n.type?this._onMousedown(n):"touchstart"===n.type?this._onTouchStart(n):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{sD.forEach(e=>{this._triggerElement.addEventListener(e,this,rD)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(n){0===n.state?this._startFadeOutTransition(n):2===n.state&&this._destroyRipple(n)}_startFadeOutTransition(n){const e=n===this._mostRecentTransientRipple,{persistent:r}=n.config;n.state=1,!r&&(!e||!this._isPointerDown)&&n.fadeOut()}_destroyRipple(n){const e=this._activeRipples.get(n)??null;this._activeRipples.delete(n),this._activeRipples.size||(this._containerRect=null),n===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),n.state=3,null!==e&&(n.element.removeEventListener("transitionend",e.onTransitionEnd),n.element.removeEventListener("transitioncancel",e.onTransitionCancel)),n.element.remove()}_onMousedown(n){const e=function Nz(t){return 0===t.buttons||0===t.offsetX&&0===t.offsetY}(n),r=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;!this._target.rippleDisabled&&!e&&!r&&(this._isPointerDown=!0,this.fadeInRipple(n.clientX,n.clientY,this._target.rippleConfig))}_onTouchStart(n){if(!this._target.rippleDisabled&&!function zz(t){const n=t.touches&&t.touches[0]||t.changedTouches&&t.changedTouches[0];return!(!n||-1!==n.identifier||null!=n.radiusX&&1!==n.radiusX||null!=n.radiusY&&1!==n.radiusY)}(n)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const e=n.changedTouches;for(let r=0;r<e.length;r++)this.fadeInRipple(e[r].clientX,e[r].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(n=>{!n.config.persistent&&(1===n.state||n.config.terminateOnPointerUp&&0===n.state)&&n.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){const n=this._triggerElement;n&&(oD.forEach(e=>jA._eventManager.removeHandler(e,n,this)),this._pointerUpEventsRegistered&&sD.forEach(e=>n.removeEventListener(e,this,rD)))}}jA._eventManager=new Zz;let n3=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t}),t.\u0275inj=di({imports:[tD,tD]}),t})(),r3=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=_r({type:t,selectors:[["app-hello"]],decls:5,vars:0,consts:[[1,"container"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"h1"),At(2,"Discover Your Perfect European Weekend Getaway!"),Ve(),ke(3,"h2"),At(4,"Plan Your Weekend Adventure with Detailed Weather and Temperature Insights"),Ve()())},styles:[".container[_ngcontent-%COMP%]{margin-top:0;padding-top:160px;text-align:center;margin-bottom:0;color:#fff;text-shadow:1px 1px 2px rgb(100,100,100)}h2[_ngcontent-%COMP%]{color:#fff;font-size:1.2rem;width:90%;margin:0 auto}@media (max-width: 992px){.container[_ngcontent-%COMP%]{padding-top:130px}}"]}),t})();const o3=["secondInput"],s3=["thirdInput"];function a3(t,n){if(1&t&&(ke(0,"h2",19),At(1),Ve()),2&t){const e=Ot();ut(1),ro("",e.errorMessage,"!")}}let l3=(()=>{class t{constructor(e,r,l,h){this.http=e,this.weatherService=r,this.helper=l,this.test=h,this.capital="",this.country="",this.description="",this.temperature=-1,this.icon="",this.errorMessage="",this.url=""}onSubmit(){this.weatherService.getWeather(this.capital).subscribe(e=>{console.log(e.temp);let r="";-1e4!==e.temp&&""!==this.capital?""===this.url?this.searchCountryImage(this.capital,l=>{r=l||"https://www.grouphealth.ca/wp-content/uploads/2018/05/placeholder-image.png",this.addCapital(r,e)}):(r=this.url,this.addCapital(r,e)):this.errorMessage=""===this.country?"Missing country name":e.message})}searchCountryImage(e,r){const _=`https://api.unsplash.com/search/photos?query=${encodeURIComponent(`${e} landmark`)}&client_id=JEEcrWMwrI_Y9PV0hUX_MZw5ICMhPMHlIW3W7XOHkUM`;this.http.get(_).subscribe(C=>{r(C.results&&C.results.length>0?C.results[0].urls.regular:null)})}fetchUnsplashImages(e,r){const C=`https://api.unsplash.com/search/photos?query=${encodeURIComponent(`${e} city`)}&per_page=4&client_id=JEEcrWMwrI_Y9PV0hUX_MZw5ICMhPMHlIW3W7XOHkUM`;this.http.get(C).subscribe(M=>{if(M.results&&M.results.length>0){const P=M.results.map(B=>B.urls.regular);r(P)}else r([])})}addCapital(e,r){this.fetchUnsplashImages(this.capital,l=>{this.helper.capitals.push({id:this.helper.capitals.length+1,capital:this.capital,country:this.country,favourite:!1,visited:!1,planned:!1,url:e,temperature:Math.round(10*r.temp)/10,icon:r.icon,description:this.description,images:l.length>0?l:["https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png","https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png","https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png","https://storage.googleapis.com/proudcity/mebanenc/uploads/2021/03/placeholder-image.png"]}),localStorage.setItem("capitals",JSON.stringify(this.helper.capitals)),this.helper.dialog()})}onTextChanged(){this.errorMessage=""}onFirstInputEnter(){this.secondInputRef.nativeElement.focus()}onSecondInputEnter(){this.thirdInputRef.nativeElement.focus()}onThirdInputEnter(){this.thirdInputRef.nativeElement.focus()}onClose(){this.helper.dialog()}}return t.\u0275fac=function(e){return new(e||t)(He(Qf),He(IA),He(k_),He($b))},t.\u0275cmp=_r({type:t,selectors:[["app-add-capital"]],viewQuery:function(e,r){if(1&e&&($d(o3,5),$d(s3,5)),2&e){let l;wh(l=Ch())&&(r.secondInputRef=l.first),wh(l=Ch())&&(r.thirdInputRef=l.first)}},decls:33,vars:5,consts:[[1,"container-main"],[1,"dialog"],[1,"row"],[1,"col-4"],[1,"px-1"],[1,"col-8"],["class","float-end text-failure",4,"ngIf"],[1,"input-group","mb-3"],["type","text","aria-label","Default","aria-describedby","inputGroup-sizing-default","placeholder","City name",1,"form-control",3,"ngModel","keyup","keyup.enter","ngModelChange"],["type","text","aria-label","Default","aria-describedby","inputGroup-sizing-default","placeholder","Country name",1,"form-control",3,"ngModel","keyup.enter","ngModelChange"],["secondInput",""],["type","text","aria-label","Default","aria-describedby","inputGroup-sizing-default","placeholder","Description",1,"form-control","description",3,"ngModel","ngModelChange"],["thirdsecondInput",""],["type","text","aria-label","Default","aria-describedby","inputGroup-sizing-default","placeholder","http://..",1,"form-control",3,"ngModel","keyup.enter","ngModelChange"],["fourthInput",""],[1,"row","row-buttons","mx-0","px-0","mt-4"],[1,"col-6","px-0","my-auto"],[1,"btn","btn-cancel",3,"click"],[1,"btn","btn-success",3,"click"],[1,"float-end","text-failure"]],template:function(e,r){1&e&&(ke(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h2",4),At(5,"Capital"),Ve()(),ke(6,"div",5),yt(7,a3,2,1,"h2",6),Ve()(),ke(8,"div",7)(9,"input",8),ft("keyup",function(){return r.onTextChanged()})("keyup.enter",function(){return r.onFirstInputEnter()})("ngModelChange",function(h){return r.capital=h}),Ve()(),ke(10,"h2",4),At(11,"Country"),Ve(),ke(12,"div",7)(13,"input",9,10),ft("keyup.enter",function(){return r.onSecondInputEnter()})("ngModelChange",function(h){return r.country=h}),Ve()(),ke(15,"h2",4),At(16,"Description"),Ve(),ke(17,"div",7)(18,"textarea",11,12),ft("ngModelChange",function(h){return r.description=h}),At(20,"      "),Ve()(),ke(21,"h2",4),At(22,"Image URL (optional)"),Ve(),ke(23,"div",7)(24,"input",13,14),ft("keyup.enter",function(){return r.onSubmit()})("ngModelChange",function(h){return r.url=h}),Ve()(),ke(26,"div",15)(27,"div",16)(28,"button",17),ft("click",function(){return r.onClose()}),At(29,"Cancel"),Ve()(),ke(30,"div",16)(31,"button",18),ft("click",function(){return r.onSubmit()}),At(32,"Submit"),Ve()()()()()),2&e&&(ut(7),ot("ngIf",r.errorMessage),ut(2),ot("ngModel",r.capital),ut(4),ot("ngModel",r.country),ut(5),ot("ngModel",r.description),ut(6),ot("ngModel",r.url))},dependencies:[Zd,ep,P_,Jf],styles:[".container-main[_ngcontent-%COMP%]{position:fixed;top:85px;left:0;right:0;width:100vw!important;height:100vh;background-color:#64646400;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);z-index:20}.dialog[_ngcontent-%COMP%]{position:relative;margin:45px auto 0;width:400px;padding:20px 20px 85px;border-radius:1rem;background-color:#fff9;border:white 3px solid;box-shadow:#0000001a 0 4px 12px}.description[_ngcontent-%COMP%]{height:130px;border-radius:1rem!important;overflow-y:scroll}h2[_ngcontent-%COMP%]{font-size:1.2rem}@media (max-width: 768px){.dialog[_ngcontent-%COMP%]{width:350px}}.input-group[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{border-radius:2rem;outline:none!important}.btn[_ngcontent-%COMP%]{width:100%;border-radius:2rem}.text-failure[_ngcontent-%COMP%]{color:#cc2e2e;font-weight:800;animation:_ngcontent-%COMP%_pulse 1s infinite}.row-buttons[_ngcontent-%COMP%]{background-color:#fff6;border-radius:2rem;width:50%;box-sizing:inherit;border:3px white solid;position:absolute;right:20px}.btn-cancel[_ngcontent-%COMP%]:hover{font-weight:600;transition:.1s}@keyframes _ngcontent-%COMP%_pulse{0%{opacity:1}50%{opacity:.5}to{opacity:1}}"]}),t})(),c3=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=Ni({type:t,bootstrap:[cz]}),t.\u0275inj=di({imports:[JR,rz,n3,uN,cB,KN]}),t})();(function Kh(t,n,e){const r=t.\u0275cmp;r.directiveDefs=Il(n,!1),r.pipeDefs=Il(e,!0)})($b,[Nf,c_,Zd,bA,bT,CT,r3,l3],[]),YR().bootstrapModule(c3).catch(t=>console.error(t))},898:function(nm){nm.exports=function(){"use strict";var lu,cu,ri;function Bh(p,je){if(lu)if(cu){var Xo="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+lu+")(sharedChunk); ("+cu+")(sharedChunk); self.onerror = null;",so={};lu(so),ri=je(so),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ri.workerUrl=window.URL.createObjectURL(new Blob([Xo],{type:"text/javascript"})))}else cu=je;else lu=je}return Bh(0,function(p){var je=typeof self<"u"?self:{},Xo="2.15.0";let so;const Kt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==so){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{so=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch{so=o}}return so},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Kt.API_URL)return null;try{const o=new URL(Kt.API_URL);return"api.mapbox.cn"===o.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===o.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Zt={supported:!1,testSupport:function(o){!Eo&&kr&&(ws?ic(o):Li=o)}};let Li,kr,Eo=!1,ws=!1;function ic(o){const i=o.createTexture();o.bindTexture(o.TEXTURE_2D,i);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,kr),o.isContextLost())return;Zt.supported=!0}catch{}o.deleteTexture(i),Eo=!0}je.document&&(kr=je.document.createElement("img"),kr.onload=function(){Li&&ic(Li),Li=null,ws=!0},kr.onerror=function(){Eo=!0,Li=null},kr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const dl="01";function Xr(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var ao=Hr;function Hr(o,i,s,c){this.cx=3*o,this.bx=3*(s-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(c-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=s,this.p2y=c}Hr.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(void 0===i&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var s=o,c=0;c<8;c++){var d=this.sampleCurveX(s)-o;if(Math.abs(d)<i)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=d/m}var y=0,x=1;for(s=o,c=0;c<20&&(d=this.sampleCurveX(s),!(Math.abs(d-o)<i));c++)o>d?y=s:x=s,s=.5*(x-y)+y;return s},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var Ta=Xr(ao),Cs=Io;function Io(o,i){this.x=o,this.y=i}Io.prototype={clone:function(){return new Io(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,s=o.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),s=Math.sin(o),c=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=c,this},_rotateAround:function(o,i){var s=Math.cos(o),c=Math.sin(o),d=i.y+c*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-c*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Io.convert=function(o){return o instanceof Io?o:Array.isArray(o)?new Io(o[0],o[1]):o};var at=Xr(Cs);const Nh=Math.PI/180,Da=180/Math.PI;function on(o){return o*Nh}function Hi(o){return o*Da}const rc=[[0,0],[1,0],[1,1],[0,1]];function uu(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,s=i*o;return 4*(o<.5?s:3*(o-i)+s-.75)}function Sa(o,i,s,c){const d=new Ta(o,i,s,c);return function(m){return d.solve(m)}}const Ko=Sa(.25,.1,.25,1);function cn(o,i,s){return Math.min(s,Math.max(i,o))}function ka(o,i,s){return(s=cn((s-o)/(i-o),0,1))*s*(3-2*s)}function pn(o,i,s){const c=s-i,d=((o-i)%c+c)%c+i;return d===i?s:d}function Bi(o,i,s){if(!o.length)return s(null,[]);let c=o.length;const d=new Array(o.length);let m=null;o.forEach((y,x)=>{i(y,(w,E)=>{w&&(m=w),d[x]=E,0==--c&&s(m,d)})})}function Ys(o){const i=[];for(const s in o)i.push(o[s]);return i}function Ci(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}let Js=1;function nr(){return Js++}function Es(){return function o(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Yo(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function hi(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Jn(o,i){o.forEach(s=>{i[s]&&(i[s]=i[s].bind(i))})}function pl(o,i){return-1!==o.indexOf(i,o.length-i.length)}function ct(o,i,s){const c={};for(const d in o)c[d]=i.call(s||this,o[d],d,o);return c}function ea(o,i,s){const c={};for(const d in o)i.call(s||this,o[d],d,o)&&(c[d]=o[d]);return c}function lo(o){return Array.isArray(o)?o.map(lo):"object"==typeof o&&o?ct(o,lo):o}const fl={};function li(o){fl[o]||(typeof console<"u"&&console.warn(o),fl[o]=!0)}function Mo(o,i,s){return(s.y-o.y)*(i.x-o.x)>(i.y-o.y)*(s.x-o.x)}function zh(o){let i=0;for(let s,c,d=0,m=o.length,y=m-1;d<m;y=d++)s=o[d],c=o[y],i+=(c.x-s.x)*(s.y+c.y);return i}function ta(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function co(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,d,m)=>{const y=d||m;return i[c]=!y||y.toLowerCase(),""}),i["max-age"]){const s=parseInt(i["max-age"],10);isNaN(s)?delete i["max-age"]:i["max-age"]=s}return i}let hu=null;function oc(o){if(null==hu){const i=o.navigator?o.navigator.userAgent:null;hu=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return hu}function du(o){try{const i=je[o];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function na(o,i){return[o[4*i],o[4*i+1],o[4*i+2],o[4*i+3]]}const sc="mapbox-tiles";let Kr,ia,ac=500,Vh=50;function pu(){try{return je.caches}catch{}}function ml(){pu()&&!Kr&&(Kr=je.caches.open(sc))}function lc(o){const i=o.indexOf("?");if(i<0)return o;const c=function(d){const m=d.indexOf("?");return m>0?d.slice(m+1).split("&"):[]}(o).filter(d=>{const m=d.split("=");return"language"===m[0]||"worldview"===m[0]});return c.length?`${o.slice(0,i)}?${c.join("&")}`:o.slice(0,i)}let To=1/0;const Pa={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Pa);class Ra extends Error{constructor(i,s,c){401===s&&Ce(c)&&(i+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(i),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Oa=ta()?()=>self.worker&&self.worker.referrer:()=>("blob:"===je.location.protocol?je.parent:je).location.href,gl=function(o,i){if(!(/^file:/.test(s=o.url)||/^file:/.test(Oa())&&!/^\w+:/.test(s))){if(je.fetch&&je.Request&&je.AbortController&&je.Request.prototype.hasOwnProperty("signal"))return function(c,d){const m=new je.AbortController,y=new je.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Oa(),referrerPolicy:c.referrerPolicy,signal:m.signal});let x=!1,w=!1;const E=(D=y.url).indexOf("sku=")>0&&Ce(D);var D;"json"===c.type&&y.headers.set("Accept","application/json");const k=(L,N,j)=>{if(w)return;if(L&&"SecurityError"!==L.message&&li(L.toString()),N&&j)return R(N);const q=Date.now();je.fetch(y).then(J=>{if(J.ok){const se=E?J.clone():null;return R(J,se,q)}return d(new Ra(J.statusText,J.status,c.url))}).catch(J=>{"AbortError"!==J.name&&d(new Error(`${J.message} ${c.url}`))})},R=(L,N,j)=>{("arrayBuffer"===c.type?L.arrayBuffer():"json"===c.type?L.json():L.text()).then(q=>{w||(N&&j&&function(J,se,Y){if(ml(),!Kr)return;const oe={status:se.status,statusText:se.statusText,headers:new je.Headers};se.headers.forEach((xe,we)=>oe.headers.set(we,xe));const ce=co(se.headers.get("Cache-Control")||"");if(ce["no-store"])return;ce["max-age"]&&oe.headers.set("Expires",new Date(Y+1e3*ce["max-age"]).toUTCString());const le=oe.headers.get("Expires");le&&(new Date(le).getTime()-Y<42e4||function(xe,we){if(void 0===ia)try{new Response(new ReadableStream),ia=!0}catch{ia=!1}ia?we(xe.body):xe.blob().then(we)}(se,xe=>{const we=new je.Response(xe,oe);ml(),Kr&&Kr.then(Re=>Re.put(lc(J.url),we)).catch(Re=>li(Re.message))}))}(y,N,j),x=!0,d(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{w||d(new Error(q.message))})};return E?function(L,N){if(ml(),!Kr)return N(null);const j=lc(L.url);Kr.then(q=>{q.match(j).then(J=>{const se=function(Y){if(!Y)return!1;const oe=new Date(Y.headers.get("Expires")||0),ce=co(Y.headers.get("Cache-Control")||"");return oe>Date.now()&&!ce["no-cache"]}(J);q.delete(j),se&&q.put(j,J.clone()),N(null,J,se)}).catch(N)}).catch(N)}(y,k):k(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(o,i);if(ta()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,i,void 0,!0)}var s;return function(c,d){const m=new je.XMLHttpRequest;m.open(c.method||"GET",c.url,!0),"arrayBuffer"===c.type&&(m.responseType="arraybuffer");for(const y in c.headers)m.setRequestHeader(y,c.headers[y]);return"json"===c.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===c.credentials,m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let y=m.response;if("json"===c.type)try{y=JSON.parse(m.response)}catch(x){return d(x)}d(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new Ra(m.statusText,m.status,c.url))},m.send(c.body),{cancel:()=>m.abort()}}(o,i)},_l=function(o,i){return gl(Ci(o,{type:"arrayBuffer"}),i)};function jh(o){const i=je.document.createElement("a");return i.href=o,i.protocol===je.document.location.protocol&&i.host===je.document.location.host}const ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let U,H;U=[],H=0;const re=function(o,i){if(Zt.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),H>=Kt.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return U.push(m),m}H++;let s=!1;const c=()=>{if(!s)for(s=!0,H--;U.length&&H<Kt.MAX_PARALLEL_IMAGE_REQUESTS;){const m=U.shift(),{requestParameters:y,callback:x,cancelled:w}=m;w||(m.cancel=re(y,x).cancel)}},d=_l(o,(m,y,x,w)=>{c(),m?i(m):y&&(je.createImageBitmap?function(E,D){const k=new je.Blob([new Uint8Array(E)],{type:"image/png"});je.createImageBitmap(k).then(R=>{D(null,R)}).catch(R=>{D(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(E,D)=>i(E,D,x,w)):function(E,D){const k=new je.Image,R=je.URL;k.onload=()=>{D(null,k),R.revokeObjectURL(k.src),k.onload=null,je.requestAnimationFrame(()=>{k.src=ae})},k.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new je.Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?R.createObjectURL(L):ae}(y,(E,D)=>i(E,D,x,w)))});return{cancel:()=>{d.cancel(),c()}}},he="NO_ACCESS_TOKEN";function ge(o){return 0===o.indexOf("mapbox:")}function Ce(o){return Kt.API_URL_REGEX.test(o)}function be(o){return Kt.API_CDN_URL_REGEX.test(o)}function me(o){return Kt.API_STYLE_REGEX.test(o)&&!Se(o)}function Se(o){return Kt.API_SPRITE_REGEX.test(o)}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(o){const i=o.match(it);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Ye(o){const i=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${i}`}const Ut="mapbox.eventData";function Rt(o){if(!o)return null;const i=o.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(je.atob(i[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ht{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const s=Rt(Kt.ACCESS_TOKEN);let c="";return c=s&&s.u?je.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):Kt.ACCESS_TOKEN||"",i?`${Ut}.${i}:${c}`:`${Ut}:${c}`}fetchEventData(){const i=du("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{const d=je.localStorage.getItem(s);d&&(this.eventData=JSON.parse(d));const m=je.localStorage.getItem(c);m&&(this.anonId=m)}catch{li("Unable to read from LocalStorage")}}saveEventData(){const i=du("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(i)try{je.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&je.localStorage.setItem(s,JSON.stringify(this.eventData))}catch{li("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,s,c,d){if(!Kt.EVENTS_URL)return;const m=st(Kt.EVENTS_URL);m.params.push(`access_token=${d||Kt.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(i).toISOString()},x=s?Ci(y,s):y,w={url:Ye(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};var D;this.pendingRequest=(D=E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(d)},gl(Ci(w,{method:"POST"}),D))}queueRequest(i,s){this.queue.push(i),this.processRequests(s)}}const nn=new class extends Ht{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,i){Kt.EVENTS_URL&&Kt.ACCESS_TOKEN&&Array.isArray(o)&&o.some(s=>ge(s)||Ce(s))&&this.queueRequest(Date.now(),i)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Rt(Kt.ACCESS_TOKEN),s=i?i.u:Kt.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;hi(this.anonId)||(this.anonId=Es(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),y=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||m.getDate()!==y.getDate()}else c=!0;c?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xo,skuId:dl,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=s)},o):this.processRequests()}},fn=nn.postTurnstileEvent.bind(nn),oi=new class extends Ht{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,i,s,c){this.skuToken=i,this.errorCb=c,Kt.EVENTS_URL&&(s||Kt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(he)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),hi(this.anonId)||(this.anonId=Es()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Xo,skuId:dl,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o))}},yi=oi.postMapLoadEvent.bind(oi),fr=new class extends Ht{constructor(){super("gljs.performance")}postPerformanceEvent(o,i){Kt.EVENTS_URL&&(o||Kt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},o)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),c=function(d){const m=je.performance.getEntriesByType("resource"),y=je.performance.getEntriesByType("mark"),x=function(R){const L={};if(R)for(const N in R)if("other"!==N)for(const j of R[N]){const q=`${N}ResolveRangeMin`,J=`${N}ResolveRangeMax`,se=`${N}RequestCount`,Y=`${N}RequestCachedCount`;L[q]=Math.min(L[q]||1/0,j.startTime),L[J]=Math.max(L[J]||-1/0,j.responseEnd);const oe=ce=>{void 0===L[ce]&&(L[ce]=0),++L[ce]};void 0!==j.transferSize&&0===j.transferSize&&oe(Y),oe(se)}return L}(function(R,L){const N={};if(R)for(const j of R){const q=L(j);void 0===N[q]&&(N[q]=[]),N[q].push(j)}return N}(m,rm)),w=je.devicePixelRatio,E=je.navigator.connection||je.navigator.mozConnection||je.navigator.webkitConnection,D={counters:[],metadata:[],attributes:[]},k=(R,L,N)=>{null!=N&&R.push({name:L,value:N.toString()})};for(const R in x)k(D.counters,R,x[R]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(k(D.counters,"interactionRangeMin",d.interactionRange[0]),k(D.counters,"interactionRangeMax",d.interactionRange[1])),y)for(const R of Object.keys(Do)){const L=Do[R],N=y.find(j=>j.name===L);N&&k(D.counters,L,N.startTime)}return k(D.counters,"visibilityHidden",d.visibilityHidden),k(D.attributes,"style",function(R){if(R)for(const L of R){const N=L.name.split("?")[0];if(me(N)){const j=N.split("/").slice(-2);if(2===j.length)return`mapbox://styles/${j[0]}/${j[1]}`}}}(m)),k(D.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),k(D.attributes,"fogEnabled",d.fogEnabled?"true":"false"),k(D.attributes,"projection",d.projection),k(D.attributes,"zoom",d.zoom),k(D.metadata,"devicePixelRatio",w),k(D.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),k(D.metadata,"navigatorUserAgent",je.navigator.userAgent),k(D.metadata,"screenWidth",je.screen.width),k(D.metadata,"screenHeight",je.screen.height),k(D.metadata,"windowWidth",je.innerWidth),k(D.metadata,"windowHeight",je.innerHeight),k(D.metadata,"mapWidth",d.width/w),k(D.metadata,"mapHeight",d.height/w),k(D.metadata,"webglRenderer",d.renderer),k(D.metadata,"webglVendor",d.vendor),k(D.metadata,"sdkVersion",Xo),k(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(s);for(const d of c.metadata);for(const d of c.counters);for(const d of c.attributes);this.postEvent(i,c,()=>{},o)}},Pi=fr.postPerformanceEvent.bind(fr),$i=new class extends Ht{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,i,s,c){if(!Kt.API_URL||!Kt.SESSION_PATH)return;const d=st(Kt.API_URL+Kt.SESSION_PATH);d.params.push(`sku=${i||""}`),d.params.push(`access_token=${c||Kt.ACCESS_TOKEN||""}`);const m={url:Ye(d),headers:{"Content-Type":"text/plain"}};var x;this.pendingRequest=(x=y=>{this.pendingRequest=null,s(y),this.saveEventData(),this.processRequests(c)},gl(Ci(m,{method:"GET"}),x))}getSessionAPI(o,i,s,c){this.skuToken=i,this.errorCb=c,Kt.SESSION_PATH&&Kt.API_URL&&(s||Kt.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},s):this.errorCb(new Error(he)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:s}=this.queue.shift();i&&this.success[i]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):i&&(this.success[i]=!0)},o)}},qi=$i.getSessionAPI.bind($i),zn=new Set,Do={create:"create",load:"load",fullLoad:"fullLoad"},Jo={mark(o){je.performance.mark(o)},measure(o,i,s){je.performance.measure(o,i,s)}};function rm(o){const i=o.name.split("?")[0];return be(i)&&i.includes("mapbox-gl.js")?"javascript":be(i)&&i.includes("mapbox-gl.css")?"css":Kt.API_FONTS_REGEX.test(i)?"fontRange":Se(i)?"sprite":me(i)?"style":Kt.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const Tn=je.performance;function Uh(o){const i=o?o.url.toString():void 0;return Tn.getEntriesByName(i)}let Fa,fu,ra,es;const ts={now:()=>void 0!==ra?ra:je.performance.now(),setNow(o){ra=o},restoreNow(){ra=void 0},frame(o){const i=je.requestAnimationFrame(o);return{cancel:()=>je.cancelAnimationFrame(i)}},getImageData(o,i=0){const{width:s,height:c}=o;es||(es=je.document.createElement("canvas"));const d=es.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(s>es.width||c>es.height)&&(es.width=s,es.height=c),d.clearRect(-i,-i,s+2*i,c+2*i),d.drawImage(o,0,0,s,c),d.getImageData(-i,-i,s+2*i,c+2*i)},resolveURL:o=>(Fa||(Fa=je.document.createElement("a")),Fa.href=o,Fa.href),get devicePixelRatio(){return je.devicePixelRatio},get prefersReducedMotion(){return!!je.matchMedia&&(null==fu&&(fu=je.matchMedia("(prefers-reduced-motion: reduce)")),fu.matches)}};function mu(o,i,s){s[o]&&-1!==s[o].indexOf(i)||(s[o]=s[o]||[],s[o].push(i))}function Gh(o,i,s){if(s&&s[o]){const c=s[o].indexOf(i);-1!==c&&s[o].splice(c,1)}}class La{constructor(i,s={}){Ci(this,s),this.type=i}}class Is extends La{constructor(i,s={}){super("error",Ci({error:i},s))}}class cc{on(i,s){return this._listeners=this._listeners||{},mu(i,s,this._listeners),this}off(i,s){return Gh(i,s,this._listeners),Gh(i,s,this._oneTimeListeners),this}once(i,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},mu(i,s,this._oneTimeListeners),this):new Promise(c=>this.once(i,c))}fire(i,s){"string"==typeof i&&(i=new La(i,s||{}));const c=i.type;if(this.listens(c)){i.target=this;const d=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of d)x.call(this,i);const m=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of m)Gh(c,x,this._oneTimeListeners),x.call(this,i);const y=this._eventedParent;y&&(Ci(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(i))}else i instanceof Is&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,s){return this._eventedParent=i,this._eventedParentData=s,this}}var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ms(o,...i){for(const s of i)for(const c in s)o[c]=s[c];return o}function Ei(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function An(o){if(Array.isArray(o))return o.map(An);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const s in o)i[s]=An(o[s]);return i}return Ei(o)}class rp extends Error{constructor(i,s){super(s),this.message=s,this.key=i}}var So=rp;class uc{constructor(i,s=[]){this.parent=i,this.bindings={};for(const[c,d]of s)this.bindings[c]=d}concat(i){return new uc(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Qn=uc;const oa={kind:"null"},Ke={kind:"number"},sn={kind:"string"},an={kind:"boolean"},yn={kind:"color"},kt={kind:"object"},Yt={kind:"value"},Pr={kind:"collator"},gu={kind:"formatted"},ns={kind:"resolvedImage"};function rt(o,i){return{kind:"array",itemType:o,N:i}}function Wn(o){if("array"===o.kind){const i=Wn(o.itemType);return"number"==typeof o.N?`array<${i}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${i}>`}return o.kind}const Jt=[oa,Ke,sn,an,yn,gu,kt,rt(Yt),ns];function vn(o,i){if("error"===i.kind)return null;if("array"===o.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!vn(o.itemType,i.itemType))&&("number"!=typeof o.N||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if("value"===o.kind)for(const s of Jt)if(!vn(s,i))return null}return`Expected ${Wn(o)} but found ${Wn(i)} instead.`}function hc(o,i){return i.some(s=>s.kind===o.kind)}function _u(o,i){return i.some(s=>"null"===s?null===o:"array"===s?Array.isArray(o):"object"===s?o&&!Array.isArray(o)&&"object"==typeof o:s===typeof o)}var Hh,dc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ir(o){return(o=Math.round(o))<0?0:o>255?255:o}function yu(o){return ir("%"===o[o.length-1]?parseFloat(o)/100*255:parseInt(o))}function vu(o){return(i="%"===o[o.length-1]?parseFloat(o)/100:parseFloat(o))<0?0:i>1?1:i;var i}function pc(o,i,s){return s<0?s+=1:s>1&&(s-=1),6*s<1?o+(i-o)*s*6:2*s<1?i:3*s<2?o+(i-o)*(2/3-s)*6:o}try{Hh={}.parseCSSColor=function(o){var i,s=o.replace(/ /g,"").toLowerCase();if(s in dc)return dc[s].slice();if("#"===s[0])return 4===s.length?(i=parseInt(s.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===s.length&&(i=parseInt(s.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var c=s.indexOf("("),d=s.indexOf(")");if(-1!==c&&d+1===s.length){var m=s.substr(0,c),y=s.substr(c+1,d-(c+1)).split(","),x=1;switch(m){case"rgba":if(4!==y.length)return null;x=vu(y.pop());case"rgb":return 3!==y.length?null:[yu(y[0]),yu(y[1]),yu(y[2]),x];case"hsla":if(4!==y.length)return null;x=vu(y.pop());case"hsl":if(3!==y.length)return null;var w=(parseFloat(y[0])%360+360)%360/360,E=vu(y[1]),D=vu(y[2]),k=D<=.5?D*(E+1):D+E-D*E,R=2*D-k;return[ir(255*pc(R,k,w+1/3)),ir(255*pc(R,k,w)),ir(255*pc(R,k,w-1/3)),x];default:return null}}return null}}catch{}class Ii{constructor(i,s,c,d=1){this.r=i,this.g=s,this.b=c,this.a=d}static parse(i){if(!i)return;if(i instanceof Ii)return i;if("string"!=typeof i)return;const s=Hh(i);return s?new Ii(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[i,s,c,d]=this.toArray();return`rgba(${Math.round(i)},${Math.round(s)},${Math.round(c)},${d})`}toArray(){const{r:i,g:s,b:c,a:d}=this;return 0===d?[0,0,0,0]:[255*i/d,255*s/d,255*c/d,d]}toArray01(){const{r:i,g:s,b:c,a:d}=this;return 0===d?[0,0,0,0]:[i/d,s/d,c/d,d]}toArray01PremultipliedAlpha(){const{r:i,g:s,b:c,a:d}=this;return[i,s,c,d]}}Ii.black=new Ii(0,0,0,1),Ii.white=new Ii(1,1,1,1),Ii.transparent=new Ii(0,0,0,0),Ii.red=new Ii(1,0,0,1),Ii.blue=new Ii(0,0,1,1);var Mi=Ii;class op{constructor(i,s,c){this.sensitivity=i?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,s){return this.collator.compare(i,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class sp{constructor(i,s,c,d,m){this.text=i.normalize?i.normalize():i,this.image=s,this.scale=c,this.fontStack=d,this.textColor=m}}class Yr{constructor(i){this.sections=i}static fromString(i){return new Yr([new sp(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof Yr?i:Yr.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const s of this.sections){if(s.image){i.push(["image",s.image.name]);continue}i.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),i.push(c)}return i}}class uo{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new uo({name:i,available:!1}):null}serialize(){return["image",this.name]}}function om(o,i,s,c){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof s&&s>=0&&s<=255?void 0===c||"number"==typeof c&&c>=0&&c<=1?null:`Invalid rgba value [${[o,i,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof c?[o,i,s,c]:[o,i,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fc(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Mi||o instanceof op||o instanceof Yr||o instanceof uo)return!0;if(Array.isArray(o)){for(const i of o)if(!fc(i))return!1;return!0}if("object"==typeof o){for(const i in o)if(!fc(o[i]))return!1;return!0}return!1}function vi(o){if(null===o)return oa;if("string"==typeof o)return sn;if("boolean"==typeof o)return an;if("number"==typeof o)return Ke;if(o instanceof Mi)return yn;if(o instanceof op)return Pr;if(o instanceof Yr)return gu;if(o instanceof uo)return ns;if(Array.isArray(o)){const i=o.length;let s;for(const c of o){const d=vi(c);if(s){if(s===d)continue;s=Yt;break}s=d}return rt(s||Yt,i)}return kt}function mr(o){const i=typeof o;return null===o?"":"string"===i||"number"===i||"boolean"===i?String(o):o instanceof Mi||o instanceof Yr||o instanceof uo?o.toString():JSON.stringify(o)}class Bn{constructor(i,s){this.type=i,this.value=s}static parse(i,s){if(2!==i.length)return s.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!fc(i[1]))return s.error("invalid value");const c=i[1];let d=vi(c);const m=s.expectedType;return"array"!==d.kind||0!==d.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(d=m),new Bn(d,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Mi?["rgba"].concat(this.value.toArray()):this.value instanceof Yr?this.value.serialize():this.value}}var yl=Bn,gr=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const ap={string:sn,number:Ke,boolean:an,object:kt};class Mt{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");let c,d=1;const m=i[0];if("array"===m){let x,w;if(i.length>2){const E=i[1];if("string"!=typeof E||!(E in ap)||"object"===E)return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=ap[E],d++}else x=Yt;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return s.error('The length argument to "array" must be a positive integer literal',2);w=i[2],d++}c=rt(x,w)}else c=ap[m];const y=[];for(;d<i.length;d++){const x=s.parse(i[d],d,Yt);if(!x)return null;y.push(x)}return new Mt(c,y)}evaluate(i){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(i);if(!vn(this.type,vi(c)))return c;if(s===this.args.length-1)throw new gr(`Expected value to be of type ${Wn(this.type)}, but found ${Wn(vi(c))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,s=[i.kind];if("array"===i.kind){const c=i.itemType;if("string"===c.kind||"number"===c.kind||"boolean"===c.kind){s.push(c.kind);const d=i.N;("number"==typeof d||this.args.length>1)&&s.push(d)}}return s.concat(this.args.map(c=>c.serialize()))}}var sa=Mt;class di{constructor(i){this.type=gu,this.sections=i}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[1];if(!Array.isArray(c)&&"object"==typeof c)return s.error("First argument must be an image or text section.");const d=[];let m=!1;for(let y=1;y<=i.length-1;++y){const x=i[y];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=s.parse(x["font-scale"],1,Ke),!w))return null;let E=null;if(x["text-font"]&&(E=s.parse(x["text-font"],1,rt(sn)),!E))return null;let D=null;if(x["text-color"]&&(D=s.parse(x["text-color"],1,yn),!D))return null;const k=d[d.length-1];k.scale=w,k.font=E,k.textColor=D}else{const w=s.parse(i[y],1,Yt);if(!w)return null;const E=w.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:w,scale:null,font:null,textColor:null})}}return new di(d)}evaluate(i){return new Yr(this.sections.map(s=>{const c=s.content.evaluate(i);return vi(c)===ns?new sp("",c,null,null,null):new sp(mr(c),null,s.scale?s.scale.evaluate(i):null,s.font?s.font.evaluate(i).join(","):null,s.textColor?s.textColor.evaluate(i):null)}))}eachChild(i){for(const s of this.sections)i(s.content),s.scale&&i(s.scale),s.font&&i(s.font),s.textColor&&i(s.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const s of this.sections){i.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),i.push(c)}return i}}class Ba{constructor(i){this.type=ns,this.input=i}static parse(i,s){if(2!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,sn);return c?new Ba(c):s.error("No image name provided.")}evaluate(i){const s=this.input.evaluate(i),c=uo.fromString(s);return c&&i.availableImages&&(c.available=i.availableImages.indexOf(s)>-1),c}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const sm={"to-boolean":an,"to-color":yn,"to-number":Ke,"to-string":sn};class Au{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expected at least one argument.");const c=i[0];if(("to-boolean"===c||"to-string"===c)&&2!==i.length)return s.error("Expected one argument.");const d=sm[c],m=[];for(let y=1;y<i.length;y++){const x=s.parse(i[y],y,Yt);if(!x)return null;m.push(x)}return new Au(d,m)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let s,c;for(const d of this.args){if(s=d.evaluate(i),c=null,s instanceof Mi)return s;if("string"==typeof s){const m=i.parseColor(s);if(m)return m}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:om(s[0],s[1],s[2],s[3]),!c))return new Mi(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new gr(c||`Could not parse color from value '${"string"==typeof s?s:String(JSON.stringify(s))}'`)}if("number"===this.type.kind){let s=null;for(const c of this.args){if(s=c.evaluate(i),null===s)return 0;const d=Number(s);if(!isNaN(d))return d}throw new gr(`Could not convert ${JSON.stringify(s)} to number.`)}return"formatted"===this.type.kind?Yr.fromString(mr(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?uo.fromString(mr(this.args[0].evaluate(i))):mr(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new di([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ba(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(s=>{i.push(s.serialize())}),i}}var vl=Au;const is=["Unknown","Point","LineString","Polygon"];var xu=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?is[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-o[0])+this.featureDistanceData.bearing[1]*(c*i-o[1])}return 0}parseColor(o){let i=this._parseColorCache[o];return i||(i=this._parseColorCache[o]=Mi.parse(o)),i}};class rs{constructor(i,s,c,d){this.name=i,this.type=s,this._evaluate=c,this.args=d}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,s){const c=i[0],d=rs.definitions[c];if(!d)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,x=y.filter(([E])=>!Array.isArray(E)||E.length===i.length-1);let w=null;for(const[E,D]of x){w=new wl(s.registry,s.path,null,s.scope);const k=[];let R=!1;for(let L=1;L<i.length;L++){const N=i[L],j=Array.isArray(E)?E[L-1]:E.type,q=w.parse(N,1+k.length,j);if(!q){R=!0;break}k.push(q)}if(!R)if(Array.isArray(E)&&E.length!==k.length)w.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let L=0;L<k.length;L++){const N=Array.isArray(E)?E[L]:E.type,j=k[L];w.concat(L+1).checkSubtype(N,j.type)}if(0===w.errors.length)return new rs(c,m,D,k)}}if(1===x.length)s.errors.push(...w.errors);else{const E=(x.length?x:y).map(([k])=>{return R=k,Array.isArray(R)?`(${R.map(Wn).join(", ")})`:`(${Wn(R.type)}...)`;var R}).join(" | "),D=[];for(let k=1;k<i.length;k++){const R=s.parse(i[k],1+D.length);if(!R)return null;D.push(Wn(R.type))}s.error(`Expected arguments of type ${E}, but found (${D.join(", ")}) instead.`)}return null}static register(i,s){rs.definitions=s;for(const c in s)i[c]=rs}}var ko=rs;class Al{constructor(i,s,c){this.type=Pr,this.locale=c,this.caseSensitive=i,this.diacriticSensitive=s}static parse(i,s){if(2!==i.length)return s.error("Expected one argument.");const c=i[1];if("object"!=typeof c||Array.isArray(c))return s.error("Collator options argument must be an object.");const d=s.parse(void 0!==c["case-sensitive"]&&c["case-sensitive"],1,an);if(!d)return null;const m=s.parse(void 0!==c["diacritic-sensitive"]&&c["diacritic-sensitive"],1,an);if(!m)return null;let y=null;return c.locale&&(y=s.parse(c.locale,1,sn),!y)?null:new Al(d,m,y)}evaluate(i){return new op(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Ts=8192;function Lt(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function aa(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function mc(o,i){const s=(180+o[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,d=Math.pow(2,i.z);return[Math.round(s*d*Ts),Math.round(c*d*Ts)]}function Jr(o,i,s){const c=o[0]-i[0],d=o[1]-i[1],m=o[0]-s[0],y=o[1]-s[1];return c*y-m*d==0&&c*m<=0&&d*y<=0}function gc(o,i){let s=!1;for(let y=0,x=i.length;y<x;y++){const w=i[y];for(let E=0,D=w.length;E<D-1;E++){if(Jr(o,w[E],w[E+1]))return!1;(d=w[E])[1]>(c=o)[1]!=(m=w[E+1])[1]>c[1]&&c[0]<(m[0]-d[0])*(c[1]-d[1])/(m[1]-d[1])+d[0]&&(s=!s)}}var c,d,m;return s}function lp(o,i){for(let s=0;s<i.length;s++)if(gc(o,i[s]))return!0;return!1}function ei(o,i,s,c){const d=c[0]-s[0],m=c[1]-s[1],y=(o[0]-s[0])*m-d*(o[1]-s[1]),x=(i[0]-s[0])*m-d*(i[1]-s[1]);return y>0&&x<0||y<0&&x>0}function _c(o,i,s){for(const E of s)for(let D=0;D<E.length-1;++D)if((x=[(y=E[D+1])[0]-(m=E[D])[0],y[1]-m[1]])[0]*(w=[(d=i)[0]-(c=o)[0],d[1]-c[1]])[1]-x[1]*w[0]!=0&&ei(c,d,m,y)&&ei(m,y,c,d))return!0;var c,d,m,y,x,w;return!1}function Rn(o,i){for(let s=0;s<o.length;++s)if(!gc(o[s],i))return!1;for(let s=0;s<o.length-1;++s)if(_c(o[s],o[s+1],i))return!1;return!0}function U_(o,i){for(let s=0;s<i.length;s++)if(Rn(o,i[s]))return!0;return!1}function Na(o,i,s){const c=[];for(let d=0;d<o.length;d++){const m=[];for(let y=0;y<o[d].length;y++){const x=mc(o[d][y],s);Lt(i,x),m.push(x)}c.push(m)}return c}function bu(o,i,s){const c=[];for(let d=0;d<o.length;d++){const m=Na(o[d],i,s);c.push(m)}return c}function xl(o,i,s,c){if(o[0]<s[0]||o[0]>s[2]){const d=.5*c;let m=o[0]-s[0]>d?-c:s[0]-o[0]>d?c:0;0===m&&(m=o[0]-s[2]>d?-c:s[2]-o[0]>d?c:0),o[0]+=m}Lt(i,o)}function cp(o,i,s,c){const d=Math.pow(2,c.z)*Ts,m=[c.x*Ts,c.y*Ts],y=[];if(!o)return y;for(const x of o)for(const w of x){const E=[w.x+m[0],w.y+m[1]];xl(E,i,s,d),y.push(E)}return y}function $h(o,i,s,c){const d=Math.pow(2,c.z)*Ts,m=[c.x*Ts,c.y*Ts],y=[];if(!o)return y;for(const w of o){const E=[];for(const D of w){const k=[D.x+m[0],D.y+m[1]];Lt(i,k),E.push(k)}y.push(E)}if(i[2]-i[0]<=d/2){(x=i)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of y)for(const E of w)xl(E,i,s,d)}var x;return y}class bl{constructor(i,s){this.type=an,this.geojson=i,this.geometries=s}static parse(i,s){if(2!==i.length)return s.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(fc(i[1])){const c=i[1];if("FeatureCollection"===c.type)for(let d=0;d<c.features.length;++d){const m=c.features[d].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new bl(c,c.features[d].geometry)}else if("Feature"===c.type){const d=c.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new bl(c,c.geometry)}else if("Polygon"===c.type||"MultiPolygon"===c.type)return new bl(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=Na(c.coordinates,m,y),w=cp(s.geometry(),d,m,y);if(!aa(d,m))return!1;for(const E of w)if(!gc(E,x))return!1}if("MultiPolygon"===c.type){const x=bu(c.coordinates,m,y),w=cp(s.geometry(),d,m,y);if(!aa(d,m))return!1;for(const E of w)if(!lp(E,x))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(s,c){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=s.canonicalID();if(!y)return!1;if("Polygon"===c.type){const x=Na(c.coordinates,m,y),w=$h(s.geometry(),d,m,y);if(!aa(d,m))return!1;for(const E of w)if(!Rn(E,x))return!1}if("MultiPolygon"===c.type){const x=bu(c.coordinates,m,y),w=$h(s.geometry(),d,m,y);if(!aa(d,m))return!1;for(const E of w)if(!U_(E,x))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var yc=bl;function os(o){if(o instanceof ko&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof yc)return!1;let i=!0;return o.eachChild(s=>{i&&!os(s)&&(i=!1)}),i}function $r(o){if(o instanceof ko&&"feature-state"===o.name)return!1;let i=!0;return o.eachChild(s=>{i&&!$r(s)&&(i=!1)}),i}function za(o,i){if(o instanceof ko&&i.indexOf(o.name)>=0)return!1;let s=!0;return o.eachChild(c=>{s&&!za(c,i)&&(s=!1)}),s}class mt{constructor(i,s){this.type=s.type,this.name=i,this.boundExpression=s}static parse(i,s){if(2!==i.length||"string"!=typeof i[1])return s.error("'var' expression requires exactly one string literal argument.");const c=i[1];return s.scope.has(c)?new mt(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var qh=mt;class $t{constructor(i,s=[],c,d=new Qn,m=[]){this.registry=i,this.path=s,this.key=s.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=m,this.expectedType=c}parse(i,s,c,d,m={}){return s?this.concat(s,c,d)._parse(i,m):this._parse(i,m)}_parse(i,s){function c(d,m,y){return"assert"===y?new sa(m,[d]):"coerce"===y?new vl(m,[d]):d}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=i[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let y=m.parse(i,this);if(!y)return null;if(this.expectedType){const x=this.expectedType,w=y.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else y=c(y,x,s.typeAnnotation||"coerce");else y=c(y,x,s.typeAnnotation||"assert")}if(!(y instanceof yl)&&"resolvedImage"!==y.type.kind&&vc(y)){const x=new xu;try{y=new yl(y.type,y.evaluate(x))}catch(w){return this.error(w.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,s,c){const d="number"==typeof i?this.path.concat(i):this.path,m=c?this.scope.concat(c):this.scope;return new $t(this.registry,d,s||null,m,this.errors)}error(i,...s){const c=`${this.key}${s.map(d=>`[${d}]`).join("")}`;this.errors.push(new So(c,i))}checkSubtype(i,s){const c=vn(i,s);return c&&this.error(c),c}}var wl=$t;function vc(o){if(o instanceof qh)return vc(o.boundExpression);if(o instanceof ko&&"error"===o.name||o instanceof Al||o instanceof yc)return!1;const i=o instanceof vl||o instanceof sa;let s=!0;return o.eachChild(c=>{s=i?s&&vc(c):s&&c instanceof yl}),!!s&&os(o)&&za(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function la(o,i){const s=o.length-1;let c,d,m=0,y=s,x=0;for(;m<=y;)if(x=Math.floor((m+y)/2),c=o[x],d=o[x+1],c<=i){if(x===s||i<d)return x;m=x+1}else{if(!(c>i))throw new gr("Input is not a number.");y=x-1}return 0}class wu{constructor(i,s,c){this.type=i,this.input=s,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static parse(i,s){if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(i[1],1,Ke);if(!c)return null;const d=[];let m=null;s.expectedType&&"value"!==s.expectedType.kind&&(m=s.expectedType);for(let y=1;y<i.length;y+=2){const x=1===y?-1/0:i[y],w=i[y+1],E=y,D=y+1;if("number"!=typeof x)return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(d.length&&d[d.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=s.parse(w,D,m);if(!k)return null;m=m||k.type,d.push([x,k])}return new wu(m,c,d)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const d=this.input.evaluate(i);if(d<=s[0])return c[0].evaluate(i);const m=s.length;return d>=s[m-1]?c[m-1].evaluate(i):c[la(s,d)].evaluate(i)}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&i.push(this.labels[s]),i.push(this.outputs[s].serialize());return i}}var Wh=wu;function xn(o,i,s){return o*(1-s)+i*s}var eo=Object.freeze({__proto__:null,array:function(o,i,s){return o.map((c,d)=>xn(c,i[d],s))},color:function(o,i,s){return new Mi(xn(o.r,i.r,s),xn(o.g,i.g,s),xn(o.b,i.b,s),xn(o.a,i.a,s))},number:xn});const Po=.95047,ho=1.08883,ss=4/29,bn=6/29,Cl=3*bn*bn,Zh=bn*bn*bn,Qh=Math.PI/180,up=180/Math.PI;function Ro(o){return o>Zh?Math.pow(o,1/3):o/Cl+ss}function Va(o){return o>bn?o*o*o:Cl*(o-ss)}function Xh(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function _r(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Kh(o){const i=_r(o.r),s=_r(o.g),c=_r(o.b),d=Ro((.4124564*i+.3575761*s+.1804375*c)/Po),m=Ro((.2126729*i+.7151522*s+.072175*c)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Ro((.0193339*i+.119192*s+.9503041*c)/ho)),alpha:o.a}}function hp(o){let i=(o.l+16)/116,s=isNaN(o.a)?i:i+o.a/500,c=isNaN(o.b)?i:i-o.b/200;return i=1*Va(i),s=Po*Va(s),c=ho*Va(c),new Mi(Xh(3.2404542*s-1.5371385*i-.4985314*c),Xh(-.969266*s+1.8760108*i+.041556*c),Xh(.0556434*s-.2040259*i+1.0572252*c),o.alpha)}function am(o,i,s){const c=i-o;return o+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const Ni={forward:Kh,reverse:hp,interpolate:function(o,i,s){return{l:xn(o.l,i.l,s),a:xn(o.a,i.a,s),b:xn(o.b,i.b,s),alpha:xn(o.alpha,i.alpha,s)}}},El={forward:function(o){const{l:i,a:s,b:c}=Kh(o),d=Math.atan2(c,s)*up;return{h:d<0?d+360:d,c:Math.sqrt(s*s+c*c),l:i,alpha:o.a}},reverse:function(o){const i=o.h*Qh,s=o.c;return hp({l:o.l,a:Math.cos(i)*s,b:Math.sin(i)*s,alpha:o.alpha})},interpolate:function(o,i,s){return{h:am(o.h,i.h,s),c:xn(o.c,i.c,s),l:xn(o.l,i.l,s),alpha:xn(o.alpha,i.alpha,s)}}};var Cu=Object.freeze({__proto__:null,hcl:El,lab:Ni});class Bt{constructor(i,s,c,d,m){this.type=i,this.operator=s,this.interpolation=c,this.input=d,this.labels=[],this.outputs=[];for(const[y,x]of m)this.labels.push(y),this.outputs.push(x)}static interpolationFactor(i,s,c,d){let m=0;if("exponential"===i.name)m=yr(s,i.base,c,d);else if("linear"===i.name)m=yr(s,1,c,d);else if("cubic-bezier"===i.name){const y=i.controlPoints;m=new Ta(y[0],y[1],y[2],y[3]).solve(yr(s,1,c,d))}return m}static parse(i,s){let[c,d,m,...y]=i;if(!Array.isArray(d)||0===d.length)return s.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const E=d[1];if("number"!=typeof E)return s.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:E}}else{if("cubic-bezier"!==d[0])return s.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const E=d.slice(1);if(4!==E.length||E.some(D=>"number"!=typeof D||D<0||D>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:E}}}if(i.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(m=s.parse(m,2,Ke),!m)return null;const x=[];let w=null;"interpolate-hcl"===c||"interpolate-lab"===c?w=yn:s.expectedType&&"value"!==s.expectedType.kind&&(w=s.expectedType);for(let E=0;E<y.length;E+=2){const D=y[E],k=y[E+1],R=E+3,L=E+4;if("number"!=typeof D)return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(x.length&&x[x.length-1][0]>=D)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const N=s.parse(k,L,w);if(!N)return null;w=w||N.type,x.push([D,N])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Bt(w,c,d,m,x):s.error(`Type ${Wn(w)} is not interpolatable.`)}evaluate(i){const s=this.labels,c=this.outputs;if(1===s.length)return c[0].evaluate(i);const d=this.input.evaluate(i);if(d<=s[0])return c[0].evaluate(i);const m=s.length;if(d>=s[m-1])return c[m-1].evaluate(i);const y=la(s,d),x=Bt.interpolationFactor(this.interpolation,d,s[y],s[y+1]),w=c[y].evaluate(i),E=c[y+1].evaluate(i);return"interpolate"===this.operator?eo[this.type.kind.toLowerCase()](w,E,x):"interpolate-hcl"===this.operator?El.reverse(El.interpolate(El.forward(w),El.forward(E),x)):Ni.reverse(Ni.interpolate(Ni.forward(w),Ni.forward(E),x))}eachChild(i){i(this.input);for(const s of this.outputs)i(s)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,i,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function yr(o,i,s,c){const d=c-s,m=o-s;return 0===d?0:1===i?m/d:(Math.pow(i,m)-1)/(Math.pow(i,d)-1)}var mn=Bt;class zi{constructor(i,s){this.type=i,this.args=s}static parse(i,s){if(i.length<2)return s.error("Expectected at least one argument.");let c=null;const d=s.expectedType;d&&"value"!==d.kind&&(c=d);const m=[];for(const x of i.slice(1)){const w=s.parse(x,1+m.length,c,void 0,{typeAnnotation:"omit"});if(!w)return null;c=c||w.type,m.push(w)}const y=d&&m.some(x=>vn(d,x.type));return new zi(y?Yt:c,m)}evaluate(i){let s,c=null,d=0;for(const m of this.args){if(d++,c=m.evaluate(i),c&&c instanceof uo&&!c.available&&(s||(s=c),c=null,d===this.args.length))return s;if(null!==c)break}return c}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var vr=zi;class Ds{constructor(i,s){this.type=s.type,this.bindings=[].concat(i),this.result=s}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const s of this.bindings)i(s[1]);i(this.result)}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const c=[];for(let m=1;m<i.length-1;m+=2){const y=i[m];if("string"!=typeof y)return s.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return s.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=s.parse(i[m+1],m+1);if(!x)return null;c.push([y,x])}const d=s.parse(i[i.length-1],i.length-1,s.expectedType,c);return d?new Ds(c,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[s,c]of this.bindings)i.push(s,c.serialize());return i.push(this.result.serialize()),i}}var qr=Ds;class Eu{constructor(i,s,c){this.type=i,this.index=s,this.input=c}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Ke),d=s.parse(i[2],2,rt(s.expectedType||Yt));return c&&d?new Eu(d.type.itemType,c,d):null}evaluate(i){const s=this.index.evaluate(i),c=this.input.evaluate(i);if(s<0)throw new gr(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new gr(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new gr(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var dp=Eu;class Il{constructor(i,s){this.type=an,this.needle=i,this.haystack=s}static parse(i,s){if(3!==i.length)return s.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Yt),d=s.parse(i[2],2,Yt);return c&&d?hc(c.type,[an,sn,Ke,oa,Yt])?new Il(c,d):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(c.type)} instead`):null}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(null==c)return!1;if(!_u(s,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(vi(s))} instead.`);if(!_u(c,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Wn(vi(c))} instead.`);return c.indexOf(s)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var po=Il;class xt{constructor(i,s,c){this.type=Ke,this.needle=i,this.haystack=s,this.fromIndex=c}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Yt),d=s.parse(i[2],2,Yt);if(!c||!d)return null;if(!hc(c.type,[an,sn,Ke,oa,Yt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(c.type)} instead`);if(4===i.length){const m=s.parse(i[3],3,Ke);return m?new xt(c,d,m):null}return new xt(c,d)}evaluate(i){const s=this.needle.evaluate(i),c=this.haystack.evaluate(i);if(!_u(s,["boolean","string","number","null"]))throw new gr(`Expected first argument to be of type boolean, string, number or null, but found ${Wn(vi(s))} instead.`);if(!_u(c,["string","array"]))throw new gr(`Expected second argument to be of type array or string, but found ${Wn(vi(c))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(i);return c.indexOf(s,d)}return c.indexOf(s)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var un=xt;class ci{constructor(i,s,c,d,m,y){this.inputType=i,this.type=s,this.input=c,this.cases=d,this.outputs=m,this.otherwise=y}static parse(i,s){if(i.length<5)return s.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return s.error("Expected an even number of arguments.");let c,d;s.expectedType&&"value"!==s.expectedType.kind&&(d=s.expectedType);const m={},y=[];for(let E=2;E<i.length-1;E+=2){let D=i[E];const k=i[E+1];Array.isArray(D)||(D=[D]);const R=s.concat(E);if(0===D.length)return R.error("Expected at least one branch label.");for(const N of D){if("number"!=typeof N&&"string"!=typeof N)return R.error("Branch labels must be numbers or strings.");if("number"==typeof N&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof N&&Math.floor(N)!==N)return R.error("Numeric branch labels must be integer values.");if(c){if(R.checkSubtype(c,vi(N)))return null}else c=vi(N);if(void 0!==m[String(N)])return R.error("Branch labels must be unique.");m[String(N)]=y.length}const L=s.parse(k,E,d);if(!L)return null;d=d||L.type,y.push(L)}const x=s.parse(i[1],1,Yt);if(!x)return null;const w=s.parse(i[i.length-1],i.length-1,d);return w?"value"!==x.type.kind&&s.concat(1).checkSubtype(c,x.type)?null:new ci(c,d,x,m,y,w):null}evaluate(i){const s=this.input.evaluate(i);return(vi(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],d={};for(const y of s){const x=d[this.cases[y]];void 0===x?(d[this.cases[y]]=c.length,c.push([this.cases[y],[y]])):c[x][1].push(y)}const m=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,x]of c)i.push(1===x.length?m(x[0]):x.map(m)),i.push(this.outputs[y].serialize());return i.push(this.otherwise.serialize()),i}}var Oo=ci;class Ss{constructor(i,s,c){this.type=i,this.branches=s,this.otherwise=c}static parse(i,s){if(i.length<4)return s.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&"value"!==s.expectedType.kind&&(c=s.expectedType);const d=[];for(let y=1;y<i.length-1;y+=2){const x=s.parse(i[y],y,an);if(!x)return null;const w=s.parse(i[y+1],y+1,c);if(!w)return null;d.push([x,w]),c=c||w.type}const m=s.parse(i[i.length-1],i.length-1,c);return m?new Ss(c,d,m):null}evaluate(i){for(const[s,c]of this.branches)if(s.evaluate(i))return c.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[s,c]of this.branches)i(s),i(c);i(this.otherwise)}outputDefined(){return this.branches.every(([i,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(s=>{i.push(s.serialize())}),i}}var rr=Ss;class as{constructor(i,s,c,d){this.type=i,this.input=s,this.beginIndex=c,this.endIndex=d}static parse(i,s){if(i.length<=2||i.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const c=s.parse(i[1],1,Yt),d=s.parse(i[2],2,Ke);if(!c||!d)return null;if(!hc(c.type,[rt(Yt),sn,Yt]))return s.error(`Expected first argument to be of type array or string, but found ${Wn(c.type)} instead`);if(4===i.length){const m=s.parse(i[3],3,Ke);return m?new as(c.type,c,d,m):null}return new as(c.type,c,d)}evaluate(i){const s=this.input.evaluate(i),c=this.beginIndex.evaluate(i);if(!_u(s,["string","array"]))throw new gr(`Expected first argument to be of type array or string, but found ${Wn(vi(s))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(i);return s.slice(c,d)}return s.slice(c)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ai=as;function ja(o,i){return"=="===o||"!="===o?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Ac(o,i,s,c){return 0===c.compare(i,s)}function en(o,i,s){const c="=="!==o&&"!="!==o;return class hD{constructor(m,y,x){this.type=an,this.lhs=m,this.rhs=y,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===y.type.kind}static parse(m,y){if(3!==m.length&&4!==m.length)return y.error("Expected two or three arguments.");const x=m[0];let w=y.parse(m[1],1,Yt);if(!w)return null;if(!ja(x,w.type))return y.concat(1).error(`"${x}" comparisons are not supported for type '${Wn(w.type)}'.`);let E=y.parse(m[2],2,Yt);if(!E)return null;if(!ja(x,E.type))return y.concat(2).error(`"${x}" comparisons are not supported for type '${Wn(E.type)}'.`);if(w.type.kind!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return y.error(`Cannot compare types '${Wn(w.type)}' and '${Wn(E.type)}'.`);c&&("value"===w.type.kind&&"value"!==E.type.kind?w=new sa(E.type,[w]):"value"!==w.type.kind&&"value"===E.type.kind&&(E=new sa(w.type,[E])));let D=null;if(4===m.length){if("string"!==w.type.kind&&"string"!==E.type.kind&&"value"!==w.type.kind&&"value"!==E.type.kind)return y.error("Cannot use collator to compare non-string types.");if(D=y.parse(m[3],3,Pr),!D)return null}return new hD(w,E,D)}evaluate(m){const y=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(c&&this.hasUntypedArgument){const w=vi(y),E=vi(x);if(w.kind!==E.kind||"string"!==w.kind&&"number"!==w.kind)throw new gr(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const w=vi(y),E=vi(x);if("string"!==w.kind||"string"!==E.kind)return i(m,y,x)}return this.collator?s(m,y,x,this.collator.evaluate(m)):i(m,y,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(y=>{m.push(y.serialize())}),m}}}const Yh=en("==",function(o,i,s){return i===s},Ac),xc=en("!=",function(o,i,s){return i!==s},function(o,i,s,c){return!Ac(0,i,s,c)}),pp=en("<",function(o,i,s){return i<s},function(o,i,s,c){return c.compare(i,s)<0}),Ml=en(">",function(o,i,s){return i>s},function(o,i,s,c){return c.compare(i,s)>0}),Ar=en("<=",function(o,i,s){return i<=s},function(o,i,s,c){return c.compare(i,s)<=0}),Tl=en(">=",function(o,i,s){return i>=s},function(o,i,s,c){return c.compare(i,s)>=0});class ks{constructor(i,s,c,d,m,y){this.type=sn,this.number=i,this.locale=s,this.currency=c,this.unit=d,this.minFractionDigits=m,this.maxFractionDigits=y}static parse(i,s){if(3!==i.length)return s.error("Expected two arguments.");const c=s.parse(i[1],1,Ke);if(!c)return null;const d=i[2];if("object"!=typeof d||Array.isArray(d))return s.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=s.parse(d.locale,1,sn),!m))return null;let y=null;if(d.currency&&(y=s.parse(d.currency,1,sn),!y))return null;let x=null;if(d.unit&&(x=s.parse(d.unit,1,sn),!x))return null;let w=null;if(d["min-fraction-digits"]&&(w=s.parse(d["min-fraction-digits"],1,Ke),!w))return null;let E=null;return d["max-fraction-digits"]&&(E=s.parse(d["max-fraction-digits"],1,Ke),!E)?null:new ks(c,m,y,x,w,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Rr{constructor(i){this.type=Ke,this.input=i}static parse(i,s){if(2!==i.length)return s.error(`Expected 1 argument, but found ${i.length-1} instead.`);const c=s.parse(i[1],1);return c?"array"!==c.type.kind&&"string"!==c.type.kind&&"value"!==c.type.kind?s.error(`Expected argument of type string or array, but found ${Wn(c.type)} instead.`):new Rr(c):null}evaluate(i){const s=this.input.evaluate(i);if("string"==typeof s||Array.isArray(s))return s.length;throw new gr(`Expected value to be of type string or array, but found ${Wn(vi(s))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(s=>{i.push(s.serialize())}),i}}const Dl={"==":Yh,"!=":xc,">":Ml,"<":pp,">=":Tl,"<=":Ar,array:sa,at:dp,boolean:sa,case:rr,coalesce:vr,collator:Al,format:di,image:Ba,in:po,"index-of":un,interpolate:mn,"interpolate-hcl":mn,"interpolate-lab":mn,length:Rr,let:qr,literal:yl,match:Oo,number:sa,"number-format":ks,object:sa,slice:Ai,step:Wh,string:sa,"to-boolean":vl,"to-color":vl,"to-number":vl,"to-string":vl,var:qh,within:yc};function Jh(o,[i,s,c,d]){i=i.evaluate(o),s=s.evaluate(o),c=c.evaluate(o);const m=d?d.evaluate(o):1,y=om(i,s,c,m);if(y)throw new gr(y);return new Mi(i/255*m,s/255*m,c/255*m,m)}function On(o,i){return o in i}function ed(o,i){const s=i[o];return void 0===s?null:s}function Wr(o){return{type:o}}ko.register(Dl,{error:[{kind:"error"},[sn],(o,[i])=>{throw new gr(i.evaluate(o))}],typeof:[sn,[Yt],(o,[i])=>Wn(vi(i.evaluate(o)))],"to-rgba":[rt(Ke,4),[yn],(o,[i])=>i.evaluate(o).toArray()],rgb:[yn,[Ke,Ke,Ke],Jh],rgba:[yn,[Ke,Ke,Ke,Ke],Jh],has:{type:an,overloads:[[[sn],(o,[i])=>On(i.evaluate(o),o.properties())],[[sn,kt],(o,[i,s])=>On(i.evaluate(o),s.evaluate(o))]]},get:{type:Yt,overloads:[[[sn],(o,[i])=>ed(i.evaluate(o),o.properties())],[[sn,kt],(o,[i,s])=>ed(i.evaluate(o),s.evaluate(o))]]},"feature-state":[Yt,[sn],(o,[i])=>ed(i.evaluate(o),o.featureState||{})],properties:[kt,[],o=>o.properties()],"geometry-type":[sn,[],o=>o.geometryType()],id:[Yt,[],o=>o.id()],zoom:[Ke,[],o=>o.globals.zoom],pitch:[Ke,[],o=>o.globals.pitch||0],"distance-from-center":[Ke,[],o=>o.distanceFromCenter()],"heatmap-density":[Ke,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ke,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[Ke,[],o=>o.globals.skyRadialProgress||0],accumulated:[Yt,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[Ke,Wr(Ke),(o,i)=>{let s=0;for(const c of i)s+=c.evaluate(o);return s}],"*":[Ke,Wr(Ke),(o,i)=>{let s=1;for(const c of i)s*=c.evaluate(o);return s}],"-":{type:Ke,overloads:[[[Ke,Ke],(o,[i,s])=>i.evaluate(o)-s.evaluate(o)],[[Ke],(o,[i])=>-i.evaluate(o)]]},"/":[Ke,[Ke,Ke],(o,[i,s])=>i.evaluate(o)/s.evaluate(o)],"%":[Ke,[Ke,Ke],(o,[i,s])=>i.evaluate(o)%s.evaluate(o)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(o,[i,s])=>Math.pow(i.evaluate(o),s.evaluate(o))],sqrt:[Ke,[Ke],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[Ke,[Ke],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[Ke,[Ke],(o,[i])=>Math.log(i.evaluate(o))],log2:[Ke,[Ke],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[Ke,[Ke],(o,[i])=>Math.sin(i.evaluate(o))],cos:[Ke,[Ke],(o,[i])=>Math.cos(i.evaluate(o))],tan:[Ke,[Ke],(o,[i])=>Math.tan(i.evaluate(o))],asin:[Ke,[Ke],(o,[i])=>Math.asin(i.evaluate(o))],acos:[Ke,[Ke],(o,[i])=>Math.acos(i.evaluate(o))],atan:[Ke,[Ke],(o,[i])=>Math.atan(i.evaluate(o))],min:[Ke,Wr(Ke),(o,i)=>Math.min(...i.map(s=>s.evaluate(o)))],max:[Ke,Wr(Ke),(o,i)=>Math.max(...i.map(s=>s.evaluate(o)))],abs:[Ke,[Ke],(o,[i])=>Math.abs(i.evaluate(o))],round:[Ke,[Ke],(o,[i])=>{const s=i.evaluate(o);return s<0?-Math.round(-s):Math.round(s)}],floor:[Ke,[Ke],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[Ke,[Ke],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[an,[sn,Yt],(o,[i,s])=>o.properties()[i.value]===s.value],"filter-id-==":[an,[Yt],(o,[i])=>o.id()===i.value],"filter-type-==":[an,[sn],(o,[i])=>o.geometryType()===i.value],"filter-<":[an,[sn,Yt],(o,[i,s])=>{const c=o.properties()[i.value],d=s.value;return typeof c==typeof d&&c<d}],"filter-id-<":[an,[Yt],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<c}],"filter->":[an,[sn,Yt],(o,[i,s])=>{const c=o.properties()[i.value],d=s.value;return typeof c==typeof d&&c>d}],"filter-id->":[an,[Yt],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>c}],"filter-<=":[an,[sn,Yt],(o,[i,s])=>{const c=o.properties()[i.value],d=s.value;return typeof c==typeof d&&c<=d}],"filter-id-<=":[an,[Yt],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s<=c}],"filter->=":[an,[sn,Yt],(o,[i,s])=>{const c=o.properties()[i.value],d=s.value;return typeof c==typeof d&&c>=d}],"filter-id->=":[an,[Yt],(o,[i])=>{const s=o.id(),c=i.value;return typeof s==typeof c&&s>=c}],"filter-has":[an,[Yt],(o,[i])=>i.value in o.properties()],"filter-has-id":[an,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[an,[rt(sn)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[an,[rt(Yt)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[an,[sn,rt(Yt)],(o,[i,s])=>s.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[an,[sn,rt(Yt)],(o,[i,s])=>function(c,d,m,y){for(;m<=y;){const x=m+y>>1;if(d[x]===c)return!0;d[x]>c?y=x-1:m=x+1}return!1}(o.properties()[i.value],s.value,0,s.value.length-1)],all:{type:an,overloads:[[[an,an],(o,[i,s])=>i.evaluate(o)&&s.evaluate(o)],[Wr(an),(o,i)=>{for(const s of i)if(!s.evaluate(o))return!1;return!0}]]},any:{type:an,overloads:[[[an,an],(o,[i,s])=>i.evaluate(o)||s.evaluate(o)],[Wr(an),(o,i)=>{for(const s of i)if(s.evaluate(o))return!0;return!1}]]},"!":[an,[an],(o,[i])=>!i.evaluate(o)],"is-supported-script":[an,[sn],(o,[i])=>{const s=o.globals&&o.globals.isSupportedScript;return!s||s(i.evaluate(o))}],upcase:[sn,[sn],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[sn,[sn],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[sn,Wr(Yt),(o,i)=>i.map(s=>mr(s.evaluate(o))).join("")],"resolved-locale":[sn,[Pr],(o,[i])=>i.evaluate(o).resolvedLocale()]});var Sl=Dl;function bc(o){return{result:"success",value:o}}function ls(o){return{result:"error",value:o}}function Fo(o){return"data-driven"===o["property-type"]}function Wi(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function td(o){return!!o.expression&&o.expression.interpolated}function qt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Or(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function Iu(o){return o}function ca(o,i){const s="color"===i.type,c=o.stops&&"object"==typeof o.stops[0][0],d=c||!(c||void 0!==o.property),m=o.type||(td(i)?"exponential":"interval");if(s&&((o=Ms({},o)).stops&&(o.stops=o.stops.map(E=>[E[0],Mi.parse(E[1])])),o.default=Mi.parse(o.default?o.default:i.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!Cu[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let y,x,w;if("exponential"===m)y=ua;else if("interval"===m)y=Mu;else if("categorical"===m){y=fo,x=Object.create(null);for(const E of o.stops)x[E[0]]=E[1];w=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);y=fp}if(c){const E={},D=[];for(let L=0;L<o.stops.length;L++){const N=o.stops[L],j=N[0].zoom;void 0===E[j]&&(E[j]={zoom:j,type:o.type,property:o.property,default:o.default,stops:[]},D.push(j)),E[j].stops.push([N[0].value,N[1]])}const k=[];for(const L of D)k.push([E[L].zoom,ca(E[L],i)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:mn.interpolationFactor.bind(void 0,R),zoomStops:k.map(L=>L[0]),evaluate:({zoom:L},N)=>ua({stops:k,base:o.base},i,L).evaluate(L,N)}}if(d){const E="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:mn.interpolationFactor.bind(void 0,E),zoomStops:o.stops.map(D=>D[0]),evaluate:({zoom:D})=>y(o,i,D,x,w)}}return{kind:"source",evaluate(E,D){const k=D&&D.properties?D.properties[o.property]:void 0;return void 0===k?Ps(o.default,i.default):y(o,i,k,x,w)}}}function Ps(o,i,s){return void 0!==o?o:void 0!==i?i:void 0!==s?s:void 0}function fo(o,i,s,c,d){return Ps(typeof s===d?c[s]:void 0,o.default,i.default)}function Mu(o,i,s){if("number"!==qt(s))return Ps(o.default,i.default);const c=o.stops.length;if(1===c||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[c-1][0])return o.stops[c-1][1];const d=la(o.stops.map(m=>m[0]),s);return o.stops[d][1]}function ua(o,i,s){const c=void 0!==o.base?o.base:1;if("number"!==qt(s))return Ps(o.default,i.default);const d=o.stops.length;if(1===d||s<=o.stops[0][0])return o.stops[0][1];if(s>=o.stops[d-1][0])return o.stops[d-1][1];const m=la(o.stops.map(D=>D[0]),s),y=function(D,k,R,L){const N=L-R,j=D-R;return 0===N?0:1===k?j/N:(Math.pow(k,j)-1)/(Math.pow(k,N)-1)}(s,c,o.stops[m][0],o.stops[m+1][0]),x=o.stops[m][1],w=o.stops[m+1][1];let E=eo[i.type]||Iu;if(o.colorSpace&&"rgb"!==o.colorSpace){const D=Cu[o.colorSpace];E=(k,R)=>D.reverse(D.interpolate(D.forward(k),D.forward(R),y))}return"function"==typeof x.evaluate?{evaluate(...D){const k=x.evaluate.apply(void 0,D),R=w.evaluate.apply(void 0,D);if(void 0!==k&&void 0!==R)return E(k,R,y)}}:E(x,w,y)}function fp(o,i,s){return"color"===i.type?s=Mi.parse(s):"formatted"===i.type?s=Yr.fromString(s.toString()):"resolvedImage"===i.type?s=uo.fromString(s.toString()):qt(s)===i.type||"enum"===i.type&&i.values[s]||(s=void 0),Ps(s,o.default,i.default)}class Tu{constructor(i,s){var c;this.expression=i,this._warningHistory={},this._evaluator=new xu,this._defaultValue=s?"color"===(c=s).type&&(Or(c.default)||Array.isArray(c.default))?new Mi(0,0,0,0):"color"===c.type?Mi.parse(c.default)||null:void 0===c.default?null:c.default:null,this._enumValues=s&&"enum"===s.type?s.values:null}evaluateWithoutErrorHandling(i,s,c,d,m,y,x,w){return this._evaluator.globals=i,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(i,s,c,d,m,y,x,w){this._evaluator.globals=i,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new gr(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function wc(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in Sl}function Cc(o,i){const s=new wl(Sl,[],i?function(d){const m={color:yn,string:sn,number:Ke,enum:sn,boolean:an,formatted:gu,resolvedImage:ns};return"array"===d.type?rt(m[d.value]||Yt,d.length):m[d.type]}(i):void 0),c=s.parse(o,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return c?bc(new Tu(c,i)):ls(s.errors)}class mp{constructor(i,s){this.kind=i,this._styleExpression=s,this.isStateDependent="constant"!==i&&!$r(s.expression)}evaluateWithoutErrorHandling(i,s,c,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,d,m,y)}evaluate(i,s,c,d,m,y){return this._styleExpression.evaluate(i,s,c,d,m,y)}}class Du{constructor(i,s,c,d){this.kind=i,this.zoomStops=c,this._styleExpression=s,this.isStateDependent="camera"!==i&&!$r(s.expression),this.interpolationType=d}evaluateWithoutErrorHandling(i,s,c,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(i,s,c,d,m,y)}evaluate(i,s,c,d,m,y){return this._styleExpression.evaluate(i,s,c,d,m,y)}interpolationFactor(i,s,c){return this.interpolationType?mn.interpolationFactor(this.interpolationType,i,s,c):0}}function Su(o,i){if("error"===(o=Cc(o,i)).result)return o;const s=o.value.expression,c=os(s);if(!c&&!Fo(i))return ls([new So("","data expressions not supported")]);const d=za(s,["zoom","pitch","distance-from-center"]);if(!d&&!Wi(i))return ls([new So("","zoom expressions not supported")]);const m=id(s);return m||d?m instanceof So?ls([m]):m instanceof mn&&!td(i)?ls([new So("",'"interpolate" expressions cannot be used with this property')]):bc(m?new Du(c?"camera":"composite",o.value,m.labels,m instanceof mn?m.interpolation:void 0):new mp(c?"constant":"source",o.value)):ls([new So("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class nd{constructor(i,s){this._parameters=i,this._specification=s,Ms(this,ca(this._parameters,this._specification))}static deserialize(i){return new nd(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function id(o){let i=null;if(o instanceof qr)i=id(o.result);else if(o instanceof vr){for(const s of o.args)if(i=id(s),i)break}else(o instanceof Wh||o instanceof mn)&&o.input instanceof ko&&"zoom"===o.input.name&&(i=o);return i instanceof So||o.eachChild(s=>{const c=id(s);c instanceof So?i=c:!i&&c?i=new So("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&c&&i!==c&&(i=new So("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class pt{constructor(i,s,c,d){this.message=(i?`${i}: `:"")+c,d&&(this.identifier=d),null!=s&&s.__line__&&(this.line=s.__line__)}}function cs(o){const i=o.key,s=o.value,c=o.valueSpec||{},d=o.objectElementValidators||{},m=o.style,y=o.styleSpec;let x=[];const w=qt(s);if("object"!==w)return[new pt(i,s,`object expected, ${w} found`)];for(const E in s){const D=E.split(".")[0];let k;d[D]?k=d[D]:c[D]?k=pi:d["*"]?k=d["*"]:c["*"]&&(k=pi),k?x=x.concat(k({key:(i&&`${i}.`)+E,value:s[E],valueSpec:c[D]||c["*"],style:m,styleSpec:y,object:s,objectKey:E},s)):x.push(new pt(i,s[E],`unknown property "${E}"`))}for(const E in c)d[E]||c[E].required&&void 0===c[E].default&&void 0===s[E]&&x.push(new pt(i,s,`missing required property "${E}"`));return x}function lm(o){const i=o.value,s=o.valueSpec,c=o.style,d=o.styleSpec,m=o.key,y=o.arrayElementValidator||pi;if("array"!==qt(i))return[new pt(m,i,`array expected, ${qt(i)} found`)];if(s.length&&i.length!==s.length)return[new pt(m,i,`array length ${s.length} expected, length ${i.length} found`)];if(s["min-length"]&&i.length<s["min-length"])return[new pt(m,i,`array length at least ${s["min-length"]} expected, length ${i.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};d.$version<7&&(x.function=s.function),"object"===qt(s.value)&&(x=s.value);let w=[];for(let E=0;E<i.length;E++)w=w.concat(y({array:i,arrayIndex:E,value:i[E],valueSpec:x,style:c,styleSpec:d,key:`${m}[${E}]`}));return w}function ku(o){const i=o.key,s=o.value,c=o.valueSpec;let d=qt(s);if("number"===d&&s!=s&&(d="NaN"),"number"!==d)return[new pt(i,s,`number expected, ${d} found`)];if("minimum"in c){let m=c.minimum;if("array"===qt(c.minimum)&&(m=c.minimum[o.arrayIndex]),s<m)return[new pt(i,s,`${s} is less than the minimum value ${m}`)]}if("maximum"in c){let m=c.maximum;if("array"===qt(c.maximum)&&(m=c.maximum[o.arrayIndex]),s>m)return[new pt(i,s,`${s} is greater than the maximum value ${m}`)]}return[]}function Pu(o){const i=o.valueSpec,s=Ei(o.value.type);let c,d,m,y={};const x="categorical"!==s&&void 0===o.value.property,w=!x,E="array"===qt(o.value.stops)&&"array"===qt(o.value.stops[0])&&"object"===qt(o.value.stops[0][0]),D=cs({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(L){if("identity"===s)return[new pt(L.key,L.value,'identity function may not have a "stops" property')];let N=[];const j=L.value;return N=N.concat(lm({key:L.key,value:j,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:k})),"array"===qt(j)&&0===j.length&&N.push(new pt(L.key,j,"array must have at least one stop")),N},default:function(L){return pi({key:L.key,value:L.value,valueSpec:i,style:L.style,styleSpec:L.styleSpec})}}});return"identity"===s&&x&&D.push(new pt(o.key,o.value,'missing required property "property"')),"identity"===s||o.value.stops||D.push(new pt(o.key,o.value,'missing required property "stops"')),"exponential"===s&&o.valueSpec.expression&&!td(o.valueSpec)&&D.push(new pt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(w&&!Fo(o.valueSpec)?D.push(new pt(o.key,o.value,"property functions not supported")):x&&!Wi(o.valueSpec)&&D.push(new pt(o.key,o.value,"zoom functions not supported"))),"categorical"!==s&&!E||void 0!==o.value.property||D.push(new pt(o.key,o.value,'"property" property is required')),D;function k(L){let N=[];const j=L.value,q=L.key;if("array"!==qt(j))return[new pt(q,j,`array expected, ${qt(j)} found`)];if(2!==j.length)return[new pt(q,j,`array length 2 expected, length ${j.length} found`)];if(E){if("object"!==qt(j[0]))return[new pt(q,j,`object expected, ${qt(j[0])} found`)];if(void 0===j[0].zoom)return[new pt(q,j,"object stop key must have zoom")];if(void 0===j[0].value)return[new pt(q,j,"object stop key must have value")];const J=Ei(j[0].zoom);if("number"!=typeof J)return[new pt(q,j[0].zoom,"stop zoom values must be numbers")];if(m&&m>J)return[new pt(q,j[0].zoom,"stop zoom values must appear in ascending order")];J!==m&&(m=J,d=void 0,y={}),N=N.concat(cs({key:`${q}[0]`,value:j[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:ku,value:R}}))}else N=N.concat(R({key:`${q}[0]`,value:j[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},j));return wc(An(j[1]))?N.concat([new pt(`${q}[1]`,j[1],"expressions are not allowed in function stops.")]):N.concat(pi({key:`${q}[1]`,value:j[1],valueSpec:i,style:L.style,styleSpec:L.styleSpec}))}function R(L,N){const j=qt(L.value),q=Ei(L.value),J=null!==L.value?L.value:N;if(c){if(j!==c)return[new pt(L.key,J,`${j} stop domain type must match previous stop domain type ${c}`)]}else c=j;if("number"!==j&&"string"!==j&&"boolean"!==j&&"number"!=typeof q&&"string"!=typeof q&&"boolean"!=typeof q)return[new pt(L.key,J,"stop domain value must be a number, string, or boolean")];if("number"!==j&&"categorical"!==s){let se=`number expected, ${j} found`;return Fo(i)&&void 0===s&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new pt(L.key,J,se)]}return"categorical"!==s||"number"!==j||"number"==typeof q&&isFinite(q)&&Math.floor(q)===q?"categorical"!==s&&"number"===j&&"number"==typeof q&&"number"==typeof d&&void 0!==d&&q<d?[new pt(L.key,J,"stop domain values must appear in ascending order")]:(d=q,"categorical"===s&&q in y?[new pt(L.key,J,"stop domain values must be unique")]:(y[q]=!0,[])):[new pt(L.key,J,`integer expected, found ${String(q)}`)]}}function Vi(o){const i=("property"===o.expressionContext?Su:Cc)(An(o.value),o.valueSpec);if("error"===i.result)return i.value.map(c=>new pt(`${o.key}${c.key}`,o.value,c.message));const s=i.value.expression||i.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!s.outputDefined())return[new pt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!$r(s))return[new pt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return kl(s,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!za(s,["zoom","feature-state"]))return[new pt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!os(s))return[new pt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function kl(o,i){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const d of i.valueSpec.expression.parameters)s.delete(d);if(0===s.size)return[];const c=[];return o instanceof ko&&s.has(o.name)?[new pt(i.key,i.value,`["${o.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(o.eachChild(d=>{c.push(...kl(d,i))}),c)}function rd(o){const i=o.key,s=o.value,c=o.valueSpec,d=[];return Array.isArray(c.values)?-1===c.values.indexOf(Ei(s))&&d.push(new pt(i,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):-1===Object.keys(c.values).indexOf(Ei(s))&&d.push(new pt(i,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),d}function gp(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!gp(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function od(o,i="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gp(o)||(o=Ua(o));const s=o;let c=!0;try{c=function(E){if(!ji(E))return E;let D=An(E);return Ru(D),D=ha(D),D}(s)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(s,null,2)}\n        `)}const d=Oe[`filter_${i}`],m=Cc(c,d);let y=null;if("error"===m.result)throw new Error(m.value.map(E=>`${E.key}: ${E.message}`).join(", "));y=(E,D,k)=>m.value.evaluate(E,D,{},k);let x=null,w=null;if(c!==s){const E=Cc(s,d);if("error"===E.result)throw new Error(E.value.map(D=>`${D.key}: ${D.message}`).join(", "));x=(D,k,R,L,N)=>E.value.evaluate(D,k,{},R,void 0,void 0,L,N),w=!os(E.value.expression)}return{filter:y,dynamicFilter:x||void 0,needGeometry:_p(c),needFeature:!!w}}function ha(o){if(!Array.isArray(o))return o;const i=function(s){if(Ou.has(s[0]))for(let c=1;c<s.length;c++)if(ji(s[c]))return!0;return s}(o);return!0===i?i:i.map(s=>ha(s))}function Ru(o){let i=!1;const s=[];if("case"===o[0]){for(let c=1;c<o.length-1;c+=2)i=i||ji(o[c]),s.push(o[c+1]);s.push(o[o.length-1])}else if("match"===o[0]){i=i||ji(o[1]);for(let c=2;c<o.length-1;c+=2)s.push(o[c+1]);s.push(o[o.length-1])}else if("step"===o[0]){i=i||ji(o[1]);for(let c=1;c<o.length-1;c+=2)s.push(o[c+1])}i&&(o.length=0,o.push("any",...s));for(let c=1;c<o.length;c++)Ru(o[c])}function ji(o){if(!Array.isArray(o))return!1;if("pitch"===(i=o[0])||"distance-from-center"===i)return!0;var i;for(let s=1;s<o.length;s++)if(ji(o[s]))return!0;return!1}const Ou=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function cm(o,i){return o<i?-1:o>i?1:0}function _p(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let i=1;i<o.length;i++)if(_p(o[i]))return!0;return!1}function Ua(o){if(!o)return!0;const i=o[0];return o.length<=1?"any"!==i:"=="===i?Fu(o[1],o[2],"=="):"!="===i?Lu(Fu(o[1],o[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Fu(o[1],o[2],i):"any"===i?(s=o.slice(1),["any"].concat(s.map(Ua))):"all"===i?["all"].concat(o.slice(1).map(Ua)):"none"===i?["all"].concat(o.slice(1).map(Ua).map(Lu)):"in"===i?sd(o[1],o.slice(2)):"!in"===i?Lu(sd(o[1],o.slice(2))):"has"===i?Ec(o[1]):"!has"===i?Lu(Ec(o[1])):"within"!==i||o;var s}function Fu(o,i,s){switch(o){case"$type":return[`filter-type-${s}`,i];case"$id":return[`filter-id-${s}`,i];default:return[`filter-${s}`,o,i]}}function sd(o,i){if(0===i.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(s=>typeof s!=typeof i[0])?["filter-in-large",o,["literal",i.sort(cm)]]:["filter-in-small",o,["literal",i]]}}function Ec(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Lu(o){return["!",o]}function xr(o){return gp(An(o.value))?Vi(Ms({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):Pl(o)}function Pl(o){const i=o.value,s=o.key;if("array"!==qt(i))return[new pt(s,i,`array expected, ${qt(i)} found`)];const c=o.styleSpec;let d,m=[];if(i.length<1)return[new pt(s,i,"filter array must have at least 1 element")];switch(m=m.concat(rd({key:`${s}[0]`,value:i[0],valueSpec:c.filter_operator,style:o.style,styleSpec:o.styleSpec})),Ei(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===Ei(i[1])&&m.push(new pt(s,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&m.push(new pt(s,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(d=qt(i[1]),"string"!==d&&m.push(new pt(`${s}[1]`,i[1],`string expected, ${d} found`)));for(let y=2;y<i.length;y++)d=qt(i[y]),"$type"===Ei(i[1])?m=m.concat(rd({key:`${s}[${y}]`,value:i[y],valueSpec:c.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&m.push(new pt(`${s}[${y}]`,i[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<i.length;y++)m=m.concat(Pl({key:`${s}[${y}]`,value:i[y],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":d=qt(i[1]),2!==i.length?m.push(new pt(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==d&&m.push(new pt(`${s}[1]`,i[1],`string expected, ${d} found`));break;case"within":d=qt(i[1]),2!==i.length?m.push(new pt(s,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==d&&m.push(new pt(`${s}[1]`,i[1],`object expected, ${d} found`))}return m}function Bu(o,i){const s=o.key,c=o.style,d=o.styleSpec,m=o.value,y=o.objectKey,x=d[`${i}_${o.layerType}`];if(!x)return[];const w=y.match(/^(.*)-transition$/);if("paint"===i&&w&&x[w[1]]&&x[w[1]].transition)return pi({key:s,value:m,valueSpec:d.transition,style:c,styleSpec:d});const E=o.valueSpec||x[y];if(!E)return[new pt(s,m,`unknown property "${y}"`)];let D;if("string"===qt(m)&&Fo(E)&&!E.tokens&&(D=/^{([^}]+)}$/.exec(m))){const R=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new pt(s,m,`"${y}" does not support interpolation syntax\nUse an identity property function instead: ${R}.`)]}const k=[];return"symbol"===o.layerType&&("text-field"===y&&c&&!c.glyphs&&k.push(new pt(s,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&Or(An(m))&&"identity"===Ei(m.type)&&k.push(new pt(s,m,'"text-font" does not support identity functions'))),k.concat(pi({key:o.key,value:m,valueSpec:E,style:c,styleSpec:d,expressionContext:"property",propertyType:i,propertyKey:y}))}function Zi(o){return Bu(o,"paint")}function ad(o){return Bu(o,"layout")}function Ic(o){let i=[];const s=o.value,c=o.key,d=o.style,m=o.styleSpec;s.type||s.ref||i.push(new pt(c,s,'either "type" or "ref" is required'));let y=Ei(s.type);const x=Ei(s.ref);if(s.id){const w=Ei(s.id);for(let E=0;E<o.arrayIndex;E++){const D=d.layers[E];Ei(D.id)===w&&i.push(new pt(c,s.id,`duplicate layer id "${s.id}", previously used at line ${D.id.__line__}`))}}if("ref"in s){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in s&&i.push(new pt(c,s[E],`"${E}" is prohibited for ref layers`))}),d.layers.forEach(E=>{Ei(E.id)===x&&(w=E)}),w?w.ref?i.push(new pt(c,s.ref,"ref cannot reference another ref layer")):y=Ei(w.type):"string"==typeof x&&i.push(new pt(c,s.ref,`ref layer "${x}" not found`))}else if("background"!==y&&"sky"!==y)if(s.source){const w=d.sources&&d.sources[s.source],E=w&&Ei(w.type);w?"vector"===E&&"raster"===y?i.push(new pt(c,s.source,`layer "${s.id}" requires a raster source`)):"raster"===E&&"raster"!==y?i.push(new pt(c,s.source,`layer "${s.id}" requires a vector source`)):"vector"!==E||s["source-layer"]?"raster-dem"===E&&"hillshade"!==y?i.push(new pt(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||"geojson"===E&&w.lineMetrics||i.push(new pt(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new pt(c,s,`layer "${s.id}" must specify a "source-layer"`)):i.push(new pt(c,s.source,`source "${s.source}" not found`))}else i.push(new pt(c,s,'missing required property "source"'));return i=i.concat(cs({key:c,value:s,valueSpec:m.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>pi({key:`${c}.type`,value:s.type,valueSpec:m.layer.type,style:o.style,styleSpec:o.styleSpec,object:s,objectKey:"type"}),filter:w=>xr(Ms({layerType:y},w)),layout:w=>cs({layer:s,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>ad(Ms({layerType:y},E))}}),paint:w=>cs({layer:s,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Zi(Ms({layerType:y},E))}})}})),i}function Ri(o){const i=o.value,s=o.key,c=qt(i);return"string"!==c?[new pt(s,i,`string expected, ${c} found`)]:[]}const yp={promoteId:function({key:o,value:i}){if("string"===qt(i))return Ri({key:o,value:i});{const s=[];for(const c in i)s.push(...Ri({key:`${o}.${c}`,value:i[c]}));return s}}};function ld(o){const i=o.value,s=o.key,c=o.styleSpec,d=o.style;if(!i.type)return[new pt(s,i,'"type" is required')];const m=Ei(i.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=cs({key:s,value:i,valueSpec:c[`source_${m.replace("-","_")}`],style:o.style,styleSpec:c,objectElementValidators:yp}),y;case"geojson":if(y=cs({key:s,value:i,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:yp}),i.cluster)for(const x in i.clusterProperties){const[w,E]=i.clusterProperties[x],D="string"==typeof w?[w,["accumulated"],["get",x]]:w;y.push(...Vi({key:`${s}.${x}.map`,value:E,expressionContext:"cluster-map"})),y.push(...Vi({key:`${s}.${x}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return y;case"video":return cs({key:s,value:i,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return cs({key:s,value:i,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new pt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return rd({key:`${s}.type`,value:i.type,valueSpec:{values:Rl(c)},style:d,styleSpec:c})}}function Rl(o){return o.source.reduce((i,s)=>{const c=o[s];return"enum"===c.type.type&&(i=i.concat(Object.keys(c.type.values))),i},[])}function Fr(o){const i=o.value,s=o.styleSpec,c=s.light,d=o.style;let m=[];const y=qt(i);if(void 0===i)return m;if("object"!==y)return m=m.concat([new pt("light",i,`object expected, ${y} found`)]),m;for(const x in i){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&c[w[1]]&&c[w[1]].transition?pi({key:x,value:i[x],valueSpec:s.transition,style:d,styleSpec:s}):c[x]?pi({key:x,value:i[x],valueSpec:c[x],style:d,styleSpec:s}):[new pt(x,i[x],`unknown property "${x}"`)])}return m}function cd(o){const i=o.value,s=o.key,c=o.style,d=o.styleSpec,m=d.terrain;let y=[];const x=qt(i);if(void 0===i)return y;if("object"!==x)return y=y.concat([new pt("terrain",i,`object expected, ${x} found`)]),y;for(const w in i){const E=w.match(/^(.*)-transition$/);y=y.concat(E&&m[E[1]]&&m[E[1]].transition?pi({key:w,value:i[w],valueSpec:d.transition,style:c,styleSpec:d}):m[w]?pi({key:w,value:i[w],valueSpec:m[w],style:c,styleSpec:d}):[new pt(w,i[w],`unknown property "${w}"`)])}if(i.source){const w=c.sources&&c.sources[i.source],E=w&&Ei(w.type);w?"raster-dem"!==E&&y.push(new pt(s,i.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):y.push(new pt(s,i.source,`source "${i.source}" not found`))}else y.push(new pt(s,i,'terrain is missing required property "source"'));return y}function Mc(o){const i=o.value,s=o.style,c=o.styleSpec,d=c.fog;let m=[];const y=qt(i);if(void 0===i)return m;if("object"!==y)return m=m.concat([new pt("fog",i,`object expected, ${y} found`)]),m;for(const x in i){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&d[w[1]]&&d[w[1]].transition?pi({key:x,value:i[x],valueSpec:c.transition,style:s,styleSpec:c}):d[x]?pi({key:x,value:i[x],valueSpec:d[x],style:s,styleSpec:c}):[new pt(x,i[x],`unknown property "${x}"`)])}return m}const vp={"*":()=>[],array:lm,boolean:function(o){const i=o.value,s=o.key,c=qt(i);return"boolean"!==c?[new pt(s,i,`boolean expected, ${c} found`)]:[]},number:ku,color:function(o){const i=o.key,s=o.value,c=qt(s);return"string"!==c?[new pt(i,s,`color expected, ${c} found`)]:null===Hh(s)?[new pt(i,s,`color expected, "${s}" found`)]:[]},enum:rd,filter:xr,function:Pu,layer:Ic,object:cs,source:ld,light:Fr,terrain:cd,fog:Mc,string:Ri,formatted:function(o){return 0===Ri(o).length?[]:Vi(o)},resolvedImage:function(o){return 0===Ri(o).length?[]:Vi(o)},projection:function(o){const i=o.value,s=o.styleSpec,c=s.projection,d=o.style;let m=[];const y=qt(i);if("object"===y)for(const x in i)m=m.concat(pi({key:x,value:i[x],valueSpec:c[x],style:d,styleSpec:s}));else"string"!==y&&(m=m.concat([new pt("projection",i,`object or string expected, ${y} found`)]));return m}};function pi(o){const i=o.value,s=o.valueSpec,c=o.styleSpec;return s.expression&&Or(Ei(i))?Pu(o):s.expression&&wc(An(i))?Vi(o):s.type&&vp[s.type]?vp[s.type](o):cs(Ms({},o,{valueSpec:s.type?c[s.type]:s}))}function Ap(o){const i=o.value,s=o.key,c=Ri(o);return c.length||(-1===i.indexOf("{fontstack}")&&c.push(new pt(s,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&c.push(new pt(s,i,'"glyphs" url must include a "{range}" token'))),c}function Nu(o,i=Oe){return Lo(pi({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,objectElementValidators:{glyphs:Ap,"*":()=>[]}}))}const rn=o=>Lo(Zi(o)),xp=o=>Lo(ad(o));function Lo(o){return o.slice().sort((i,s)=>i.line&&s.line?i.line-s.line:0)}function bp(o,i){let s=!1;if(i&&i.length)for(const c of i)o.fire(new Is(new Error(c.message))),s=!0;return s}var um=No,Bo=3;function No(o,i,s){var c=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var d=new Int32Array(this.arrayBuffer);o=d[0],this.d=(i=d[1])+2*(s=d[2]);for(var m=0;m<this.d*this.d;m++){var y=d[Bo+m],x=d[Bo+m+1];c.push(y===x?null:d.subarray(y,x))}var w=d[Bo+c.length+1];this.keys=d.subarray(d[Bo+c.length],w),this.bboxes=d.subarray(w),this.insert=this._insertReadonly}else{this.d=i+2*s;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=o,this.padding=s,this.scale=i/o,this.uid=0;var D=s/i*o;this.min=-D,this.max=o+D}No.prototype.insert=function(o,i,s,c,d){this._forEachCell(i,s,c,d,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(i),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d)},No.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},No.prototype._insertCell=function(o,i,s,c,d,m){this.cells[d].push(m)},No.prototype.query=function(o,i,s,c,d){var m=this.min,y=this.max;if(o<=m&&i<=m&&y<=s&&y<=c&&!d)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,i,s,c,this._queryCell,x,{},d),x},No.prototype._queryCell=function(o,i,s,c,d,m,y,x){var w=this.cells[d];if(null!==w)for(var E=this.keys,D=this.bboxes,k=0;k<w.length;k++){var R=w[k];if(void 0===y[R]){var L=4*R;(x?x(D[L+0],D[L+1],D[L+2],D[L+3]):o<=D[L+2]&&i<=D[L+3]&&s>=D[L+0]&&c>=D[L+1])?(y[R]=!0,m.push(E[R])):y[R]=!1}}},No.prototype._forEachCell=function(o,i,s,c,d,m,y,x){for(var w=this._convertToCellCoord(o),E=this._convertToCellCoord(i),D=this._convertToCellCoord(s),k=this._convertToCellCoord(c),R=w;R<=D;R++)for(var L=E;L<=k;L++){var N=this.d*L+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(L),this._convertFromCellCoord(R+1),this._convertFromCellCoord(L+1)))&&d.call(this,o,i,s,c,N,m,y,x))return}},No.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},No.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},No.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,i=Bo+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var d=new Int32Array(i+s+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=i,y=0;y<o.length;y++){var x=o[y];d[Bo+y]=m,d.set(x,m),m+=x.length}return d[Bo+o.length]=m,d.set(this.keys,m),d[Bo+o.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};var Ga=Xr(um);const zu={};function Ae(o,i,s={}){Object.defineProperty(o,"_classRegistryKey",{value:i,writeable:!1}),zu[i]={klass:o,omit:s.omit||[]}}Ae(Object,"Object"),Ga.serialize=function(o,i){const s=o.toArrayBuffer();return i&&i.push(s),{buffer:s}},Ga.deserialize=function(o){return new Ga(o.buffer)},Object.defineProperty(Ga,"name",{value:"Grid"}),Ae(Ga,"Grid"),Ae(Mi,"Color"),Ae(Error,"Error"),Ae(Ra,"AJAXError"),Ae(uo,"ResolvedImage"),Ae(nd,"StylePropertyFunction"),Ae(Tu,"StyleExpression",{omit:["_evaluator"]}),Ae(Du,"ZoomDependentExpression"),Ae(mp,"ZoomConstantExpression"),Ae(ko,"CompoundExpression",{omit:["_evaluate"]});for(const o in Sl)zu[Sl[o]._classRegistryKey]||Ae(Sl[o],`Expression${o}`);function En(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function In(o){return je.ImageBitmap&&o instanceof je.ImageBitmap}function gn(o,i){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(En(o)||In(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const s=o;return i&&i.push(s.buffer),s}if(o instanceof je.ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const s=[];for(const c of o)s.push(gn(c,i));return s}if("object"==typeof o){const s=o.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const d=s.serialize?s.serialize(o,i):{};if(!s.serialize){for(const m in o)o.hasOwnProperty(m)&&(zu[c].omit.indexOf(m)>=0||(d[m]=gn(o[m],i)));o instanceof Error&&(d.message=o.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==c&&(d.$name=c),d}throw new Error("can't serialize object of type "+typeof o)}function fi(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||En(o)||In(o)||ArrayBuffer.isView(o)||o instanceof je.ImageData)return o;if(Array.isArray(o))return o.map(fi);if("object"==typeof o){const i=o.$name||"Object",{klass:s}=zu[i];if(!s)throw new Error(`can't deserialize unregistered class ${i}`);if(s.deserialize)return s.deserialize(o);const c=Object.create(s.prototype);for(const d of Object.keys(o))"$name"!==d&&(c[d]=fi(o[d]));return c}throw new Error("can't deserialize object of type "+typeof o)}const dt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Ha(o){for(const i of o)if(Tc(i.charCodeAt(0)))return!0;return!1}function us(o){for(const i of o)if(!Vu(i.charCodeAt(0)))return!1;return!0}function Vu(o){return!(dt.Arabic(o)||dt["Arabic Supplement"](o)||dt["Arabic Extended-A"](o)||dt["Arabic Presentation Forms-A"](o)||dt["Arabic Presentation Forms-B"](o))}function Tc(o){return!(746!==o&&747!==o&&(o<4352||!(dt["Bopomofo Extended"](o)||dt.Bopomofo(o)||dt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||dt["CJK Compatibility Ideographs"](o)||dt["CJK Compatibility"](o)||dt["CJK Radicals Supplement"](o)||dt["CJK Strokes"](o)||!(!dt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||dt["CJK Unified Ideographs Extension A"](o)||dt["CJK Unified Ideographs"](o)||dt["Enclosed CJK Letters and Months"](o)||dt["Hangul Compatibility Jamo"](o)||dt["Hangul Jamo Extended-A"](o)||dt["Hangul Jamo Extended-B"](o)||dt["Hangul Jamo"](o)||dt["Hangul Syllables"](o)||dt.Hiragana(o)||dt["Ideographic Description Characters"](o)||dt.Kanbun(o)||dt["Kangxi Radicals"](o)||dt["Katakana Phonetic Extensions"](o)||dt.Katakana(o)&&12540!==o||!(!dt["Halfwidth and Fullwidth Forms"](o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!dt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||dt["Unified Canadian Aboriginal Syllabics"](o)||dt["Unified Canadian Aboriginal Syllabics Extended"](o)||dt["Vertical Forms"](o)||dt["Yijing Hexagram Symbols"](o)||dt["Yi Syllables"](o)||dt["Yi Radicals"](o))))}function wp(o){return!(Tc(o)||(i=o,dt["Latin-1 Supplement"](i)&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||dt["General Punctuation"](i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||dt["Letterlike Symbols"](i)||dt["Number Forms"](i)||dt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||dt["Control Pictures"](i)&&9251!==i||dt["Optical Character Recognition"](i)||dt["Enclosed Alphanumerics"](i)||dt["Geometric Shapes"](i)||dt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||dt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||dt["CJK Symbols and Punctuation"](i)||dt.Katakana(i)||dt["Private Use Area"](i)||dt["CJK Compatibility Forms"](i)||dt["Small Form Variants"](i)||dt["Halfwidth and Fullwidth Forms"](i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i}function hm(o){return o>=1424&&o<=2303||dt["Arabic Presentation Forms-A"](o)||dt["Arabic Presentation Forms-B"](o)}function Cp(o,i){return!(!i&&hm(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||dt.Khmer(o))}function Lr(o){for(const i of o)if(hm(i.charCodeAt(0)))return!0;return!1}const zo="deferred",ju="loading",da="loaded";let Zr=null,f="unavailable",a=null;const u=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(f="error"),Zr&&Zr(o)};function g(){v.fire(new La("pluginStateChange",{pluginStatus:f,pluginURL:a}))}const v=new cc,b=function(){return f},I=function(){if(f!==zo||!a)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");f=ju,g(),a&&_l({url:a},o=>{o?u(o):(f=da,g())})},T={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>f===da||null!=T.applyArabicShaping,isLoading:()=>f===ju,setState(o){f=o.pluginStatus,a=o.pluginURL},isParsed:()=>null!=T.applyArabicShaping&&null!=T.processBidirectionalText&&null!=T.processStyledBidirectionalText,getPluginURL:()=>a};class S{constructor(i,s){this.zoom=i,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(i){return function(s,c){for(const d of s)if(!Cp(d.charCodeAt(0),c))return!1;return!0}(i,T.isLoaded())}}class F{constructor(i,s){this.property=i,this.value=s,this.expression=function(c,d){if(Or(c))return new nd(c,d);if(wc(c)){const m=Su(c,d);if("error"===m.result)throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=c;return"string"==typeof c&&"color"===d.type&&(m=Mi.parse(c)),{kind:"constant",evaluate:()=>m}}}(void 0===s?i.specification.default:s,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,s,c){return this.property.possiblyEvaluate(this,i,s,c)}}class O{constructor(i){this.property=i,this.value=new F(i,void 0)}transitioned(i,s){return new $(this.property,this.value,s,Ci({},i.transition,this.transition),i.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class z{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return lo(this._values[i].value.value)}setValue(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new O(this._values[i].property)),this._values[i].value=new F(this._values[i].property,null===s?void 0:lo(s))}getTransition(i){return lo(this._values[i].transition)}setTransition(i,s){this._values.hasOwnProperty(i)||(this._values[i]=new O(this._values[i].property)),this._values[i].transition=lo(s)||void 0}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c);const d=this.getTransition(s);void 0!==d&&(i[`${s}-transition`]=d)}return i}transitioned(i,s){const c=new Q(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].transitioned(i,s._values[d]);return c}untransitioned(){const i=new Q(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].untransitioned();return i}}class ${constructor(i,s,c,d,m){const y=d.delay||0,x=d.duration||0;m=m||0,this.property=i,this.value=s,this.begin=m+y,this.end=this.begin+x,i.specification.transition&&(d.delay||d.duration)&&(this.prior=c)}possiblyEvaluate(i,s,c){const d=i.now||0,m=this.value.possiblyEvaluate(i,s,c),y=this.prior;if(y){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return y.possiblyEvaluate(i,s,c);{const x=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(i,s,c),m,uu(x))}}return m}}class Q{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,s,c){const d=new ee(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(i,s,c);return d}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class K{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return lo(this._values[i].value)}setValue(i,s){this._values[i]=new F(this._values[i].property,null===s?void 0:lo(s))}serialize(){const i={};for(const s of Object.keys(this._values)){const c=this.getValue(s);void 0!==c&&(i[s]=c)}return i}possiblyEvaluate(i,s,c){const d=new ee(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(i,s,c);return d}}class X{constructor(i,s,c){this.property=i,this.value=s,this.parameters=c}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,s,c,d){return this.property.evaluate(this.value,this.parameters,i,s,c,d)}}class ee{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class V{constructor(i){this.specification=i}possiblyEvaluate(i,s){return i.expression.evaluate(s)}interpolate(i,s,c){const d=eo[this.specification.type];return d?d(i,s,c):i}}class W{constructor(i,s){this.specification=i,this.overrides=s}possiblyEvaluate(i,s,c,d){return new X(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(s,null,{},c,d)}:i.expression,s)}interpolate(i,s,c){if("constant"!==i.value.kind||"constant"!==s.value.kind)return i;if(void 0===i.value.value||void 0===s.value.value)return new X(this,{kind:"constant",value:void 0},i.parameters);const d=eo[this.specification.type];return d?new X(this,{kind:"constant",value:d(i.value.value,s.value.value,c)},i.parameters):i}evaluate(i,s,c,d,m,y){return"constant"===i.kind?i.value:i.evaluate(s,c,d,m,y)}}class ne{constructor(i){this.specification=i}possiblyEvaluate(i,s,c,d){return!!i.expression.evaluate(s,null,{},c,d)}interpolate(){return!1}}class te{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new S(0,{});for(const c in i){const d=i[c];d.specification.overridable&&this.overridableProperties.push(c);const m=this.defaultPropertyValues[c]=new F(d,void 0),y=this.defaultTransitionablePropertyValues[c]=new O(d);this.defaultTransitioningPropertyValues[c]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=m.possiblyEvaluate(s)}}}function de(o,i){return 256*(o=cn(Math.floor(o),0,255))+cn(Math.floor(i),0,255)}Ae(W,"DataDrivenProperty"),Ae(V,"DataConstantProperty"),Ae(ne,"ColorRampProperty");const fe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class pe{constructor(i,s){this._structArray=i,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ye{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,s){return i._trim(),s&&(i.isTransferred=!0,s.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const s=Object.create(this.prototype);return s.arrayBuffer=i.arrayBuffer,s.length=i.length,s.capacity=i.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function _e(o,i=1){let s=0,c=0;return{members:o.map(d=>{const m=fe[d.type].BYTES_PER_ELEMENT,y=s=Me(s,Math.max(i,m)),x=d.components||1;return c=Math.max(c,m),s+=m*x,{name:d.name,type:d.type,components:x,offset:y}}),size:Me(s,Math.max(c,i)),alignment:i}}function Me(o,i){return Math.ceil(o/i)*i}class We extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const d=2*i;return this.int16[d+0]=s,this.int16[d+1]=c,i}}We.prototype.bytesPerElement=4,Ae(We,"StructArrayLayout2i4");class Ee extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,c)}emplace(i,s,c,d){const m=3*i;return this.int16[m+0]=s,this.int16[m+1]=c,this.int16[m+2]=d,i}}Ee.prototype.bytesPerElement=6,Ae(Ee,"StructArrayLayout3i6");class Be extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,d)}emplace(i,s,c,d,m){const y=4*i;return this.int16[y+0]=s,this.int16[y+1]=c,this.int16[y+2]=d,this.int16[y+3]=m,i}}Be.prototype.bytesPerElement=8,Ae(Be,"StructArrayLayout4i8");class De extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,d,m,y,x)}emplace(i,s,c,d,m,y,x,w){const E=6*i,D=12*i,k=3*i;return this.int16[E+0]=s,this.int16[E+1]=c,this.uint8[D+4]=d,this.uint8[D+5]=m,this.uint8[D+6]=y,this.uint8[D+7]=x,this.float32[k+2]=w,i}}De.prototype.bytesPerElement=12,Ae(De,"StructArrayLayout2i4ub1f12");class Ze extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,d)}emplace(i,s,c,d,m){const y=4*i;return this.float32[y+0]=s,this.float32[y+1]=c,this.float32[y+2]=d,this.float32[y+3]=m,i}}Ze.prototype.bytesPerElement=16,Ae(Ze,"StructArrayLayout4f16");class Ie extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,c,d,m)}emplace(i,s,c,d,m,y){const x=6*i,w=3*i;return this.uint16[x+0]=s,this.uint16[x+1]=c,this.uint16[x+2]=d,this.uint16[x+3]=m,this.float32[w+2]=y,i}}Ie.prototype.bytesPerElement=12,Ae(Ie,"StructArrayLayout4ui1f12");class Fe extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,d)}emplace(i,s,c,d,m){const y=4*i;return this.uint16[y+0]=s,this.uint16[y+1]=c,this.uint16[y+2]=d,this.uint16[y+3]=m,i}}Fe.prototype.bytesPerElement=8,Ae(Fe,"StructArrayLayout4ui8");class Qe extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,d,m,y)}emplace(i,s,c,d,m,y,x){const w=6*i;return this.int16[w+0]=s,this.int16[w+1]=c,this.int16[w+2]=d,this.int16[w+3]=m,this.int16[w+4]=y,this.int16[w+5]=x,i}}Qe.prototype.bytesPerElement=12,Ae(Qe,"StructArrayLayout6i12");class Ue extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x,w,E,D,k,R){const L=this.length;return this.resize(L+1),this.emplace(L,i,s,c,d,m,y,x,w,E,D,k,R)}emplace(i,s,c,d,m,y,x,w,E,D,k,R,L){const N=12*i;return this.int16[N+0]=s,this.int16[N+1]=c,this.int16[N+2]=d,this.int16[N+3]=m,this.uint16[N+4]=y,this.uint16[N+5]=x,this.uint16[N+6]=w,this.uint16[N+7]=E,this.int16[N+8]=D,this.int16[N+9]=k,this.int16[N+10]=R,this.int16[N+11]=L,i}}Ue.prototype.bytesPerElement=24,Ae(Ue,"StructArrayLayout4i4ui4i24");class et extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y){const x=this.length;return this.resize(x+1),this.emplace(x,i,s,c,d,m,y)}emplace(i,s,c,d,m,y,x){const w=10*i,E=5*i;return this.int16[w+0]=s,this.int16[w+1]=c,this.int16[w+2]=d,this.float32[E+2]=m,this.float32[E+3]=y,this.float32[E+4]=x,i}}et.prototype.bytesPerElement=20,Ae(et,"StructArrayLayout3i3f20");class Ct extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint32[1*i+0]=s,i}}Ct.prototype.bytesPerElement=4,Ae(Ct,"StructArrayLayout1ul4");class Nt extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x,w,E,D,k,R,L){const N=this.length;return this.resize(N+1),this.emplace(N,i,s,c,d,m,y,x,w,E,D,k,R,L)}emplace(i,s,c,d,m,y,x,w,E,D,k,R,L,N){const j=20*i,q=10*i;return this.int16[j+0]=s,this.int16[j+1]=c,this.int16[j+2]=d,this.int16[j+3]=m,this.int16[j+4]=y,this.float32[q+3]=x,this.float32[q+4]=w,this.float32[q+5]=E,this.float32[q+6]=D,this.int16[j+14]=k,this.uint32[q+8]=R,this.uint16[j+18]=L,this.uint16[j+19]=N,i}}Nt.prototype.bytesPerElement=40,Ae(Nt,"StructArrayLayout5i4f1i1ul2ui40");class _t extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,s,c,d,m,y,x)}emplace(i,s,c,d,m,y,x,w){const E=8*i;return this.int16[E+0]=s,this.int16[E+1]=c,this.int16[E+2]=d,this.int16[E+4]=m,this.int16[E+5]=y,this.int16[E+6]=x,this.int16[E+7]=w,i}}_t.prototype.bytesPerElement=16,Ae(_t,"StructArrayLayout3i2i2i16");class Dt extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,c,d,m)}emplace(i,s,c,d,m,y){const x=4*i,w=8*i;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=d,this.int16[w+6]=m,this.int16[w+7]=y,i}}Dt.prototype.bytesPerElement=16,Ae(Dt,"StructArrayLayout2f1f2i16");class hn extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,d)}emplace(i,s,c,d,m){const y=12*i,x=3*i;return this.uint8[y+0]=s,this.uint8[y+1]=c,this.float32[x+1]=d,this.float32[x+2]=m,i}}hn.prototype.bytesPerElement=12,Ae(hn,"StructArrayLayout2ub2f12");class ln extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,c)}emplace(i,s,c,d){const m=3*i;return this.float32[m+0]=s,this.float32[m+1]=c,this.float32[m+2]=d,i}}ln.prototype.bytesPerElement=12,Ae(ln,"StructArrayLayout3f12");class wt extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,i,s,c)}emplace(i,s,c,d){const m=3*i;return this.uint16[m+0]=s,this.uint16[m+1]=c,this.uint16[m+2]=d,i}}wt.prototype.bytesPerElement=6,Ae(wt,"StructArrayLayout3ui6");class Dn extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce){const le=this.length;return this.resize(le+1),this.emplace(le,i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce)}emplace(i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce,le){const xe=30*i,we=15*i,Re=60*i;return this.int16[xe+0]=s,this.int16[xe+1]=c,this.int16[xe+2]=d,this.float32[we+2]=m,this.float32[we+3]=y,this.uint16[xe+8]=x,this.uint16[xe+9]=w,this.uint32[we+5]=E,this.uint32[we+6]=D,this.uint32[we+7]=k,this.uint16[xe+16]=R,this.uint16[xe+17]=L,this.uint16[xe+18]=N,this.float32[we+10]=j,this.float32[we+11]=q,this.uint8[Re+48]=J,this.uint8[Re+49]=se,this.uint8[Re+50]=Y,this.uint32[we+13]=oe,this.int16[xe+28]=ce,this.uint8[Re+58]=le,i}}Dn.prototype.bytesPerElement=60,Ae(Dn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Vn extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce,le,xe,we,Re,$e,Te,Ne,ze,Ge){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce,le,xe,we,Re,$e,Te,Ne,ze,Ge)}emplace(i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q,J,se,Y,oe,ce,le,xe,we,Re,$e,Te,Ne,ze,Ge,Xe){const Pe=38*i,lt=19*i;return this.int16[Pe+0]=s,this.int16[Pe+1]=c,this.int16[Pe+2]=d,this.float32[lt+2]=m,this.float32[lt+3]=y,this.int16[Pe+8]=x,this.int16[Pe+9]=w,this.int16[Pe+10]=E,this.int16[Pe+11]=D,this.int16[Pe+12]=k,this.int16[Pe+13]=R,this.uint16[Pe+14]=L,this.uint16[Pe+15]=N,this.uint16[Pe+16]=j,this.uint16[Pe+17]=q,this.uint16[Pe+18]=J,this.uint16[Pe+19]=se,this.uint16[Pe+20]=Y,this.uint16[Pe+21]=oe,this.uint16[Pe+22]=ce,this.uint16[Pe+23]=le,this.uint16[Pe+24]=xe,this.uint16[Pe+25]=we,this.uint16[Pe+26]=Re,this.uint16[Pe+27]=$e,this.uint16[Pe+28]=Te,this.uint32[lt+15]=Ne,this.float32[lt+16]=ze,this.float32[lt+17]=Ge,this.float32[lt+18]=Xe,i}}Vn.prototype.bytesPerElement=76,Ae(Vn,"StructArrayLayout3i2f6i15ui1ul3f76");class Sn extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.float32[1*i+0]=s,i}}Sn.prototype.bytesPerElement=4,Ae(Sn,"StructArrayLayout1f4");class jn extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s,c,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,i,s,c,d,m)}emplace(i,s,c,d,m,y){const x=5*i;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=d,this.float32[x+3]=m,this.float32[x+4]=y,i}}jn.prototype.bytesPerElement=20,Ae(jn,"StructArrayLayout5f20");class or extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,i,s,c,d)}emplace(i,s,c,d,m){const y=6*i;return this.uint32[3*i+0]=s,this.uint16[y+2]=c,this.uint16[y+3]=d,this.uint16[y+4]=m,i}}or.prototype.bytesPerElement=12,Ae(or,"StructArrayLayout1ul3ui12");class Ti extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const d=2*i;return this.uint16[d+0]=s,this.uint16[d+1]=c,i}}Ti.prototype.bytesPerElement=4,Ae(Ti,"StructArrayLayout2ui4");class mo extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const s=this.length;return this.resize(s+1),this.emplace(s,i)}emplace(i,s){return this.uint16[1*i+0]=s,i}}mo.prototype.bytesPerElement=2,Ae(mo,"StructArrayLayout1ui2");class to extends ye{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,s){const c=this.length;return this.resize(c+1),this.emplace(c,i,s)}emplace(i,s,c){const d=2*i;return this.float32[d+0]=s,this.float32[d+1]=c,i}}to.prototype.bytesPerElement=8,Ae(to,"StructArrayLayout2f8");class Xn extends pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xn.prototype.size=40;class Fn extends Nt{get(i){return new Xn(this,i)}}Ae(Fn,"CollisionBoxArray");class kn extends pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}kn.prototype.size=60;class xi extends Dn{get(i){return new kn(this,i)}}Ae(xi,"PlacedSymbolArray");class br extends pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}br.prototype.size=76;class ti extends Vn{get(i){return new br(this,i)}}Ae(ti,"SymbolInstanceArray");class mi extends Sn{getoffsetX(i){return this.float32[1*i+0]}}Ae(mi,"GlyphOffsetArray");class Uu extends We{getx(i){return this.int16[2*i+0]}gety(i){return this.int16[2*i+1]}}Ae(Uu,"SymbolLineVertexArray");class hs extends pe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hs.prototype.size=12;class $a extends or{get(i){return new hs(this,i)}}Ae($a,"FeatureIndexArray");class ds extends Ti{geta_centroid_pos0(i){return this.uint16[2*i+0]}geta_centroid_pos1(i){return this.uint16[2*i+1]}}Ae(ds,"FillExtrusionCentroidArray");const ps=_e([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Rs=_e([{name:"a_dash",components:4,type:"Uint16"}]);var Gu={exports:{}},pm=function(o,i){var s,c,d,m,y,x,w,E;for(c=o.length-(s=3&o.length),d=i,y=3432918353,x=461845907,E=0;E<c;)w=255&o.charCodeAt(E)|(255&o.charCodeAt(++E))<<8|(255&o.charCodeAt(++E))<<16|(255&o.charCodeAt(++E))<<24,++E,d=27492+(65535&(m=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(w=0,s){case 3:w^=(255&o.charCodeAt(E+2))<<16;case 2:w^=(255&o.charCodeAt(E+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&o.charCodeAt(E)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return d^=o.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0},HA=function(o,i){for(var s,c=o.length,d=i^c,m=0;c>=4;)s=1540483477*(65535&(s=255&o.charCodeAt(m)|(255&o.charCodeAt(++m))<<8|(255&o.charCodeAt(++m))<<16|(255&o.charCodeAt(++m))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:d^=(255&o.charCodeAt(m+2))<<16;case 2:d^=(255&o.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&o.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};Gu.exports=pm,Gu.exports.murmur3=pm,Gu.exports.murmur2=HA;var $u=Xr(Gu.exports);class pa{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,s,c,d){this.ids.push(G_(i)),this.positions.push(s,c,d)}getPositions(i){const s=G_(i);let c=0,d=this.ids.length-1;for(;c<d;){const y=c+d>>1;this.ids[y]>=s?d=y:c=y+1}const m=[];for(;this.ids[c]===s;)m.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return m}static serialize(i,s){const c=new Float64Array(i.ids),d=new Uint32Array(i.positions);return Ep(c,d,0,c.length-1),s&&s.push(c.buffer,d.buffer),{ids:c,positions:d}}static deserialize(i){const s=new pa;return s.ids=i.ids,s.positions=i.positions,s.indexed=!0,s}}function G_(o){const i=+o;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:$u(String(o))}function Ep(o,i,s,c){for(;s<c;){const d=o[s+c>>1];let m=s-1,y=c+1;for(;;){do{m++}while(o[m]<d);do{y--}while(o[y]>d);if(m>=y)break;ud(o,m,y),ud(i,3*m,3*y),ud(i,3*m+1,3*y+1),ud(i,3*m+2,3*y+2)}y-s<c-y?(Ep(o,i,s,y),s=y+1):(Ep(o,i,y+1,c),c=y)}}function ud(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}Ae(pa,"FeaturePositionMap");class go{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,s),this.initialized=!0),!!this.location}}class Ip extends go{constructor(i){super(i),this.current=0}set(i,s,c){this.fetchUniformLocation(i,s)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class wr extends go{constructor(i){super(i),this.current=[0,0,0,0]}set(i,s,c){this.fetchUniformLocation(i,s)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class Mp extends go{constructor(i){super(i),this.current=Mi.transparent}set(i,s,c){this.fetchUniformLocation(i,s)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const $A=new Float32Array(16),H_=new Float32Array(9),Tp=new Float32Array(4);function Fl(o){return[de(255*o.r,255*o.g),de(255*o.b,255*o.a)]}class fa{constructor(i,s,c){this.value=i,this.uniformNames=s.map(d=>`u_${d}`),this.type=c}setUniform(i,s,c,d,m){s.set(i,m,d.constantOr(this.value))}getBinding(i,s){return"color"===this.type?new Mp(i):new Ip(i)}}class Os{constructor(i,s){this.uniformNames=s.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(i){this.pixelRatio=i.pixelRatio||1,this.pattern=i.tl.concat(i.br)}setUniform(i,s,c,d,m){const y="u_pattern"===m||"u_dash"===m?this.pattern:"u_pixel_ratio"===m?this.pixelRatio:null;y&&s.set(i,m,y)}getBinding(i,s){return"u_pattern"===s||"u_dash"===s?new wr(i):new Ip(i)}}class ma{constructor(i,s,c,d){this.expression=i,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===c?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(i,s,c,d,m,y){const x=this.paintVertexArray.length,w=this.expression.evaluate(new S(0),s,{},m,d,y);this.paintVertexArray.resize(i),this._setPaintValue(x,i,w)}updatePaintArray(i,s,c,d,m){const y=this.expression.evaluate({zoom:0},c,d,void 0,m);this._setPaintValue(i,s,y)}_setPaintValue(i,s,c){if("color"===this.type){const d=Fl(c);for(let m=i;m<s;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=i;d<s;d++)this.paintVertexArray.emplace(d,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vo{constructor(i,s,c,d,m,y){this.expression=i,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===c?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(i,s,c,d,m,y){const x=this.expression.evaluate(new S(this.zoom),s,{},m,d,y),w=this.expression.evaluate(new S(this.zoom+1),s,{},m,d,y),E=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(E,i,x,w)}updatePaintArray(i,s,c,d,m){const y=this.expression.evaluate({zoom:this.zoom},c,d,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},c,d,void 0,m);this._setPaintValue(i,s,y,x)}_setPaintValue(i,s,c,d){if("color"===this.type){const m=Fl(c),y=Fl(d);for(let x=i;x<s;x++)this.paintVertexArray.emplace(x,m[0],m[1],y[0],y[1])}else{for(let m=i;m<s;m++)this.paintVertexArray.emplace(m,c,d);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(d))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,s,c,d,m){const y=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,x=cn(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);s.set(i,m,x)}getBinding(i,s){return new Ip(i)}}class jo{constructor(i,s,c,d,m){this.expression=i,this.layerId=m,this.paintVertexAttributes=("array"===c?Rs:ps).members;for(let y=0;y<s.length;++y);this.paintVertexArray=new d}populatePaintArray(i,s,c){const d=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValues(d,i,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(i,s,c,d,m,y){this._setPaintValues(i,s,c.patterns&&c.patterns[this.layerId],y)}_setPaintValues(i,s,c,d){if(!d||!c)return;const m=d[c];if(!m)return;const{tl:y,br:x,pixelRatio:w}=m;for(let E=i;E<s;E++)this.paintVertexArray.emplace(E,y[0],y[1],x[0],x[1],w)}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Dc{constructor(i,s,c=(()=>!0)){this.binders={},this._buffers=[];const d=[];for(const m in i.paint._values){if(!c(m))continue;const y=i.paint.get(m);if(!(y instanceof X&&Fo(y.property.specification)))continue;const x=vw(m,i.type),w=y.value,E=y.property.specification.type,D=!!y.property.useIntegerZoom,k="line-dasharray"===m||m.endsWith("pattern"),R="line-dasharray"===m&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==w.kind||R)if("source"===w.kind||R||k){const L=qA(m,E,"source");this.binders[m]=k?new jo(w,x,E,L,i.id):new ma(w,x,E,L),d.push(`/a_${m}`)}else{const L=qA(m,E,"composite");this.binders[m]=new Vo(w,x,E,D,s,L),d.push(`/z_${m}`)}else this.binders[m]=k?new Os(w.value,x):new fa(w.value,x,E),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(i){const s=this.binders[i];return s instanceof ma||s instanceof Vo?s.maxValue:0}populatePaintArrays(i,s,c,d,m,y){for(const x in this.binders){const w=this.binders[x];(w instanceof ma||w instanceof Vo||w instanceof jo)&&w.populatePaintArray(i,s,c,d,m,y)}}setConstantPatternPositions(i){for(const s in this.binders){const c=this.binders[s];c instanceof Os&&c.setConstantPatternPositions(i)}}updatePaintArrays(i,s,c,d,m,y){let x=!1;for(const w in i){const E=s.getPositions(w);for(const D of E){const k=c.feature(D.index);for(const R in this.binders){const L=this.binders[R];if((L instanceof ma||L instanceof Vo||L instanceof jo)&&!0===L.expression.isStateDependent){const N=d.paint.get(R);L.expression=N.value,L.updatePaintArray(D.start,D.end,k,i[w],m,y),x=!0}}}}return x}defines(){const i=[];for(const s in this.binders){const c=this.binders[s];(c instanceof fa||c instanceof Os)&&i.push(...c.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return i}getBinderAttributes(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof ma||c instanceof Vo||c instanceof jo)for(let d=0;d<c.paintVertexAttributes.length;d++)i.push(c.paintVertexAttributes[d].name)}return i}getBinderUniforms(){const i=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof fa||c instanceof Os||c instanceof Vo)for(const d of c.uniformNames)i.push(d)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const s=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof fa||d instanceof Os||d instanceof Vo)for(const m of d.uniformNames)s.push({name:m,property:c,binding:d.getBinding(i,m)})}return s}setUniforms(i,s,c,d,m){for(const{name:y,property:x,binding:w}of c)this.binders[x].setUniform(i,w,m,d.get(x),y)}updatePaintBuffers(){this._buffers=[];for(const i in this.binders){const s=this.binders[i];(s instanceof ma||s instanceof Vo||s instanceof jo)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const s in this.binders){const c=this.binders[s];(c instanceof ma||c instanceof Vo||c instanceof jo)&&c.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const s=this.binders[i];(s instanceof ma||s instanceof Vo||s instanceof jo)&&s.destroy()}}}class Sc{constructor(i,s,c=(()=>!0)){this.programConfigurations={};for(const d of i)this.programConfigurations[d.id]=new Dc(d,s,c);this.needsUpload=!1,this._featureMap=new pa,this._bufferOffset=0}populatePaintArrays(i,s,c,d,m,y,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,s,d,m,y,x);void 0!==s.id&&this._featureMap.add(s.id,c,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,s,c,d,m){for(const y of c)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(i,this._featureMap,s,y,d,m)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const vt={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function vw(o,i){return vt[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}const Aw={"line-pattern":{source:Ie,composite:Ie},"fill-pattern":{source:Ie,composite:Ie},"fill-extrusion-pattern":{source:Ie,composite:Ie},"line-dasharray":{source:Fe,composite:Fe}},xw={color:{source:to,composite:Ze},number:{source:Sn,composite:to}};function qA(o,i,s){const c=Aw[o];return c&&c[s]||xw[i][s]}Ae(fa,"ConstantBinder"),Ae(Os,"PatternConstantBinder"),Ae(ma,"SourceExpressionBinder"),Ae(jo,"PatternCompositeBinder"),Ae(Vo,"CompositeExpressionBinder"),Ae(Dc,"ProgramConfiguration",{omit:["_buffers"]}),Ae(Sc,"ProgramConfigurationSet");const WA="-transition";class ga extends cc{constructor(i,s){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),s.layout&&(this._unevaluatedLayout=new K(s.layout)),s.paint)){this._transitionablePaint=new z(s.paint);for(const c in i.paint)this.setPaintProperty(c,i.paint[c],{validate:!1});for(const c in i.layout)this.setLayoutProperty(c,i.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ee(s.paint)}}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,s,c={}){null!=s&&this._validate(xp,`layers.${this.id}.layout.${i}`,i,s,c)||("visibility"!==i?this._unevaluatedLayout.setValue(i,s):this.visibility=s)}getPaintProperty(i){return pl(i,WA)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,s,c={}){if(null!=s&&this._validate(rn,`layers.${this.id}.paint.${i}`,i,s,c))return!1;if(pl(i,WA))return this._transitionablePaint.setTransition(i.slice(0,-11),s||void 0),!1;{const d=this._transitionablePaint._values[i],m=d.value.isDataDriven(),y=d.value;this._transitionablePaint.setValue(i,s),this._handleSpecialPaintPropertyUpdate(i);const x=this._transitionablePaint._values[i].value,w=x.isDataDriven(),E=pl(i,"pattern")||"line-dasharray"===i;return w||m||E||this._handleOverridablePaintPropertyUpdate(i,y,x)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,s,c){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,s)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ea(i,(s,c)=>!(void 0===s||"layout"===c&&!Object.keys(s).length||"paint"===c&&!Object.keys(s).length))}_validate(i,s,c,d,m={}){return(!m||!1!==m.validate)&&bp(this,i.call(Nu,{key:s,layerType:this.type,objectKey:c,value:d,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const s=this.paint.get(i);if(s instanceof X&&Fo(s.property.specification)&&("source"===s.value.kind||"composite"===s.value.kind)&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=od(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const bw=_e([{name:"a_pos",components:2,type:"Int16"}],4),hd=_e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Oi{constructor(i=[]){this.segments=i}prepareSegment(i,s,c,d){let m=this.segments[this.segments.length-1];return i>Oi.MAX_VERTEX_ARRAY_LENGTH&&li(`Max vertices per segment is ${Oi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!m||m.vertexLength+i>Oi.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},void 0!==d&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const i of this.segments)for(const s in i.vaos)i.vaos[s].destroy()}static simpleSegment(i,s,c,d){return new Oi([{vertexOffset:i,primitiveOffset:s,vertexLength:c,primitiveLength:d,vaos:{},sortKey:0}])}}Oi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ae(Oi,"SegmentVector");var Tt=8192;class ui{constructor(i,s){i&&(s?this.setSouthWest(i).setNorthEast(s):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Pn?new Pn(i.lng,i.lat):Pn.convert(i),this}setSouthWest(i){return this._sw=i instanceof Pn?new Pn(i.lng,i.lat):Pn.convert(i),this}extend(i){const s=this._sw,c=this._ne;let d,m;if(i instanceof Pn)d=i,m=i;else{if(!(i instanceof ui))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(ui.convert(i)):this.extend(Pn.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&(i.hasOwnProperty("lon")||i.hasOwnProperty("lng"))?this.extend(Pn.convert(i)):this;if(d=i._sw,m=i._ne,!d||!m)return this}return s||c?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),c.lng=Math.max(m.lng,c.lng),c.lat=Math.max(m.lat,c.lat)):(this._sw=new Pn(d.lng,d.lat),this._ne=new Pn(m.lng,m.lat)),this}getCenter(){return new Pn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Pn(this.getWest(),this.getNorth())}getSouthEast(){return new Pn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:s,lat:c}=Pn.convert(i);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(i){return!i||i instanceof ui?i:new ui(i)}}var qu=1e-6,Cr=typeof Float32Array<"u"?Float32Array:Array;function $_(){var o=new Cr(9);return Cr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Uo(o,i,s){var c=i[0],d=i[1],m=i[2],y=i[3],x=i[4],w=i[5],E=i[6],D=i[7],k=i[8],R=s[0],L=s[1],N=s[2],j=s[3],q=s[4],J=s[5],se=s[6],Y=s[7],oe=s[8];return o[0]=R*c+L*y+N*E,o[1]=R*d+L*x+N*D,o[2]=R*m+L*w+N*k,o[3]=j*c+q*y+J*E,o[4]=j*d+q*x+J*D,o[5]=j*m+q*w+J*k,o[6]=se*c+Y*y+oe*E,o[7]=se*d+Y*x+oe*D,o[8]=se*m+Y*w+oe*k,o}function Br(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Dp(o,i){var s=i[0],c=i[1],d=i[2],m=i[3],y=i[4],x=i[5],w=i[6],E=i[7],D=i[8],k=i[9],R=i[10],L=i[11],N=i[12],j=i[13],q=i[14],J=i[15],se=s*x-c*y,Y=s*w-d*y,oe=s*E-m*y,ce=c*w-d*x,le=c*E-m*x,xe=d*E-m*w,we=D*j-k*N,Re=D*q-R*N,$e=D*J-L*N,Te=k*q-R*j,Ne=k*J-L*j,ze=R*J-L*q,Ge=se*ze-Y*Ne+oe*Te+ce*$e-le*Re+xe*we;return Ge?(o[0]=(x*ze-w*Ne+E*Te)*(Ge=1/Ge),o[1]=(d*Ne-c*ze-m*Te)*Ge,o[2]=(j*xe-q*le+J*ce)*Ge,o[3]=(R*le-k*xe-L*ce)*Ge,o[4]=(w*$e-y*ze-E*Re)*Ge,o[5]=(s*ze-d*$e+m*Re)*Ge,o[6]=(q*oe-N*xe-J*Y)*Ge,o[7]=(D*xe-R*oe+L*Y)*Ge,o[8]=(y*Ne-x*$e+E*we)*Ge,o[9]=(c*$e-s*Ne-m*we)*Ge,o[10]=(N*le-j*oe+J*se)*Ge,o[11]=(k*oe-D*le-L*se)*Ge,o[12]=(x*Re-y*Te-w*we)*Ge,o[13]=(s*Te-c*Re+d*we)*Ge,o[14]=(j*Y-N*ce-q*se)*Ge,o[15]=(D*ce-k*Y+R*se)*Ge,o):null}function _a(o,i,s){var c=i[0],d=i[1],m=i[2],y=i[3],x=i[4],w=i[5],E=i[6],D=i[7],k=i[8],R=i[9],L=i[10],N=i[11],j=i[12],q=i[13],J=i[14],se=i[15],Y=s[0],oe=s[1],ce=s[2],le=s[3];return o[0]=Y*c+oe*x+ce*k+le*j,o[1]=Y*d+oe*w+ce*R+le*q,o[2]=Y*m+oe*E+ce*L+le*J,o[3]=Y*y+oe*D+ce*N+le*se,o[4]=(Y=s[4])*c+(oe=s[5])*x+(ce=s[6])*k+(le=s[7])*j,o[5]=Y*d+oe*w+ce*R+le*q,o[6]=Y*m+oe*E+ce*L+le*J,o[7]=Y*y+oe*D+ce*N+le*se,o[8]=(Y=s[8])*c+(oe=s[9])*x+(ce=s[10])*k+(le=s[11])*j,o[9]=Y*d+oe*w+ce*R+le*q,o[10]=Y*m+oe*E+ce*L+le*J,o[11]=Y*y+oe*D+ce*N+le*se,o[12]=(Y=s[12])*c+(oe=s[13])*x+(ce=s[14])*k+(le=s[15])*j,o[13]=Y*d+oe*w+ce*R+le*q,o[14]=Y*m+oe*E+ce*L+le*J,o[15]=Y*y+oe*D+ce*N+le*se,o}function qa(o,i,s){var c,d,m,y,x,w,E,D,k,R,L,N,j=s[0],q=s[1],J=s[2];return i===o?(o[12]=i[0]*j+i[4]*q+i[8]*J+i[12],o[13]=i[1]*j+i[5]*q+i[9]*J+i[13],o[14]=i[2]*j+i[6]*q+i[10]*J+i[14],o[15]=i[3]*j+i[7]*q+i[11]*J+i[15]):(d=i[1],m=i[2],y=i[3],x=i[4],w=i[5],E=i[6],D=i[7],k=i[8],R=i[9],L=i[10],N=i[11],o[0]=c=i[0],o[1]=d,o[2]=m,o[3]=y,o[4]=x,o[5]=w,o[6]=E,o[7]=D,o[8]=k,o[9]=R,o[10]=L,o[11]=N,o[12]=c*j+x*q+k*J+i[12],o[13]=d*j+w*q+R*J+i[13],o[14]=m*j+E*q+L*J+i[14],o[15]=y*j+D*q+N*J+i[15]),o}function kc(o,i,s){var c=s[0],d=s[1],m=s[2];return o[0]=i[0]*c,o[1]=i[1]*c,o[2]=i[2]*c,o[3]=i[3]*c,o[4]=i[4]*d,o[5]=i[5]*d,o[6]=i[6]*d,o[7]=i[7]*d,o[8]=i[8]*m,o[9]=i[9]*m,o[10]=i[10]*m,o[11]=i[11]*m,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o}function q_(o,i,s){var c=Math.sin(s),d=Math.cos(s),m=i[4],y=i[5],x=i[6],w=i[7],E=i[8],D=i[9],k=i[10],R=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=m*d+E*c,o[5]=y*d+D*c,o[6]=x*d+k*c,o[7]=w*d+R*c,o[8]=E*d-m*c,o[9]=D*d-y*c,o[10]=k*d-x*c,o[11]=R*d-w*c,o}function Sp(o,i,s){var c=Math.sin(s),d=Math.cos(s),m=i[0],y=i[1],x=i[2],w=i[3],E=i[8],D=i[9],k=i[10],R=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=m*d-E*c,o[1]=y*d-D*c,o[2]=x*d-k*c,o[3]=w*d-R*c,o[8]=m*c+E*d,o[9]=y*c+D*d,o[10]=x*c+k*d,o[11]=w*c+R*d,o}function ZA(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function _o(o,i,s){var c,d,m,y=s[0],x=s[1],w=s[2],E=Math.hypot(y,x,w);return E<qu?null:(y*=E=1/E,x*=E,w*=E,c=Math.sin(i),d=Math.cos(i),o[0]=y*y*(m=1-d)+d,o[1]=x*y*m+w*c,o[2]=w*y*m-x*c,o[3]=0,o[4]=y*x*m-w*c,o[5]=x*x*m+d,o[6]=w*x*m+y*c,o[7]=0,o[8]=y*w*m+x*c,o[9]=x*w*m-y*c,o[10]=w*w*m+d,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var fm=_a;function Ll(){var o=new Cr(3);return Cr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function QA(o){var i=new Cr(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i}function Wu(o){return Math.hypot(o[0],o[1],o[2])}function Zu(o,i,s){var c=new Cr(3);return c[0]=o,c[1]=i,c[2]=s,c}function Wa(o,i,s){return o[0]=i[0]+s[0],o[1]=i[1]+s[1],o[2]=i[2]+s[2],o}function mm(o,i,s){return o[0]=i[0]-s[0],o[1]=i[1]-s[1],o[2]=i[2]-s[2],o}function W_(o,i,s){return o[0]=i[0]*s[0],o[1]=i[1]*s[1],o[2]=i[2]*s[2],o}function dd(o,i,s){return o[0]=Math.min(i[0],s[0]),o[1]=Math.min(i[1],s[1]),o[2]=Math.min(i[2],s[2]),o}function pd(o,i,s){return o[0]=Math.max(i[0],s[0]),o[1]=Math.max(i[1],s[1]),o[2]=Math.max(i[2],s[2]),o}function no(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o}function Bl(o,i,s,c){return o[0]=i[0]+s[0]*c,o[1]=i[1]+s[1]*c,o[2]=i[2]+s[2]*c,o}function Er(o,i){var s=i[0],c=i[1],d=i[2],m=s*s+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),o[0]=i[0]*m,o[1]=i[1]*m,o[2]=i[2]*m,o}function sr(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]}function kp(o,i,s){var c=i[0],d=i[1],m=i[2],y=s[0],x=s[1],w=s[2];return o[0]=d*w-m*x,o[1]=m*y-c*w,o[2]=c*x-d*y,o}function ni(o,i,s){var c=i[0],d=i[1],m=i[2],y=s[3]*c+s[7]*d+s[11]*m+s[15];return o[0]=(s[0]*c+s[4]*d+s[8]*m+s[12])/(y=y||1),o[1]=(s[1]*c+s[5]*d+s[9]*m+s[13])/y,o[2]=(s[2]*c+s[6]*d+s[10]*m+s[14])/y,o}function Z_(o,i,s){var c=s[0],d=s[1],m=s[2],y=i[0],x=i[1],w=i[2],E=d*w-m*x,D=m*y-c*w,k=c*x-d*y,R=d*k-m*D,L=m*E-c*k,N=c*D-d*E,j=2*s[3];return D*=j,k*=j,L*=2,N*=2,o[0]=y+(E*=j)+(R*=2),o[1]=x+D+L,o[2]=w+k+N,o}var Qu,io=mm,Pp=W_,Q_=Wu;function X_(o,i,s){return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o}function K_(o,i){var s=i[0],c=i[1],d=i[2],m=i[3],y=s*s+c*c+d*d+m*m;return y>0&&(y=1/Math.sqrt(y)),o[0]=s*y,o[1]=c*y,o[2]=d*y,o[3]=m*y,o}function fs(o,i,s){var c=i[0],d=i[1],m=i[2],y=i[3];return o[0]=s[0]*c+s[4]*d+s[8]*m+s[12]*y,o[1]=s[1]*c+s[5]*d+s[9]*m+s[13]*y,o[2]=s[2]*c+s[6]*d+s[10]*m+s[14]*y,o[3]=s[3]*c+s[7]*d+s[11]*m+s[15]*y,o}function Xu(){var o=new Cr(4);return Cr!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function Y_(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function XA(o,i,s){s*=.5;var c=i[0],d=i[1],m=i[2],y=i[3],x=Math.sin(s),w=Math.cos(s);return o[0]=c*w+y*x,o[1]=d*w+m*x,o[2]=m*w-d*x,o[3]=y*w-c*x,o}function gm(o,i,s){s*=.5;var c=i[0],d=i[1],m=i[2],y=i[3],x=Math.sin(s),w=Math.cos(s);return o[0]=c*w-m*x,o[1]=d*w+y*x,o[2]=m*w+c*x,o[3]=y*w-d*x,o}Ll(),Qu=new Cr(4),Cr!=Float32Array&&(Qu[0]=0,Qu[1]=0,Qu[2]=0,Qu[3]=0);var KA=K_;Ll(),Zu(1,0,0),Zu(0,1,0),Xu(),Xu(),$_();const ww=_e([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:J_}=ww,ey=_e([{name:"a_pos_3",components:3,type:"Int16"}]);var fd=_e([{name:"a_pos",type:"Int16",components:2}]);class Ku{constructor(i,s){this.pos=i,this.dir=s}intersectsPlane(i,s,c){const d=sr(s,this.dir);if(Math.abs(d)<1e-6)return!1;const m=((i[0]-this.pos[0])*s[0]+(i[1]-this.pos[1])*s[1]+(i[2]-this.pos[2])*s[2])/d;return c[0]=this.pos[0]+this.dir[0]*m,c[1]=this.pos[1]+this.dir[1]*m,c[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(i,s,c){if(j=(L=this.pos)[0],q=L[1],J=L[2],se=(N=i)[0],Y=N[1],oe=N[2],Math.abs(j-se)<=qu*Math.max(1,Math.abs(j),Math.abs(se))&&Math.abs(q-Y)<=qu*Math.max(1,Math.abs(q),Math.abs(Y))&&Math.abs(J-oe)<=qu*Math.max(1,Math.abs(J),Math.abs(oe))||0===s)return c[0]=c[1]=c[2]=0,!1;var L,N,j,q,J,se,Y,oe;const[d,m,y]=this.dir,x=this.pos[0]-i[0],w=this.pos[1]-i[1],E=this.pos[2]-i[2],D=d*d+m*m+y*y,k=2*(x*d+w*m+E*y),R=k*k-4*D*(x*x+w*w+E*E-s*s);if(R<0){const L=Math.max(-k/2,0),N=x+d*L,j=w+m*L,q=E+y*L,J=Math.hypot(N,j,q);return c[0]=N*s/J,c[1]=j*s/J,c[2]=q*s/J,!1}{const L=(-k-Math.sqrt(R))/(2*D);if(L<0){const N=Math.hypot(x,w,E);return c[0]=x*s/N,c[1]=w*s/N,c[2]=E*s/N,!1}return c[0]=x+d*L,c[1]=w+m*L,c[2]=E+y*L,!0}}}class Rp{constructor(i,s,c,d,m){this.TL=i,this.TR=s,this.BR=c,this.BL=d,this.horizon=m}static fromInvProjectionMatrix(i,s,c){const d=[-1,1,1],m=[1,1,1],y=[1,-1,1],x=[-1,-1,1],w=ni(d,d,i),E=ni(m,m,i),D=ni(y,y,i),k=ni(x,x,i);return new Rp(w,E,D,k,s/c)}}class _m{constructor(i,s){this.points=i,this.planes=s}static fromInvProjectionMatrix(i,s,c,d){const m=Math.pow(2,c),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=fs([],w,i),D=1/E[3]/s*m;return(k=E)[0]=(R=E)[0]*(L=[D,D,d?1/E[3]:D,D])[0],k[1]=R[1]*L[1],k[2]=R[2]*L[2],k[3]=R[3]*L[3],k;var k,R,L}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Er([],kp([],io([],y[w[0]],y[w[1]]),io([],y[w[2]],y[w[1]]))),D=-sr(E,y[w[1]]);return E.concat(D)});return new _m(y,x)}}class Nr{static fromPoints(i){const s=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const d of i)dd(s,s,d),pd(c,c,d);return new Nr(s,c)}static applyTransform(i,s){const c=i.getCorners();for(let d=0;d<c.length;++d)ni(c[d],c[d],s);return Nr.fromPoints(c)}constructor(i,s){this.min=i,this.max=s,this.center=no([],Wa([],this.min,this.max),.5)}quadrant(i){const s=[i%2==0,i<2],c=QA(this.min),d=QA(this.max);for(let m=0;m<s.length;m++)c[m]=s[m]?this.min[m]:this.center[m],d[m]=s[m]?this.center[m]:this.max[m];return d[2]=this.max[2],new Nr(c,d)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,s=this.max;return[[i[0],i[1],i[2]],[s[0],i[1],i[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[i[0],i[1],s[2]],[s[0],i[1],s[2]],[s[0],s[1],s[2]],[i[0],s[1],s[2]]]}intersects(i){const s=this.getCorners();let c=!0;for(let d=0;d<i.planes.length;d++){const m=i.planes[d];let y=0;for(let x=0;x<s.length;x++)y+=sr(m,s[x])+m[3]>=0;if(0===y)return 0;y!==s.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let m=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let x=0;x<i.points.length;x++){const w=i.points[x][d]-this.min[d];m=Math.min(m,w),y=Math.max(y,w)}if(y<0||m>this.max[d]-this.min[d])return 0}return 1}}const ty=5,ym=6,Za=Tt/Math.PI/2,YA=16383,Rc=[64,32,16],Fs=-Za,Ls=Za,vm=[new Nr([Fs,Fs,Fs],[Ls,Ls,Ls]),new Nr([Fs,Fs,Fs],[0,0,Ls]),new Nr([0,Fs,Fs],[Ls,0,Ls]),new Nr([Fs,0,Fs],[0,Ls,Ls]),new Nr([0,0,Fs],[Ls,Ls,Ls])];function Am(o){return o*Za/eh}function JA(o,i,s,c=!0){const d=no([],o._camera.position,o.worldSize),m=[i,s,1,1];fs(m,m,o.pixelMatrixInverse),X_(m,m,1/m[3]);const y=Er([],io([],m,d)),x=o.globeMatrix,w=[x[12],x[13],x[14]],E=io([],w,d),D=Wu(E),k=Er([],E),R=o.worldSize/(2*Math.PI),L=sr(k,y),N=Math.asin(R/D);if(N<Math.acos(L)){if(!c)return null;const $e=[],Te=[];no($e,y,D/L),Er(Te,io(Te,$e,E)),Er(y,Wa(y,E,no(y,Te,Math.tan(N)*D)))}const j=[];new Ku(d,y).closestPointOnSphere(w,R,j);const q=Er([],na(x,0)),J=Er([],na(x,1)),se=Er([],na(x,2)),Y=sr(q,j),oe=sr(J,j),ce=sr(se,j),le=Hi(Math.asin(-oe/R));let xe=Hi(Math.atan2(Y,ce));xe=o.center.lng+function($e,Te){const Ne=(Te-$e+180)%360-180;return Ne<-180?Ne+360:Ne}(o.center.lng,xe);const we=Bs(xe),Re=cn(ya(le),0,1);return new th(we,Re)}class Cw{constructor(i,s,c){this.a=io([],i,c),this.b=io([],s,c),this.center=c;const d=Er([],this.a),m=Er([],this.b);this.angle=Math.acos(sr(d,m))}}function ny(o,i){if(0===o.angle)return null;let s;return s=0===o.a[i]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[i]/o.a[i]/Math.sin(o.angle)-1/Math.tan(o.angle)),s<0||s>1?null:function(c,d,m,y){const x=Math.sin(m);return c*(Math.sin((1-y)*m)/x)+d*(Math.sin(y*m)/x)}(o.a[i],o.b[i],o.angle,cn(s,0,1))+o.center[i]}function Qa(o){if(o.z<=1)return vm[o.z+2*o.y+o.x];const i=Fp(md(o));return Nr.fromPoints(i)}function Oc(o,i,s){return no(o,o,1-s),Bl(o,o,i,s)}function xm(o,i){const s=Ju(i.zoom);if(0===s)return Qa(o);const c=md(o),d=Fp(c),m=Bs(c.getWest())*i.worldSize,y=Bs(c.getEast())*i.worldSize,x=ya(c.getNorth())*i.worldSize,w=ya(c.getSouth())*i.worldSize,E=[m,x,0],D=[y,x,0],k=[m,w,0],R=[y,w,0],L=Dp([],i.globeMatrix);return ni(E,E,L),ni(D,D,L),ni(k,k,L),ni(R,R,L),d[0]=Oc(d[0],k,s),d[1]=Oc(d[1],R,s),d[2]=Oc(d[2],D,s),d[3]=Oc(d[3],E,s),Nr.fromPoints(d)}function Op(o,i,s){for(const c of o)ni(c,c,i),no(c,c,s)}function md({x:o,y:i,z:s}){const c=1/(1<<s),d=new Pn(Go(o*c),lr((i+1)*c)),m=new Pn(Go((o+1)*c),lr(i*c));return new ui(d,m)}function Fp(o){const i=on(o.getNorth()),s=on(o.getSouth()),c=Math.cos(i),d=Math.cos(s),m=Math.sin(i),y=Math.sin(s),x=o.getWest(),w=o.getEast();return[ar(d,y,x),ar(d,y,w),ar(c,m,w),ar(c,m,x)]}function ar(o,i,s,c=Za){return s=on(s),[o*Math.sin(s)*c,-i*c,o*Math.cos(s)*c]}function Yu(o,i,s){return ar(Math.cos(on(o)),Math.sin(on(o)),i,s)}function gd(o,i,s,c){const d=1<<s.z,m=(o/Tt+s.x)/d;return Yu(lr((i/Tt+s.y)/d),Go(m),c)}function Lp({min:o,max:i}){return YA/Math.max(i[0]-o[0],i[1]-o[1],i[2]-o[2])}const bm=new Float64Array(16);function Fc(o){const i=Lp(o),s=ZA(bm,[i,i,i]);return qa(s,s,((c=[])[0]=-(d=o.min)[0],c[1]=-d[1],c[2]=-d[2],c));var c,d}function wm(o){const i=(c=o.min,(s=bm)[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=c[0],s[13]=c[1],s[14]=c[2],s[15]=1,s);var s,c;const d=1/Lp(o);return kc(i,i,[d,d,d])}function ry(o,i,s,c,d){const m=function(w){const E=Tt/(2*Math.PI);return w/(2*Math.PI)/E}(s),y=[o,i,-s/(2*Math.PI)],x=Br(new Float64Array(16));return qa(x,x,y),kc(x,x,[m,m,m]),q_(x,x,on(-d)),Sp(x,x,on(-c)),x}function Ju(o){return ka(ty,ym,o)}function Cm(o,i){const s=Yu(i.lat,i.lng);return y=(d=mm([],function(N){const j=Yu(N._center.lat,N._center.lng);let q=kp([],Zu(0,1,0),j);const J=_o([],-N.angle,j);q=ni(q,q,J),_o(J,-N._pitch,q);const se=Er([],j);return no(se,se,Am(N.cameraToCenterDistance/N.pixelsPerMeter)),ni(se,se,J),Wa([],j,se)}(o),s))[0],x=d[1],w=d[2],E=(m=s)[0],D=m[1],k=m[2],L=(R=Math.sqrt(y*y+x*x+w*w)*Math.sqrt(E*E+D*D+k*k))&&sr(d,m)/R,Math.acos(Math.min(Math.max(L,-1),1));var d,m,y,x,w,E,D,k,R,L}function Em(o,i){return Cm(o,i)>Math.PI/2*1.01}const oy=on(85),yo=Math.cos(oy),Im=Math.sin(oy),eh=6371008.8,Bp=2*Math.PI*eh;class Di{constructor(i,s){if(isNaN(i)||isNaN(s))throw new Error(`Invalid LngLat object: (${i}, ${s})`);if(this.lng=+i,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Di(pn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const s=Math.PI/180,c=this.lat*s,d=i.lat*s,m=Math.sin(c)*Math.sin(d)+Math.cos(c)*Math.cos(d)*Math.cos((i.lng-this.lng)*s);return eh*Math.acos(Math.min(m,1))}toBounds(i=0){const s=360*i/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new ui(new Di(this.lng-c,this.lat-s),new Di(this.lng+c,this.lat+s))}toEcef(i){const s=Am(i);return Yu(this.lat,this.lng,Za+s)}static convert(i){if(i instanceof Di)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Di(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Di(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Pn=Di;function Np(o){return Bp*Math.cos(o*Math.PI/180)}function Bs(o){return(180+o)/360}function ya(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function ms(o,i){return o/Np(i)}function Go(o){return 360*o-180}function lr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function sy(o,i){return o*Np(lr(i))}const cr=85.051129;function ay(o){return 1/Math.cos(o*Math.PI/180)}class th{constructor(i,s,c=0){this.x=+i,this.y=+s,this.z=+c}static fromLngLat(i,s=0){const c=Pn.convert(i);return new th(Bs(c.lng),ya(c.lat),ms(s,c.lat))}toLngLat(){return new Pn(Go(this.x),lr(this.y))}toAltitude(){return sy(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bp*ay(lr(this.y))}}function _d(o,i,s,c,d,m,y,x,w){const E=(i+c)/2,D=(s+d)/2,k=new at(E,D);x(k),function(R,L,N,j,q,J){const se=N-q,Y=j-J;return Math.abs((j-L)*se-(N-R)*Y)/Math.hypot(se,Y)}(k.x,k.y,m.x,m.y,y.x,y.y)>=w?(_d(o,i,s,E,D,m,k,x,w),_d(o,E,D,c,d,k,y,x,w)):o.push(y)}function zp(o,i,s){let c=o[0],d=c.x,m=c.y;i(c);const y=[c];for(let x=1;x<o.length;x++){const w=o[x],{x:E,y:D}=w;i(w),_d(y,d,m,E,D,c,w,i,s),d=E,m=D,c=w}return y}function Mm(o,i,s,c){if(c(i,s)){const d=i.add(s)._mult(.5);Mm(o,i,d,c),Mm(o,d,s,c)}else o.push(s)}function yd(o,i){let s=o[0];const c=[s];for(let d=1;d<o.length;d++){const m=o[d];Mm(c,s,m,i),s=m}return c}const Tm=Math.pow(2,14)-1,ly=-Tm-1;function Dm(o,i){const s=Math.round(o.x*i),c=Math.round(o.y*i);return o.x=cn(s,ly,Tm),o.y=cn(c,ly,Tm),(s<o.x||s>o.x+1||c<o.y||c>o.y+1)&&li("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ns(o,i,s){const c=o.loadGeometry(),d=o.extent,m=Tt/d;if(i&&s&&s.projection.isReprojectedInTileSpace){const y=1<<i.z,{scale:x,x:w,y:E,projection:D}=s,k=R=>{const L=Go((i.x+R.x/d)/y),N=lr((i.y+R.y/d)/y),j=D.project(L,N);R.x=(j.x*x-w)*d,R.y=(j.y*x-E)*d};for(let R=0;R<c.length;R++)if(1!==o.type)c[R]=zp(c[R],k,1);else{const L=[];for(const N of c[R])N.x<0||N.x>=d||N.y<0||N.y>=d||(k(N),L.push(N));c[R]=L}}for(const y of c)for(const x of y)Dm(x,m);return c}function Nl(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Ns(o):[]}}function Xa(o,i,s,c,d){o.emplaceBack(2*i+(c+1)/2,2*s+(d+1)/2)}function nh(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class Vp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new We,this.indexArray=new wt,this.segments=new Oi,this.programConfigurations=new Sc(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,d){const m=this.layers[0],y=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:E,id:D,index:k,sourceLayerIndex:R}of i){const L=this.layers[0]._featureFilter.needGeometry,N=Nl(E,L);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),N,c))continue;const j=x?x.evaluate(N,{},c):void 0,q={id:D,properties:E.properties,type:E.type,sourceLayerIndex:R,index:k,geometry:L?N.geometry:Ns(E,c,d),patterns:{},sortKey:j};y.push(q)}x&&y.sort((E,D)=>E.sortKey-D.sortKey);let w=null;"globe"===d.projection.name&&(this.globeExtVertexArray=new Qe,w=d.projection);for(const E of y){const{geometry:D,index:k,sourceLayerIndex:R}=E,L=i[k].feature;this.addFeature(E,D,k,s.availableImages,c,w),s.featureIndex.insert(L,D,k,R,this.index)}}update(i,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,bw.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,hd.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,s,c,d,m,y){for(const x of s)for(const w of x){const E=w.x,D=w.y;if(E<0||E>=Tt||D<0||D>=Tt)continue;if(y){const L=y.projectTilePoint(E,D,m),N=y.upVector(m,E,D),j=this.globeExtVertexArray;nh(j,L,N),nh(j,L,N),nh(j,L,N),nh(j,L,N)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),R=k.vertexLength;Xa(this.layoutVertexArray,E,D,-1,-1),Xa(this.layoutVertexArray,E,D,1,-1),Xa(this.layoutVertexArray,E,D,1,1),Xa(this.layoutVertexArray,E,D,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,{},d,m)}}function cy(o,i){for(let s=0;s<o.length;s++)if(Ka(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(Ka(o,i[s]))return!0;return!!km(o,i)}function Sm(o,i,s){return!!Ka(o,i)||!!Pm(i,o,s)}function uy(o,i){if(1===o.length)return Rm(i,o[0]);for(let s=0;s<i.length;s++){const c=i[s];for(let d=0;d<c.length;d++)if(Ka(o,c[d]))return!0}for(let s=0;s<o.length;s++)if(Rm(i,o[s]))return!0;for(let s=0;s<i.length;s++)if(km(o,i[s]))return!0;return!1}function e0(o,i,s){if(o.length>1){if(km(o,i))return!0;for(let c=0;c<i.length;c++)if(Pm(i[c],o,s))return!0}for(let c=0;c<o.length;c++)if(Pm(o[c],i,s))return!0;return!1}function km(o,i){if(0===o.length||0===i.length)return!1;for(let s=0;s<o.length-1;s++){const c=o[s],d=o[s+1];for(let m=0;m<i.length-1;m++)if(t0(c,d,i[m],i[m+1]))return!0}return!1}function t0(o,i,s,c){return Mo(o,s,c)!==Mo(i,s,c)&&Mo(o,i,s)!==Mo(o,i,c)}function Pm(o,i,s){const c=s*s;if(1===i.length)return o.distSqr(i[0])<c;for(let d=1;d<i.length;d++)if(hy(o,i[d-1],i[d])<c)return!0;return!1}function hy(o,i,s){const c=i.distSqr(s);if(0===c)return o.distSqr(i);const d=((o.x-i.x)*(s.x-i.x)+(o.y-i.y)*(s.y-i.y))/c;return o.distSqr(d<0?i:d>1?s:s.sub(i)._mult(d)._add(i))}function Rm(o,i){let s,c,d,m=!1;for(let y=0;y<o.length;y++){s=o[y];for(let x=0,w=s.length-1;x<s.length;w=x++)c=s[x],d=s[w],c.y>i.y!=d.y>i.y&&i.x<(d.x-c.x)*(i.y-c.y)/(d.y-c.y)+c.x&&(m=!m)}return m}function Ka(o,i){let s=!1;for(let c=0,d=o.length-1;c<o.length;d=c++){const m=o[c],y=o[d];m.y>i.y!=y.y>i.y&&i.x<(y.x-m.x)*(i.y-m.y)/(y.y-m.y)+m.x&&(s=!s)}return s}function Om(o,i,s,c,d){for(const y of o)if(i<=y.x&&s<=y.y&&c>=y.x&&d>=y.y)return!0;const m=[new at(i,s),new at(i,d),new at(c,d),new at(c,s)];if(o.length>2)for(const y of m)if(Ka(o,y))return!0;for(let y=0;y<o.length-1;y++)if(Fm(o[y],o[y+1],m))return!0;return!1}function Fm(o,i,s){const c=s[0],d=s[2];if(o.x<c.x&&i.x<c.x||o.x>d.x&&i.x>d.x||o.y<c.y&&i.y<c.y||o.y>d.y&&i.y>d.y)return!1;const m=Mo(o,i,s[0]);return m!==Mo(o,i,s[1])||m!==Mo(o,i,s[2])||m!==Mo(o,i,s[3])}function ih(o,i,s){const c=i.paint.get(o).value;return"constant"===c.kind?c.value:s.programConfigurations.get(i.id).getMaxValue(o)}function jp(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Lm(o,i,s,c,d){if(!i[0]&&!i[1])return o;const m=at.convert(i)._mult(d);"viewport"===s&&m._rotate(-c);const y=[];for(let x=0;x<o.length;x++)y.push(o[x].sub(m));return y}function Bm(o,i,s,c){const d=at.convert(o)._mult(c);return"viewport"===i&&d._rotate(-s),d}Ae(Vp,"CircleBucket",{omit:["layers"]});const Lc=new te({"circle-sort-key":new W(Oe.layout_circle["circle-sort-key"])});var dy={paint:new te({"circle-radius":new W(Oe.paint_circle["circle-radius"]),"circle-color":new W(Oe.paint_circle["circle-color"]),"circle-blur":new W(Oe.paint_circle["circle-blur"]),"circle-opacity":new W(Oe.paint_circle["circle-opacity"]),"circle-translate":new V(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new V(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new V(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new V(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new W(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new W(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new W(Oe.paint_circle["circle-stroke-opacity"])}),layout:Lc};function Nm(o,i,s,c,d,m,y,x,w){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(w*=o.pixelToTileUnitsFactor);const E=o.tileID.canonical,D=s.projection.upVectorScale(E,s.center.lat,s.worldSize).metersToTile;for(const k of i)for(const R of k){const L=R.add(x),N=d&&s.elevation?s.elevation.exaggeration()*d.getElevationAt(L.x,L.y,!0):0,j=s.projection.projectTilePoint(L.x,L.y,E);if(N>0){const Y=s.projection.upVector(E,L.x,L.y);j.x+=Y[0]*D*N,j.y+=Y[1]*D*N,j.z+=Y[2]*D*N}const q=m?L:n0(j.x,j.y,j.z,c),J=m?o.tilespaceRays.map(Y=>o0(Y,N)):o.queryGeometry.screenGeometry,se=fs([],[j.x,j.y,j.z,1],c);if(!y&&m?w*=se[3]/s.cameraToCenterDistance:y&&!m&&(w*=s.cameraToCenterDistance/se[3]),m){const Y=lr((R.y/Tt+E.y)/(1<<E.z));w/=s.projection.pixelsPerMeter(Y,1)/ms(1,Y)}if(Sm(J,q,w))return!0}return!1}function n0(o,i,s,c){const d=fs([],[o,i,s,1],c);return new at(d[0]/d[3],d[1]/d[3])}const r0=Zu(0,0,0),Up=Zu(0,0,1);function o0(o,i){const s=Ll();return r0[2]=i,o.intersectsPlane(r0,Up,s),new at(s[0],s[1])}class zm extends Vp{}function Vm(o,{width:i,height:s},c,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==i*s*c)throw new RangeError("mismatched image size")}else d=new Uint8Array(i*s*c);return o.width=i,o.height=s,o.data=d,o}function jm(o,i,s){const{width:c,height:d}=i;c===o.width&&d===o.height||(vd(o,i,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,c),height:Math.min(o.height,d)},s),o.width=c,o.height=d,o.data=i.data)}function vd(o,i,s,c,d,m){if(0===d.width||0===d.height)return i;if(d.width>o.width||d.height>o.height||s.x>o.width-d.width||s.y>o.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>i.width||d.height>i.height||c.x>i.width-d.width||c.y>i.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=o.data,x=i.data;for(let w=0;w<d.height;w++){const E=((s.y+w)*o.width+s.x)*m,D=((c.y+w)*i.width+c.x)*m;for(let k=0;k<d.width*m;k++)x[D+k]=y[E+k]}return i}Ae(zm,"HeatmapBucket",{omit:["layers"]});class va{constructor(i,s){Vm(this,i,1,s)}resize(i){jm(this,new va(i),1)}clone(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,d,m){vd(i,s,c,d,m,1)}}class zr{constructor(i,s){Vm(this,i,4,s)}resize(i){jm(this,new zr(i),4)}replace(i,s){s?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new zr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,s,c,d,m){vd(i,s,c,d,m,4)}}Ae(va,"AlphaImage"),Ae(zr,"RGBAImage");var Gp={paint:new te({"heatmap-radius":new W(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new W(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new V(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new V(Oe.paint_heatmap["heatmap-opacity"])})};function Hp(o){const i={},s=o.resolution||256,c=o.clips?o.clips.length:1,d=o.image||new zr({width:s,height:c}),m=(y,x,w)=>{i[o.evaluationKey]=w;const E=o.expression.evaluate(i);d.data[y+x+0]=Math.floor(255*E.r/E.a),d.data[y+x+1]=Math.floor(255*E.g/E.a),d.data[y+x+2]=Math.floor(255*E.b/E.a),d.data[y+x+3]=Math.floor(255*E.a)};if(o.clips)for(let y=0,x=0;y<c;++y,x+=4*s)for(let w=0,E=0;w<s;w++,E+=4){const D=w/(s-1),{start:k,end:R}=o.clips[y];m(x,E,k*(1-D)+R*D)}else for(let y=0,x=0;y<s;y++,x+=4)m(0,x,y/(s-1));return d}var Um={paint:new te({"hillshade-illumination-direction":new V(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new V(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new V(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new V(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new V(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new V(Oe.paint_hillshade["hillshade-accent-color"])})};const Gm=_e([{name:"a_pos",components:2,type:"Int16"}],4),{members:Hm}=Gm;var Bc={exports:{}};function $p(o,i,s){s=s||2;var c,d,m,y,x,w,E,D=i&&i.length,k=D?i[0]*s:o.length,R=$m(o,0,k,s,!0),L=[];if(!R||R.next===R.prev)return L;if(D&&(R=function(j,q,J,se){var Y,oe,ce,le=[];for(Y=0,oe=q.length;Y<oe;Y++)(ce=$m(j,q[Y]*se,Y<oe-1?q[Y+1]*se:j.length,se,!1))===ce.next&&(ce.steiner=!0),le.push(Ew(ce));for(le.sort(qm),Y=0;Y<le.length;Y++)J=rh(le[Y],J);return J}(o,i,R,s)),o.length>80*s){c=m=o[0],d=y=o[1];for(var N=s;N<k;N+=s)(x=o[N])<c&&(c=x),(w=o[N+1])<d&&(d=w),x>m&&(m=x),w>y&&(y=w);E=0!==(E=Math.max(m-c,y-d))?32767/E:0}return Ad(R,L,s,c,d,E,0),L}function $m(o,i,s,c,d){var m,y;if(d===Km(o,i,s,c)>0)for(m=i;m<s;m+=c)y=zl(m,o[m],o[m+1],y);else for(m=s-c;m>=i;m-=c)y=zl(m,o[m],o[m+1],y);return y&&xd(y,y.next)&&(Cd(y),y=y.next),y}function Nc(o,i){if(!o)return o;i||(i=o);var s,c=o;do{if(s=!1,c.steiner||!xd(c,c.next)&&0!==Si(c.prev,c,c.next))c=c.next;else{if(Cd(c),(c=i=c.prev)===c.next)break;s=!0}}while(s||c!==i);return i}function Ad(o,i,s,c,d,m,y){if(o){!y&&m&&function(D,k,R,L){var N=D;do{0===N.z&&(N.z=Wm(N.x,N.y,k,R,L)),N.prevZ=N.prev,N.nextZ=N.next,N=N.next}while(N!==D);N.prevZ.nextZ=null,N.prevZ=null,function(j){var q,J,se,Y,oe,ce,le,xe,we=1;do{for(J=j,j=null,oe=null,ce=0;J;){for(ce++,se=J,le=0,q=0;q<we&&(le++,se=se.nextZ);q++);for(xe=we;le>0||xe>0&&se;)0!==le&&(0===xe||!se||J.z<=se.z)?(Y=J,J=J.nextZ,le--):(Y=se,se=se.nextZ,xe--),oe?oe.nextZ=Y:j=Y,Y.prevZ=oe,oe=Y;J=se}oe.nextZ=null,we*=2}while(ce>1)}(N)}(o,c,d,m);for(var x,w,E=o;o.prev!==o.next;)if(x=o.prev,w=o.next,m?py(o,c,d,m):s0(o))i.push(x.i/s|0),i.push(o.i/s|0),i.push(w.i/s|0),Cd(o),o=w.next,E=w.next;else if((o=w)===E){y?1===y?Ad(o=fy(Nc(o),i,s),i,s,c,d,m,2):2===y&&qp(o,i,s,c,d,m):Ad(Nc(o),i,s,c,d,m,1);break}}}function s0(o){var i=o.prev,s=o,c=o.next;if(Si(i,s,c)>=0)return!1;for(var d=i.x,m=s.x,y=c.x,x=i.y,w=s.y,E=c.y,D=d<m?d<y?d:y:m<y?m:y,k=x<w?x<E?x:E:w<E?w:E,R=d>m?d>y?d:y:m>y?m:y,L=x>w?x>E?x:E:w>E?w:E,N=c.next;N!==i;){if(N.x>=D&&N.x<=R&&N.y>=k&&N.y<=L&&oh(d,x,m,w,y,E,N.x,N.y)&&Si(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function py(o,i,s,c){var d=o.prev,m=o,y=o.next;if(Si(d,m,y)>=0)return!1;for(var x=d.x,w=m.x,E=y.x,D=d.y,k=m.y,R=y.y,L=x<w?x<E?x:E:w<E?w:E,N=D<k?D<R?D:R:k<R?k:R,j=x>w?x>E?x:E:w>E?w:E,q=D>k?D>R?D:R:k>R?k:R,J=Wm(L,N,i,s,c),se=Wm(j,q,i,s,c),Y=o.prevZ,oe=o.nextZ;Y&&Y.z>=J&&oe&&oe.z<=se;){if(Y.x>=L&&Y.x<=j&&Y.y>=N&&Y.y<=q&&Y!==d&&Y!==y&&oh(x,D,w,k,E,R,Y.x,Y.y)&&Si(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,oe.x>=L&&oe.x<=j&&oe.y>=N&&oe.y<=q&&oe!==d&&oe!==y&&oh(x,D,w,k,E,R,oe.x,oe.y)&&Si(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;Y&&Y.z>=J;){if(Y.x>=L&&Y.x<=j&&Y.y>=N&&Y.y<=q&&Y!==d&&Y!==y&&oh(x,D,w,k,E,R,Y.x,Y.y)&&Si(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;oe&&oe.z<=se;){if(oe.x>=L&&oe.x<=j&&oe.y>=N&&oe.y<=q&&oe!==d&&oe!==y&&oh(x,D,w,k,E,R,oe.x,oe.y)&&Si(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function fy(o,i,s){var c=o;do{var d=c.prev,m=c.next.next;!xd(d,m)&&bd(d,c,c.next,m)&&ah(d,m)&&ah(m,d)&&(i.push(d.i/s|0),i.push(c.i/s|0),i.push(m.i/s|0),Cd(c),Cd(c.next),c=o=m),c=c.next}while(c!==o);return Nc(c)}function qp(o,i,s,c,d,m){var y=o;do{for(var x=y.next.next;x!==y.prev;){if(y.i!==x.i&&Zm(y,x)){var w=Qm(y,x);return y=Nc(y,y.next),w=Nc(w,w.next),Ad(y,i,s,c,d,m,0),void Ad(w,i,s,c,d,m,0)}x=x.next}y=y.next}while(y!==o)}function qm(o,i){return o.x-i.x}function rh(o,i){var s=function(d,m){var y,x=m,w=d.x,E=d.y,D=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var k=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(k<=w&&k>D&&(D=k,y=x.x<x.next.x?x:x.next,k===w))return y}x=x.next}while(x!==m);if(!y)return null;var R,L=y,N=y.x,j=y.y,q=1/0;x=y;do{w>=x.x&&x.x>=N&&w!==x.x&&oh(E<j?w:D,E,N,j,E<j?D:w,E,x.x,x.y)&&(R=Math.abs(E-x.y)/(w-x.x),ah(x,d)&&(R<q||R===q&&(x.x>y.x||x.x===y.x&&a0(y,x)))&&(y=x,q=R)),x=x.next}while(x!==L);return y}(o,i);if(!s)return i;var c=Qm(s,o);return Nc(c,c.next),Nc(s,s.next)}function a0(o,i){return Si(o.prev,o,i.prev)<0&&Si(i.next,o,o.next)<0}function Wm(o,i,s,c,d){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-s)*d|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-c)*d|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Ew(o){var i=o,s=o;do{(i.x<s.x||i.x===s.x&&i.y<s.y)&&(s=i),i=i.next}while(i!==o);return s}function oh(o,i,s,c,d,m,y,x){return(d-y)*(i-x)>=(o-y)*(m-x)&&(o-y)*(c-x)>=(s-y)*(i-x)&&(s-y)*(m-x)>=(d-y)*(c-x)}function Zm(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(s,c){var d=s;do{if(d.i!==s.i&&d.next.i!==s.i&&d.i!==c.i&&d.next.i!==c.i&&bd(d,d.next,s,c))return!0;d=d.next}while(d!==s);return!1}(o,i)&&(ah(o,i)&&ah(i,o)&&function(s,c){var d=s,m=!1,y=(s.x+c.x)/2,x=(s.y+c.y)/2;do{d.y>x!=d.next.y>x&&d.next.y!==d.y&&y<(d.next.x-d.x)*(x-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next}while(d!==s);return m}(o,i)&&(Si(o.prev,o,i.prev)||Si(o,i.prev,i))||xd(o,i)&&Si(o.prev,o,o.next)>0&&Si(i.prev,i,i.next)>0)}function Si(o,i,s){return(i.y-o.y)*(s.x-i.x)-(i.x-o.x)*(s.y-i.y)}function xd(o,i){return o.x===i.x&&o.y===i.y}function bd(o,i,s,c){var d=wd(Si(o,i,s)),m=wd(Si(o,i,c)),y=wd(Si(s,c,o)),x=wd(Si(s,c,i));return d!==m&&y!==x||!(0!==d||!sh(o,s,i))||!(0!==m||!sh(o,c,i))||!(0!==y||!sh(s,o,c))||!(0!==x||!sh(s,i,c))}function sh(o,i,s){return i.x<=Math.max(o.x,s.x)&&i.x>=Math.min(o.x,s.x)&&i.y<=Math.max(o.y,s.y)&&i.y>=Math.min(o.y,s.y)}function wd(o){return o>0?1:o<0?-1:0}function ah(o,i){return Si(o.prev,o,o.next)<0?Si(o,i,o.next)>=0&&Si(o,o.prev,i)>=0:Si(o,i,o.prev)<0||Si(o,o.next,i)<0}function Qm(o,i){var s=new Xm(o.i,o.x,o.y),c=new Xm(i.i,i.x,i.y),d=o.next,m=i.prev;return o.next=i,i.prev=o,s.next=d,d.prev=s,c.next=s,s.prev=c,m.next=c,c.prev=m,c}function zl(o,i,s,c){var d=new Xm(o,i,s);return c?(d.next=c.next,d.prev=c,c.next.prev=d,c.next=d):(d.prev=d,d.next=d),d}function Cd(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Xm(o,i,s){this.i=o,this.x=i,this.y=s,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Km(o,i,s,c){for(var d=0,m=i,y=s-c;m<s;m+=c)d+=(o[y]-o[m])*(o[m+1]+o[y+1]),y=m;return d}Bc.exports=$p,Bc.exports.default=$p,$p.deviation=function(o,i,s,c){var d=i&&i.length,m=Math.abs(Km(o,0,d?i[0]*s:o.length,s));if(d)for(var y=0,x=i.length;y<x;y++)m-=Math.abs(Km(o,i[y]*s,y<x-1?i[y+1]*s:o.length,s));var w=0;for(y=0;y<c.length;y+=3){var E=c[y]*s,D=c[y+1]*s,k=c[y+2]*s;w+=Math.abs((o[E]-o[k])*(o[D+1]-o[E+1])-(o[E]-o[D])*(o[k+1]-o[E+1]))}return 0===m&&0===w?0:Math.abs((w-m)/m)},$p.flatten=function(o){for(var i=o[0][0].length,s={vertices:[],holes:[],dimensions:i},c=0,d=0;d<o.length;d++){for(var m=0;m<o[d].length;m++)for(var y=0;y<i;y++)s.vertices.push(o[d][m][y]);d>0&&s.holes.push(c+=o[d-1].length)}return s};var Ym=Xr(Bc.exports);function l0(o,i,s,c,d){vo(o,i,s||0,c||o.length-1,d||c0)}function vo(o,i,s,c,d){for(;c>s;){if(c-s>600){var m=c-s+1,y=i-s+1,x=Math.log(m),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(m-w)/m)*(y-m/2<0?-1:1);vo(o,i,Math.max(s,Math.floor(i-y*w/m+E)),Math.min(c,Math.floor(i+(m-y)*w/m+E)),d)}var D=o[i],k=s,R=c;for(Ao(o,s,i),d(o[c],D)>0&&Ao(o,s,c);k<R;){for(Ao(o,k,R),k++,R--;d(o[k],D)<0;)k++;for(;d(o[R],D)>0;)R--}0===d(o[s],D)?Ao(o,s,R):Ao(o,++R,c),R<=i&&(s=R+1),i<=R&&(c=R-1)}}function Ao(o,i,s){var c=o[i];o[i]=o[s],o[s]=c}function c0(o,i){return o<i?-1:o>i?1:0}function Jm(o,i){const s=o.length;if(s<=1)return[o];const c=[];let d,m;for(let y=0;y<s;y++){const x=zh(o[y]);0!==x&&(o[y].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(d&&c.push(d),d=[o[y]]):d.push(o[y]))}if(d&&c.push(d),i>1)for(let y=0;y<c.length;y++)c[y].length<=i||(l0(c[y],i,1,c[y].length-1,u0),c[y]=c[y].slice(0,i));return c}function u0(o,i){return i.area-o.area}function eg(o,i,s){const c=s.patternDependencies;let d=!1;for(const m of i){const y=m.paint.get(`${o}-pattern`);y.isConstant()||(d=!0);const x=y.constantOr(null);x&&(d=!0,c[x]=!0)}return d}function tg(o,i,s,c,d){const m=d.patternDependencies;for(const y of i){const x=y.paint.get(`${o}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:c},s,{},d.availableImages);w=w&&w.name?w.name:w,m[w]=!0,s.patterns[y.id]=w}}return s}class Wp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new We,this.indexArray=new wt,this.indexArray2=new Ti,this.programConfigurations=new Sc(i.layers,i.zoom),this.segments=new Oi,this.segments2=new Oi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=i.projection}populate(i,s,c,d){this.hasPattern=eg("fill",this.layers,s);const m=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:D}of i){const k=this.layers[0]._featureFilter.needGeometry,R=Nl(x,k);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),R,c))continue;const L=m?m.evaluate(R,{},c,s.availableImages):void 0,N={id:w,properties:x.properties,type:x.type,sourceLayerIndex:D,index:E,geometry:k?R.geometry:Ns(x,c,d),patterns:{},sortKey:L};y.push(N)}m&&y.sort((x,w)=>x.sortKey-w.sortKey);for(const x of y){const{geometry:w,index:E,sourceLayerIndex:D}=x;if(this.hasPattern){const k=tg("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(k)}else this.addFeature(x,w,E,c,{},s.availableImages);s.featureIndex.insert(i[E].feature,w,E,D,this.index)}}update(i,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,d)}addFeatures(i,s,c,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Hm),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,s,c,d,m,y=[]){for(const x of Jm(s,500)){let w=0;for(const N of x)w+=N.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),D=E.vertexLength,k=[],R=[];for(const N of x){if(0===N.length)continue;N!==x[0]&&R.push(k.length/2);const j=this.segments2.prepareSegment(N.length,this.layoutVertexArray,this.indexArray2),q=j.vertexLength;this.layoutVertexArray.emplaceBack(N[0].x,N[0].y),this.indexArray2.emplaceBack(q+N.length-1,q),k.push(N[0].x),k.push(N[0].y);for(let J=1;J<N.length;J++)this.layoutVertexArray.emplaceBack(N[J].x,N[J].y),this.indexArray2.emplaceBack(q+J-1,q+J),k.push(N[J].x),k.push(N[J].y);j.vertexLength+=N.length,j.primitiveLength+=N.length}const L=Ym(k,R);for(let N=0;N<L.length;N+=3)this.indexArray.emplaceBack(D+L[N],D+L[N+1],D+L[N+2]);E.vertexLength+=w,E.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,m,y,d)}}Ae(Wp,"FillBucket",{omit:["layers","patternFeatures"]});const my=new te({"fill-sort-key":new W(Oe.layout_fill["fill-sort-key"])});var h0={paint:new te({"fill-antialias":new V(Oe.paint_fill["fill-antialias"]),"fill-opacity":new W(Oe.paint_fill["fill-opacity"]),"fill-color":new W(Oe.paint_fill["fill-color"]),"fill-outline-color":new W(Oe.paint_fill["fill-outline-color"]),"fill-translate":new V(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new V(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new W(Oe.paint_fill["fill-pattern"])}),layout:my};const d0=_e([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),p0=_e([{name:"a_centroid_pos",components:2,type:"Uint16"}]),f0=_e([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Zp}=d0;var gs={},Ed=Cs,ng=zc;function zc(o,i,s,c,d){this.properties={},this.extent=s,this.type=0,this._pbf=o,this._geometry=-1,this._keys=c,this._values=d,o.readFields(gy,this,i)}function gy(o,i,s){1==o?i.id=s.readVarint():2==o?function(c,d){for(var m=c.readVarint()+c.pos;c.pos<m;){var y=d._keys[c.readVarint()],x=d._values[c.readVarint()];d.properties[y]=x}}(s,i):3==o?i.type=s.readVarint():4==o&&(i._geometry=s.pos)}function Iw(o){for(var i,s,c=0,d=0,m=o.length,y=m-1;d<m;y=d++)c+=((s=o[y]).x-(i=o[d]).x)*(i.y+s.y);return c}zc.types=["Unknown","Point","LineString","Polygon"],zc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,s=o.readVarint()+o.pos,c=1,d=0,m=0,y=0,x=[];o.pos<s;){if(d<=0){var w=o.readVarint();c=7&w,d=w>>3}if(d--,1===c||2===c)m+=o.readSVarint(),y+=o.readSVarint(),1===c&&(i&&x.push(i),i=[]),i.push(new Ed(m,y));else{if(7!==c)throw new Error("unknown command "+c);i&&i.push(i[0].clone())}}return i&&x.push(i),x},zc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,s=1,c=0,d=0,m=0,y=1/0,x=-1/0,w=1/0,E=-1/0;o.pos<i;){if(c<=0){var D=o.readVarint();s=7&D,c=D>>3}if(c--,1===s||2===s)(d+=o.readSVarint())<y&&(y=d),d>x&&(x=d),(m+=o.readSVarint())<w&&(w=m),m>E&&(E=m);else if(7!==s)throw new Error("unknown command "+s)}return[y,w,x,E]},zc.prototype.toGeoJSON=function(o,i,s){var c,d,m=this.extent*Math.pow(2,s),y=this.extent*o,x=this.extent*i,w=this.loadGeometry(),E=zc.types[this.type];function D(L){for(var N=0;N<L.length;N++){var j=L[N];L[N]=[360*(j.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(j.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(c=0;c<w.length;c++)k[c]=w[c][0];D(w=k);break;case 2:for(c=0;c<w.length;c++)D(w[c]);break;case 3:for(w=function(L){var N=L.length;if(N<=1)return[L];for(var j,q,J=[],se=0;se<N;se++){var Y=Iw(L[se]);0!==Y&&(void 0===q&&(q=Y<0),q===Y<0?(j&&J.push(j),j=[L[se]]):j.push(L[se]))}return j&&J.push(j),J}(w),c=0;c<w.length;c++)for(d=0;d<w[c].length;d++)D(w[c][d])}1===w.length?w=w[0]:E="Multi"+E;var R={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Mw=ng,m0=Qp;function Qp(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(ig,this,i),this.length=this._features.length}function ig(o,i,s){15===o?i.version=s.readVarint():1===o?i.name=s.readString():5===o?i.extent=s.readVarint():2===o?i._features.push(s.pos):3===o?i._keys.push(s.readString()):4===o&&i._values.push(function(c){for(var d=null,m=c.readVarint()+c.pos;c.pos<m;){var y=c.readVarint()>>3;d=1===y?c.readString():2===y?c.readFloat():3===y?c.readDouble():4===y?c.readVarint64():5===y?c.readVarint():6===y?c.readSVarint():7===y?c.readBoolean():null}return d}(s))}Qp.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new Mw(this._pbf,i,this.extent,this._keys,this._values)};var Tw=m0;function Dw(o,i,s){if(3===o){var c=new Tw(s,s.readVarint()+s.pos);c.length&&(i[c.name]=c)}}var Xp=gs.VectorTile=function(o,i){this.layers=o.readFields(Dw,{},i)},Kp=gs.VectorTileFeature=ng;function Yp(o,i,s,c){const d=[],m=0===c?(y,x,w,E,D,k)=>{y.push(new at(k,w+(k-x)/(E-x)*(D-w)))}:(y,x,w,E,D,k)=>{y.push(new at(x+(k-w)/(D-w)*(E-x),k))};for(const y of o){const x=[];for(const w of y){if(w.length<=2)continue;const E=[];for(let R=0;R<w.length-1;R++){const L=w[R].x,N=w[R].y,j=w[R+1].x,q=w[R+1].y,J=0===c?L:N,se=0===c?j:q;J<i?se>i&&m(E,L,N,j,q,i):J>s?se<s&&m(E,L,N,j,q,s):E.push(w[R]),se<i&&J>=i&&m(E,L,N,j,q,i),se>s&&J<=s&&m(E,L,N,j,q,s)}let D=w[w.length-1];const k=0===c?D.x:D.y;k>=i&&k<=s&&E.push(D),E.length&&(D=E[E.length-1],E[0].x===D.x&&E[0].y===D.y||E.push(E[0]),x.push(E))}x.length&&d.push(x)}return d}gs.VectorTileLayer=m0;const g0=Kp.types,_0=Math.pow(2,13);function lh(o,i,s,c,d,m,y,x){o.emplaceBack((i<<1)+y,(s<<1)+m,(Math.floor(c*_0)<<1)+d,Math.round(x))}function Vl(o,i,s){o.emplaceBack(i.x,i.y,i.z,16384*s[0],16384*s[1],16384*s[2])}class rg{constructor(){this.acc=new at(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new at(i.x,i.y),this.max=new at(i.x,i.y))}append(i,s){this.currentPolyCount.edges++,this.acc._add(i);const c=this.min,d=this.max;i.x<c.x?c.x=i.x:i.x>d.x&&(d.x=i.x),i.y<c.y?c.y=i.y:i.y>d.y&&(d.y=i.y),((0===i.x||i.x===Tt)&&i.x===s.x)!=((0===i.y||i.y===Tt)&&i.y===s.y)&&this.processBorderOverlap(i,s),s.x<0!=i.x<0&&this.addBorderIntersection(0,xn(s.y,i.y,(0-s.x)/(i.x-s.x))),s.x>Tt!=i.x>Tt&&this.addBorderIntersection(1,xn(s.y,i.y,(Tt-s.x)/(i.x-s.x))),s.y<0!=i.y<0&&this.addBorderIntersection(2,xn(s.x,i.x,(0-s.y)/(i.y-s.y))),s.y>Tt!=i.y>Tt&&this.addBorderIntersection(3,xn(s.x,i.x,(Tt-s.y)/(i.y-s.y)))}addBorderIntersection(i,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[i];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(i,s){if(i.x===s.x){if(i.y===s.y)return;const c=0===i.x?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,i.y)}else{const c=0===i.y?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,i.x)}}centroid(){const i=this.polyCount.reduce((s,c)=>s+c.edges,0);return 0!==i?this.acc.div(i)._round():new at(0,0)}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,s)=>i+ +(s[0]!==Number.MAX_VALUE),0)}}class Vc{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new Be,this.centroidVertexArray=new ds,this.indexArray=new wt,this.programConfigurations=new Sc(i.layers,i.zoom),this.segments=new Oi,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=i.enableTerrain}populate(i,s,c,d){this.features=[],this.hasPattern=eg("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const y=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*y/(y*y+1)/Tt/(1<<m.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:m,id:y,index:x,sourceLayerIndex:w}of i){const E=this.layers[0]._featureFilter.needGeometry,D=Nl(m,E);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),D,c))continue;const k={id:y,sourceLayerIndex:w,index:x,geometry:E?D.geometry:Ns(m,c,d),properties:m.properties,type:m.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push(tg("fill-extrusion",this.layers,k,this.zoom,s)):this.addFeature(k,k.geometry,x,c,{},s.availableImages,d),s.featureIndex.insert(m,k.geometry,x,w,this.index,R)}this.sortBorders()}addFeatures(i,s,c,d,m){for(const y of this.features){const{geometry:x}=y;this.addFeature(y,x,y.index,s,c,d,m)}this.sortBorders()}update(i,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Zp),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,f0.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,p0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,s,c,d,m,y,x){const w=[new at(0,0),new at(Tt,Tt)],E=x.projection,D="globe"===E.name,k=this.enableTerrain&&!D?new rg:null,R="Polygon"===g0[i.type];D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qe);const L=Jm(s,500);for(let J=L.length-1;J>=0;J--){const se=L[J];(0===se.length||(N=se[0]).every(Y=>Y.x<=0)||N.every(Y=>Y.x>=Tt)||N.every(Y=>Y.y<=0)||N.every(Y=>Y.y>=Tt))&&L.splice(J,1)}var N;let j;if(D)j=xy(L,w,d);else{j=[];for(const J of L)j.push({polygon:J,bounds:w})}const q=R?this.edgeRadius:0;for(const{polygon:J,bounds:se}of j){let Y=0,oe=0;for(const le of J)R&&!le[0].equals(le[le.length-1])&&le.push(le[0]),oe+=R?le.length-1:le.length;const ce=this.segments.prepareSegment((R?5:4)*oe,this.layoutVertexArray,this.indexArray);if(R){const le=[],xe=[];Y=ce.vertexLength;for(const Re of J){let $e,Te;Re.length&&Re!==J[0]&&xe.push(le.length/2),$e=Re[1].sub(Re[0])._perp()._unit();for(let Ne=1;Ne<Re.length;Ne++){const ze=Re[Ne],Ge=Re[Ne===Re.length-1?1:Ne+1];let{x:Xe,y:Pe}=ze;if(q){Te=Ge.sub(ze)._perp()._unit();const lt=$e.add(Te)._unit(),gt=q*Math.min(4,1/($e.x*lt.x+$e.y*lt.y));Xe+=gt*lt.x,Pe+=gt*lt.y,$e=Te}lh(this.layoutVertexArray,Xe,Pe,0,0,1,1,0),ce.vertexLength++,le.push(ze.x,ze.y),D&&Vl(this.layoutVertexExtArray,E.projectTilePoint(Xe,Pe,d),E.upVector(d,Xe,Pe))}}const we=Ym(le,xe);for(let Re=0;Re<we.length;Re+=3)this.indexArray.emplaceBack(Y+we[Re],Y+we[Re+2],Y+we[Re+1]),ce.primitiveLength++}for(const le of J){k&&le.length&&k.startRing(le[0]);let xe,we,Re,$e=le.length>4&&Aa(le[le.length-2],le[0],le[1]),Te=q?Zn(le[le.length-2],le[0],le[1],q):0;we=le[1].sub(le[0])._perp()._unit();let Ne=!0;for(let ze=1,Ge=0;ze<le.length;ze++){let Xe=le[ze-1],Pe=le[ze];const lt=le[ze===le.length-1?1:ze+1];if(k&&R&&k.currentPolyCount.top++,vy(Pe,Xe,se)){q&&(we=lt.sub(Pe)._perp()._unit(),Ne=!Ne);continue}k&&k.append(Pe,Xe);const gt=Pe.sub(Xe)._perp(),ht=gt.x/(Math.abs(gt.x)+Math.abs(gt.y)),zt=gt.y>0?1:0,nt=Xe.dist(Pe);if(Ge+nt>32768&&(Ge=0),q){Re=lt.sub(Pe)._perp()._unit();let jt=yy(Xe,Pe,lt,_y(we,Re),q);isNaN(jt)&&(jt=0);const Pt=Pe.sub(Xe)._unit();Xe=Xe.add(Pt.mult(Te))._round(),Pe=Pe.add(Pt.mult(-jt))._round(),Te=jt,we=Re}const It=ce.vertexLength,Vt=le.length>4&&Aa(Xe,Pe,lt);let wn=Jp(Ge,$e,Ne);if(lh(this.layoutVertexArray,Xe.x,Xe.y,ht,zt,0,0,wn),lh(this.layoutVertexArray,Xe.x,Xe.y,ht,zt,0,1,wn),Ge+=nt,wn=Jp(Ge,Vt,!Ne),$e=Vt,lh(this.layoutVertexArray,Pe.x,Pe.y,ht,zt,0,0,wn),lh(this.layoutVertexArray,Pe.x,Pe.y,ht,zt,0,1,wn),ce.vertexLength+=4,this.indexArray.emplaceBack(It+0,It+1,It+2),this.indexArray.emplaceBack(It+1,It+3,It+2),ce.primitiveLength+=2,q){const jt=Y+(1===ze?le.length-2:ze-2),Pt=1===ze?Y:jt+1;if(this.indexArray.emplaceBack(It+1,jt,It+3),this.indexArray.emplaceBack(jt,Pt,It+3),ce.primitiveLength+=2,void 0===xe&&(xe=It),!vy(lt,le[ze],se)){const Yn=ze===le.length-1?xe:ce.vertexLength;this.indexArray.emplaceBack(It+2,It+3,Yn),this.indexArray.emplaceBack(It+3,Yn+1,Yn),this.indexArray.emplaceBack(It+3,Pt,Yn+1),ce.primitiveLength+=3}Ne=!Ne}if(D){const jt=this.layoutVertexExtArray,Pt=E.projectTilePoint(Xe.x,Xe.y,d),Yn=E.projectTilePoint(Pe.x,Pe.y,d),yt=E.upVector(d,Xe.x,Xe.y),Wt=E.upVector(d,Pe.x,Pe.y);Vl(jt,Pt,yt),Vl(jt,Pt,yt),Vl(jt,Yn,Wt),Vl(jt,Yn,Wt)}}R&&(Y+=le.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const J=k.borders,se=this.featuresOnBorder.push(k)-1;for(let Y=0;Y<4;Y++)J[Y][0]!==Number.MAX_VALUE&&this.borders[Y].push(se)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,m,y,d)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((s,c)=>this.featuresOnBorder[s].borders[i][0]-this.featuresOnBorder[c].borders[i][0])}encodeCentroid(i,s,c=!0){let d,m;if(i)if(0!==i.y){const x=s.span()._mult(this.tileToMeter);d=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else d=Math.ceil(7*(i.x+450)),m=0;else d=0,m=+c;let y=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(y++,d,m);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(y++,0,m),this.centroidVertexArray.emplace(y++,d,m)}}}function _y(o,i){const s=o.add(i)._unit();return o.x*s.x+o.y*s.y}function Zn(o,i,s,c){const d=i.sub(o)._perp()._unit(),m=s.sub(i)._perp()._unit();return yy(o,i,s,_y(d,m),c)}function yy(o,i,s,c,d){const m=Math.sqrt(1-c*c);return Math.min(o.dist(i)/3,i.dist(s)/3,d*m/c)}function vy(o,i,s){return o.x<s[0].x&&i.x<s[0].x||o.x>s[1].x&&i.x>s[1].x||o.y<s[0].y&&i.y<s[0].y||o.y>s[1].y&&i.y>s[1].y}function Aa(o,i,s){if(o.x<0||o.x>=Tt||i.x<0||i.x>=Tt||s.x<0||s.x>=Tt)return!1;const c=s.sub(i),d=c.perp(),m=o.sub(i);return(c.x*m.x+c.y*m.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(m.x*m.x+m.y*m.y))>-.866&&d.x*m.x+d.y*m.y<0}function Jp(o,i,s){const c=i?2|o:-3&o;return s?1|c:-2&c}function Ay(){const o=Math.PI/32,i=Math.tan(o),s=eh;return s*Math.sqrt(1+2*i*i)-s}function xy(o,i,s){const c=1<<s.z,d=Go(s.x/c),m=Go((s.x+1)/c),y=lr(s.y/c),x=lr((s.y+1)/c);return function(w,E,D,k,R=0,L){const N=[];if(!w.length||!D||!k)return N;const j=(le,xe)=>{for(const we of le)N.push({polygon:we,bounds:xe})},q=Math.ceil(Math.log2(D)),J=Math.ceil(Math.log2(k)),se=q-J,Y=[];for(let le=0;le<Math.abs(se);le++)Y.push(se>0?0:1);for(let le=0;le<Math.min(q,J);le++)Y.push(0),Y.push(1);let oe=w;if(oe=Yp(oe,E[0].y-R,E[1].y+R,1),oe=Yp(oe,E[0].x-R,E[1].x+R,0),!oe.length)return N;const ce=[];for(Y.length?ce.push({polygons:oe,bounds:E,depth:0}):j(oe,E);ce.length;){const le=ce.pop(),xe=le.depth,we=Y[xe],Re=le.bounds[0],$e=le.bounds[1],Te=0===we?Re.x:Re.y,Ne=0===we?$e.x:$e.y,ze=L?L(we,Te,Ne):.5*(Te+Ne),Ge=Yp(le.polygons,Te-R,ze+R,we),Xe=Yp(le.polygons,ze-R,Ne+R,we);if(Ge.length){const Pe=[Re,new at(0===we?ze:$e.x,1===we?ze:$e.y)];Y.length>xe+1?ce.push({polygons:Ge,bounds:Pe,depth:xe+1}):j(Ge,Pe)}if(Xe.length){const Pe=[new at(0===we?ze:Re.x,1===we?ze:Re.y),$e];Y.length>xe+1?ce.push({polygons:Xe,bounds:Pe,depth:xe+1}):j(Xe,Pe)}}return N}(o,i,Math.ceil((m-d)/11.25),Math.ceil((y-x)/11.25),1,(w,E,D)=>{if(0===w)return.5*(E+D);{const k=lr((s.y+E/Tt)/c);return(ya(.5*(lr((s.y+D/Tt)/c)+k))*c-s.y)*Tt}})}Ae(Vc,"FillExtrusionBucket",{omit:["layers","features"]}),Ae(rg,"PartMetadata");const y0=new te({"fill-extrusion-edge-radius":new V(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var v0={paint:new te({"fill-extrusion-opacity":new V(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new W(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new V(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new V(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new W(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new W(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new W(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new V(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new V(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new V(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new V(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:y0};function og(o,i,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[o*c-2*Math.PI*6378137/2,i*c-2*Math.PI*6378137/2]}class sg{constructor(i,s,c){this.z=i,this.x=s,this.y=c,this.key=jl(0,i,i,s,c)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,s){const c=(y=this.y,x=this.z,w=og(256*(m=this.x),256*(y=Math.pow(2,x)-y-1),x),E=og(256*(m+1),256*(y+1),x),w[0]+","+w[1]+","+E[0]+","+E[1]),d=function(m,y,x){let w,E="";for(let D=m;D>0;D--)w=1<<D-1,E+=(y&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);var m,y,x,w,E;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===s?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class A0{constructor(i,s){this.wrap=i,this.canonical=s,this.key=jl(i,s.z,s.z,s.x,s.y)}}class Qi{constructor(i,s,c,d,m){this.overscaledZ=i,this.wrap=s,this.canonical=new sg(c,+d,+m),this.key=0===s&&i===c?this.canonical.key:jl(s,i,c,d,m)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const s=this.canonical.z-i;return i>this.canonical.z?new Qi(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qi(i,this.wrap,i,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(i,s=!0){if(this.overscaledZ===i&&s)return this.key;if(i>this.canonical.z)return jl(this.wrap*+s,i,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-i;return jl(this.wrap*+s,i,i,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const s=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>s&&i.canonical.y===this.canonical.y>>s}children(i){if(this.overscaledZ>=i)return[new Qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,d=2*this.canonical.y;return[new Qi(s,this.wrap,s,c,d),new Qi(s,this.wrap,s,c+1,d),new Qi(s,this.wrap,s,c,d+1),new Qi(s,this.wrap,s,c+1,d+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Qi(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new A0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function jl(o,i,s,c,d){const m=1<<Math.min(s,22);let y=m*(d%m)+c%m;return o&&s<22&&(y+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-s)))),16*(32*y+s)+(i-s)}Ae(sg,"CanonicalTileID"),Ae(Qi,"OverscaledTileID",{omit:["projMatrix"]});class jc extends at{constructor(i,s,c){super(i,s),this.z=c}}function ch(o,i){return o.x*i.x+o.y*i.y}function ag(o,i){if(1===o.length){let s=0;const c=i[s++];let d;for(;!d||c.equals(d);)if(d=i[s++],!d)return 1/0;for(;s<i.length;s++){const m=i[s],y=o[0],x=d.sub(c),w=m.sub(c),E=y.sub(c),D=ch(x,x),k=ch(x,w),R=ch(w,w),L=ch(E,x),N=ch(E,w),j=D*R-k*k,q=(R*L-k*N)/j,J=(D*N-k*L)/j,se=c.z*(1-q-J)+d.z*q+m.z*J;if(isFinite(se))return se}return 1/0}{let s=1/0;for(const c of i)s=Math.min(s,c.z);return s}}function by(o,i,s,c,d,m,y,x){const w=y*d.getElevationAt(o,i,!0,!0),E=0!==m[0],D=E?0===m[1]?y*(m[0]/7-450):y*function(k,R,L){const N=Math.floor(R[0]/8),j=Math.floor(R[1]/8),q=10*(R[0]-8*N),J=10*(R[1]-8*j),se=k.getElevationAt(N,j,!0,!0),Y=k.getMeterToDEM(L),oe=Math.floor(.5*(q*Y-1)),ce=Math.floor(.5*(J*Y-1)),le=k.tileCoordToPixel(N,j),xe=2*oe+1,we=2*ce+1,Re=(gt=xe,ht=we,[(Xe=k).getElevationAtPixel(Pe=le.x-oe,lt=le.y-ce,!0),Xe.getElevationAtPixel(Pe+ht,lt,!0),Xe.getElevationAtPixel(Pe,lt+ht,!0),Xe.getElevationAtPixel(Pe+gt,lt+ht,!0)]),$e=Math.abs(Re[0]-Re[1]),Te=Math.abs(Re[2]-Re[3]),Ne=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),ze=Math.min(.25,.5*Y*($e+Te)/xe),Ge=Math.min(.25,.5*Y*Ne/we);var Xe,Pe,lt,gt,ht;return se+Math.max(ze*q,Ge*J)}(d,m,x):w;return{base:w+(0===s)?-1:s,top:E?Math.max(D+c,w+s+2):w+c}}const x0=_e([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:wy}=x0,Cy=_e([{name:"a_packed",components:4,type:"Float32"}]),{members:lg}=Cy,Sw=Kp.types,cg=Math.cos(Math.PI/180*37.5);class ef{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(s=>s.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new De,this.layoutVertexArray2=new Ze,this.indexArray=new wt,this.programConfigurations=new Sc(i.layers,i.zoom),this.segments=new Oi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(i,s,c,d){this.hasPattern=eg("line",this.layers,s);const m=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:D,id:k,index:R,sourceLayerIndex:L}of i){const N=this.layers[0]._featureFilter.needGeometry,j=Nl(D,N);if(!this.layers[0]._featureFilter.filter(new S(this.zoom),j,c))continue;const q=m?m.evaluate(j,{},c):void 0,J={id:k,properties:D.properties,type:D.type,sourceLayerIndex:L,index:R,geometry:N?j.geometry:Ns(D,c,d),patterns:{},sortKey:q};y.push(J)}m&&y.sort((D,k)=>D.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:w}=s,E=this.addConstantDashes(x);for(const D of y){const{geometry:k,index:R,sourceLayerIndex:L}=D;if(E&&this.addFeatureDashes(D,x),this.hasPattern){const N=tg("line",this.layers,D,this.zoom,s);this.patternFeatures.push(N)}else this.addFeature(D,k,R,c,x.positions,s.availableImages);w.insert(i[R].feature,k,R,L,this.index)}}addConstantDashes(i){let s=!1;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==m.kind)s=!0;else{const y=m.value,x=d.value;if(!x)continue;i.addDash(x,y)}}return s}addFeatureDashes(i,s){const c=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,y=d.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===y.kind)continue;let x,w;if("constant"===m.kind){if(x=m.value,!x)continue}else x=m.evaluate({zoom:c},i);w="constant"===y.kind?y.value:y.evaluate({zoom:c},i),s.addDash(x,w),i.patterns[d.id]=s.getKey(x,w)}}update(i,s,c,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,s,this.stateDependentLayers,c,d)}addFeatures(i,s,c,d,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,s,c,d)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,lg)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,wy),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,s,c,d,m,y){const x=this.layers[0].layout,w=x.get("line-join").evaluate(i,{}),E=x.get("line-cap").evaluate(i,{}),D=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const R of s)this.addLine(R,i,w,E,D,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,c,m,y,d)}addLine(i,s,c,d,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<i.length-1;J++)this.totalDistance+=i[J].dist(i[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===Sw[s.type];let w=i.length;for(;w>=2&&i[w-1].equals(i[w-2]);)w--;let E=0;for(;E<w-1&&i[E].equals(i[E+1]);)E++;if(w<(x?3:2))return;"bevel"===c&&(m=1.05);const D=this.overscaling<=16?15*Tt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let R,L,N,j,q;this.e1=this.e2=-1,x&&(R=i[w-2],q=i[E].sub(R)._unit()._perp());for(let J=E;J<w;J++){if(N=J===w-1?x?i[E+1]:void 0:i[J+1],N&&i[J].equals(N))continue;q&&(j=q),R&&(L=R),R=i[J],q=N?N.sub(R)._unit()._perp():j,j=j||q;let se=j.add(q);0===se.x&&0===se.y||se._unit();const Y=j.x*q.x+j.y*q.y,oe=se.x*q.x+se.y*q.y,ce=0!==oe?1/oe:1/0,le=2*Math.sqrt(2-2*oe),xe=oe<cg&&L&&N,we=j.x*q.y-j.y*q.x>0;if(xe&&J>E){const Te=R.dist(L);if(Te>2*D){const Ne=R.sub(R.sub(L)._mult(D/Te)._round());this.updateDistance(L,Ne),this.addCurrentVertex(Ne,j,0,0,k),L=Ne}}const Re=L&&N;let $e=Re?c:x?"butt":d;if(Re&&"round"===$e&&(ce<y?$e="miter":ce<=2&&($e="fakeround")),"miter"===$e&&ce>m&&($e="bevel"),"bevel"===$e&&(ce>2&&($e="flipbevel"),ce<m&&($e="miter")),L&&this.updateDistance(L,R),"miter"===$e)se._mult(ce),this.addCurrentVertex(R,se,0,0,k);else if("flipbevel"===$e){if(ce>100)se=q.mult(-1);else{const Te=ce*j.add(q).mag()/j.sub(q).mag();se._perp()._mult(Te*(we?-1:1))}this.addCurrentVertex(R,se,0,0,k),this.addCurrentVertex(R,se.mult(-1),0,0,k)}else if("bevel"===$e||"fakeround"===$e){const Te=-Math.sqrt(ce*ce-1),Ne=we?Te:0,ze=we?0:Te;if(L&&this.addCurrentVertex(R,j,Ne,ze,k),"fakeround"===$e){const Ge=Math.round(180*le/Math.PI/20);for(let Xe=1;Xe<Ge;Xe++){let Pe=Xe/Ge;if(.5!==Pe){const gt=Pe-.5;Pe+=Pe*gt*(Pe-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*gt*gt+(.848013+Y*(.215638*Y-1.06021)))}const lt=q.sub(j)._mult(Pe)._add(j)._unit()._mult(we?-1:1);this.addHalfVertex(R,lt.x,lt.y,!1,we,0,k)}}N&&this.addCurrentVertex(R,q,-Ne,-ze,k)}else if("butt"===$e)this.addCurrentVertex(R,se,0,0,k);else if("square"===$e){const Te=L?1:-1;L||this.addCurrentVertex(R,se,Te,Te,k),this.addCurrentVertex(R,se,0,0,k),L&&this.addCurrentVertex(R,se,Te,Te,k)}else"round"===$e&&(L&&(this.addCurrentVertex(R,j,0,0,k),this.addCurrentVertex(R,j,1,1,k,!0)),N&&(this.addCurrentVertex(R,q,-1,-1,k,!0),this.addCurrentVertex(R,q,0,0,k)));if(xe&&J<w-1){const Te=R.dist(N);if(Te>2*D){const Ne=R.add(N.sub(R)._mult(D/Te)._round());this.updateDistance(R,Ne),this.addCurrentVertex(Ne,q,0,0,k),R=Ne}}}}addCurrentVertex(i,s,c,d,m,y=!1){const x=s.y*d-s.x,w=-s.y-s.x*d;this.addHalfVertex(i,s.x+s.y*c,s.y-s.x*c,y,!1,c,m),this.addHalfVertex(i,x,w,y,!0,-d,m)}addHalfVertex({x:i,y:s},c,d,m,y,x,w){this.layoutVertexArray.emplaceBack((i<<1)+(m?1:0),(s<<1)+(y?1:0),Math.round(63*c)+128,Math.round(63*d)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),y?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,s){this.distance+=i.dist(s),this.updateScaledDistance()}}Ae(ef,"LineBucket",{omit:["layers","patternFeatures"]});const ug=new te({"line-cap":new W(Oe.layout_line["line-cap"]),"line-join":new W(Oe.layout_line["line-join"]),"line-miter-limit":new V(Oe.layout_line["line-miter-limit"]),"line-round-limit":new V(Oe.layout_line["line-round-limit"]),"line-sort-key":new W(Oe.layout_line["line-sort-key"])});var hg={paint:new te({"line-opacity":new W(Oe.paint_line["line-opacity"]),"line-color":new W(Oe.paint_line["line-color"]),"line-translate":new V(Oe.paint_line["line-translate"]),"line-translate-anchor":new V(Oe.paint_line["line-translate-anchor"]),"line-width":new W(Oe.paint_line["line-width"]),"line-gap-width":new W(Oe.paint_line["line-gap-width"]),"line-offset":new W(Oe.paint_line["line-offset"]),"line-blur":new W(Oe.paint_line["line-blur"]),"line-dasharray":new W(Oe.paint_line["line-dasharray"]),"line-pattern":new W(Oe.paint_line["line-pattern"]),"line-gradient":new ne(Oe.paint_line["line-gradient"]),"line-trim-offset":new V(Oe.paint_line["line-trim-offset"])}),layout:ug};const dg=new class extends W{possiblyEvaluate(o,i){return i=new S(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition}),super.possiblyEvaluate(o,i)}evaluate(o,i,s,c){return i=Ci({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(o,i,s,c)}}(hg.paint.properties["line-width"].specification);function Ul(o,i){return i>0?i+2*o:o}dg.useIntegerZoom=!0;const b0=_e([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),pg=_e([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),tf=_e([{name:"a_projected_pos",components:4,type:"Float32"}],4);_e([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const w0=_e([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),fg=_e([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Id=_e([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),xa=_e([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);_e([{name:"triangle",components:3,type:"Uint16"}]),_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),_e([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),_e([{type:"Float32",name:"offsetX"}]),_e([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Xi=24;const Ho=128;function mg(o,i){const{expression:s}=i;if("constant"===s.kind)return{kind:"constant",layoutSize:s.evaluate(new S(o+1))};if("source"===s.kind)return{kind:"source"};{const{zoomStops:c,interpolationType:d}=s;let m=0;for(;m<c.length&&c[m]<=o;)m++;m=Math.max(0,m-1);let y=m;for(;y<c.length&&c[y]<o+1;)y++;y=Math.min(c.length-1,y);const x=c[m],w=c[y];return"composite"===s.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:w,minSize:s.evaluate(new S(x)),maxSize:s.evaluate(new S(w)),interpolationType:d}}}function nf(o,{uSize:i,uSizeT:s},{lowerSize:c,upperSize:d}){return"source"===o.kind?c/Ho:"composite"===o.kind?xn(c/Ho,d/Ho,s):i}function Uc(o,i){let s=0,c=0;if("constant"===o.kind)c=o.layoutSize;else if("source"!==o.kind){const{interpolationType:d,minZoom:m,maxZoom:y}=o,x=d?cn(mn.interpolationFactor(d,i,m,y),0,1):0;"camera"===o.kind?c=xn(o.minSize,o.maxSize,x):s=x}return{uSizeT:s,uSize:c}}var uh=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ho,evaluateSizeForFeature:nf,evaluateSizeForZoom:Uc,getSizeData:mg});function C0(o,i,s){return o.sections.forEach(c=>{c.text=function(d,m,y){const x=m.layout.get("text-transform").evaluate(y,{});return"uppercase"===x?d=d.toLocaleUpperCase():"lowercase"===x&&(d=d.toLocaleLowerCase()),T.applyArabicShaping&&(d=T.applyArabicShaping(d)),d}(c.text,i,s)}),o}const Md={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function E0(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function gg(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var Ey=Gn,_g=function(o,i,s,c,d){var m,y,x=8*d-c-1,w=(1<<x)-1,E=w>>1,D=-7,k=s?d-1:0,R=s?-1:1,L=o[i+k];for(k+=R,m=L&(1<<-D)-1,L>>=-D,D+=x;D>0;m=256*m+o[i+k],k+=R,D-=8);for(y=m&(1<<-D)-1,m>>=-D,D+=c;D>0;y=256*y+o[i+k],k+=R,D-=8);if(0===m)m=1-E;else{if(m===w)return y?NaN:1/0*(L?-1:1);y+=Math.pow(2,c),m-=E}return(L?-1:1)*y*Math.pow(2,m-c)},Iy=function(o,i,s,c,d,m){var y,x,w,E=8*m-d-1,D=(1<<E)-1,k=D>>1,R=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,L=c?0:m-1,N=c?1:-1,j=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(x=isNaN(i)?1:0,y=D):(y=Math.floor(Math.log(i)/Math.LN2),i*(w=Math.pow(2,-y))<1&&(y--,w*=2),(i+=y+k>=1?R/w:R*Math.pow(2,1-k))*w>=2&&(y++,w/=2),y+k>=D?(x=0,y=D):y+k>=1?(x=(i*w-1)*Math.pow(2,d),y+=k):(x=i*Math.pow(2,k-1)*Math.pow(2,d),y=0));d>=8;o[s+L]=255&x,L+=N,x/=256,d-=8);for(y=y<<d|x,E+=d;E>0;o[s+L]=255&y,L+=N,y/=256,E-=8);o[s+L-N]|=128*j};function Gn(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}Gn.Varint=0,Gn.Fixed64=1,Gn.Bytes=2,Gn.Fixed32=5;var My=4294967296,Ty=1/My,hh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ya(o){return o.type===Gn.Bytes?o.readVarint()+o.pos:o.pos+1}function Vr(o,i,s){var c=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));s.realloc(c);for(var d=s.pos-1;d>=o;d--)s.buf[d+c]=s.buf[d]}function I0(o,i){for(var s=0;s<o.length;s++)i.writeVarint(o[s])}function Dy(o,i){for(var s=0;s<o.length;s++)i.writeSVarint(o[s])}function Ja(o,i){for(var s=0;s<o.length;s++)i.writeFloat(o[s])}function M0(o,i){for(var s=0;s<o.length;s++)i.writeDouble(o[s])}function T0(o,i){for(var s=0;s<o.length;s++)i.writeBoolean(o[s])}function Gc(o,i){for(var s=0;s<o.length;s++)i.writeFixed32(o[s])}function D0(o,i){for(var s=0;s<o.length;s++)i.writeSFixed32(o[s])}function yg(o,i){for(var s=0;s<o.length;s++)i.writeFixed64(o[s])}function vg(o,i){for(var s=0;s<o.length;s++)i.writeSFixed64(o[s])}function rf(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Gl(o,i,s){o[s]=i,o[s+1]=i>>>8,o[s+2]=i>>>16,o[s+3]=i>>>24}function el(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}Gn.prototype={destroy:function(){this.buf=null},readFields:function(o,i,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),d=c>>3,m=this.pos;this.type=7&c,o(d,i,this),this.pos===m&&this.skip(c)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=rf(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=el(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=rf(this.buf,this.pos)+rf(this.buf,this.pos+4)*My;return this.pos+=8,o},readSFixed64:function(){var o=rf(this.buf,this.pos)+el(this.buf,this.pos+4)*My;return this.pos+=8,o},readFloat:function(){var o=_g(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=_g(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,s,c=this.buf;return i=127&(s=c[this.pos++]),s<128?i:(i|=(127&(s=c[this.pos++]))<<7,s<128?i:(i|=(127&(s=c[this.pos++]))<<14,s<128?i:(i|=(127&(s=c[this.pos++]))<<21,s<128?i:function(d,m,y){var x,w,E=y.buf;if(x=(112&(w=E[y.pos++]))>>4,w<128||(x|=(127&(w=E[y.pos++]))<<3,w<128)||(x|=(127&(w=E[y.pos++]))<<10,w<128)||(x|=(127&(w=E[y.pos++]))<<17,w<128)||(x|=(127&(w=E[y.pos++]))<<24,w<128)||(x|=(1&(w=E[y.pos++]))<<31,w<128))return function zs(o,i,s){return s?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}(d,x,m);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(s=c[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&hh?hh.decode(this.buf.subarray(i,o)):function(s,c,d){for(var m="",y=c;y<d;){var x,w,E,D=s[y],k=null,R=D>239?4:D>223?3:D>191?2:1;if(y+R>d)break;1===R?D<128&&(k=D):2===R?128==(192&(x=s[y+1]))&&(k=(31&D)<<6|63&x)<=127&&(k=null):3===R?(w=s[y+2],128==(192&(x=s[y+1]))&&128==(192&w)&&((k=(15&D)<<12|(63&x)<<6|63&w)<=2047||k>=55296&&k<=57343)&&(k=null)):4===R&&(w=s[y+2],E=s[y+3],128==(192&(x=s[y+1]))&&128==(192&w)&&128==(192&E)&&((k=(15&D)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||k>=1114112)&&(k=null)),null===k?(k=65533,R=1):k>65535&&(k-=65536,m+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),m+=String.fromCharCode(k),y+=R}return m}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==Gn.Bytes)return o.push(this.readVarint(i));var s=Ya(this);for(o=o||[];this.pos<s;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==Gn.Bytes)return o.push(this.readSVarint());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==Gn.Bytes)return o.push(this.readBoolean());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==Gn.Bytes)return o.push(this.readFloat());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==Gn.Bytes)return o.push(this.readDouble());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==Gn.Bytes)return o.push(this.readFixed32());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==Gn.Bytes)return o.push(this.readSFixed32());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==Gn.Bytes)return o.push(this.readFixed64());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==Gn.Bytes)return o.push(this.readSFixed64());var i=Ya(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===Gn.Varint)for(;this.buf[this.pos++]>127;);else if(i===Gn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Gn.Fixed32)this.pos+=4;else{if(i!==Gn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var s=new Uint8Array(i);s.set(this.buf),this.buf=s,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Gl(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Gl(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Gl(this.buf,-1&o,this.pos),Gl(this.buf,Math.floor(o*Ty),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Gl(this.buf,-1&o,this.pos),Gl(this.buf,Math.floor(o*Ty),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,s){var c,d,m,x;if(i>=0?(c=i%4294967296|0,d=i/4294967296|0):(d=~(-i/4294967296),4294967295^(c=~(-i%4294967296))?c=c+1|0:(c=0,d=d+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),m=c,(x=s).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,y){var x=(7&m)<<4;y.buf[y.pos++]|=x|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(d,s)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(c,d,m){for(var y,x,w=0;w<d.length;w++){if((y=d.charCodeAt(w))>55295&&y<57344){if(!x){y>56319||w+1===d.length?(c[m++]=239,c[m++]=191,c[m++]=189):x=y;continue}if(y<56320){c[m++]=239,c[m++]=191,c[m++]=189,x=y;continue}y=x-55296<<10|y-56320|65536,x=null}else x&&(c[m++]=239,c[m++]=191,c[m++]=189,x=null);y<128?c[m++]=y:(y<2048?c[m++]=y>>6|192:(y<65536?c[m++]=y>>12|224:(c[m++]=y>>18|240,c[m++]=y>>12&63|128),c[m++]=y>>6&63|128),c[m++]=63&y|128)}return m}(this.buf,o,this.pos);var s=this.pos-i;s>=128&&Vr(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s},writeFloat:function(o){this.realloc(4),Iy(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Iy(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var s=0;s<i;s++)this.buf[this.pos++]=o[s]},writeRawMessage:function(o,i){this.pos++;var s=this.pos;o(i,this);var c=this.pos-s;c>=128&&Vr(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(o,i,s){this.writeTag(o,Gn.Bytes),this.writeRawMessage(i,s)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,I0,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,Dy,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,T0,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,Ja,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,M0,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,Gc,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,D0,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,yg,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,vg,i)},writeBytesField:function(o,i){this.writeTag(o,Gn.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,Gn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,Gn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,Gn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,Gn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,Gn.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,Gn.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,Gn.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,Gn.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,Gn.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,Boolean(i))}};var sf=Xr(Ey);const Ag=3;function S0(o,i,s){i.glyphs=[],1===o&&s.readMessage(k0,i)}function k0(o,i,s){if(3===o){const{id:c,bitmap:d,width:m,height:y,left:x,top:w,advance:E}=s.readMessage(Td,{});i.glyphs.push({id:c,bitmap:new va({width:m+2*Ag,height:y+2*Ag},d),metrics:{width:m,height:y,left:x,top:w,advance:E}})}else 4===o?i.ascender=s.readSVarint():5===o&&(i.descender=s.readSVarint())}function Td(o,i,s){1===o?i.id=s.readVarint():2===o?i.bitmap=s.readBytes():3===o?i.width=s.readVarint():4===o?i.height=s.readVarint():5===o?i.left=s.readSVarint():6===o?i.top=s.readSVarint():7===o&&(i.advance=s.readVarint())}const af=Ag;function xg(o){let i=0,s=0;for(const y of o)i+=y.w*y.h,s=Math.max(s,y.w);o.sort((y,x)=>x.h-y.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),s),h:1/0}];let d=0,m=0;for(const y of o)for(let x=c.length-1;x>=0;x--){const w=c[x];if(!(y.w>w.w||y.h>w.h)){if(y.x=w.x,y.y=w.y,m=Math.max(m,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===w.w&&y.h===w.h){const E=c.pop();x<c.length&&(c[x]=E)}else y.h===w.h?(w.x+=y.w,w.w-=y.w):y.w===w.w?(w.y+=y.h,w.h-=y.h):(c.push({x:w.x+y.w,y:w.y,w:w.w-y.w,h:y.h}),w.y+=y.h,w.h-=y.h);break}}return{w:d,h:m,fill:i/(d*m)||0}}const Ki=1;class Vs{constructor(i,{pixelRatio:s,version:c,stretchX:d,stretchY:m,content:y}){this.paddedRect=i,this.pixelRatio=s,this.stretchX=d,this.stretchY=m,this.content=y,this.version=c}get tl(){return[this.paddedRect.x+Ki,this.paddedRect.y+Ki]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ki,this.paddedRect.y+this.paddedRect.h-Ki]}get displaySize(){return[(this.paddedRect.w-2*Ki)/this.pixelRatio,(this.paddedRect.h-2*Ki)/this.pixelRatio]}}class Sy{constructor(i,s){const c={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(i,c,m),this.addImages(s,d,m);const{w:y,h:x}=xg(m),w=new zr({width:y||1,height:x||1});for(const E in i){const D=i[E],k=c[E].paddedRect;zr.copy(D.data,w,{x:0,y:0},{x:k.x+Ki,y:k.y+Ki},D.data)}for(const E in s){const D=s[E],k=d[E].paddedRect,R=k.x+Ki,L=k.y+Ki,N=D.data.width,j=D.data.height;zr.copy(D.data,w,{x:0,y:0},{x:R,y:L},D.data),zr.copy(D.data,w,{x:0,y:j-1},{x:R,y:L-1},{width:N,height:1}),zr.copy(D.data,w,{x:0,y:0},{x:R,y:L+j},{width:N,height:1}),zr.copy(D.data,w,{x:N-1,y:0},{x:R-1,y:L},{width:1,height:j}),zr.copy(D.data,w,{x:0,y:0},{x:R+N,y:L},{width:1,height:j})}this.image=w,this.iconPositions=c,this.patternPositions=d}addImages(i,s,c){for(const d in i){const m=i[d],y={x:0,y:0,w:m.data.width+2*Ki,h:m.data.height+2*Ki};c.push(y),s[d]=new Vs(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>i.hasImage(c)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in i.updatedImages)this.patchUpdatedImage(this.iconPositions[c],i.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],i.getImage(c),s)}patchUpdatedImage(i,s,c){if(!i||!s||i.version===s.version)return;i.version=s.version;const[d,m]=i.tl;c.update(s.data,void 0,{x:d,y:m})}}Ae(Vs,"ImagePosition"),Ae(Sy,"ImageAtlas");const $o={horizontal:1,vertical:2,horizontalOnly:3},P0=-17;class lf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,s){const c=new lf;return c.scale=i||1,c.fontStack=s,c}static forImage(i){const s=new lf;return s.imageName=i,s}}class Hc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,s){const c=new Hc;for(let d=0;d<i.sections.length;d++){const m=i.sections[d];m.image?c.addImageSection(m):c.addTextSection(m,s)}return c}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(s,c){let d="";for(let m=0;m<s.length;m++){const y=s.charCodeAt(m+1)||null,x=s.charCodeAt(m-1)||null;d+=!c&&(y&&wp(y)&&!Md[s[m+1]]||x&&wp(x)&&!Md[s[m-1]])||!Md[s[m]]?s[m]:Md[s[m]]}return d}(this.text,i)}trim(){let i=0;for(let c=0;c<this.text.length&&Dd[this.text.charCodeAt(c)];c++)i++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=i&&Dd[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(i,s),this.sectionIndex=this.sectionIndex.slice(i,s)}substring(i,s){const c=new Hc;return c.text=this.text.substring(i,s),c.sectionIndex=this.sectionIndex.slice(i,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,s)=>Math.max(i,this.sections[s].scale),0)}addTextSection(i,s){this.text+=i.text,this.sections.push(lf.forText(i.scale,i.fontStack||s));const c=this.sections.length-1;for(let d=0;d<i.text.length;++d)this.sectionIndex.push(c)}addImageSection(i){const s=i.image?i.image.name:"";if(0===s.length)return void li("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(lf.forImage(s)),this.sectionIndex.push(this.sections.length-1)):li("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ky(o,i,s,c,d,m,y,x,w,E,D,k,R,L,N){const j=Hc.fromFeature(o,d);k===$o.vertical&&j.verticalizePunctuation(R);let q=[];const J=function(le,xe,we,Re,$e,Te){if(!le)return[];const Ne=[],ze=function(lt,gt,ht,zt,nt,It){let Vt=0;for(let wn=0;wn<lt.length();wn++){const jt=lt.getSection(wn);Vt+=Ry(lt.getCharCode(wn),jt,zt,nt,gt,It)}return Vt/Math.max(1,Math.ceil(Vt/ht))}(le,xe,we,Re,$e,Te),Ge=le.text.indexOf("\u200b")>=0;let Xe=0;for(let lt=0;lt<le.length();lt++){const gt=le.getSection(lt),ht=le.getCharCode(lt);if(Dd[ht]||(Xe+=Ry(ht,gt,Re,$e,xe,Te)),lt<le.length()-1){const zt=!((Pe=ht)<11904||!(dt["Bopomofo Extended"](Pe)||dt.Bopomofo(Pe)||dt["CJK Compatibility Forms"](Pe)||dt["CJK Compatibility Ideographs"](Pe)||dt["CJK Compatibility"](Pe)||dt["CJK Radicals Supplement"](Pe)||dt["CJK Strokes"](Pe)||dt["CJK Symbols and Punctuation"](Pe)||dt["CJK Unified Ideographs Extension A"](Pe)||dt["CJK Unified Ideographs"](Pe)||dt["Enclosed CJK Letters and Months"](Pe)||dt["Halfwidth and Fullwidth Forms"](Pe)||dt.Hiragana(Pe)||dt["Ideographic Description Characters"](Pe)||dt["Kangxi Radicals"](Pe)||dt["Katakana Phonetic Extensions"](Pe)||dt.Katakana(Pe)||dt["Vertical Forms"](Pe)||dt["Yi Radicals"](Pe)||dt["Yi Syllables"](Pe)));(Py[ht]||zt||gt.imageName)&&Ne.push(Oy(lt+1,Xe,ze,Ne,R0(ht,le.getCharCode(lt+1),zt&&Ge),!1))}}var Pe;return _s(Oy(le.length(),Xe,ze,Ne,0,!0))}(j,E,m,i,c,L),{processBidirectionalText:se,processStyledBidirectionalText:Y}=T;if(se&&1===j.sections.length){const le=se(j.toString(),J);for(const xe of le){const we=new Hc;we.text=xe,we.sections=j.sections;for(let Re=0;Re<xe.length;Re++)we.sectionIndex.push(0);q.push(we)}}else if(Y){const le=Y(j.text,j.sectionIndex,J);for(const xe of le){const we=new Hc;we.text=xe[0],we.sectionIndex=xe[1],we.sections=j.sections,q.push(we)}}else q=function(le,xe){const we=[],Re=le.text;let $e=0;for(const Te of xe)we.push(le.substring($e,Te)),$e=Te;return $e<Re.length&&we.push(le.substring($e,Re.length)),we}(j,J);const oe=[],ce={positionedLines:oe,text:j.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(le,xe,we,Re,$e,Te,Ne,ze,Ge,Xe,Pe,lt){let gt=0,ht=0,zt=0;const nt="right"===ze?1:"left"===ze?0:.5;let It=!1;for(const yt of $e){const Wt=yt.getSections();for(const Nn of Wt){if(Nn.imageName)continue;const ot=xe[Nn.fontStack];if(ot&&(It=void 0!==ot.ascender&&void 0!==ot.descender,!It))break}if(!It)break}let Vt=0;for(const yt of $e){yt.trim();const Wt=yt.getMaxScale(),Nn=(Wt-1)*Xi,ot={positionedGlyphs:[],lineOffset:0};le.positionedLines[Vt]=ot;const Un=ot.positionedGlyphs;let Hn=0;if(!yt.length()){ht+=Te,++Vt;continue}let ke=0,Ve=0;for(let $n=0;$n<yt.length();$n++){const bi=yt.getSection($n),gi=yt.getSectionIndex($n),si=yt.getCharCode($n);let Gt=bi.scale,ai=null,qn=null,Ir=null,ft=Xi,Yi=0;const Ji=!(Ge===$o.horizontal||!Pe&&!Tc(si)||Pe&&(Dd[si]||(wn=si,dt.Arabic(wn)||dt["Arabic Supplement"](wn)||dt["Arabic Extended-A"](wn)||dt["Arabic Presentation Forms-A"](wn)||dt["Arabic Presentation Forms-B"](wn))));if(bi.imageName){const jr=Re[bi.imageName];if(!jr)continue;Ir=bi.imageName,le.iconsInText=le.iconsInText||!0,qn=jr.paddedRect;const Ui=jr.displaySize;Gt=Gt*Xi/lt,ai={width:Ui[0],height:Ui[1],left:Ki,top:-af,advance:Ji?Ui[1]:Ui[0],localGlyph:!1},Yi=It?-ai.height*Gt:P0+Wt*Xi-Ui[1]*Gt,ft=ai.advance;const xs=(Ji?Ui[0]:Ui[1])*Gt-Xi*Wt;xs>0&&xs>Hn&&(Hn=xs)}else{const jr=we[bi.fontStack];if(!jr)continue;jr[si]&&(qn=jr[si]);const Ui=xe[bi.fontStack];if(!Ui)continue;const xs=Ui.glyphs[si];if(!xs)continue;if(ai=xs.metrics,ft=8203!==si?Xi:0,It){const Ot=void 0!==Ui.ascender?Math.abs(Ui.ascender):0,jd=void 0!==Ui.descender?Math.abs(Ui.descender):0,Ud=(Ot+jd)*Gt;ke<Ud&&(ke=Ud,Ve=(Ot-jd)/2*Gt),Yi=-Ot*Gt}else Yi=P0+(Wt-Gt)*Xi}Ji?(le.verticalizable=!0,Un.push({glyph:si,imageName:Ir,x:gt,y:ht+Yi,vertical:Ji,scale:Gt,localGlyph:ai.localGlyph,fontStack:bi.fontStack,sectionIndex:gi,metrics:ai,rect:qn}),gt+=ft*Gt+Xe):(Un.push({glyph:si,imageName:Ir,x:gt,y:ht+Yi,vertical:Ji,scale:Gt,localGlyph:ai.localGlyph,fontStack:bi.fontStack,sectionIndex:gi,metrics:ai,rect:qn}),gt+=ai.advance*Gt+Xe)}0!==Un.length&&(zt=Math.max(gt-Xe,zt),It?Cg(Un,nt,Hn,Ve,Te*Wt/2):Cg(Un,nt,Hn,0,Te/2)),gt=0;const St=Te*Wt+Hn;ot.lineOffset=Math.max(Hn,Nn),ht+=St,++Vt}var wn;const jt=ht,{horizontalAlign:Pt,verticalAlign:Yn}=wg(Ne);(function(yt,Wt,Nn,ot,Un,Hn){const ke=(Wt-Nn)*Un,Ve=-Hn*ot;for(const St of yt)for(const $n of St.positionedGlyphs)$n.x+=ke,$n.y+=Ve})(le.positionedLines,nt,Pt,Yn,zt,jt),le.top+=-Yn*jt,le.bottom=le.top+jt,le.left+=-Pt*zt,le.right=le.left+zt,le.hasBaseline=It}(ce,i,s,c,q,y,x,w,k,E,R,N),!function(le){for(const xe of le)if(0!==xe.positionedGlyphs.length)return!1;return!0}(oe)&&ce}const Dd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Py={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ry(o,i,s,c,d,m){if(i.imageName){const y=c[i.imageName];return y?y.displaySize[0]*i.scale*Xi/m+d:0}{const y=s[i.fontStack],x=y&&y.glyphs[o];return x?x.metrics.advance*i.scale+d:0}}function bg(o,i,s,c){const d=Math.pow(o-i,2);return c?o<i?d/2:2*d:d+Math.abs(s)*s}function R0(o,i,s){let c=0;return 10===o&&(c-=1e4),s&&(c+=150),40!==o&&65288!==o||(c+=50),41!==i&&65289!==i||(c+=50),c}function Oy(o,i,s,c,d,m){let y=null,x=bg(i,s,d,m);for(const w of c){const E=bg(i-w.x,s,d,m)+w.badness;E<=x&&(y=w,x=E)}return{index:o,x:i,priorBreak:y,badness:x}}function _s(o){return o?_s(o.priorBreak).concat(o.index):[]}function wg(o){let i=.5,s=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:i,verticalAlign:s}}function Cg(o,i,s,c,d){if(!(i||s||c||d))return;const m=o.length-1,y=o[m],x=(y.x+y.metrics.advance*y.scale)*i;for(let w=0;w<=m;w++)o[w].x-=x,o[w].y+=s+c+d}function O0(o,i,s){const{horizontalAlign:c,verticalAlign:d}=wg(s),m=i[0]-o.displaySize[0]*c,y=i[1]-o.displaySize[1]*d;return{image:o,top:y,bottom:y+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function Fy(o,i,s,c,d,m){const y=o.image;let x;if(y.content){const q=y.content,J=y.pixelRatio||1;x=[q[0]/J,q[1]/J,y.displaySize[0]-q[2]/J,y.displaySize[1]-q[3]/J]}const w=i.left*m,E=i.right*m;let D,k,R,L;"width"===s||"both"===s?(L=d[0]+w-c[3],k=d[0]+E+c[1]):(L=d[0]+(w+E-y.displaySize[0])/2,k=L+y.displaySize[0]);const N=i.top*m,j=i.bottom*m;return"height"===s||"both"===s?(D=d[1]+N-c[0],R=d[1]+j+c[2]):(D=d[1]+(N+j-y.displaySize[1])/2,R=D+y.displaySize[1]),{image:y,top:D,right:k,bottom:R,left:L,collisionPadding:x}}class tl extends at{constructor(i,s,c,d,m){super(i,s),this.angle=d,this.z=c,void 0!==m&&(this.segment=m)}clone(){return new tl(this.x,this.y,this.z,this.angle,this.segment)}}function Ly(o,i,s,c,d){if(void 0===i.segment)return!0;let m=i,y=i.segment+1,x=0;for(;x>-s/2;){if(y--,y<0)return!1;x-=o[y].dist(m),m=o[y]}x+=o[y].dist(o[y+1]),y++;const w=[];let E=0;for(;x<s/2;){const D=o[y],k=o[y+1];if(!k)return!1;let R=o[y-1].angleTo(D)-D.angleTo(k);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:R}),E+=R;x-w[0].distance>c;)E-=w.shift().angleDelta;if(E>d)return!1;y++,x+=D.dist(k)}return!0}function Eg(o){let i=0;for(let s=0;s<o.length-1;s++)i+=o[s].dist(o[s+1]);return i}function By(o,i,s){return o?.6*i*s:0}function Ny(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function F0(o,i,s,c,d,m){const y=By(s,d,m),x=Ny(s,c)*m;let w=0;const E=Eg(o)/2;for(let D=0;D<o.length-1;D++){const k=o[D],R=o[D+1],L=k.dist(R);if(w+L>E){const N=(E-w)/L,j=xn(k.x,R.x,N),q=xn(k.y,R.y,N),J=new tl(j,q,0,R.angleTo(k),D);return!y||Ly(o,J,x,y,i)?J:void 0}w+=L}}function dn(o,i,s,c,d,m,y,x,w){const E=By(c,m,y),D=Ny(c,d),k=D*y,R=0===o[0].x||o[0].x===w||0===o[0].y||o[0].y===w;return i-k<i/4&&(i=k+i/4),ut(o,R?i/2*x%i:(D/2+2*m)*y*x%i,i,E,s,k,R,!1,w)}function ut(o,i,s,c,d,m,y,x,w){const E=m/2,D=Eg(o);let k=0,R=i-s,L=[];for(let N=0;N<o.length-1;N++){const j=o[N],q=o[N+1],J=j.dist(q),se=q.angleTo(j);for(;R+s<k+J;){R+=s;const Y=(R-k)/J,oe=xn(j.x,q.x,Y),ce=xn(j.y,q.y,Y);if(oe>=0&&oe<w&&ce>=0&&ce<w&&R-E>=0&&R+E<=D){const le=new tl(oe,ce,0,se,N);le._round(),c&&!Ly(o,le,m,c,d)||L.push(le)}}k+=J}return x||L.length||y||(L=ut(o,k/2,s,c,d,m,y,!0,w)),L}function Ig(o,i,s,c,d){const m=[];for(let y=0;y<o.length;y++){const x=o[y];let w;for(let E=0;E<x.length-1;E++){let D=x[E],k=x[E+1];D.x<i&&k.x<i||(D.x<i?D=new at(i,D.y+(i-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<i&&(k=new at(i,D.y+(i-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<s&&k.y<s||(D.y<s?D=new at(D.x+(s-D.y)/(k.y-D.y)*(k.x-D.x),s)._round():k.y<s&&(k=new at(D.x+(s-D.y)/(k.y-D.y)*(k.x-D.x),s)._round()),D.x>=c&&k.x>=c||(D.x>=c?D=new at(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=c&&(k=new at(c,D.y+(c-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=d&&k.y>=d||(D.y>=d?D=new at(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round():k.y>=d&&(k=new at(D.x+(d-D.y)/(k.y-D.y)*(k.x-D.x),d)._round()),w&&D.equals(w[w.length-1])||(w=[D],m.push(w)),w.push(k)))))}}return m}Ae(tl,"Anchor");const dh=1e20;function zy(o,i,s,c,d,m,y,x,w){for(let E=i;E<i+c;E++)Vy(o,s*m+E,m,d,y,x,w);for(let E=s;E<s+d;E++)Vy(o,E*m+i,1,c,y,x,w)}function Vy(o,i,s,c,d,m,y){m[0]=0,y[0]=-dh,y[1]=dh,d[0]=o[i];for(let x=1,w=0,E=0;x<c;x++){d[x]=o[i+x*s];const D=x*x;do{const k=m[w];E=(d[x]-d[k]+D-k*k)/(x-k)/2}while(E<=y[w]&&--w>-1);w++,m[w]=x,y[w]=E,y[w+1]=dh}for(let x=0,w=0;x<c;x++){for(;y[w+1]<x;)w++;const E=m[w],D=x-E;o[i+x*s]=d[E]+D*D}}const ys=2,Mg={none:0,ideographs:1,all:2};class $c{constructor(i,s,c){this.requestManager=i,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,s){const c=[];for(const d in i)for(const m of i[d])c.push({stack:d,id:m});Bi(c,({stack:d,id:m},y)=>{let x=this.entries[d];x||(x=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(void 0!==w)return void y(null,{stack:d,id:m,glyph:w});if(w=this._tinySDF(x,d,m),w)return x.glyphs[m]=w,void y(null,{stack:d,id:m,glyph:w});const E=Math.floor(m/256);if(256*E>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void y(null,{stack:d,id:m,glyph:w});let D=x.requests[E];D||(D=x.requests[E]=[],$c.loadGlyphRange(d,E,this.url,this.requestManager,(k,R)=>{if(R){x.ascender=R.ascender,x.descender=R.descender;for(const L in R.glyphs)this._doesCharSupportLocalGlyph(+L)||(x.glyphs[+L]=R.glyphs[+L]);x.ranges[E]=!0}for(const L of D)L(k,R);delete x.requests[E]})),D.push((k,R)=>{k?y(k):R&&y(null,{stack:d,id:m,glyph:R.glyphs[m]||null})})},(d,m)=>{if(d)s(d);else if(m){const y={};for(const{stack:x,id:w,glyph:E}of m)void 0===y[x]&&(y[x]={}),void 0===y[x].glyphs&&(y[x].glyphs={}),y[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;s(null,y)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Mg.none&&(this.localGlyphMode===Mg.all?!!this.localFontFamily:!!this.localFontFamily&&(dt["CJK Unified Ideographs"](i)||dt["Hangul Syllables"](i)||dt.Hiragana(i)||dt.Katakana(i)||dt["CJK Symbols and Punctuation"](i)))}_tinySDF(i,s,c){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let m=i.tinySDF;if(!m){let j="400";/bold/i.test(s)?j="900":/medium/i.test(s)?j="500":/light/i.test(s)&&(j="200"),m=i.tinySDF=new $c.TinySDF({fontFamily:d,fontWeight:j,fontSize:24*ys,buffer:3*ys,radius:8*ys}),m.fontWeight=j}if(this.localGlyphs[m.fontWeight][c])return this.localGlyphs[m.fontWeight][c];const y=String.fromCharCode(c),{data:x,width:w,height:E,glyphWidth:D,glyphHeight:k,glyphLeft:R,glyphTop:L,glyphAdvance:N}=m.draw(y);return this.localGlyphs[m.fontWeight][c]={id:c,bitmap:new va({width:w,height:E},x),metrics:{width:D/ys,height:k/ys,left:R/ys,top:L/ys-27,advance:N/ys,localGlyph:!0}}}}$c.loadGlyphRange=function(o,i,s,c,d){const m=256*i,y=m+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",o).replace("{range}",`${m}-${y}`),Pa.Glyphs);_l(x,(w,E)=>{if(w)d(w);else if(E){const D={},k=new sf(E).readFields(S0,{});for(const R of k.glyphs)D[R.id]=R;d(null,{glyphs:D,ascender:k.ascender,descender:k.descender})}})},$c.TinySDF=class{constructor({fontSize:o=24,buffer:i=3,radius:s=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=i,this.cutoff=c,this.radius=s;const x=this.size=o+4*i,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${y} ${m} ${o}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const i=document.createElement("canvas");return i.width=i.height=o,i}draw(o){const{width:i,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(o),y=Math.ceil(s),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-d))),w=Math.min(this.size-this.buffer,y+Math.ceil(c)),E=x+2*this.buffer,D=w+2*this.buffer,k=Math.max(E*D,0),R=new Uint8ClampedArray(k),L={data:R,width:E,height:D,glyphWidth:x,glyphHeight:w,glyphTop:y,glyphLeft:0,glyphAdvance:i};if(0===x||0===w)return L;const{ctx:N,buffer:j,gridInner:q,gridOuter:J}=this;N.clearRect(j,j,x,w),N.fillText(o,j,j+y);const se=N.getImageData(j,j,x,w);J.fill(dh,0,k),q.fill(0,0,k);for(let Y=0;Y<w;Y++)for(let oe=0;oe<x;oe++){const ce=se.data[4*(Y*x+oe)+3]/255;if(0===ce)continue;const le=(Y+j)*E+oe+j;if(1===ce)J[le]=0,q[le]=dh;else{const xe=.5-ce;J[le]=xe>0?xe*xe:0,q[le]=xe<0?xe*xe:0}}zy(J,0,0,E,D,E,this.f,this.v,this.z),zy(q,j,j,x,w,E,this.f,this.v,this.z);for(let Y=0;Y<k;Y++){const oe=Math.sqrt(J[Y])-Math.sqrt(q[Y]);R[Y]=Math.round(255-255*(oe/this.radius+this.cutoff))}return L}};const ph=Ki;function jy(o,i,s,c){const d=[],m=o.image,y=m.pixelRatio,x=m.paddedRect.w-2*ph,w=m.paddedRect.h-2*ph,E=o.right-o.left,D=o.bottom-o.top,k=m.stretchX||[[0,x]],R=m.stretchY||[[0,w]],L=(Te,Ne)=>Te+Ne[1]-Ne[0],N=k.reduce(L,0),j=R.reduce(L,0),q=x-N,J=w-j;let se=0,Y=N,oe=0,ce=j,le=0,xe=q,we=0,Re=J;if(m.content&&c){const Te=m.content;se=Tg(k,0,Te[0]),oe=Tg(R,0,Te[1]),Y=Tg(k,Te[0],Te[2]),ce=Tg(R,Te[1],Te[3]),le=Te[0]-se,we=Te[1]-oe,xe=Te[2]-Te[0]-Y,Re=Te[3]-Te[1]-ce}const $e=(Te,Ne,ze,Ge)=>{const Xe=Sd(Te.stretch-se,Y,E,o.left),Pe=xo(Te.fixed-le,xe,Te.stretch,N),lt=Sd(Ne.stretch-oe,ce,D,o.top),gt=xo(Ne.fixed-we,Re,Ne.stretch,j),ht=Sd(ze.stretch-se,Y,E,o.left),zt=xo(ze.fixed-le,xe,ze.stretch,N),nt=Sd(Ge.stretch-oe,ce,D,o.top),It=xo(Ge.fixed-we,Re,Ge.stretch,j),Vt=new at(Xe,lt),wn=new at(ht,lt),jt=new at(ht,nt),Pt=new at(Xe,nt),Yn=new at(Pe/y,gt/y),yt=new at(zt/y,It/y),Wt=i*Math.PI/180;if(Wt){const Un=Math.sin(Wt),Hn=Math.cos(Wt),ke=[Hn,-Un,Un,Hn];Vt._matMult(ke),wn._matMult(ke),Pt._matMult(ke),jt._matMult(ke)}const Nn=Te.stretch+Te.fixed,ot=Ne.stretch+Ne.fixed;return{tl:Vt,tr:wn,bl:Pt,br:jt,tex:{x:m.paddedRect.x+ph+Nn,y:m.paddedRect.y+ph+ot,w:ze.stretch+ze.fixed-Nn,h:Ge.stretch+Ge.fixed-ot},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yn,pixelOffsetBR:yt,minFontScaleX:xe/y/E,minFontScaleY:Re/y/D,isSDF:s}};if(c&&(m.stretchX||m.stretchY)){const Te=Dg(k,q,N),Ne=Dg(R,J,j);for(let ze=0;ze<Te.length-1;ze++){const Ge=Te[ze],Xe=Te[ze+1];for(let Pe=0;Pe<Ne.length-1;Pe++)d.push($e(Ge,Ne[Pe],Xe,Ne[Pe+1]))}}else d.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return d}function Tg(o,i,s){let c=0;for(const d of o)c+=Math.max(i,Math.min(s,d[1]))-Math.max(i,Math.min(s,d[0]));return c}function Dg(o,i,s){const c=[{fixed:-ph,stretch:0}];for(const[d,m]of o){const y=c[c.length-1];c.push({fixed:d-y.stretch,stretch:y.stretch}),c.push({fixed:d-y.stretch,stretch:y.stretch+(m-d)})}return c.push({fixed:i+ph,stretch:s}),c}function Sd(o,i,s,c){return o/i*s+c}function xo(o,i,s,c){return o-i*s/c}function L0(o,i,s,c){const d=i+o.positionedLines[c].lineOffset;return 0===c?s+d/2:s+(d+(i+o.positionedLines[c-1].lineOffset))/2}class Sg{constructor(i=[],s=kg){if(this.data=i,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:s,compare:c}=this,d=s[i];for(;i>0;){const m=i-1>>1,y=s[m];if(c(d,y)>=0)break;s[i]=y,i=m}s[i]=d}_down(i){const{data:s,compare:c}=this,d=this.length>>1,m=s[i];for(;i<d;){let y=1+(i<<1),x=s[y];const w=y+1;if(w<this.length&&c(s[w],x)<0&&(y=w,x=s[w]),c(x,m)>=0)break;s[i]=x,i=y}s[i]=m}}function kg(o,i){return o<i?-1:o>i?1:0}function B0(o,i=1,s=!1){let c=1/0,d=1/0,m=-1/0,y=-1/0;const x=o[0];for(let L=0;L<x.length;L++){const N=x[L];(!L||N.x<c)&&(c=N.x),(!L||N.y<d)&&(d=N.y),(!L||N.x>m)&&(m=N.x),(!L||N.y>y)&&(y=N.y)}const w=Math.min(m-c,y-d);let E=w/2;const D=new Sg([],kw);if(0===w)return new at(c,d);for(let L=c;L<m;L+=w)for(let N=d;N<y;N+=w)D.push(new kd(L+E,N+E,E,o));let k=function(L){let N=0,j=0,q=0;const J=L[0];for(let se=0,Y=J.length,oe=Y-1;se<Y;oe=se++){const ce=J[se],le=J[oe],xe=ce.x*le.y-le.x*ce.y;j+=(ce.x+le.x)*xe,q+=(ce.y+le.y)*xe,N+=3*xe}return new kd(j/N,q/N,0,L)}(o),R=D.length;for(;D.length;){const L=D.pop();(L.d>k.d||!k.d)&&(k=L,s&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,R)),L.max-k.d<=i||(E=L.h/2,D.push(new kd(L.p.x-E,L.p.y-E,E,o)),D.push(new kd(L.p.x+E,L.p.y-E,E,o)),D.push(new kd(L.p.x-E,L.p.y+E,E,o)),D.push(new kd(L.p.x+E,L.p.y+E,E,o)),R+=4)}return s&&(console.log(`num probes: ${R}`),console.log(`best distance: ${k.d}`)),k.p}function kw(o,i){return i.max-o.max}class kd{constructor(i,s,c,d){this.p=new at(i,s),this.h=c,this.d=function(m,y){let x=!1,w=1/0;for(let E=0;E<y.length;E++){const D=y[E];for(let k=0,R=D.length,L=R-1;k<R;L=k++){const N=D[k],j=D[L];N.y>m.y!=j.y>m.y&&m.x<(j.x-N.x)*(m.y-N.y)/(j.y-N.y)+N.x&&(x=!x),w=Math.min(w,hy(m,N,j))}}return(x?1:-1)*Math.sqrt(w)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const Pd=7,Pg=Number.POSITIVE_INFINITY,Uy=Math.sqrt(2);function N0(o,[i,s]){let c=0,d=0;if(s===Pg){i<0&&(i=0);const m=i/Uy;switch(o){case"top-right":case"top-left":d=m-Pd;break;case"bottom-right":case"bottom-left":d=-m+Pd;break;case"bottom":d=-i+Pd;break;case"top":d=i-Pd}switch(o){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=i;break;case"right":c=-i}}else{switch(i=Math.abs(i),s=Math.abs(s),o){case"top-right":case"top-left":case"top":d=s-Pd;break;case"bottom-right":case"bottom-left":case"bottom":d=-s+Pd}switch(o){case"top-right":case"bottom-right":case"right":c=-i;break;case"top-left":case"bottom-left":case"left":c=i}}return[c,d]}function z0(o,i,s,c,d,m,y,x,w,E){o.createArrays(),o.tilePixelRatio=Tt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const D=o.layers[0].layout,k=o.layers[0]._unevaluatedLayout._values,R={};if("composite"===o.textSizeData.kind){const{minZoom:j,maxZoom:q}=o.textSizeData;R.compositeTextSizes=[k["text-size"].possiblyEvaluate(new S(j),x),k["text-size"].possiblyEvaluate(new S(q),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:j,maxZoom:q}=o.iconSizeData;R.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new S(j),x),k["icon-size"].possiblyEvaluate(new S(q),x)]}R.layoutTextSize=k["text-size"].possiblyEvaluate(new S(w+1),x),R.layoutIconSize=k["icon-size"].possiblyEvaluate(new S(w+1),x),R.textMaxSize=k["text-size"].possiblyEvaluate(new S(18),x);const L="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),N=D.get("text-size");for(const j of o.features){const q=D.get("text-font").evaluate(j,{},x).join(","),J=N.evaluate(j,{},x),se=R.layoutTextSize.evaluate(j,{},x),Y=(R.layoutIconSize.evaluate(j,{},x),{horizontal:{},vertical:void 0}),oe=j.text;let ce,le=[0,0];if(oe){const Re=oe.toString(),$e=D.get("text-letter-spacing").evaluate(j,{},x)*Xi,Te=D.get("text-line-height").evaluate(j,{},x)*Xi,Ne=us(Re)?$e:0,ze=D.get("text-anchor").evaluate(j,{},x),Ge=D.get("text-variable-anchor");if(!Ge){const ht=D.get("text-radial-offset").evaluate(j,{},x);le=ht?N0(ze,[ht*Xi,Pg]):D.get("text-offset").evaluate(j,{},x).map(zt=>zt*Xi)}let Xe=L?"center":D.get("text-justify").evaluate(j,{},x);const Pe="point"===D.get("symbol-placement"),lt=Pe?D.get("text-max-width").evaluate(j,{},x)*Xi:1/0,gt=ht=>{o.allowVerticalPlacement&&Ha(Re)&&(Y.vertical=ky(oe,i,s,d,q,lt,Te,ze,ht,Ne,le,$o.vertical,!0,se,J))};if(!L&&Ge){const ht="auto"===Xe?Ge.map(nt=>Hl(nt)):[Xe];let zt=!1;for(let nt=0;nt<ht.length;nt++){const It=ht[nt];if(!Y.horizontal[It])if(zt)Y.horizontal[It]=Y.horizontal[0];else{const Vt=ky(oe,i,s,d,q,lt,Te,"center",It,Ne,le,$o.horizontal,!1,se,J);Vt&&(Y.horizontal[It]=Vt,zt=1===Vt.positionedLines.length)}}gt("left")}else{if("auto"===Xe&&(Xe=Hl(ze)),Pe||D.get("text-writing-mode").indexOf("horizontal")>=0||!Ha(Re)){const ht=ky(oe,i,s,d,q,lt,Te,ze,Xe,Ne,le,$o.horizontal,!1,se,J);ht&&(Y.horizontal[Xe]=ht)}gt(Pe?"left":Xe)}}let xe=!1;if(j.icon&&j.icon.name){const Re=c[j.icon.name];Re&&(ce=O0(d[j.icon.name],D.get("icon-offset").evaluate(j,{},x),D.get("icon-anchor").evaluate(j,{},x)),xe=Re.sdf,void 0===o.sdfIcons?o.sdfIcons=Re.sdf:o.sdfIcons!==Re.sdf&&li("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==o.pixelRatio||0!==D.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const we=Rg(Y.horizontal)||Y.vertical;o.iconsInText||(o.iconsInText=!!we&&we.iconsInText),(we||ce)&&V0(o,j,Y,ce,c,R,se,0,le,xe,y,x,E)}m&&o.generateCollisionDebugBuffers(w,o.collisionBoxArray)}function Hl(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function V0(o,i,s,c,d,m,y,x,w,E,D,k,R){let L=m.textMaxSize.evaluate(i,{},k);void 0===L&&(L=y);const N=o.layers[0].layout,j=N.get("icon-offset").evaluate(i,{},k),q=Rg(s.horizontal)||s.vertical,J="globe"===R.name,se=Xi,Y=y/se,oe=o.tilePixelRatio*L/se,ce=(ze=o.overscaling,o.zoom>18&&ze>2&&(ze>>=1),Math.max(Tt/(512*ze),1)*N.get("symbol-spacing")),le=N.get("text-padding")*o.tilePixelRatio,xe=N.get("icon-padding")*o.tilePixelRatio,we=on(N.get("text-max-angle")),Re="map"===N.get("text-rotation-alignment")&&"point"!==N.get("symbol-placement"),$e="map"===N.get("icon-rotation-alignment")&&"point"!==N.get("symbol-placement"),Te=N.get("symbol-placement"),Ne=ce/2;var ze;const Ge=N.get("icon-text-fit");let Xe;c&&"none"!==Ge&&(o.allowVerticalPlacement&&s.vertical&&(Xe=Fy(c,s.vertical,Ge,N.get("icon-text-fit-padding"),j,Y)),q&&(c=Fy(c,q,Ge,N.get("icon-text-fit-padding"),j,Y)));const Pe=(lt,gt,ht)=>{if(gt.x<0||gt.x>=Tt||gt.y<0||gt.y>=Tt)return;let zt=null;if(J){const{x:nt,y:It,z:Vt}=R.projectTilePoint(gt.x,gt.y,ht);zt={anchor:new tl(nt,It,Vt,0,void 0),up:R.upVector(ht,gt.x,gt.y)}}!function(nt,It,Vt,wn,jt,Pt,Yn,yt,Wt,Nn,ot,Un,Hn,ke,Ve,St,$n,bi,gi,si,Gt,ai,qn,Ir,ft){const Yi=nt.addToLineVertexArray(It,wn);let Ji,jr,Ui,xs,Ot,jd,Ud,gv=0,Yc=0,wf=0,Wg=0,Cf=-1,Ef=-1;const qs={};let Zg=$u("");const Zl=Vt?Vt.anchor:It;let If=0,Mf=0;if(void 0===Wt._unevaluatedLayout.getValue("text-radial-offset")?[If,Mf]=Wt.layout.get("text-offset").evaluate(Gt,{},ft).map(wo=>wo*Xi):(If=Wt.layout.get("text-radial-offset").evaluate(Gt,{},ft)*Xi,Mf=Pg),nt.allowVerticalPlacement&&jt.vertical){const wo=jt.vertical;if(Ve)jd=Og(wo),yt&&(Ud=Og(yt));else{const Qr=Wt.layout.get("text-rotate").evaluate(Gt,{},ft)+90;Ui=cf(Nn,Zl,It,ot,Un,Hn,wo,ke,Qr,St),yt&&(xs=cf(Nn,Zl,It,ot,Un,Hn,yt,bi,Qr))}}if(Pt){const wo=Wt.layout.get("icon-rotate").evaluate(Gt,{},ft),Qr="none"!==Wt.layout.get("icon-text-fit"),Zs=jy(Pt,wo,qn,Qr),Gd=yt?jy(yt,wo,qn,Qr):void 0;jr=cf(Nn,Zl,It,ot,Un,Hn,Pt,bi,wo),gv=4*Zs.length;const _v=nt.iconSizeData;let il=null;"source"===_v.kind?(il=[Ho*Wt.layout.get("icon-size").evaluate(Gt,{},ft)],il[0]>js&&li(`${nt.layerIds[0]}: Value for "icon-size" is >= ${fh}. Reduce your "icon-size".`)):"composite"===_v.kind&&(il=[Ho*ai.compositeIconSizes[0].evaluate(Gt,{},ft),Ho*ai.compositeIconSizes[1].evaluate(Gt,{},ft)],(il[0]>js||il[1]>js)&&li(`${nt.layerIds[0]}: Value for "icon-size" is >= ${fh}. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,Zs,il,si,gi,Gt,!1,Vt,It,Yi.lineStartIndex,Yi.lineLength,-1,Ir,ft),Cf=nt.icon.placedSymbolArray.length-1,Gd&&(Yc=4*Gd.length,nt.addSymbols(nt.icon,Gd,il,si,gi,Gt,$o.vertical,Vt,It,Yi.lineStartIndex,Yi.lineLength,-1,Ir,ft),Ef=nt.icon.placedSymbolArray.length-1)}for(const wo in jt.horizontal){const Qr=jt.horizontal[wo];Ji||(Zg=$u(Qr.text),Ve?Ot=Og(Qr):Ji=cf(Nn,Zl,It,ot,Un,Hn,Qr,ke,Wt.layout.get("text-rotate").evaluate(Gt,{},ft),St));const Zs=1===Qr.positionedLines.length;if(wf+=Gy(nt,Vt,It,Qr,Yn,Wt,Ve,Gt,St,Yi,jt.vertical?$o.horizontal:$o.horizontalOnly,Zs?Object.keys(jt.horizontal):[wo],qs,Cf,ai,Ir,ft),Zs)break}jt.vertical&&(Wg+=Gy(nt,Vt,It,jt.vertical,Yn,Wt,Ve,Gt,St,Yi,$o.vertical,["vertical"],qs,Ef,ai,Ir,ft));let Ws=-1;const Ca=(wo,Qr)=>wo?Math.max(wo,Qr):Qr;Ws=Ca(Ot,Ws),Ws=Ca(jd,Ws),Ws=Ca(Ud,Ws);const K0=Ws>-1?1:0;nt.glyphOffsetArray.length>=nl.MAX_GLYPHS&&li("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Gt.sortKey&&nt.addToSortKeyRanges(nt.symbolInstances.length,Gt.sortKey),nt.symbolInstances.emplaceBack(Zl.x,Zl.y,Zl.z,It.x,It.y,qs.right>=0?qs.right:-1,qs.center>=0?qs.center:-1,qs.left>=0?qs.left:-1,qs.vertical>=0?qs.vertical:-1,Cf,Ef,Zg,void 0!==Ji?Ji:nt.collisionBoxArray.length,void 0!==Ji?Ji+1:nt.collisionBoxArray.length,void 0!==Ui?Ui:nt.collisionBoxArray.length,void 0!==Ui?Ui+1:nt.collisionBoxArray.length,void 0!==jr?jr:nt.collisionBoxArray.length,void 0!==jr?jr+1:nt.collisionBoxArray.length,xs||nt.collisionBoxArray.length,xs?xs+1:nt.collisionBoxArray.length,ot,wf,Wg,gv,Yc,K0,0,If,Mf,Ws)}(o,gt,zt,lt,s,c,d,Xe,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,le,Re,w,0,xe,$e,j,i,m,E,D,k)};if("line"===Te)for(const lt of Ig(i.geometry,0,0,Tt,Tt)){const gt=dn(lt,ce,we,s.vertical||q,c,se,oe,o.overscaling,Tt);for(const ht of gt)q&&j0(o,q.text,Ne,ht)||Pe(lt,ht,k)}else if("line-center"===Te){for(const lt of i.geometry)if(lt.length>1){const gt=F0(lt,we,s.vertical||q,c,se,oe);gt&&Pe(lt,gt,k)}}else if("Polygon"===i.type)for(const lt of Jm(i.geometry,0)){const gt=B0(lt,16);Pe(lt[0],new tl(gt.x,gt.y,0,0,void 0),k)}else if("LineString"===i.type)for(const lt of i.geometry)Pe(lt,new tl(lt[0].x,lt[0].y,0,0,void 0),k);else if("Point"===i.type)for(const lt of i.geometry)for(const gt of lt)Pe([gt],new tl(gt.x,gt.y,0,0,void 0),k)}const fh=255,js=fh*Ho;function Gy(o,i,s,c,d,m,y,x,w,E,D,k,R,L,N,j,q){const J=function(oe,ce,le,xe,we,Re,$e,Te){const Ne=[];if(0===ce.positionedLines.length)return Ne;const ze=xe.layout.get("text-rotate").evaluate(Re,{})*Math.PI/180,Ge=function(ht){const zt=ht[0],nt=ht[1],It=zt*nt;return It>0?[zt,-nt]:It<0?[-zt,nt]:0===zt?[nt,zt]:[nt,-zt]}(le);let Xe=Math.abs(ce.top-ce.bottom);for(const ht of ce.positionedLines)Xe-=ht.lineOffset;const Pe=ce.positionedLines.length,lt=Xe/Pe;let gt=ce.top-le[1];for(let ht=0;ht<Pe;++ht){const zt=ce.positionedLines[ht];gt=L0(ce,lt,gt,ht);for(const nt of zt.positionedGlyphs){if(!nt.rect)continue;const It=nt.rect||{};let Vt=af+1,wn=!0,jt=1,Pt=0;if(nt.imageName){const qn=$e[nt.imageName];if(!qn)continue;if(qn.sdf){li("SDF images are not supported in formatted text and will be ignored.");continue}wn=!1,jt=qn.pixelRatio,Vt=Ki/jt}const Yn=(we||Te)&&nt.vertical,yt=nt.metrics.advance*nt.scale/2,Wt=nt.metrics,Nn=nt.rect;if(null===Nn)continue;Te&&ce.verticalizable&&(Pt=nt.imageName?yt-nt.metrics.width*nt.scale/2:0);const ot=we?[nt.x+yt,nt.y]:[0,0];let Un=[0,0],Hn=[0,0],ke=!1;we||(Yn?(Hn=[nt.x+yt+Ge[0],nt.y+Ge[1]-Pt],ke=!0):Un=[nt.x+yt+le[0],nt.y+le[1]-Pt]);const Ve=Nn.w*nt.scale/(jt*(nt.localGlyph?ys:1)),St=Nn.h*nt.scale/(jt*(nt.localGlyph?ys:1));let $n,bi,gi,si;if(Yn){const qn=nt.y-gt,Ir=new at(-yt,yt-qn),ft=-Math.PI/2,Yi=new at(...Hn);$n=new at(-yt+Un[0],Un[1]),$n._rotateAround(ft,Ir)._add(Yi),$n.x+=-qn+yt,$n.y-=(Wt.left-Vt)*nt.scale;const Ji=nt.imageName?Wt.advance*nt.scale:Xi*nt.scale,jr=String.fromCharCode(nt.glyph);E0(jr)?$n.x+=(1-Vt)*nt.scale:gg(jr)?$n.x+=Ji-Wt.height*nt.scale+(-Vt-1)*nt.scale:$n.x+=nt.imageName||Wt.width+2*Vt===Nn.w&&Wt.height+2*Vt===Nn.h?(Ji-St)/2:(Ji-(Wt.height+2*Vt)*nt.scale)/2,bi=new at($n.x,$n.y-Ve),gi=new at($n.x+St,$n.y),si=new at($n.x+St,$n.y-Ve)}else{const qn=(Wt.left-Vt)*nt.scale-yt+Un[0],Ir=(-Wt.top-Vt)*nt.scale+Un[1],ft=qn+Ve,Yi=Ir+St;$n=new at(qn,Ir),bi=new at(ft,Ir),gi=new at(qn,Yi),si=new at(ft,Yi)}if(ze){let qn;qn=we?new at(0,0):ke?new at(Ge[0],Ge[1]):new at(le[0],le[1]),$n._rotateAround(ze,qn),bi._rotateAround(ze,qn),gi._rotateAround(ze,qn),si._rotateAround(ze,qn)}const Gt=new at(0,0),ai=new at(0,0);Ne.push({tl:$n,tr:bi,bl:gi,br:si,tex:It,writingMode:ce.writingMode,glyphOffset:ot,sectionIndex:nt.sectionIndex,isSDF:wn,pixelOffsetTL:Gt,pixelOffsetBR:ai,minFontScaleX:0,minFontScaleY:0})}}return Ne}(0,c,w,m,y,x,d,o.allowVerticalPlacement),se=o.textSizeData;let Y=null;"source"===se.kind?(Y=[Ho*m.layout.get("text-size").evaluate(x,{},q)],Y[0]>js&&li(`${o.layerIds[0]}: Value for "text-size" is >= ${fh}. Reduce your "text-size".`)):"composite"===se.kind&&(Y=[Ho*N.compositeTextSizes[0].evaluate(x,{},q),Ho*N.compositeTextSizes[1].evaluate(x,{},q)],(Y[0]>js||Y[1]>js)&&li(`${o.layerIds[0]}: Value for "text-size" is >= ${fh}. Reduce your "text-size".`)),o.addSymbols(o.text,J,Y,w,y,x,D,i,s,E.lineStartIndex,E.lineLength,L,j,q);for(const oe of k)R[oe]=o.text.placedSymbolArray.length-1;return 4*J.length}function Rg(o){for(const i in o)return o[i];return null}function cf(o,i,s,c,d,m,y,x,w,E){let D=y.top,k=y.bottom,R=y.left,L=y.right;const N=y.collisionPadding;if(N&&(R-=N[0],D-=N[1],L+=N[2],k+=N[3]),w){const j=new at(R,D),q=new at(L,D),J=new at(R,k),se=new at(L,k),Y=on(w);let oe=new at(0,0);E&&(oe=new at(E[0],E[1])),j._rotateAround(Y,oe),q._rotateAround(Y,oe),J._rotateAround(Y,oe),se._rotateAround(Y,oe),R=Math.min(j.x,q.x,J.x,se.x),L=Math.max(j.x,q.x,J.x,se.x),D=Math.min(j.y,q.y,J.y,se.y),k=Math.max(j.y,q.y,J.y,se.y)}return o.emplaceBack(i.x,i.y,i.z,s.x,s.y,R,D,L,k,x,c,d,m),o.length-1}function Og(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const i=o.bottom-o.top;return i>0?Math.max(10,i):null}function j0(o,i,s,c){const d=o.compareText;if(i in d){const m=d[i];for(let y=m.length-1;y>=0;y--)if(c.dist(m[y])<s)return!0}else d[i]=[];return d[i].push(c),!1}function Hy(o,i){const s=o.fovAboveCenter,c=o.elevation?o.elevation.getMinElevationBelowMSL()*i:0,d=(o._camera.position[2]*o.worldSize-c)/Math.cos(o._pitch),m=Math.sin(s)*d/Math.sin(Math.max(Math.PI/2-o._pitch-s,.01)),y=Math.sin(o._pitch)*m+d;return Math.min(1.01*y,d*(1/o._horizonShift))}function qc(o,i){if(!i.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:i};const s=Math.pow(2,-o.z),c=o.x*s,d=(o.x+1)*s,m=o.y*s,y=(o.y+1)*s,x=Go(c),w=Go(d),E=lr(m),D=lr(y),k=i.project(x,E),R=i.project(w,E),L=i.project(w,D),N=i.project(x,D);let j=Math.min(k.x,R.x,L.x,N.x),q=Math.min(k.y,R.y,L.y,N.y),J=Math.max(k.x,R.x,L.x,N.x),se=Math.max(k.y,R.y,L.y,N.y);const Y=s/16;function oe(le,xe,we,Re,$e,Te){const Ne=(we+$e)/2,ze=(Re+Te)/2,Ge=i.project(Go(Ne),lr(ze)),Xe=Math.max(0,j-Ge.x,q-Ge.y,Ge.x-J,Ge.y-se);j=Math.min(j,Ge.x),J=Math.max(J,Ge.x),q=Math.min(q,Ge.y),se=Math.max(se,Ge.y),Xe>Y&&(oe(le,Ge,we,Re,Ne,ze),oe(Ge,xe,Ne,ze,$e,Te))}oe(k,R,c,m,d,m),oe(R,L,d,m,d,y),oe(L,N,d,y,c,y),oe(N,k,c,y,c,m),j-=Y,q-=Y,J+=Y,se+=Y;const ce=1/Math.max(J-j,se-q);return{scale:ce,x:j*ce,y:q*ce,x2:J*ce,y2:se*ce,projection:i}}const $y=Br(new Float32Array(16));class $l{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,s){return{x:0,y:0,z:0}}unproject(i,s){return new Pn(0,0)}projectTilePoint(i,s,c){return{x:i,y:s,z:0}}locationPoint(i,s,c=!0){return i._coordinatePoint(i.locationCoordinate(s),c)}pixelsPerMeter(i,s){return ms(1,i)*s}pixelSpaceConversion(i,s,c){return 1}farthestPixelDistance(i){return Hy(i,i.pixelsPerMeter)}pointCoordinate(i,s,c,d){const m=i.horizonLineFromTop(!1),y=new at(s,Math.max(m,c));return i.rayIntersectionCoordinate(i.pointRayIntersection(y,d))}pointCoordinate3D(i,s,c){const d=new at(s,c);if(i.elevation)return i.elevation.pointCoordinate(d);{const m=this.pointCoordinate(i,d.x,d.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(i,s){if(i.elevation)return!this.pointCoordinate3D(i,s.x,s.y);const c=i.horizonLineFromTop();return s.y<c}createInversionMatrix(i,s){return $y}createTileMatrix(i,s,c){let d,m,y;const x=c.canonical,w=Br(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=qc(x,this);d=1,m=E.x+c.wrap*E.scale,y=E.y,kc(w,w,[d/E.scale,d/E.scale,i.pixelsPerMeter/s])}else d=s/i.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*c.wrap)*d,y=x.y*d;return qa(w,w,[m,y,0]),kc(w,w,[d/Tt,d/Tt,1]),w}upVector(i,s,c){return[0,0,1]}upVectorScale(i,s,c){return{metersToTile:1}}}class qy extends $l{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[s,c]=this.parallels=i.parallels||[29.5,45.5],d=Math.sin(on(s));this.n=(d+Math.sin(on(c)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(i,s){const{n:c,c:d,r0:m}=this,y=on(i-this.center[0]),x=on(s),w=Math.sqrt(d-2*c*Math.sin(x))/c;return{x:w*Math.sin(y*c),y:w*Math.cos(y*c)-m,z:0}}unproject(i,s){const{n:c,c:d,r0:m}=this,y=m+s;let x=Math.atan2(i,Math.abs(y))*Math.sign(y);y*c<0&&(x-=Math.PI*Math.sign(i)*Math.sign(y));const w=on(this.center[0])*c;x=pn(x,-Math.PI-w,Math.PI-w);const E=cn(Hi(x/c)+this.center[0],-180,180),D=Math.asin(cn((d-(i*i+y*y)*c*c)/(2*c),-1,1)),k=cn(Hi(D),-cr,cr);return new Pn(E,k)}}const mh=1.340264,Wc=-.081106,uf=893e-6,Zc=.003796,hf=Math.sqrt(3)/2;class Pw extends $l{project(i,s){s=s/180*Math.PI,i=i/180*Math.PI;const c=Math.asin(hf*Math.sin(s)),d=c*c,m=d*d*d;return{x:.5*(i*Math.cos(c)/(hf*(mh+3*Wc*d+m*(7*uf+9*Zc*d)))/Math.PI+.5),y:1-.5*(c*(mh+Wc*d+m*(uf+Zc*d))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,d=c*c,m=d*d*d;for(let D,k,R,L=0;L<12&&(k=c*(mh+Wc*d+m*(uf+Zc*d))-s,R=mh+3*Wc*d+m*(7*uf+9*Zc*d),D=k/R,c=cn(c-D,-Math.PI/3,Math.PI/3),d=c*c,m=d*d*d,!(Math.abs(D)<1e-12));++L);const y=hf*i*(mh+3*Wc*d+m*(7*uf+9*Zc*d))/Math.cos(c),x=Math.asin(Math.sin(c)/hf),w=cn(180*y/Math.PI,-180,180),E=cn(180*x/Math.PI,-cr,cr);return new Pn(w,E)}}class He extends $l{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){return{x:.5+i/360,y:.5-s/360,z:0}}unproject(i,s){const c=360*(i-.5),d=cn(360*(.5-s),-cr,cr);return new Pn(c,d)}}const Qc=Math.PI/2;function df(o){return Math.tan((Qc+o)/2)}class Wy extends $l{constructor(i){super(i),this.center=i.center||[0,30];const[s,c]=this.parallels=i.parallels||[30,30];let d=on(s),m=on(c);this.southernCenter=d+m<0,this.southernCenter&&(d=-d,m=-m);const y=Math.cos(d),x=df(d);this.n=d===m?Math.sin(d):Math.log(y/Math.cos(m))/Math.log(df(m)/x),this.f=y*Math.pow(df(d),this.n)/this.n}project(i,s){s=on(s),this.southernCenter&&(s=-s),i=on(i-this.center[0]);const c=1e-6,{n:d,f:m}=this;m>0?s<-Qc+c&&(s=-Qc+c):s>Qc-c&&(s=Qc-c);const y=m/Math.pow(df(s),d);let x=y*Math.sin(d*i),w=m-y*Math.cos(d*i);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(i,s){i=(2*i-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:c,f:d}=this,m=d-s,y=Math.sign(m),x=Math.sign(c)*Math.sqrt(i*i+m*m);let w=Math.atan2(i,Math.abs(m))*y;m*c<0&&(w-=Math.PI*Math.sign(i)*y);const E=cn(Hi(w/c)+this.center[0],-180,180),D=cn(Hi(2*Math.atan(Math.pow(d/x,1/c))-Qc),-cr,cr);return new Pn(E,this.southernCenter?-D:D)}}class Zy extends $l{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,s){return{x:Bs(i),y:ya(s),z:0}}unproject(i,s){const c=Go(i),d=lr(s);return new Pn(c,d)}}const Qy=on(cr);class pf extends $l{project(i,s){const c=(s=on(s))*s,d=c*c;return{x:.5*((i=on(i))*(.8707-.131979*c+d*(d*(.003971*c-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+d*(.028874*c-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(i,s){i=(2*i-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,d=25,m=0,y=c*c;do{y=c*c;const E=y*y;m=(c*(1.007226+y*(.015085+E*(.028874*y-.044475-.005916*E)))-s)/(1.007226+y*(.045255+E*(.259866*y-.311325-.005916*11*E))),c=cn(c-m,-Qy,Qy)}while(Math.abs(m)>1e-6&&--d>0);y=c*c;const x=cn(Hi(i/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),w=Hi(c);return new Pn(x,w)}}const Xc=on(cr);class Fg extends $l{project(i,s){s=on(s),i=on(i);const c=Math.cos(s),d=2/Math.PI,m=Math.acos(c*Math.cos(i/2)),y=Math.sin(m)/m,x=.5*(i*d+2*c*Math.sin(i/2)/y)||0,w=.5*(s+Math.sin(s)/y)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(i,s){let c=i=(2*i-.5)*Math.PI,d=s=(2*(1-s)-1)*Math.PI,m=25;const y=1e-6;let x=0,w=0;do{const E=Math.cos(d),D=Math.sin(d),k=2*D*E,R=D*D,L=E*E,N=Math.cos(c/2),j=Math.sin(c/2),q=2*N*j,J=j*j,se=1-L*N*N,Y=se?1/se:0,oe=se?Math.acos(E*N)*Math.sqrt(1/se):0,ce=.5*(2*oe*E*j+2*c/Math.PI)-i,le=.5*(oe*D+d)-s,xe=.5*Y*(L*J+oe*E*N*R)+1/Math.PI,we=Y*(q*k/4-oe*D*j),Re=.125*Y*(k*j-oe*D*L*q),$e=.5*Y*(R*N+oe*J*E)+.5,Te=we*Re-$e*xe;x=(le*we-ce*$e)/Te,w=(ce*Re-le*xe)/Te,c=cn(c-x,-Math.PI,Math.PI),d=cn(d-w,-Xc,Xc)}while((Math.abs(x)>y||Math.abs(w)>y)&&--m>0);return new Pn(Hi(c),Hi(d))}}class gh extends $l{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(on(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,s){const{scale:c,cosPhi:d}=this;return{x:on(i)*d*c+.5,y:-Math.sin(on(s))/d*c+.5,z:0}}unproject(i,s){const{scale:c,cosPhi:d}=this,m=-(s-.5)/c,y=cn(Hi((i-.5)/c)/d,-180,180),x=Math.asin(cn(m*d,-1,1)),w=cn(Hi(x),-cr,cr);return new Pn(y,w)}}class Lg extends Zy{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(i,s,c){const d=gd(i,s,c);return ni(d,d,Fc(Qa(c))),{x:d[0],y:d[1],z:d[2]}}locationPoint(i,s){const c=Yu(s.lat,s.lng),d=Er([],c),m=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(s),i._centerAltitude):i._centerAltitude;Bl(c,c,d,ms(1,0)*Tt*m);const y=Br(new Float64Array(16));return _a(y,i.pixelMatrix,i.globeMatrix),ni(c,c,y),new at(c[0],c[1])}pixelsPerMeter(i,s){return ms(1,0)*s}pixelSpaceConversion(i,s,c){const d=ms(1,i)*s,m=xn(ms(1,45)*s,d,c);return this.pixelsPerMeter(i,s)/m}createTileMatrix(i,s,c){const d=wm(Qa(c.canonical));return _a(new Float64Array(16),i.globeMatrix,d)}createInversionMatrix(i,s){const{center:c}=i,d=Fc(Qa(s));return Sp(d,d,on(c.lng)),q_(d,d,on(c.lat)),kc(d,d,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(i,s,c,d){return JA(i,s,c,!0)||new th(0,0)}pointCoordinate3D(i,s,c){const d=this.pointCoordinate(i,s,c,0);return[d.x,d.y,d.z]}isPointAboveHorizon(i,s){return!JA(i,s.x,s.y,!1)}farthestPixelDistance(i){const s=function(d,m){const y=d.cameraToCenterDistance,x=d._centerAltitude*m,w=d._camera,E=d._camera.forward(),D=Wa([],no([],E,-y),[0,0,x]),k=d.worldSize/(2*Math.PI),R=[0,0,-k],L=d.width/d.height,N=Math.tan(d.fovAboveCenter),j=no([],w.up(),N),q=no([],w.right(),N*L),J=Er([],Wa([],Wa([],E,j),q)),se=[];let Y;if(new Ku(D,J).closestPointOnSphere(R,k,se)){const oe=Wa([],se,R),ce=io([],oe,D);Y=Math.cos(d.fovAboveCenter)*Wu(ce)}else{const oe=io([],D,R),ce=io([],R,D);Er(ce,ce);const le=Wu(oe)-k;Y=Math.sqrt(le*(le+2*k));const xe=Math.acos(Y/(k+le))-Math.acos(sr(E,ce));Y*=Math.cos(xe)}return 1.01*Y}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),c=Ju(i.zoom);if(c>0){const d=Hy(i,ms(1,i.center.lat)*i.worldSize),m=i.worldSize/(2*Math.PI),y=Math.max(i.width,i.height)/i.worldSize*Math.PI;return xn(s,d+m*(1-Math.cos(y)),Math.pow(c,10))}return s}upVector(i,s,c){return gd(s,c,i,1)}upVectorScale(i){return{metersToTile:Am(Lp(Qa(i)))}}}function Rd(o){const i=o.parallels,s=!!i&&Math.abs(i[0]+i[1])<.01;switch(o.name){case"mercator":return new Zy(o);case"equirectangular":return new He(o);case"naturalEarth":return new pf(o);case"equalEarth":return new Pw(o);case"winkelTripel":return new Fg(o);case"albers":return s?new gh(o):new qy(o);case"lambertConformalConic":return s?new gh(o):new Wy(o);case"globe":return new Lg(o)}throw new Error(`Invalid projection name: ${o.name}`)}const Xy=Kp.types,Bg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _h(o,i,s,c,d,m,y,x,w,E,D,k,R){const L=x?Math.min(js,Math.round(x[0])):0,N=x?Math.min(js,Math.round(x[1])):0;o.emplaceBack(i,s,Math.round(32*c),Math.round(32*d),m,y,(L<<1)+(w?1:0),N,16*E,16*D,256*k,256*R)}function yh(o,i,s,c,d,m,y){o.emplaceBack(i,s,c,d,m,y)}function Od(o,i,s,c,d){o.emplaceBack(i,s,c,d),o.emplaceBack(i,s,c,d),o.emplaceBack(i,s,c,d),o.emplaceBack(i,s,c,d)}function Ng(o){for(const i of o.sections)if(Lr(i.text))return!0;return!1}class zg{constructor(i){this.layoutVertexArray=new Ue,this.indexArray=new wt,this.programConfigurations=i,this.segments=new Oi,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new Ct,this.placedSymbolArray=new xi,this.globeExtVertexArray=new et}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,s,c,d){this.isEmpty()||(c&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,b0.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,tf.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Bg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,pg.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||d)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Ae(zg,"SymbolBuffers");class Vg{constructor(i,s,c){this.layoutVertexArray=new i,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Oi,this.collisionVertexArray=new hn,this.collisionVertexArrayExt=new ln}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,w0.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,fg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ae(Vg,"CollisionBuffers");class nl{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(y=>y.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Br([]),this.placementViewportMatrix=Br([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mg(this.zoom,s["text-size"]),this.iconSizeData=mg(this.zoom,s["icon-size"]);const c=this.layers[0].layout,d=c.get("symbol-sort-key"),m=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(y=>$o[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new zg(new Sc(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new zg(new Sc(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new mi,this.lineVertexArray=new Uu,this.symbolInstances=new ti}calculateGlyphDependencies(i,s,c,d,m){for(let y=0;y<i.length;y++)if(s[i.charCodeAt(y)]=!0,d&&m){const x=Md[i.charAt(y)];x&&(s[x.charCodeAt(0)]=!0)}}populate(i,s,c,d){const m=this.layers[0],y=m.layout,x="globe"===this.projection.name,w=y.get("text-font"),E=y.get("text-field"),D=y.get("icon-image"),k=("constant"!==E.value.kind||E.value.value instanceof Yr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),R="constant"!==D.value.kind||!!D.value.value||Object.keys(D.parameters).length>0,L=y.get("symbol-sort-key");if(this.features=[],!k&&!R)return;const N=s.iconDependencies,j=s.glyphDependencies,q=s.availableImages,J=new S(this.zoom);for(const{feature:se,id:Y,index:oe,sourceLayerIndex:ce}of i){const le=m._featureFilter.needGeometry,xe=Nl(se,le);if(!m._featureFilter.filter(J,xe,c))continue;if(le||(xe.geometry=Ns(se,c,d)),x&&1!==se.type&&c.z<=5){const Te=xe.geometry,Ne=.98078528056,ze=(Ge,Xe)=>sr(gd(Ge.x,Ge.y,c,1),gd(Xe.x,Xe.y,c,1))<Ne;for(let Ge=0;Ge<Te.length;Ge++)Te[Ge]=yd(Te[Ge],ze)}let we,Re;if(k){const Te=m.getValueAndResolveTokens("text-field",xe,c,q),Ne=Yr.factory(Te);Ng(Ne)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===b()||this.hasRTLText&&T.isParsed())&&(we=C0(Ne,m,xe))}if(R){const Te=m.getValueAndResolveTokens("icon-image",xe,c,q);Re=Te instanceof uo?Te:uo.fromString(Te)}if(!we&&!Re)continue;const $e=this.sortFeaturesByKey?L.evaluate(xe,{},c):void 0;if(this.features.push({id:Y,text:we,icon:Re,index:oe,sourceLayerIndex:ce,geometry:xe.geometry,properties:se.properties,type:Xy[se.type],sortKey:$e}),Re&&(N[Re.name]=!0),we){const Te=w.evaluate(xe,{},c).join(","),Ne="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf($o.vertical)>=0;for(const ze of we.sections)if(ze.image)N[ze.image.name]=!0;else{const Ge=Ha(we.toString()),Xe=ze.fontStack||Te,Pe=j[Xe]=j[Xe]||{};this.calculateGlyphDependencies(ze.text,Pe,Ne,this.allowVerticalPlacement,Ge)}}}"line"===y.get("symbol-placement")&&(this.features=function(se){const Y={},oe={},ce=[];let le=0;function xe(Te){ce.push(se[Te]),le++}function we(Te,Ne,ze){const Ge=oe[Te];return delete oe[Te],oe[Ne]=Ge,ce[Ge].geometry[0].pop(),ce[Ge].geometry[0]=ce[Ge].geometry[0].concat(ze[0]),Ge}function Re(Te,Ne,ze){const Ge=Y[Ne];return delete Y[Ne],Y[Te]=Ge,ce[Ge].geometry[0].shift(),ce[Ge].geometry[0]=ze[0].concat(ce[Ge].geometry[0]),Ge}function $e(Te,Ne,ze){const Ge=ze?Ne[0][Ne[0].length-1]:Ne[0][0];return`${Te}:${Ge.x}:${Ge.y}`}for(let Te=0;Te<se.length;Te++){const Ne=se[Te],ze=Ne.geometry,Ge=Ne.text?Ne.text.toString():null;if(!Ge){xe(Te);continue}const Xe=$e(Ge,ze),Pe=$e(Ge,ze,!0);if(Xe in oe&&Pe in Y&&oe[Xe]!==Y[Pe]){const lt=Re(Xe,Pe,ze),gt=we(Xe,Pe,ce[lt].geometry);delete Y[Xe],delete oe[Pe],oe[$e(Ge,ce[gt].geometry,!0)]=gt,ce[lt].geometry=null}else Xe in oe?we(Xe,Pe,ze):Pe in Y?Re(Xe,Pe,ze):(xe(Te),Y[Xe]=le-1,oe[Pe]=le-1)}return ce.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((se,Y)=>se.sortKey-Y.sortKey)}update(i,s,c,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,s,this.layers,c,d),this.icon.programConfigurations.updatePaintArrays(i,s,this.layers,c,d))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Rd(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,s){const c=this.lineVertexArray.length;if(void 0!==i.segment)for(const{x:d,y:m}of s)this.lineVertexArray.emplaceBack(d,m);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(i,s,c,d,m,y,x,w,E,D,k,R,L,N){const j=i.indexArray,q=i.layoutVertexArray,J=i.globeExtVertexArray,se=i.segments.prepareSegment(4*s.length,q,j,this.canOverlap?y.sortKey:void 0),Y=this.glyphOffsetArray.length,oe=se.vertexLength,ce=this.allowVerticalPlacement&&x===$o.vertical?Math.PI/2:0,le=y.text&&y.text.sections;for(let we=0;we<s.length;we++){const{tl:Re,tr:$e,bl:Te,br:Ne,tex:ze,pixelOffsetTL:Ge,pixelOffsetBR:Xe,minFontScaleX:Pe,minFontScaleY:lt,glyphOffset:gt,isSDF:ht,sectionIndex:zt}=s[we],nt=se.vertexLength,It=gt[1];if(_h(q,E.x,E.y,Re.x,It+Re.y,ze.x,ze.y,c,ht,Ge.x,Ge.y,Pe,lt),_h(q,E.x,E.y,$e.x,It+$e.y,ze.x+ze.w,ze.y,c,ht,Xe.x,Ge.y,Pe,lt),_h(q,E.x,E.y,Te.x,It+Te.y,ze.x,ze.y+ze.h,c,ht,Ge.x,Xe.y,Pe,lt),_h(q,E.x,E.y,Ne.x,It+Ne.y,ze.x+ze.w,ze.y+ze.h,c,ht,Xe.x,Xe.y,Pe,lt),w){const{x:Vt,y:wn,z:jt}=w.anchor,[Pt,Yn,yt]=w.up;yh(J,Vt,wn,jt,Pt,Yn,yt),yh(J,Vt,wn,jt,Pt,Yn,yt),yh(J,Vt,wn,jt,Pt,Yn,yt),yh(J,Vt,wn,jt,Pt,Yn,yt),Od(i.dynamicLayoutVertexArray,Vt,wn,jt,ce)}else Od(i.dynamicLayoutVertexArray,E.x,E.y,E.z,ce);j.emplaceBack(nt,nt+1,nt+2),j.emplaceBack(nt+1,nt+2,nt+3),se.vertexLength+=4,se.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),we!==s.length-1&&zt===s[we+1].sectionIndex||i.programConfigurations.populatePaintArrays(q.length,y,y.index,{},L,N,le&&le[zt])}const xe=w?w.anchor:E;i.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,E.x,E.y,Y,this.glyphOffsetArray.length-Y,oe,D,k,E.segment,c?c[0]:0,c?c[1]:0,d[0],d[1],x,0,!1,0,R,0)}_commitLayoutVertex(i,s,c,d,m,y,x){i.emplaceBack(s,c,d,m,y,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(i,s,c,d,m,y,x){const w=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=w.vertexLength,D=x.tileAnchorX,k=x.tileAnchorY;for(let L=0;L<4;L++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,-i.padding),c.collisionVertexArrayExt.emplaceBack(s,i.padding,i.padding),c.collisionVertexArrayExt.emplaceBack(s,-i.padding,i.padding),this._commitLayoutVertex(c.layoutVertexArray,d,m,y,D,k,new at(i.x1,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,y,D,k,new at(i.x2,i.y1)),this._commitLayoutVertex(c.layoutVertexArray,d,m,y,D,k,new at(i.x2,i.y2)),this._commitLayoutVertex(c.layoutVertexArray,d,m,y,D,k,new at(i.x1,i.y2)),w.vertexLength+=4;const R=c.indexArray;R.emplaceBack(E,E+1),R.emplaceBack(E+1,E+2),R.emplaceBack(E+2,E+3),R.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(i,s,c,d,m,y){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceTextSize(i,y,s,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(i,s,c,d,m,y){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceIconSize(i,s,y.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,y)}}generateCollisionDebugBuffers(i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Vg(_t,Id.members,Ti),this.iconCollisionBox=new Vg(_t,Id.members,Ti);const c=Uc(this.iconSizeData,i),d=Uc(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,i,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(d,i,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,s,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(c,i,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(i,s,c,d){const m=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:d),y=nf(this.textSizeData,i,m)/Xi;return this.tilePixelRatio*y}getSymbolInstanceIconSize(i,s,c){const d=this.icon.placedSymbolArray.get(c),m=nf(this.iconSizeData,i,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(i,s,c){i.emplaceBack(s,-c,-c),i.emplaceBack(s,c,-c),i.emplaceBack(s,c,c),i.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(i,s,c,d,m,y){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceTextSize(i,y,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(i,s,c,d,m,y){for(let x=d;x<m;x++){const w=c.get(x),E=this.getSymbolInstanceIconSize(i,s,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(i,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Uc(this.iconSizeData,i),d=Uc(this.textSizeData,i);for(let m=0;m<this.symbolInstances.length;m++){const y=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,i,s,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(d,i,s,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(c,i,s,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,i,s,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,s,c,d,m,y,x,w,E){const D={};if(s<c){const{x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe,featureIndex:ce}=i.get(s);D.textBox={x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe},D.textFeatureIndex=ce}if(d<m){const{x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe,featureIndex:ce}=i.get(d);D.verticalTextBox={x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe},D.verticalTextFeatureIndex=ce}if(y<x){const{x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe,featureIndex:ce}=i.get(y);D.iconBox={x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe},D.iconFeatureIndex=ce}if(w<E){const{x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe,featureIndex:ce}=i.get(w);D.verticalIconBox={x1:k,y1:R,x2:L,y2:N,padding:j,projectedAnchorX:q,projectedAnchorY:J,projectedAnchorZ:se,tileAnchorX:Y,tileAnchorY:oe},D.verticalIconFeatureIndex=ce}return D}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,s){const c=i.placedSymbolArray.get(s),d=c.vertexStartIndex+4*c.numGlyphs;for(let m=c.vertexStartIndex;m<d;m+=4)i.indexArray.emplaceBack(m,m+1,m+2),i.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const s=Math.sin(i),c=Math.cos(i),d=[],m=[],y=[];for(let x=0;x<this.symbolInstances.length;++x){y.push(x);const w=this.symbolInstances.get(x);d.push(0|Math.round(s*w.tileAnchorX+c*w.tileAnchorY)),m.push(w.featureIndex)}return y.sort((x,w)=>d[x]-d[w]||m[w]-m[x]),y}addToSortKeyRanges(i,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:m,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=c;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&m!==d&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&y!==m&&y!==d&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ae(nl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),nl.MAX_GLYPHS=65535,nl.addDynamicAttributes=Od;const U0=new te({"symbol-placement":new V(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new V(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new V(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new W(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new V(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new V(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new V(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new V(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new V(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new W(Oe.layout_symbol["icon-size"]),"icon-text-fit":new V(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new V(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new W(Oe.layout_symbol["icon-image"]),"icon-rotate":new W(Oe.layout_symbol["icon-rotate"]),"icon-padding":new V(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new V(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new W(Oe.layout_symbol["icon-offset"]),"icon-anchor":new W(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new V(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new V(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new V(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new W(Oe.layout_symbol["text-field"]),"text-font":new W(Oe.layout_symbol["text-font"]),"text-size":new W(Oe.layout_symbol["text-size"]),"text-max-width":new W(Oe.layout_symbol["text-max-width"]),"text-line-height":new W(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new W(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new W(Oe.layout_symbol["text-justify"]),"text-radial-offset":new W(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new V(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new W(Oe.layout_symbol["text-anchor"]),"text-max-angle":new V(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new V(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new W(Oe.layout_symbol["text-rotate"]),"text-padding":new V(Oe.layout_symbol["text-padding"]),"text-keep-upright":new V(Oe.layout_symbol["text-keep-upright"]),"text-transform":new W(Oe.layout_symbol["text-transform"]),"text-offset":new W(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new V(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new V(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new V(Oe.layout_symbol["text-optional"])});var ff={paint:new te({"icon-opacity":new W(Oe.paint_symbol["icon-opacity"]),"icon-color":new W(Oe.paint_symbol["icon-color"]),"icon-halo-color":new W(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new W(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new W(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new V(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new V(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new W(Oe.paint_symbol["text-opacity"]),"text-color":new W(Oe.paint_symbol["text-color"],{runtimeType:yn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new W(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new W(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new W(Oe.paint_symbol["text-halo-blur"]),"text-translate":new V(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new V(Oe.paint_symbol["text-translate-anchor"])}),layout:U0};class jg{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:oa,this.defaultValue=i}evaluate(i){if(i.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(i.formattedSection))return s.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ae(jg,"FormatSectionOverride",{omit:["defaultValue"]});class mf extends ga{constructor(i){super(i,ff)}recalculate(i,s){super.recalculate(i,s),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const d=[];for(const m of c)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,s,c,d){const m=this.layout.get(i).evaluate(s,{},c,d),y=this._unevaluatedLayout._values[i];return y.isDataDriven()||wc(y.value)||!m?m:(x=s.properties,m.replace(/{([^{}]+)}/g,(E,D)=>D in x?String(x[D]):""));var x}createBucket(i){return new nl(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of ff.paint.overridableProperties){if(!mf.hasPaintOverride(this.layout,i))continue;const s=this.paint.get(i),c=new jg(s),d=new Tu(c,s.property.specification);let m=null;m="constant"===s.value.kind||"source"===s.value.kind?new mp("source",d):new Du("composite",d,s.value.zoomStops,s.value._interpolationType),this.paint._values[i]=new X(s.property,m,s.parameters)}}_handleOverridablePaintPropertyUpdate(i,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&mf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,s){const c=i.get("text-field"),d=ff.paint.properties[s];let m=!1;const y=x=>{for(const w of x)if(d.overrides&&d.overrides.hasOverride(w))return void(m=!0)};if("constant"===c.value.kind&&c.value.value instanceof Yr)y(c.value.value.sections);else if("source"===c.value.kind){const x=E=>{m||(E instanceof yl&&vi(E.value)===gu?y(E.value.sections):E instanceof di?y(E.sections):E.eachChild(x))},w=c.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(i){return new Dc(this,i)}}var G0={paint:new te({"background-color":new V(Oe.paint_background["background-color"]),"background-pattern":new V(Oe.paint_background["background-pattern"]),"background-opacity":new V(Oe.paint_background["background-opacity"])})},qo={paint:new te({"raster-opacity":new V(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new V(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new V(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new V(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new V(Oe.paint_raster["raster-saturation"]),"raster-contrast":new V(Oe.paint_raster["raster-contrast"]),"raster-resampling":new V(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new V(Oe.paint_raster["raster-fade-duration"])})};class H0 extends ga{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var $0={paint:new te({"sky-type":new V(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new V(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new V(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new V(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new V(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new V(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new V(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new V(Oe.paint_sky["sky-opacity"])})};function Ky(o,i,s){const c=[0,0,1],d=Y_([]);return gm(d,d,s?-on(o)+Math.PI:on(o)),XA(d,d,-on(i)),Z_(c,c,d),Er(c,c)}const Ug={circle:class extends ga{constructor(o){super(o,dy)}createBucket(o){return new Vp(o)}queryRadius(o){const i=o;return ih("circle-radius",this,i)+ih("circle-stroke-width",this,i)+jp(this.paint.get("circle-translate"))}queryIntersectsFeature(o,i,s,c,d,m,y,x){const w=Bm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(i,s)+this.paint.get("circle-stroke-width").evaluate(i,s);return Nm(o,c,m,y,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new Dc(this,o)}},heatmap:class extends ga{createBucket(o){return new zm(o)}constructor(o){super(o,Gp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return ih("heatmap-radius",this,o)}queryIntersectsFeature(o,i,s,c,d,m,y,x){const w=this.paint.get("heatmap-radius").evaluate(i,s);return Nm(o,c,m,y,x,!0,!0,new at(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new Dc(this,o)}},hillshade:class extends ga{constructor(o){super(o,Um)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ga{constructor(o){super(o,h0)}getProgramIds(){const o=this.paint.get("fill-pattern"),i=o&&o.constantOr(1),s=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(o){return new Dc(this,o)}recalculate(o,i){super.recalculate(o,i);const s=this.paint._values["fill-outline-color"];"constant"===s.value.kind&&void 0===s.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Wp(o)}queryRadius(){return jp(this.paint.get("fill-translate"))}queryIntersectsFeature(o,i,s,c,d,m){return!o.queryGeometry.isAboveHorizon&&uy(Lm(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends ga{constructor(o){super(o,v0)}createBucket(o){return new Vc(o)}queryRadius(){return jp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new Dc(this,o)}queryIntersectsFeature(o,i,s,c,d,m,y,x,w){const E=Bm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(i,s),k=this.paint.get("fill-extrusion-base").evaluate(i,s),R=[0,0],L=x&&m.elevation,N=m.elevation?m.elevation.exaggeration():1,j=o.tile.getBucket(this);if(L&&j instanceof Vc){const oe=j.centroidVertexArray,ce=w+1;ce<oe.length&&(R[0]=oe.geta_centroid_pos0(ce),R[1]=oe.geta_centroid_pos1(ce))}if(0===R[0]&&1===R[1])return!1;"globe"===m.projection.name&&(c=xy([c],[new at(0,0),new at(Tt,Tt)],o.tileID.canonical).map(oe=>oe.polygon).flat());const q=L?x:null,[J,se]=(ce=c,le=k,xe=D,we=E,Re=y,$e=q,Te=R,Ne=N,ze=m.center.lat,"globe"===(oe=m).projection.name?function(Xe,Pe,lt,gt,ht,zt,nt,It,Vt,wn,jt){const Pt=[],Yn=[],yt=Xe.projection.upVectorScale(jt,Xe.center.lat,Xe.worldSize).metersToTile,Wt=[0,0,0,1],Nn=[0,0,0,1],ot=(Hn,ke,Ve,St)=>{Hn[0]=ke,Hn[1]=Ve,Hn[2]=St,Hn[3]=1},Un=Ay();lt>0&&(lt+=Un),gt+=Un;for(const Hn of Pe){const ke=[],Ve=[];for(const St of Hn){const $n=St.x+ht.x,bi=St.y+ht.y,gi=Xe.projection.projectTilePoint($n,bi,jt),si=Xe.projection.upVector(jt,St.x,St.y);let Gt=lt,ai=gt;if(nt){const qn=by($n,bi,lt,gt,nt,It,Vt,wn);Gt+=qn.base,ai+=qn.top}0!==lt?ot(Wt,gi.x+si[0]*yt*Gt,gi.y+si[1]*yt*Gt,gi.z+si[2]*yt*Gt):ot(Wt,gi.x,gi.y,gi.z),ot(Nn,gi.x+si[0]*yt*ai,gi.y+si[1]*yt*ai,gi.z+si[2]*yt*ai),ni(Wt,Wt,zt),ni(Nn,Nn,zt),ke.push(new jc(Wt[0],Wt[1],Wt[2])),Ve.push(new jc(Nn[0],Nn[1],Nn[2]))}Pt.push(ke),Yn.push(Ve)}return[Pt,Yn]}(oe,ce,le,xe,we,Re,$e,Te,Ne,ze,o.tileID.canonical):$e?function(Xe,Pe,lt,gt,ht,zt,nt,It,Vt){const wn=[],jt=[],Pt=[0,0,0,1];for(const Yn of Xe){const yt=[],Wt=[];for(const Nn of Yn){const ot=Nn.x+gt.x,Un=Nn.y+gt.y,Hn=by(ot,Un,Pe,lt,zt,nt,It,Vt);Pt[0]=ot,Pt[1]=Un,Pt[2]=Hn.base,Pt[3]=1,fs(Pt,Pt,ht),Pt[3]=Math.max(Pt[3],1e-5);const ke=new jc(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);Pt[0]=ot,Pt[1]=Un,Pt[2]=Hn.top,Pt[3]=1,fs(Pt,Pt,ht),Pt[3]=Math.max(Pt[3],1e-5);const Ve=new jc(Pt[0]/Pt[3],Pt[1]/Pt[3],Pt[2]/Pt[3]);yt.push(ke),Wt.push(Ve)}wn.push(yt),jt.push(Wt)}return[wn,jt]}(ce,le,xe,we,Re,$e,Te,Ne,ze):function(Xe,Pe,lt,gt,ht){const zt=[],nt=[],It=ht[8]*Pe,Vt=ht[9]*Pe,wn=ht[10]*Pe,jt=ht[11]*Pe,Pt=ht[8]*lt,Yn=ht[9]*lt,yt=ht[10]*lt,Wt=ht[11]*lt;for(const Nn of Xe){const ot=[],Un=[];for(const Hn of Nn){const ke=Hn.x+gt.x,Ve=Hn.y+gt.y,St=ht[0]*ke+ht[4]*Ve+ht[12],$n=ht[1]*ke+ht[5]*Ve+ht[13],bi=ht[2]*ke+ht[6]*Ve+ht[14],gi=ht[3]*ke+ht[7]*Ve+ht[15],si=St+It,Gt=$n+Vt,ai=bi+wn,qn=Math.max(gi+jt,1e-5),Ir=St+Pt,ft=$n+Yn,Yi=bi+yt,Ji=Math.max(gi+Wt,1e-5);ot.push(new jc(si/qn,Gt/qn,ai/qn)),Un.push(new jc(Ir/Ji,ft/Ji,Yi/Ji))}zt.push(ot),nt.push(Un)}return[zt,nt]}(ce,le,xe,we,Re)),Y=o.queryGeometry;var oe,ce,le,xe,we,Re,$e,Te,Ne,ze;return function(oe,ce,le){let xe=1/0;uy(le,ce)&&(xe=ag(le,ce[0]));for(let we=0;we<ce.length;we++){const Re=ce[we],$e=oe[we];for(let Te=0;Te<Re.length-1;Te++){const Ne=Re[Te],ze=[Ne,Re[Te+1],$e[Te+1],$e[Te],Ne];cy(le,ze)&&(xe=Math.min(xe,ag(le,ze)))}}return xe!==1/0&&xe}(J,se,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends ga{constructor(o){super(o,hg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Wh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,i){super.recalculate(o,i),this.paint._values["line-floorwidth"]=dg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new ef(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new Dc(this,o)}queryRadius(o){const i=o,s=Ul(ih("line-width",this,i),ih("line-gap-width",this,i)),c=ih("line-offset",this,i);return s/2+Math.abs(c)+jp(this.paint.get("line-translate"))}queryIntersectsFeature(o,i,s,c,d,m){if(o.queryGeometry.isAboveHorizon)return!1;const y=Lm(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*Ul(this.paint.get("line-width").evaluate(i,s),this.paint.get("line-gap-width").evaluate(i,s)),w=this.paint.get("line-offset").evaluate(i,s);return w&&(c=function(E,D){const k=[],R=new at(0,0);for(let L=0;L<E.length;L++){const N=E[L],j=[];for(let q=0;q<N.length;q++){const J=N[q],se=N[q+1],Y=0===q?R:J.sub(N[q-1])._unit()._perp(),oe=q===N.length-1?R:se.sub(J)._unit()._perp(),ce=Y._add(oe)._unit();ce._mult(1/(ce.x*oe.x+ce.y*oe.y)),j.push(ce._mult(D)._add(J))}k.push(j)}return k}(c,w*o.pixelToTileUnitsFactor)),function(E,D,k){for(let R=0;R<D.length;R++){const L=D[R];if(E.length>=3)for(let N=0;N<L.length;N++)if(Ka(E,L[N]))return!0;if(e0(E,L,k))return!0}return!1}(y,c,x)}isTileClipped(){return!0}},symbol:mf,background:class extends ga{constructor(o){super(o,G0)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ga{constructor(o){super(o,qo)}getProgramIds(){return["raster"]}},sky:class extends ga{constructor(o){super(o,$0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Hp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(o,i){if("atmosphere"===this.paint.get("sky-type")){const c=this.paint.get("sky-atmosphere-sun"),d=!c,m=o.style.light,y=m.properties.get("position");return d&&"viewport"===m.properties.get("anchor")&&li("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Ky(y.azimuthal,90-y.polar,i):Ky(c[0],90-c[1],i)}const s=this.paint.get("sky-gradient-center");return Ky(s[0],90-s[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class vh{constructor(i,s,c,d){this.context=i,this.format=c,this.texture=i.gl.createTexture(),this.update(s,d)}update(i,s,c){const{width:d,height:m}=i,{context:y}=this,{gl:x}=y,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:D,ImageData:k,ImageBitmap:R}=je;if(x.bindTexture(x.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||!1!==s.premultiply)),c||this.size&&this.size[0]===d&&this.size[1]===m){const{x:L,y:N}=c||{x:0,y:0};i instanceof w||i instanceof E||i instanceof D||i instanceof k||R&&i instanceof R?x.texSubImage2D(x.TEXTURE_2D,0,L,N,x.RGBA,x.UNSIGNED_BYTE,i):x.texSubImage2D(x.TEXTURE_2D,0,L,N,d,m,x.RGBA,x.UNSIGNED_BYTE,i.data)}else this.size=[d,m],i instanceof w||i instanceof E||i instanceof D||i instanceof k||R&&i instanceof R?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,i):x.texImage2D(x.TEXTURE_2D,0,this.format,d,m,0,this.format,x.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(i,s){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?i===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_NEAREST:i),this.filter=i),s!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class q0{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class W0{constructor(){this.tasks={},this.taskQueue=[],Jn(["process"],this),this.invoker=new q0(this.process),this.nextId=0}add(i,s){const c=this.nextId++,d=function({type:m,isSymbolTile:y,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||y?"parseTile"!==m||y?"parseTile"===m&&y?300-x:"maybePrepare"===m&&y?400-x:500:200-x:100-x}(s);if(0===d){ta();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:i,metadata:s,priority:d,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){ta();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const s=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let i=null,s=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<s&&(s=m.priority,i=d)}if(null===i)return null;const c=this.taskQueue[i];return this.taskQueue.splice(i,1),c}remove(){this.invoker.remove()}}class Yy{constructor(i){this._stringToNumber={},this._numberToString=[];for(let s=0;s<i.length;s++){const c=i[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const Jy=["tile","layer","source","sourceLayer","state"];class ev{constructor(i,s,c,d,m){this.type="Feature",this._vectorTileFeature=i,this._z=s,this._x=c,this._y=d,this.properties=i.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const s of Jy)void 0!==this[s]&&(i[s]=this[s]);return i}}const vs=32,As=33,ql=new Uint16Array(8184);for(let o=0;o<2046;o++){let i=o+2,s=0,c=0,d=0,m=0,y=0,x=0;for(1&i?d=m=y=vs:s=c=x=vs;(i>>=1)>1;){const E=s+d>>1,D=c+m>>1;1&i?(d=s,m=c,s=y,c=x):(s=d,c=m,d=y,m=x),y=E,x=D}const w=4*o;ql[w+0]=s,ql[w+1]=c,ql[w+2]=d,ql[w+3]=m}const ba=new Uint16Array(2178),Wl=new Uint8Array(1089),gf=new Uint16Array(1089);function tv(o){return 0===o?-.03125:32===o?.03125:0}var Us=_e([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const _f={type:2,extent:Tt,loadGeometry:()=>[[new at(0,0),new at(Tt+1,0),new at(Tt+1,Tt+1),new at(0,Tt+1),new at(0,0)]]};class Gg{constructor(i,s,c,d,m){this.tileID=i,this.uid=nr(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection)}registerFadeDuration(i){const s=i+this.timeAdded;s<ts.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=qc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,s,c){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(d,m){const y={};if(!m)return y;for(const x of d){const w=x.layerIds.map(E=>m.getLayer(E)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(D=>D.id===E)[0]));for(const E of w)y[E.id]=x}}return y}(i.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof nl){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof nl&&m.hasRTLText){this.hasRTLText=!0,T.isLoading()||T.isLoaded()||"deferred"!==b()||I();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(m))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Fn}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(i)}const s=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vh(i,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vh(i,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vh(i,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,s,c,d,m,y,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:x,transform:y,params:m,tileTransform:this.tileTransform},i,s,c):{}}querySourceFeatures(i,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),m=s?s.sourceLayer:"",y=d._geojsonTileLayer||d[m];if(!y)return;const x=od(s&&s.filter),{z:w,x:E,y:D}=this.tileID.canonical,k={z:w,x:E,y:D};for(let R=0;R<y.length;R++){const L=y.feature(R);if(x.needGeometry){const q=Nl(L,!0);if(!x.filter(new S(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!x.filter(new S(this.tileID.overscaledZ),L))continue;const N=c.getId(L,m),j=new ev(L,w,E,D,N);j.tile=k,i.push(j)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const s=this.expirationTime;if(i.cacheControl){const c=co(i.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const m=this.expirationTime-s;m?this.expirationTime=c+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),d=s.style.listImages();for(const m in this.buckets){if(!s.style.hasLayer(m))continue;const y=this.buckets[m],x=y.layers[0].sourceLayer||"_geojsonTileLayer",w=c[x],E=i[x];if(!w||!E||0===Object.keys(E).length)continue;if(y.update(E,w,d,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof ef||y instanceof Wp){const k=s.style._getSourceCache(y.layers[0].source);s._terrain&&s._terrain.enabled&&k&&y.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(k.id,this.tileID)}const D=s&&s.style&&s.style.getLayer(m);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ts.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=ts.now()+i}setTexture(i,s){const c=s.context,d=c.gl;this.texture=this.texture||s.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new vh(c,i,d.RGBA,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(i,s){const c={};for(const d of s)c[d]=!0;this.dependencies[i]=c}hasDependency(i,s){for(const c of i){const d=this.dependencies[c];if(d)for(const m of s)if(d[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,s){if(!s||"mercator"===s.name||this._tileDebugBuffer)return;const c=Ns(_f,this.tileID.canonical,this.tileTransform)[0],d=new We,m=new mo;for(let y=0;y<c.length;y++){const{x,y:w}=c[y];d.emplaceBack(x,w),m.emplaceBack(y)}m.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(m),this._tileDebugBuffer=i.createVertexBuffer(d,fd.members),this._tileDebugSegments=Oi.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(i,s){if(this._tileBoundsBuffer||!s||"mercator"===s.name)return;const c=Ns(_f,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const y=function(x,w){const E=qc(x,w),D=Math.pow(2,x.z);for(let q=0;q<As;q++)for(let J=0;J<As;J++){const se=Go((x.x+(J+tv(J))/vs)/D),Y=lr((x.y+(q+tv(q))/vs)/D),oe=w.project(se,Y),ce=q*As+J;ba[2*ce+0]=Math.round((oe.x*E.scale-E.x)*Tt),ba[2*ce+1]=Math.round((oe.y*E.scale-E.y)*Tt)}Wl.fill(0),gf.fill(0);for(let q=2045;q>=0;q--){const J=4*q,se=ql[J+0],Y=ql[J+1],oe=ql[J+2],ce=ql[J+3],le=se+oe>>1,xe=Y+ce>>1,we=le+xe-Y,Re=xe+se-le,$e=Y*As+se,Te=ce*As+oe,Ne=xe*As+le,ze=Math.hypot((ba[2*$e+0]+ba[2*Te+0])/2-ba[2*Ne+0],(ba[2*$e+1]+ba[2*Te+1])/2-ba[2*Ne+1])>=16;Wl[Ne]=Wl[Ne]||(ze?1:0),q<1022&&(Wl[Ne]=Wl[Ne]||Wl[(Y+Re>>1)*As+(se+we>>1)]||Wl[(ce+Re>>1)*As+(oe+we>>1)])}const k=new Be,R=new wt;let L=0;function N(q,J){const se=J*As+q;return 0===gf[se]&&(k.emplaceBack(ba[2*se+0],ba[2*se+1],q*Tt/vs,J*Tt/vs),gf[se]=++L),gf[se]-1}function j(q,J,se,Y,oe,ce){const le=q+se>>1,xe=J+Y>>1;if(Math.abs(q-oe)+Math.abs(J-ce)>1&&Wl[xe*As+le])j(oe,ce,q,J,le,xe),j(se,Y,oe,ce,le,xe);else{const we=N(q,J),Re=N(se,Y),$e=N(oe,ce);R.emplaceBack(we,Re,$e)}}return j(0,0,vs,vs,vs,0),j(vs,vs,0,0,0,vs),{vertices:k,indices:R}}(this.tileID.canonical,s);d=y.vertices,m=y.indices}else{d=new Be,m=new wt;for(const{x,y:w}of c)d.emplaceBack(x,w,0,0);const y=Ym(d.int16,void 0,4);for(let x=0;x<y.length;x+=3)m.emplaceBack(y[x],y[x+1],y[x+2])}this._tileBoundsBuffer=i.createVertexBuffer(d,Us.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(m),this._tileBoundsSegments=Oi.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(i,s){const c=s.projection;if(!c||"globe"!==c.name||s.freezeTileCoverage)return;const d=this.tileID.canonical,m=Fc(xm(d,s)),y=Ju(s.zoom);let x;y>0&&(x=Dp(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,d,s,m,x,y),this._makeGlobeTileDebugTextBuffer(i,d,s,m,x,y)}_globePoint(i,s,c,d,m,y,x){let w=gd(i,s,c);if(y){const E=1<<c.z,D=Bs(d.center.lng),k=ya(d.center.lat),R=(c.x+.5)/E-D;let L=0;R>.5?L=-1:R<-.5&&(L=1);let N=(i/Tt+c.x)/E+L,j=(s/Tt+c.y)/E;N=(N-D)*d._pixelsPerMercatorPixel+D,j=(j-k)*d._pixelsPerMercatorPixel+k;const q=[N*d.worldSize,j*d.worldSize,0];ni(q,q,y),w=Oc(w,q,x)}return ni(w,w,m)}_makeGlobeTileDebugBorderBuffer(i,s,c,d,m,y){const x=new We,w=new mo,E=new Ee,D=(R,L,N,j,q)=>{const J=(N-R)/(q-1),se=(j-L)/(q-1),Y=x.length;for(let oe=0;oe<q;oe++){const ce=R+oe*J,le=L+oe*se;x.emplaceBack(ce,le);const xe=this._globePoint(ce,le,s,c,d,m,y);E.emplaceBack(xe[0],xe[1],xe[2]),w.emplaceBack(Y+oe)}},k=Tt;D(0,0,k,0,16),D(k,0,k,k,16),D(k,k,0,k,16),D(0,k,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(x,fd.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(E,ey.members),this._tileDebugSegments=Oi.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(i,s,c,d,m,y){const x=Tt/4,w=new We,E=new wt,D=new Ee,k=25;E.reserve(32),w.reserve(k),D.reserve(k);const R=(L,N)=>k*L+N;for(let L=0;L<k;L++){const N=L*x;for(let j=0;j<k;j++){const q=j*x;w.emplaceBack(q,N);const J=this._globePoint(q,N,s,c,d,m,y);D.emplaceBack(J[0],J[1],J[2])}}for(let L=0;L<4;L++)for(let N=0;N<4;N++){const j=R(L,N),q=R(L,N+1),J=R(L+1,N),se=R(L+1,N+1);E.emplaceBack(j,q,J),E.emplaceBack(J,q,se)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(E),this._tileDebugTextBuffer=i.createVertexBuffer(w,fd.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(D,ey.members),this._tileDebugTextSegments=Oi.simpleSegment(0,0,k,32)}}class Z0{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,s,c){const d=String(s);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][d]=this.stateChanges[i][d]||{},Ci(this.stateChanges[i][d],c),null===this.deletedStates[i]){this.deletedStates[i]={};for(const m in this.state[i])m!==d&&(this.deletedStates[i][m]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][d]){this.deletedStates[i][d]={};for(const m in this.state[i][d])c[m]||(this.deletedStates[i][d][m]=null)}else for(const m in c)this.deletedStates[i]&&this.deletedStates[i][d]&&null===this.deletedStates[i][d][m]&&delete this.deletedStates[i][d][m]}removeFeatureState(i,s,c){if(null===this.deletedStates[i])return;const d=String(s);if(this.deletedStates[i]=this.deletedStates[i]||{},c&&void 0!==s)null!==this.deletedStates[i][d]&&(this.deletedStates[i][d]=this.deletedStates[i][d]||{},this.deletedStates[i][d][c]=null);else if(void 0!==s)if(this.stateChanges[i]&&this.stateChanges[i][d])for(c in this.deletedStates[i][d]={},this.stateChanges[i][d])this.deletedStates[i][d][c]=null;else this.deletedStates[i][d]=null;else this.deletedStates[i]=null}getState(i,s){const c=String(s),d=Ci({},(this.state[i]||{})[c],(this.stateChanges[i]||{})[c]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const m=this.deletedStates[i][s];if(null===m)return{};for(const y in m)delete d[y]}return d}initializeTileState(i,s){i.setFeatureState(this.state,s)}coalesceChanges(i,s){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const y in this.stateChanges[d])this.state[d][y]||(this.state[d][y]={}),Ci(this.state[d][y],this.stateChanges[d][y]),m[y]=this.state[d][y];c[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(null===this.deletedStates[d])for(const y in this.state[d])m[y]={},this.state[d][y]={};else for(const y in this.deletedStates[d]){if(null===this.deletedStates[d][y])this.state[d][y]={};else if(this.state[d][y])for(const x of Object.keys(this.deletedStates[d][y]))delete this.state[d][y][x];m[y]=this.state[d][y]}c[d]=c[d]||{},Ci(c[d],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(c).length)for(const d in i)i[d].setFeatureState(c,s)}}class Hg{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,s){const c=this.toIdx(i,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(i,s){return this.leaves[this.toIdx(i,s)]}toIdx(i,s){return s*this.size+i}}function nv(o,i,s,c){let d=0,m=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(c[y])<1e-15){if(s[y]<o[y]||s[y]>i[y])return null}else{const x=1/c[y];let w=(o[y]-s[y])*x,E=(i[y]-s[y])*x;if(w>E){const D=w;w=E,E=D}if(w>d&&(d=w),E<m&&(m=E),d>m)return null}return d}function iv(o,i,s,c,d,m,y,x,w,E,D){const k=c-o,R=d-i,L=m-s,N=y-o,j=x-i,q=w-s,J=D[1]*q-D[2]*j,se=D[2]*N-D[0]*q,Y=D[0]*j-D[1]*N,oe=k*J+R*se+L*Y;if(Math.abs(oe)<1e-15)return null;const ce=1/oe,le=E[0]-o,xe=E[1]-i,we=E[2]-s,Re=(le*J+xe*se+we*Y)*ce;if(Re<0||Re>1)return null;const $e=xe*L-we*R,Te=we*k-le*L,Ne=le*R-xe*k,ze=(D[0]*$e+D[1]*Te+D[2]*Ne)*ce;return ze<0||Re+ze>1?null:(N*$e+j*Te+q*Ne)*ce}function rv(o,i,s){return(o-i)/(s-i)}function yf(o,i,s,c,d,m,y,x,w){const E=1<<s,D=m-c,k=y-d,R=(o+1)/E*D+c,L=(i+0)/E*k+d,N=(i+1)/E*k+d;x[0]=(o+0)/E*D+c,x[1]=L,w[0]=R,w[1]=N}class ov{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(m){const y=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,y));const E=1/w,D=(L,N,j,q,J)=>{const se=q?1:0,Y=(L+1)*j-se,oe=N*j,ce=(N+1)*j-se;J[0]=L*j,J[1]=oe,J[2]=Y,J[3]=ce};let k=new Hg(w);const R=[];for(let L=0;L<w*w;L++){D(L%w,Math.floor(L/w),E,!1,R);const N=Gs(R[0],R[1],m),j=Gs(R[2],R[1],m),q=Gs(R[2],R[3],m),J=Gs(R[0],R[3],m);k.minimums.push(Math.min(N,j,q,J)),k.maximums.push(Math.max(N,j,q,J)),k.leaves.push(1)}for(x.push(k),w/=2;w>=1;w/=2){const L=x[x.length-1];k=new Hg(w);for(let N=0;N<w*w;N++){D(N%w,Math.floor(N/w),2,!0,R);const j=L.getElevation(R[0],R[1]),q=L.getElevation(R[2],R[1]),J=L.getElevation(R[2],R[3]),se=L.getElevation(R[0],R[3]),Y=L.isLeaf(R[0],R[1]),oe=L.isLeaf(R[2],R[1]),ce=L.isLeaf(R[2],R[3]),le=L.isLeaf(R[0],R[3]),xe=Math.min(j.min,q.min,J.min,se.min),we=Math.max(j.max,q.max,J.max,se.max),Re=Y&&oe&&ce&&le;k.maximums.push(we),k.minimums.push(xe),k.leaves.push(we-xe<=5&&Re?1:0)}x.push(k)}return x}(this.dem),c=s.length-1,d=s[c];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(i,s,c,d,m,y,x=1){return nv([i,s,-100],[c,d,this.maximums[0]*x],m,y)}raycast(i,s,c,d,m,y,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(i,s,c,d,m,y,x);if(null==w)return null;const E=[],D=[],k=[],R=[],L=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:N,t:j,nodex:q,nodey:J,depth:se}=L.pop();if(this.leaves[N]){yf(q,J,se,i,s,c,d,k,R);const oe=1<<se,ce=(q+0)/oe,le=(q+1)/oe,xe=(J+0)/oe,we=(J+1)/oe,Re=Gs(ce,xe,this.dem)*x,$e=Gs(le,xe,this.dem)*x,Te=Gs(le,we,this.dem)*x,Ne=Gs(ce,we,this.dem)*x,ze=iv(k[0],k[1],Re,R[0],k[1],$e,R[0],R[1],Te,m,y),Ge=iv(R[0],R[1],Te,k[0],R[1],Ne,k[0],k[1],Re,m,y),Xe=Math.min(null!==ze?ze:Number.MAX_VALUE,null!==Ge?Ge:Number.MAX_VALUE);if(Xe!==Number.MAX_VALUE)return Xe;{const Pe=Bl([],m,y,j);if(sv(Re,$e,Ne,Te,rv(Pe[0],k[0],R[0]),rv(Pe[1],k[1],R[1]))>=Pe[2])return j}continue}let Y=0;for(let oe=0;oe<this._siblingOffset.length;oe++){yf((q<<1)+this._siblingOffset[oe][0],(J<<1)+this._siblingOffset[oe][1],se+1,i,s,c,d,k,R),k[2]=-100,R[2]=this.maximums[this.childOffsets[N]+oe]*x;const ce=nv(k,R,m,y);if(null!=ce){const le=ce;E[oe]=le;let xe=!1;for(let we=0;we<Y&&!xe;we++)le>=E[D[we]]&&(D.splice(we,0,oe),xe=!0);xe||(D[Y]=oe),Y++}}for(let oe=0;oe<Y;oe++){const ce=D[oe];L.push({idx:this.childOffsets[N]+ce,t:E[ce],nodex:(q<<1)+this._siblingOffset[ce][0],nodey:(J<<1)+this._siblingOffset[ce][1],depth:se+1})}}return null}_addNode(i,s,c){return this.minimums.push(i),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(i,s,c,d,m){if(1===i[d].isLeaf(s,c))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const y=d-1,x=i[y];let w=0,E=0;for(let D=0;D<this._siblingOffset.length;D++){const k=2*s+this._siblingOffset[D][0],R=2*c+this._siblingOffset[D][1],L=x.getElevation(k,R),N=x.isLeaf(k,R),j=this._addNode(L.min,L.max,N);N&&(w|=1<<D),E||(E=j)}for(let D=0;D<this._siblingOffset.length;D++)w&1<<D||this._construct(i,2*s+this._siblingOffset[D][0],2*c+this._siblingOffset[D][1],y,E+D)}}function sv(o,i,s,c,d,m){return xn(xn(o,s,m),xn(i,c,m),d)}function Gs(o,i,s){const c=s.dim,d=cn(o*c-.5,0,c-1),m=cn(i*c-.5,0,c-1),y=Math.floor(d),x=Math.floor(m),w=Math.min(y+1,c-1),E=Math.min(x+1,c-1);return sv(s.get(y,x),s.get(w,x),s.get(y,E),s.get(w,E),d-y,m-x)}const Fd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function vf(o,i,s){return(256*o*256+256*i+s)/10-1e4}function Rw(o,i,s){return 256*o+i+s/256-32768}class Ah{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,s,c,d=!1,m=!1){if(this.uid=i,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&"mapbox"!==c&&"terrarium"!==c)return li(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const y=this.dim=s.height-2,x=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=d,!d){for(let w=0;w<y;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(y,w)]=x[this._idx(y-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,y)]=x[this._idx(w,y-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(y,-1)]=x[this._idx(y-1,0)],x[this._idx(-1,y)]=x[this._idx(0,y-1)],x[this._idx(y,y)]=x[this._idx(y-1,y-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new ov(this)}get(i,s,c=!1){c&&(i=cn(i,-1,this.dim),s=cn(s,-1,this.dim));const d=4*this._idx(i,s);return("terrarium"===this.encoding?Rw:vf)(this.pixels[d],this.pixels[d+1],this.pixels[d+2])}static getUnpackVector(i){return Fd[i]}get unpackVector(){return Fd[this.encoding]}_idx(i,s){if(i<-1||i>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(i+1)}static pack(i,s){const c=[0,0,0,0],d=Ah.getUnpackVector(s);let m=Math.floor((i+d[3])/d[2]);return c[2]=m%256,m=Math.floor(m/256),c[1]=m%256,m=Math.floor(m/256),c[0]=m,c}getPixels(){return new zr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,s,c){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let d=s*this.dim,m=s*this.dim+this.dim,y=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:d=m-1;break;case 1:m=d+1}switch(c){case-1:y=x-1;break;case 1:x=y+1}const w=-s*this.dim,E=-c*this.dim;for(let D=y;D<x;D++)for(let k=d;k<m;k++){const R=4*this._idx(k,D),L=4*this._idx(k+w,D+E);this.pixels[R+0]=i.pixels[L+0],this.pixels[R+1]=i.pixels[L+1],this.pixels[R+2]=i.pixels[L+2],this.pixels[R+3]=i.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ae(Ah,"DEMData"),Ae(ov,"DemMinMaxQuadTree",{omit:["dem"]});class Ow{constructor(i,s){this.max=i,this.onRemove=s,this.reset()}reset(){for(const i in this.data)for(const s of this.data[i])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(i,s,c){const d=i.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const m={value:s,timeout:void 0};if(void 0!==c&&(m.timeout=setTimeout(()=>{this.remove(i,m)},c)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const s=this.data[i].shift();return s.timeout&&clearTimeout(s.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),s.value}getByKey(i){const s=this.data[i];return s?s[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,s){if(!this.has(i))return this;const c=i.wrapped().key,d=void 0===s?0:this.data[c].indexOf(s),m=this.data[c][d];return this.data[c].splice(d,1),m.timeout&&clearTimeout(m.timeout),0===this.data[c].length&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(i){const s=[];for(const c in this.data)for(const d of this.data[c])i(d.value)||s.push(d);for(const c of s)this.remove(c.value.tileID,c)}}class Kc{constructor(i,s,c){this.func=i,this.mask=s,this.range=c}}Kc.ReadOnly=!1,Kc.ReadWrite=!0,Kc.disabled=new Kc(519,Kc.ReadOnly,[0,1]);class xf{constructor(i,s,c,d,m,y){this.test=i,this.ref=s,this.mask=c,this.fail=d,this.depthFail=m,this.pass=y}}xf.disabled=new xf({func:519,mask:0},0,0,7680,7680,7680);class Hs{constructor(i,s,c){this.blendFunction=i,this.blendColor=s,this.mask=c}}Hs.Replace=[1,0],Hs.disabled=new Hs(Hs.Replace,Mi.transparent,[!1,!1,!1,!1]),Hs.unblended=new Hs(Hs.Replace,Mi.transparent,[!0,!0,!0,!0]),Hs.alphaBlended=new Hs([1,771],Mi.transparent,[!0,!0,!0,!0]);class bo{constructor(i,s,c){this.enable=i,this.mode=s,this.frontFace=c}}bo.disabled=new bo(!1,1029,2305),bo.backCCW=new bo(!0,1029,2305),bo.backCW=new bo(!0,1029,2304),bo.frontCW=new bo(!0,1028,2304),bo.frontCCW=new bo(!0,1028,2305);class wa extends cc{constructor(i,s,c){super(),this.id=i,this._onlySymbols=c,s.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Ow(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Z0,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const s=this._tiles[i];if("loaded"!==s.state&&"errored"!==s.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,s){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,s)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(i),c.prepare(this.map.style.imageManager)}}getIds(){return Ys(this._tiles).map(i=>i.tileID).sort(xh).map(i=>i.key)}getRenderableIds(i){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,i)&&s.push(this._tiles[c]);return i?s.sort((c,d)=>{const m=c.tileID,y=d.tileID,x=new at(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new at(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||w.y-x.y||w.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(xh).map(c=>c.key)}hasRenderableParent(i){const s=this.findLoadedParent(i,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(i,s){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(s||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,s){const c=this._tiles[i];c&&("loading"!==c.state&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,i,s)))}_tileLoaded(i,s,c,d){if(d)if(i.state="errored",404!==d.status)this._source.fire(new Is(d,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=ts.now(),"expired"===c&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(s,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new La("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const m=s[d];if(i.neighboringTiles&&i.neighboringTiles[m]){const y=this.getTileByID(m);c(i,y),c(y,i)}}function c(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let y=m.tileID.canonical.x-d.tileID.canonical.x;const x=m.tileID.canonical.y-d.tileID.canonical.y,w=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;0===y&&0===x||Math.abs(x)>1||(Math.abs(y)>1&&(1===Math.abs(y+w)?y+=w:1===Math.abs(y-w)&&(y-=w)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,y,x),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,s,c,d){for(const m in this._tiles){let y=this._tiles[m];if(d[m]||!y.hasData()||y.tileID.overscaledZ<=s||y.tileID.overscaledZ>c)continue;let x=y.tileID;for(;y&&y.tileID.overscaledZ>s+1;){const E=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[E.key],y&&y.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>s;)if(w=w.scaledTo(w.overscaledZ-1),i[w.key]){d[x.key]=x;break}}}findLoadedParent(i,s){if(i.key in this._loadedParentTiles){const c=this._loadedParentTiles[i.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=i.overscaledZ-1;c>=s;c--){const d=i.scaledTo(c),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(i){const s=this._tiles[i.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,s){s=s||this._source.tileSize;const c=Math.ceil(i.width/s)+1,d=Math.ceil(i.height/s)+1,m=Math.floor(c*d*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(x)}handleWrapJump(i){const s=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,s){const c={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),c[m.tileID.key]=m}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(i,s,c){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let d;this.updateCacheSize(i,s),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Qi(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(d=i.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(x=>this._source.hasTile(x)))):d=[];const m=this._updateRetainedTiles(d);if(av(this._source.type)&&0!==d.length){const x={},w={},E=Object.keys(m);for(const k of E){const R=m[k],L=this._tiles[k];if(!L||L.fadeEndTime&&L.fadeEndTime<=ts.now())continue;const N=this.findLoadedParent(R,Math.max(R.overscaledZ-wa.maxOverzooming,this._source.minzoom));N&&(this._addTile(N.tileID),x[N.tileID.key]=N.tileID),w[k]=R}const D=d[d.length-1].overscaledZ;for(const k in this._tiles){const R=this._tiles[k];if(m[k]||!R.hasData())continue;let L=R.tileID;for(;L.overscaledZ>D;){L=L.scaledTo(L.overscaledZ-1);const N=this._tiles[L.key];if(N&&N.hasData()&&w[L.key]){m[k]=R.tileID;break}}}for(const k in x)m[k]||(this._coveredTiles[k]=!0,m[k]=x[k])}for(const x in m)this._tiles[x].clearFadeHold();const y=function(x,w){const E=[];for(const D in x)D in w||E.push(D);return E}(this._tiles,m);for(const x of y){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const s={};if(0===i.length)return s;const c={},d=i.reduce((E,D)=>Math.min(E,D.overscaledZ),1/0),m=i[0].overscaledZ,y=Math.max(m-wa.maxOverzooming,this._source.minzoom),x=Math.max(m+wa.maxUnderzooming,this._source.minzoom),w={};for(const E of i){const D=this._addTile(E);s[E.key]=E,D.hasData()||d<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,d,x,s);for(const E of i){let D=this._tiles[E.key];if(D.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const R=E.children(this._source.maxzoom)[0],L=this.getTile(R);if(L&&L.hasData()){s[R.key]=R;continue}}else{const R=E.children(this._source.maxzoom);if(s[R[0].key]&&s[R[1].key]&&s[R[2].key]&&s[R[3].key])continue}let k=D.wasRequested();for(let R=E.overscaledZ-1;R>=y;--R){const L=E.scaledTo(R);if(c[L.key]||(c[L.key]=!0,D=this.getTile(L),!D&&k&&(D=this._addTile(L)),D&&(s[L.key]=L,k=D.wasRequested(),D.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const s=[];let c,d=this._tiles[i].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}s.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;d=m}for(const m of s)this._loadedParentTiles[m]=c}}_addTile(i){let s=this._tiles[i.key];if(s)return s;s=this._cache.getAndRemove(i),s&&(this._setTileReloadTimer(i.key,s),s.tileID=i,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,s)));const c=Boolean(s);if(!c){const d=this.map?this.map.painter:null;s=new Gg(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,d,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,i.key,s.state))}return s?(s.uses++,this._tiles[i.key]=s,c||this._source.fire(new La("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(i,s){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const c=s.getExpiryTimeout();c&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},c))}_removeTile(i){const s=this._tiles[i];s&&(s.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),s.uses>0||(s.hasData()&&"reloading"!==s.state?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,s,c){const d=[],m=this.transform;if(!m)return d;const y="globe"===m.projection.name,x=Bs(m.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let D;if(y){const k=E.tileID.canonical;if(0===k.z){const R=[Math.abs(cn(x,...bh(k,-1))-x),Math.abs(cn(x,...bh(k,1))-x)];D=[0,2*R.indexOf(Math.min(...R))-1]}else{const R=[Math.abs(cn(x,...bh(k,-1))-x),Math.abs(cn(x,...bh(k,0))-x),Math.abs(cn(x,...bh(k,1))-x)];D=[R.indexOf(Math.min(...R))-1]}}else D=[0];for(const k of D){const R=i.containsTile(E,m,s,k);R&&d.push(R)}}return d}getVisibleCoordinates(i){const s=this.getRenderableIds(i).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(av(this._source.type))for(const i in this._tiles){const s=this._tiles[i];if(void 0!==s.fadeEndTime&&s.fadeEndTime>=ts.now())return!0}return!1}setFeatureState(i,s,c){this._state.updateState(i=i||"_geojsonTileLayer",s,c)}removeFeatureState(i,s,c){this._state.removeFeatureState(i=i||"_geojsonTileLayer",s,c)}getFeatureState(i,s){return this._state.getState(i=i||"_geojsonTileLayer",s)}setDependencies(i,s,c){const d=this._tiles[i];d&&d.setDependencies(s,c)}reloadTilesForDependencies(i,s){for(const c in this._tiles)this._tiles[c].hasDependency(i,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(i,s))}_preloadTiles(i,s){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(i,s))};return void this._source.on("data",x)}const c=new Map,d=Array.isArray(i)?i:[i],m=this.map.painter.terrain,y=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of d){const w=x.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)c.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}Bi(Array.from(c.values()),(x,w)=>{const E=new Gg(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,D=>{"raster-dem"===this._source.type&&E.dem&&this._backfillDEM(E),w(D,E)})},s)}}function xh(o,i){const s=Math.abs(2*o.wrap)-+(o.wrap<0),c=Math.abs(2*i.wrap)-+(i.wrap<0);return o.overscaledZ-i.overscaledZ||c-s||i.canonical.y-o.canonical.y||i.canonical.x-o.canonical.x}function av(o){return"raster"===o||"image"===o||"video"===o||"custom"===o}function bh(o,i){const s=1<<o.z;return[o.x/s+i,(o.x+1)/s+i]}wa.maxOverzooming=10,wa.maxUnderzooming=3;class Bd{constructor(i,s,c){this._demTile=i,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(i,s,c){const d=c||i.findDEMTileFor(s);if(!d||!d.dem)return;const m=d.dem,y=d.tileID,x=1<<s.canonical.z-y.canonical.z;return new Bd(d,d.tileSize/Tt/x,[(s.canonical.x/x-y.canonical.x)*m.dim,(s.canonical.y/x-y.canonical.y)*m.dim])}tileCoordToPixel(i,s){const c=s*this._scale+this._offset[1],d=Math.floor(i*this._scale+this._offset[0]),m=Math.floor(c);return new at(d,m)}getElevationAt(i,s,c,d){const m=i*this._scale+this._offset[0],y=s*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(y),E=this._dem;return d=!!d,c?xn(xn(E.get(x,w,d),E.get(x,w+1,d),y-w),xn(E.get(x+1,w,d),E.get(x+1,w+1,d),y-w),m-x):E.get(x,w,d)}getElevationAtPixel(i,s,c){return this._dem.get(i,s,!!c)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*ms(1,i)*this._dem.stride}}class lv{constructor(i,s){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Ga(Tt,16,0),this.featureIndexArray=new $a,this.promoteId=s}insert(i,s,c,d,m,y=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,d,m,y);const w=this.grid;for(let E=0;E<s.length;E++){const D=s[E],k=[1/0,1/0,-1/0,-1/0];for(let R=0;R<D.length;R++){const L=D[R];k[0]=Math.min(k[0],L.x),k[1]=Math.min(k[1],L.y),k[2]=Math.max(k[2],L.x),k[3]=Math.max(k[3],L.y)}k[0]<Tt&&k[1]<Tt&&k[2]>=0&&k[3]>=0&&w.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xp(new sf(this.rawTileData)).layers,this.sourceLayerCoder=new Yy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,s,c,d){this.loadVTLayers();const m=i.params||{},y=od(m.filter),x=i.tileResult,w=i.transform,E=x.bufferedTilespaceBounds,D=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(N,j,q,J)=>Om(x.bufferedTilespaceGeometry,N,j,q,J));D.sort(Nd);let k=null;w.elevation&&D.length>0&&(k=Bd.create(w.elevation,this.tileID));const R={};let L;for(let N=0;N<D.length;N++){const j=D[N];if(j===L)continue;L=j;const q=this.featureIndexArray.get(j);let J=null;this.loadMatchingFeature(R,q,y,m.layers,m.availableImages,s,c,d,(se,Y,oe,ce=0)=>(J||(J=Ns(se,this.tileID.canonical,i.tileTransform)),Y.queryIntersectsFeature(x,se,oe,J,this.z,i.transform,i.pixelPosMatrix,k,ce)))}return R}loadMatchingFeature(i,s,c,d,m,y,x,w,E){const{featureIndex:D,bucketIndex:k,sourceLayerIndex:R,layoutVertexArrayOffset:L}=s,N=this.bucketLayerIDs[k];if(d&&!function(se,Y){for(let oe=0;oe<se.length;oe++)if(Y.indexOf(se[oe])>=0)return!0;return!1}(d,N))return;const j=this.sourceLayerCoder.decode(R),q=this.vtLayers[j].feature(D);if(c.needGeometry){const se=Nl(q,!0);if(!c.filter(new S(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!c.filter(new S(this.tileID.overscaledZ),q))return;const J=this.getId(q,j);for(let se=0;se<N.length;se++){const Y=N[se];if(d&&d.indexOf(Y)<0)continue;const oe=y[Y];if(!oe)continue;let ce={};void 0!==J&&w&&(ce=w.getState(oe.sourceLayer||"_geojsonTileLayer",J));const le=Ci({},x[Y]);le.paint=cv(le.paint,oe.paint,q,ce,m),le.layout=cv(le.layout,oe.layout,q,ce,m);const xe=!E||E(q,oe,ce,L);if(!xe)continue;const we=new ev(q,this.z,this.x,this.y,J);we.layer=le;let Re=i[Y];void 0===Re&&(Re=i[Y]=[]),Re.push({featureIndex:D,feature:we,intersectionZ:xe})}}lookupSymbolFeatures(i,s,c,d,m,y,x,w){const E={};this.loadVTLayers();const D=od(m);for(const k of i)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:d,featureIndex:k,layoutVertexArrayOffset:0},D,y,x,w,s);return E}loadFeature(i){const{featureIndex:s,sourceLayerIndex:c}=i;this.loadVTLayers();const d=this.sourceLayerCoder.decode(c),m=this.vtFeatures[d];if(m[s])return m[s];const y=this.vtLayers[d].feature(s);return m[s]=y,y}hasLayer(i){for(const s of this.bucketLayerIDs)for(const c of s)if(i===c)return!0;return!1}getId(i,s){let c=i.id;if(this.promoteId){const d="string"==typeof this.promoteId?this.promoteId:this.promoteId[s];null!=d&&(c=i.properties[d]),"boolean"==typeof c&&(c=Number(c))}return c}}function cv(o,i,s,c,d){return ct(o,(m,y)=>{const x=i instanceof ee?i.get(y):null;return x&&x.evaluate?x.evaluate(s,c,d):x})}function Nd(o,i){return i-o}Ae(lv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class uv{constructor(i,s){this.width=i,this.height=s,this.nextRow=0,this.image=new va({width:i,height:s}),this.positions={},this.uploaded=!1}getDash(i,s){const c=this.getKey(i,s);return this.positions[c]}trim(){const i=this.width,s=this.height=Yo(this.nextRow);this.image.resize({width:i,height:s})}getKey(i,s){return i.join(",")+s}getDashRanges(i,s,c){const d=[];let m=i.length%2==1?-i[i.length-1]*c:0,y=i[0]*c,x=!0;d.push({left:m,right:y,isDash:x,zeroLength:0===i[0]});let w=i[0];for(let E=1;E<i.length;E++){x=!x;const D=i[E];m=w*c,w+=D,y=w*c,d.push({left:m,right:y,isDash:x,zeroLength:0===D})}return d}addRoundDash(i,s,c){const d=s/2;for(let m=-c;m<=c;m++){const y=this.width*(this.nextRow+c+m);let x=0,w=i[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=i[++x]);const D=Math.abs(E-w.left),k=Math.abs(E-w.right),R=Math.min(D,k);let L;const N=m/c*(d+1);if(w.isDash){const j=d-Math.abs(N);L=Math.sqrt(R*R+j*j)}else L=d-Math.sqrt(R*R+N*N);this.image.data[y+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(i,s){for(let w=i.length-1;w>=0;--w){const E=i[w],D=i[w+1];E.zeroLength?i.splice(w,1):D&&D.isDash===E.isDash&&(D.left=E.left,i.splice(w,1))}const c=i[0],d=i[i.length-1];c.isDash===d.isDash&&(c.left=d.left-this.width,d.right=c.right+this.width);const m=this.width*this.nextRow;let y=0,x=i[y];for(let w=0;w<this.width;w++){w/x.right>1&&(x=i[++y]);const E=Math.abs(w-x.left),D=Math.abs(w-x.right),k=Math.min(E,D);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+s+128))}}addDash(i,s){const c=this.getKey(i,s);if(this.positions[c])return this.positions[c];const d="round"===s,m=d?7:0,y=2*m+1;if(this.nextRow+y>this.height)return li("LineAtlas out of space"),null;0===i.length&&i.push(1);let x=0;for(let D=0;D<i.length;D++)i[D]<0&&(li("Negative value is found in line dasharray, replacing values with 0"),i[D]=0),x+=i[D];if(0!==x){const D=this.width/x,k=this.getDashRanges(i,this.width,D);d?this.addRoundDash(k,D,m):this.addRegularDash(k,"square"===s?.5*D:0)}const w=this.nextRow+m;this.nextRow+=y;const E={tl:[w,m],br:[x,0]};return this.positions[c]=E,E}}Ae(uv,"LineAtlas");const Q0=1*ys;class hv{constructor(i){const s={},c=[];for(const x in i){const w=i[x],E=s[x]={};for(const D in w.glyphs){const k=w.glyphs[+D];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const R=k.metrics.localGlyph?Q0:1,L={x:0,y:0,w:k.bitmap.width+2*R,h:k.bitmap.height+2*R};c.push(L),E[D]=L}}const{w:d,h:m}=xg(c),y=new va({width:d||1,height:m||1});for(const x in i){const w=i[x];for(const E in w.glyphs){const D=w.glyphs[+E];if(!D||0===D.bitmap.width||0===D.bitmap.height)continue;const k=s[x][E],R=D.metrics.localGlyph?Q0:1;va.copy(D.bitmap,y,{x:0,y:0},{x:k.x+R,y:k.y+R},D.bitmap)}}this.image=y,this.positions=s}}Ae(hv,"GlyphAtlas");class X0{constructor(i){this.tileID=new Qi(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=qc(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,s,c,d,m){this.status="parsing",this.data=i,this.collisionBoxArray=new Fn;const y=new Yy(Object.keys(i.layers).sort()),x=new lv(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new uv(256,256),D={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},k=s.familiesBySource[this.source];for(const ce in k){const le=i.layers[ce];if(!le)continue;let xe=!1,we=!1;for(const Te of k[ce])"symbol"===Te[0].type?xe=!0:we=!0;if(!0===this.isSymbolTile&&!xe||!1===this.isSymbolTile&&!we)continue;1===le.version&&li(`Vector tile source "${this.source}" layer "${ce}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Re=y.encode(ce),$e=[];for(let Te=0;Te<le.length;Te++){const Ne=le.feature(Te),ze=x.getId(Ne,ce);$e.push({feature:Ne,id:ze,index:Te,sourceLayerIndex:Re})}for(const Te of k[ce]){const Ne=Te[0];void 0!==this.isSymbolTile&&"symbol"===Ne.type!==this.isSymbolTile||Ne.minzoom&&this.zoom<Math.floor(Ne.minzoom)||Ne.maxzoom&&this.zoom>=Ne.maxzoom||"none"!==Ne.visibility&&($g(Te,this.zoom,c),(w[Ne.id]=Ne.createBucket({index:x.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Re,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate($e,D,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Te.map(ze=>ze.id)))}}let R,L,N,j;E.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},J=()=>{if(R)return m(R);if(L&&N&&j){const ce=new hv(L),le=new Sy(N,j);for(const xe in w){const we=w[xe];we instanceof nl?($g(we.layers,this.zoom,c),z0(we,L,ce.positions,N,le.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):we.hasPattern&&(we instanceof ef||we instanceof Wp||we instanceof Vc)&&($g(we.layers,this.zoom,c),we.addFeatures(D,this.tileID.canonical,le.patternPositions,c,this.tileTransform))}this.status="done",m(null,{buckets:Ys(w).filter(xe=>!xe.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ce.image,lineAtlas:E,imageAtlas:le,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?N:null,glyphPositions:this.returnDependencies?ce.positions:null})}},se=ct(D.glyphDependencies,ce=>Object.keys(ce).map(Number));Object.keys(se).length?d.send("getGlyphs",{uid:this.uid,stacks:se},(ce,le)=>{R||(R=ce,L=le,J())},void 0,!1,q):L={};const Y=Object.keys(D.iconDependencies);Y.length?d.send("getImages",{icons:Y,source:this.source,tileID:this.tileID,type:"icons"},(ce,le)=>{R||(R=ce,N=le,J())},void 0,!1,q):N={};const oe=Object.keys(D.patternDependencies);oe.length?d.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"patterns"},(ce,le)=>{R||(R=ce,j=le,J())},void 0,!1,q):j={},J()}}function $g(o,i,s){const c=new S(i);for(const d of o)d.recalculate(c,s)}class dv{constructor(i){this.entries={},this.scheduler=i}request(i,s,c,d){const m=this.entries[i]=this.entries[i]||{callbacks:[]};if(m.result){const[y,x]=m.result;return this.scheduler?this.scheduler.add(()=>{d(y,x)},s):d(y,x),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=c((y,x)=>{m.result=[y,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(y,x)},s):w(y,x);setTimeout(()=>delete this.entries[i],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(y=>y!==d),m.callbacks.length||(m.cancel(),delete this.entries[i]))}}}function pv(o,i,s){const c=JSON.stringify(o.request);return o.data&&(this.deduped.entries[c]={result:[null,o.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},d=>{const m=_l(o.request,(y,x,w,E)=>{y?d(y):x&&d(null,{vectorTile:s?void 0:new Xp(new sf(x)),rawData:x,cacheControl:w,expires:E})});return()=>{m.cancel(),d()}},i)}const fv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qg{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,c]=new Uint8Array(i,0,2);if(219!==s)throw new Error("Data does not appear to be in a KDBush format.");const d=c>>4;if(1!==d)throw new Error(`Got v${d} data when expected v1.`);const m=fv[15&c];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(i,2,1),[x]=new Uint32Array(i,4,1);return new qg(x,y,m,i)}constructor(i,s=64,c=Float64Array,d){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=c,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const m=fv.indexOf(this.ArrayType),y=2*i*this.ArrayType.BYTES_PER_ELEMENT,x=i*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${c}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+w,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+y+x+w),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+x+w,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=i)}add(i,s){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=i,this.coords[this._pos++]=s,c}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return bf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,s,c,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:x}=this,w=[0,m.length-1,0],E=[];for(;w.length;){const D=w.pop()||0,k=w.pop()||0,R=w.pop()||0;if(k-R<=x){for(let q=R;q<=k;q++){const J=y[2*q],se=y[2*q+1];J>=i&&J<=c&&se>=s&&se<=d&&E.push(m[q])}continue}const L=R+k>>1,N=y[2*L],j=y[2*L+1];N>=i&&N<=c&&j>=s&&j<=d&&E.push(m[L]),(0===D?i<=N:s<=j)&&(w.push(R),w.push(L-1),w.push(1-D)),(0===D?c>=N:d>=j)&&(w.push(L+1),w.push(k),w.push(1-D))}return E}within(i,s,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:m,nodeSize:y}=this,x=[0,d.length-1,0],w=[],E=c*c;for(;x.length;){const D=x.pop()||0,k=x.pop()||0,R=x.pop()||0;if(k-R<=y){for(let q=R;q<=k;q++)mv(m[2*q],m[2*q+1],i,s)<=E&&w.push(d[q]);continue}const L=R+k>>1,N=m[2*L],j=m[2*L+1];mv(N,j,i,s)<=E&&w.push(d[L]),(0===D?i-c<=N:s-c<=j)&&(x.push(R),x.push(L-1),x.push(1-D)),(0===D?i+c>=N:s+c>=j)&&(x.push(L+1),x.push(k),x.push(1-D))}return w}}function bf(o,i,s,c,d,m){if(d-c<=s)return;const y=c+d>>1;Kn(o,i,y,c,d,m),bf(o,i,s,c,y-1,1-m),bf(o,i,s,y+1,d,1-m)}function Kn(o,i,s,c,d,m){for(;d>c;){if(d-c>600){const E=d-c+1,D=s-c+1,k=Math.log(E),R=.5*Math.exp(2*k/3),L=.5*Math.sqrt(k*R*(E-R)/E)*(D-E/2<0?-1:1);Kn(o,i,s,Math.max(c,Math.floor(s-D*R/E+L)),Math.min(d,Math.floor(s+(E-D)*R/E+L)),m)}const y=i[2*s+m];let x=c,w=d;for(zd(o,i,c,s),i[2*d+m]>y&&zd(o,i,c,d);x<w;){for(zd(o,i,x,w),x++,w--;i[2*x+m]<y;)x++;for(;i[2*w+m]>y;)w--}i[2*c+m]===y?zd(o,i,c,w):(w++,zd(o,i,w,d)),w<=s&&(c=w+1),s<=w&&(d=w-1)}}function zd(o,i,s,c){Vd(o,s,c),Vd(i,2*s,2*c),Vd(i,2*s+1,2*c+1)}function Vd(o,i,s){const c=o[i];o[i]=o[s],o[s]=c}function mv(o,i,s,c){const d=o-s,m=i-c;return d*d+m*m}p.ARRAY_TYPE=Cr,p.AUTH_ERR_MSG=he,p.Aabb=Nr,p.Actor=class{constructor(o,i,s){this.target=o,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Jn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ta()?o:je,this.scheduler=new W0}send(o,i,s,c,d=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=m,this.callbacks[y]=s);const x=oc(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:o,hasCallback:!!s,targetMapId:c,mustQueue:d,sourceMapId:this.mapId,data:gn(i,x)},x),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(o){const i=o.data,s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(i.mustQueue||ta()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,i),c&&c.metadata||{type:"message"})}else this.processTask(s,i)}processTask(o,i){if("<response>"===i.type){const s=this.callbacks[o];delete this.callbacks[o],s&&(i.error?s(fi(i.error)):s(null,fi(i.data)))}else{const s=oc(this.globalScope)?void 0:[],c=i.hasCallback?(m,y)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:m?gn(m):null,data:gn(y,s)},s)}:m=>{},d=fi(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,c);else if(this.parent.getWorkerSource){const m=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,m[0],d.source)[m[1]](d,c)}else c(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=sg,p.Color=Mi,p.ColorMode=Hs,p.CullFaceMode=bo,p.DEMData=Ah,p.DataConstantProperty=V,p.DedupedRequest=dv,p.DepthMode=Kc,p.EXTENT=Tt,p.Elevation=class{isDataAvailableAtPoint(o){const i=this._source();if(this.isUsingMockSource()||!i||o.y<0||o.y>1)return!1;const s=i.getSource().maxzoom,c=1<<s,d=Math.floor(o.x),m=Math.floor((o.x-d)*c),y=Math.floor(o.y*c),x=this.findDEMTileFor(new Qi(s,d,s,m,y));return!(!x||!x.dem)}getAtPointOrZero(o,i=0){return this.getAtPoint(o,i)||0}getAtPoint(o,i,s=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const c=this._source();if(!c||o.y<0||o.y>1)return i;const d=c.getSource().maxzoom,m=1<<d,y=Math.floor(o.x),x=o.x-y,w=new Qi(d,y,d,Math.floor(x*m),Math.floor(o.y*m)),E=this.findDEMTileFor(w);if(!E||!E.dem)return i;const D=E.dem,k=1<<E.tileID.canonical.z,R=(x*k-E.tileID.canonical.x)*D.dim,L=(o.y*k-E.tileID.canonical.y)*D.dim,N=Math.floor(R),j=Math.floor(L);return(s?this.exaggeration():1)*xn(xn(D.get(N,j),D.get(N,j+1),L-j),xn(D.get(N+1,j),D.get(N+1,j+1),L-j),R-N)}getAtTileOffset(o,i,s){const c=1<<o.canonical.z;return this.getAtPointOrZero(new th(o.wrap+(o.canonical.x+i/Tt)/c,(o.canonical.y+s/Tt)/c))}getAtTileOffsetFunc(o,i,s,c){return d=>{const m=this.getAtTileOffset(o,d.x,d.y),y=c.upVector(o.canonical,d.x,d.y);return no(y,y,m*c.upVectorScale(o.canonical,i,s).metersToTile),y}}getForTilePoints(o,i,s,c){if(this.isUsingMockSource())return!1;const d=Bd.create(this,o,c);return!!d&&(i.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],s)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(o);if(!i||!i.dem)return null;const s=i.dem.tree,c=i.tileID,d=1<<o.canonical.z-c.canonical.z;let m=o.canonical.x/d-c.canonical.x,y=o.canonical.y/d-c.canonical.y,x=0;for(let w=0;w<o.canonical.z-c.canonical.z&&!s.leaves[x];w++){m*=2,y*=2;const E=2*Math.floor(y)+Math.floor(m);x=s.childOffsets[x]+E,m%=1,y%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,i,s){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=Is,p.EvaluationParameters=S,p.Event=La,p.Evented=cc,p.FillExtrusionBucket=Vc,p.Frustum=_m,p.FrustumCorners=Rp,p.GLOBE_RADIUS=Za,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=ym,p.GLOBE_ZOOM_THRESHOLD_MIN=ty,p.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_fillGridMeshWithLods(o,i){const s=new We,c=new wt,d=[],m=o+1+2,y=i[0]+1,x=i[0]+1+(1+i.length),w=(E,D,k)=>{let R=E===m-1?E-2:0===E?E:E-1;return R+=k?24575:0,[R,D]};for(let E=0;E<m;++E)s.emplaceBack(...w(E,0,!0));for(let E=0;E<y;++E)for(let D=0;D<m;++D)s.emplaceBack(...w(D,E,(0===D||D===m-1)&&!0));for(let E=0;E<i.length;++E){const D=i[E];for(let k=0;k<m;++k)s.emplaceBack(...w(k,D,!0))}for(let E=0;E<i.length;++E){const D=c.length,k=i[E]+1+2,R=new wt;for(let j=0;j<k-1;j++){const q=j===k-2,J=q?m*(x-i.length+E-j):m;for(let se=0;se<m-1;se++){const Y=j*m+se;0===j||q||0===se||se===m-2?(R.emplaceBack(Y+1,Y,Y+J),R.emplaceBack(Y+J,Y+J+1,Y+1)):(c.emplaceBack(Y+1,Y,Y+J),c.emplaceBack(Y+J,Y+J+1,Y+1))}}const L=Oi.simpleSegment(0,D,s.length,c.length-D);for(let j=0;j<R.uint16.length;j+=3)c.emplaceBack(R.uint16[j],R.uint16[j+1],R.uint16[j+2]);const N=Oi.simpleSegment(0,D,s.length,c.length-D);d.push({withoutSkirts:L,withSkirts:N})}return{vertices:s,indices:c,segments:d}}_createGrid(o){const i=this._fillGridMeshWithLods(64,Rc);this._gridSegments=i.segments,this._gridBuffer=o.createVertexBuffer(i.vertices,fd.members),this._gridIndexBuffer=o.createIndexBuffer(i.indices,!0)}_createPoles(o){const i=new wt;for(let d=0;d<=64;d++)i.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=o.createIndexBuffer(i,!0);const s=new jn,c=new jn;this._poleSegments=[];for(let d=0,m=0;d<ty;d++){const y=360/(1<<d);s.emplaceBack(0,-Za,0,.5,0),c.emplaceBack(0,-Za,0,.5,1);for(let x=0;x<=64;x++){const w=x/64,E=xn(0,y,w),[D,k,R]=ar(yo,Im,E,Za);s.emplaceBack(D,k,R,w,0),c.emplaceBack(D,k,R,w,1)}this._poleSegments.push(Oi.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(s,J_,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(c,J_,!1)}getGridBuffers(o,i){return[this._gridBuffer,this._gridIndexBuffer,i?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,i){if(!this._wireframeSegments){const s=new Ti,c=64,d=c+1+2,m=1;this._wireframeSegments=[];for(let y=0,x=0;y<Rc.length;y++){const w=Rc[y];for(let D=m;D<w+m;D++)for(let k=m;k<c+m;k++){const R=D*d+k;s.emplaceBack(R,R+1),s.emplaceBack(R,R+d),s.emplaceBack(R,R+d+1)}const E=w*c*3;this._wireframeSegments.push(Oi.simpleSegment(0,x,(w+1)*d,E)),x+=E}this._wireframeIndexBuffer=o.createIndexBuffer(s)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},p.GlyphManager=$c,p.ImagePosition=Vs,p.KDBush=qg,p.LivePerformanceUtils=Jo,p.LngLat=Pn,p.LngLatBounds=ui,p.LocalGlyphMode=Mg,p.MAX_MERCATOR_LATITUDE=cr,p.MercatorCoordinate=th,p.ONE_EM=Xi,p.OverscaledTileID=Qi,p.PerformanceMarkers=Do,p.Point=at,p.Properties=te,p.RGBAImage=zr,p.Ray=Ku,p.RequestManager=class{constructor(o,i,s){this._transformRequestFn=o,this._customAccessToken=i,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const o=function(){let i="";for(let s=0;s<10;s++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dl,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,i){return this._transformRequestFn&&this._transformRequestFn(o,i)||{url:o}}normalizeStyleURL(o,i){if(!ge(o))return o;const s=st(o);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeGlyphsURL(o,i){if(!ge(o))return o;const s=st(o);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||i)}normalizeSourceURL(o,i,s,c){if(!ge(o))return o;const d=st(o);return d.path=`/v4/${d.authority}.json`,d.params.push("secure"),s&&d.params.push(`language=${s}`),c&&d.params.push(`worldview=${c}`),this._makeAPIURL(d,this._customAccessToken||i)}normalizeSpriteURL(o,i,s,c){const d=st(o);return ge(o)?(d.path=`/styles/v1${d.path}/sprite${i}${s}`,this._makeAPIURL(d,this._customAccessToken||c)):(d.path+=`${i}${s}`,Ye(d))}normalizeTileURL(o,i,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!ge(o))return o;const c=st(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||s&&"raster"!==c.authority&&512===s?"@2x":""}${Zt.supported?".webp":"$1"}`),"raster"===c.authority?c.path=`/${Kt.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${Kt.TILE_URL_VERSION}${c.path}`);const d=this._customAccessToken||function(m){for(const y of m){const x=y.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||Kt.ACCESS_TOKEN;return Kt.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,d)}canonicalizeTileURL(o,i){const s=st(o);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return o;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${Kt.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${Kt.TILE_URL_VERSION}/`,"")}`;let d=s.params;return i&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(c+=`?${d.join("&")}`),c}canonicalizeTileset(o,i){const s=!!i&&ge(i),c=[];for(const d of o.tiles||[])Ce(d)?c.push(this.canonicalizeTileURL(d,s)):c.push(d);return c}_makeAPIURL(o,i){const s="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=st(Kt.API_URL);if(o.protocol=c.protocol,o.authority=c.authority,"http"===o.protocol){const d=o.params.indexOf("secure");d>=0&&o.params.splice(d,1)}if("/"!==c.path&&(o.path=`${c.path}${o.path}`),!Kt.REQUIRE_ACCESS_TOKEN)return Ye(o);if(i=i||Kt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return o.params=o.params.filter(d=>-1===d.indexOf("access_token")),o.params.push(`access_token=${i||""}`),Ye(o)}},p.ResourceType=Pa,p.SegmentVector=Oi,p.SourceCache=wa,p.StencilMode=xf,p.StructArrayLayout1ui2=mo,p.StructArrayLayout2f1f2i16=Dt,p.StructArrayLayout2i4=We,p.StructArrayLayout2ui4=Ti,p.StructArrayLayout3f12=ln,p.StructArrayLayout3ui6=wt,p.StructArrayLayout4i8=Be,p.StructArrayLayout5f20=jn,p.Texture=vh,p.Tile=Gg,p.Transitionable=z,p.Uniform1f=Ip,p.Uniform1i=class extends go{constructor(o){super(o),this.current=0}set(o,i,s){this.fetchUniformLocation(o,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},p.Uniform2f=class extends go{constructor(o){super(o),this.current=[0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}},p.Uniform3f=class extends go{constructor(o){super(o),this.current=[0,0,0]}set(o,i,s){this.fetchUniformLocation(o,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}},p.Uniform4f=wr,p.UniformColor=Mp,p.UniformMatrix2f=class extends go{constructor(o){super(o),this.current=Tp}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<4;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}},p.UniformMatrix3f=class extends go{constructor(o){super(o),this.current=H_}set(o,i,s){if(this.fetchUniformLocation(o,i))for(let c=0;c<9;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},p.UniformMatrix4f=class extends go{constructor(o){super(o),this.current=$A}set(o,i,s){if(this.fetchUniformLocation(o,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let c=1;c<16;c++)if(s[c]!==this.current[c]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}},p.UnwrappedTileID=A0,p.ValidationError=pt,p.VectorTileFeature=Kp,p.VectorTileWorkerSource=class extends cc{constructor(o,i,s,c,d){super(),this.actor=o,this.layerIndex=i,this.availableImages=s,this.loadVectorData=d||pv,this.loading={},this.loaded={},this.deduped=new dv(o.scheduler),this.isSpriteLoaded=c,this.scheduler=o.scheduler}loadTile(o,i){const s=o.uid,c=o&&o.request,d=c&&c.collectResourceTiming,m=this.loading[s]=new X0(o);m.abort=this.loadVectorData(o,(y,x)=>{const w=!this.loading[s];if(delete this.loading[s],w||y||!x)return m.status="done",w||(this.loaded[s]=m),i(y);const E=x.rawData,D={};x.expires&&(D.expires=x.expires),x.cacheControl&&(D.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new Xp(new sf(E));const k=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,L)=>{if(R||!L)return i(R);const N={};if(d){const j=Uh(c);j.length>0&&(N.resourceTiming=JSON.parse(JSON.stringify(j)))}i(null,Ci({rawTileData:E.slice(0)},L,D,N))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[s]=m})}reloadTile(o,i){const s=this.loaded,c=o.uid,d=this;if(s&&s[c]){const m=s[c];m.showCollisionBoxes=o.showCollisionBoxes,m.enableTerrain=!!o.enableTerrain,m.projection=o.projection,m.tileTransform=qc(o.tileID.canonical,o.projection);const y=(x,w)=>{const E=m.reloadCallback;E&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,E)),i(x,w)};"parsing"===m.status?m.reloadCallback=y:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(o,i){const s=o.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),i()}removeTile(o,i){const s=this.loaded,c=o.uid;s&&s[c]&&delete s[c],i()}},p.WritingMode=$o,p.ZoomDependentExpression=Du,p.add=Wa,p.addDynamicAttributes=Od,p.adjoint=function(o,i){var s=i[0],c=i[1],d=i[2],m=i[3],y=i[4],x=i[5],w=i[6],E=i[7],D=i[8];return o[0]=y*D-x*E,o[1]=d*E-c*D,o[2]=c*x-d*y,o[3]=x*w-m*D,o[4]=s*D-d*w,o[5]=d*m-s*x,o[6]=m*E-y*w,o[7]=c*w-s*E,o[8]=s*y-c*m,o},p.asyncAll=Bi,p.bezier=Sa,p.bindAll=Jn,p.boundsAttributes=Us,p.bufferConvexPolygon=function(o,i){const s=[];for(let c=0;c<o.length;c++){const d=pn(c-1,-1,o.length-1),m=pn(c+1,-1,o.length-1),y=o[c],x=o[m],w=o[d].sub(y).unit(),E=x.sub(y).unit(),D=E.angleWithSep(w.x,w.y),k=w.add(E).unit().mult(-1*i/Math.sin(D/2));s.push(y.add(k))}return s},p.cacheEntryPossiblyAdded=function(o){To++,To>Vh&&(o.getActor().send("enforceCacheSizeLimit",ac),To=0)},p.calculateGlobeLabelMatrix=function(o,i){const{x:s,y:c}=o.point,d=ry(s,c,o.worldSize/o._pixelsPerMercatorPixel,0,0);return _a(d,d,wm(Qa(i)))},p.calculateGlobeMatrix=function(o){const{x:i,y:s}=o.point,{lng:c,lat:d}=o._center;return ry(i,s,o.worldSize,c,d)},p.calculateGlobeMercatorMatrix=function(o){const i=o.pixelsPerMeter,s=i/ms(1,o.center.lat),c=Br(new Float64Array(16));return qa(c,c,[o.point.x,o.point.y,0]),kc(c,c,[s,s,i]),Float32Array.from(c)},p.circumferenceAtLatitude=Np,p.clamp=cn,p.clearTileCache=function(o){if(!pu())return;const i=je.caches.delete(sc);o&&i.catch(o).then(()=>o())},p.clipLine=Ig,p.clone=function(o){var i=new Cr(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},p.clone$1=lo,p.collisionCircleLayout=xa,p.config=Kt,p.conjugate=function(o,i){return o[0]=-i[0],o[1]=-i[1],o[2]=-i[2],o[3]=i[3],o},p.create=function(){var o=new Cr(16);return Cr!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},p.create$1=$_,p.createExpression=Cc,p.createLayout=_e,p.createStyleLayer=function(o){return"custom"===o.type?new H0(o):new Ug[o.type](o)},p.cross=kp,p.degToRad=on,p.distance=function(o,i){return Math.hypot(i[0]-o[0],i[1]-o[1],i[2]-o[2])},p.div=function(o,i,s){return o[0]=i[0]/s[0],o[1]=i[1]/s[1],o[2]=i[2]/s[2],o},p.dot=sr,p.earthRadius=eh,p.ease=Ko,p.easeCubicInOut=uu,p.ecefToLatLng=function([o,i,s]){const c=Math.hypot(o,i,s),d=Math.atan2(o,s),m=.5*Math.PI-Math.acos(-i/c);return new Pn(Hi(d),Hi(m))},p.emitValidationErrors=bp,p.endsWith=pl,p.enforceCacheSizeLimit=function(o){ml(),Kr&&Kr.then(i=>{i.keys().then(s=>{for(let c=0;c<s.length-o;c++)i.delete(s[c])})})},p.evaluateSizeForFeature=nf,p.evaluateSizeForZoom=Uc,p.evaluateVariableOffset=N0,p.evented=v,p.exactEquals=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]},p.exactEquals$1=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]},p.exported=ts,p.exported$1=Zt,p.extend=Ci,p.extend$1=Ms,p.fillExtrusionHeightLift=Ay,p.filterObject=ea,p.fromMat4=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[4],o[4]=i[5],o[5]=i[6],o[6]=i[8],o[7]=i[9],o[8]=i[10],o},p.fromQuat=function(o,i){var s=i[0],c=i[1],d=i[2],m=i[3],y=s+s,x=c+c,w=d+d,E=s*y,D=c*y,k=c*x,R=d*y,L=d*x,N=d*w,j=m*y,q=m*x,J=m*w;return o[0]=1-k-N,o[1]=D+J,o[2]=R-q,o[3]=0,o[4]=D-J,o[5]=1-E-N,o[6]=L+j,o[7]=0,o[8]=R+q,o[9]=L-j,o[10]=1-E-k,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},p.fromRotation=function(o,i){var s=Math.sin(i),c=Math.cos(i);return o[0]=c,o[1]=s,o[2]=0,o[3]=-s,o[4]=c,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},p.fromScaling=ZA,p.furthestTileCorner=function(o){const i=Math.round((o+45+360)%360/90)%4;return rc[i]},p.getAABBPointSquareDist=function(o,i,s){let c=0;for(let d=0;d<2;++d){const m=s?s[d]:0;o[d]>m&&(c+=(o[d]-m)*(o[d]-m)),i[d]<m&&(c+=(m-i[d])*(m-i[d]))}return c},p.getAnchorAlignment=wg,p.getAnchorJustification=Hl,p.getBounds=function(o){let i=1/0,s=1/0,c=-1/0,d=-1/0;for(const m of o)i=Math.min(i,m.x),s=Math.min(s,m.y),c=Math.max(c,m.x),d=Math.max(d,m.y);return{min:new at(i,s),max:new at(c,d)}},p.getColumn=na,p.getDefaultExportFromCjs=Xr,p.getGridMatrix=function(o,i,s,c){const d=i.getNorth(),m=i.getSouth(),y=i.getWest(),x=i.getEast(),w=1<<o.z,E=x-y,D=d-m,k=E/64,R=-D/Rc[s],L=[0,k,0,R,0,0,d,y,0];if(o.z>0){const N=180/c;Uo(L,L,[N/E+1,0,0,0,N/D+1,0,-.5*N/k,.5*N/R,1])}return L[2]=w,L[5]=o.x,L[8]=o.y,L},p.getImage=re,p.getJSON=function(o,i){return gl(Ci(o,{type:"json"}),i)},p.getLatitudinalLod=function(o){const i=cr-5;o=cn(o,-i,i)/i*90;const s=Math.pow(Math.abs(Math.sin(on(o))),3);return Math.round(s*(Rc.length-1))},p.getMapSessionAPI=qi,p.getPerformanceMeasurement=Uh,p.getProjection=Rd,p.getRTLTextPluginStatus=b,p.getReferrer=Oa,p.getTilePoint=function(o,{x:i,y:s},c=0){return new at(((i-c)*o.scale-o.x)*Tt,(s*o.scale-o.y)*Tt)},p.getTileVec3=function(o,i,s=0){return Zu(((i.x-s)*o.scale-o.x)*Tt,(i.y*o.scale-o.y)*Tt,sy(i.z,i.y))},p.getVideo=function(o,i){const s=je.document.createElement("video");s.muted=!0,s.onloadstart=function(){i(null,s)};for(let c=0;c<o.length;c++){const d=je.document.createElement("source");jh(o[c])||(s.crossOrigin="Anonymous"),d.src=o[c],s.appendChild(d)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(o){const i=[0,0,0],s=Br(new Float64Array(16));return _a(s,o.pixelMatrix,o.globeMatrix),ni(i,i,s),new at(i[0],i[1])},p.globeDenormalizeECEF=wm,p.globeECEFOrigin=function(o,i){const s=[0,0,0];return ni(s,s,Fc(Qa(i.canonical))),ni(s,s,o),s},p.globeMetersToEcef=Am,p.globeNormalizeECEF=Fc,p.globePixelsToTileUnits=function(o,i){return Tt/(512*Math.pow(2,o))*Lp(Qa(i))},p.globePoleMatrixForTile=function(o,i,s){const c=Br(new Float64Array(16)),d=(i/(1<<o)-.5)*Math.PI*2;return Sp(c,s.globeMatrix,d),Float32Array.from(c)},p.globeTileBounds=Qa,p.globeTiltAtLngLat=Cm,p.globeToMercatorTransition=Ju,p.globeUseCustomAntiAliasing=function(o,i,s){const c=Ju(s.zoom),d=o.style.map._antialias,m=!!i.extStandardDerivatives,y=i.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===c&&!d&&!y&&m},p.identity=Br,p.identity$1=Y_,p.invert=Dp,p.isFullscreen=function(){return!!je.document.fullscreenElement||!!je.document.webkitFullscreenElement},p.isLngLatBehindGlobe=Em,p.isMapAuthenticated=function(o){return zn.has(o)},p.isMapboxURL=ge,p.isSafariWithAntialiasingBug=function(o){const i=o.navigator?o.navigator.userAgent:null;return!!oc(o)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=lr,p.latLngToECEF=Yu,p.len=Q_,p.length=Wu,p.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},p.lngFromMercatorX=Go,p.loadVectorTile=pv,p.makeRequest=gl,p.mapValue=function(o,i,s,c,d){return cn((o-i)/(s-i)*(d-c)+c,c,d)},p.mercatorScale=ay,p.mercatorXfromLng=Bs,p.mercatorYfromLat=ya,p.mercatorZfromAltitude=ms,p.mul=fm,p.mul$1=Pp,p.multiply=_a,p.multiply$1=Uo,p.multiply$2=W_,p.nextPowerOfTwo=Yo,p.normalize=Er,p.normalize$1=KA,p.normalize$2=K_,p.number=xn,p.ortho=function(o,i,s,c,d,m,y){var x=1/(i-s),w=1/(c-d),E=1/(m-y);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*E,o[11]=0,o[12]=(i+s)*x,o[13]=(d+c)*w,o[14]=(y+m)*E,o[15]=1,o},p.pbf=Ey,p.perspective=function(o,i,s,c,d){var m,y=1/Math.tan(i/2);return o[0]=y/s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=y,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=d&&d!==1/0?(o[10]=(d+c)*(m=1/(c-d)),o[14]=2*d*c*m):(o[10]=-1,o[14]=-2*c),o},p.pick=function(o,i){const s={};for(let c=0;c<i.length;c++){const d=i[c];d in o&&(s[d]=o[d])}return s},p.plugin=T,p.pointGeometry=Cs,p.polesInViewport=function(o){const i=Br(new Float64Array(16));_a(i,o.pixelMatrix,o.globeMatrix);const s=[0,Fs,0],c=[0,Ls,0];return ni(s,s,i),ni(c,c,i),[s[0]>0&&s[0]<=o.width&&s[1]>0&&s[1]<=o.height&&!Em(o,new Pn(o.center.lat,90)),c[0]>0&&c[0]<=o.width&&c[1]>0&&c[1]<=o.height&&!Em(o,new Pn(o.center.lat,-90))]},p.polygonContainsPoint=Ka,p.polygonIntersectsBox=Om,p.polygonIntersectsPolygon=cy,p.polygonizeBounds=function(o,i,s=0,c=!0){const d=new at(s,s),m=o.sub(d),y=i.add(d),x=[m,new at(y.x,m.y),y,new at(m.x,y.y)];return c&&x.push(m.clone()),x},p.posAttributes=fd,p.postMapLoadEvent=yi,p.postPerformanceEvent=Pi,p.postTurnstileEvent=fn,p.potpack=xg,p.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},p.radToDeg=Hi,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(o){return o({pluginStatus:f,pluginURL:a}),v.on("pluginStateChange",o),o},p.removeAuthState=function(o){zn.delete(o)},p.renderColorRamp=Hp,p.resample=zp,p.rotateX=q_,p.rotateX$1=XA,p.rotateY=Sp,p.rotateY$1=gm,p.rotateZ=function(o,i,s){var c=Math.sin(s),d=Math.cos(s),m=i[0],y=i[1],x=i[2],w=i[3],E=i[4],D=i[5],k=i[6],R=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=m*d+E*c,o[1]=y*d+D*c,o[2]=x*d+k*c,o[3]=w*d+R*c,o[4]=E*d-m*c,o[5]=D*d-y*c,o[6]=k*d-x*c,o[7]=R*d-w*c,o},p.rotateZ$1=function(o,i,s){s*=.5;var c=i[0],d=i[1],m=i[2],y=i[3],x=Math.sin(s),w=Math.cos(s);return o[0]=c*w+d*x,o[1]=d*w-c*x,o[2]=m*w+y*x,o[3]=y*w-m*x,o},p.scale=kc,p.scale$1=X_,p.scale$2=no,p.scaleAndAdd=Bl,p.set=function(o,i,s,c){return o[0]=i,o[1]=s,o[2]=c,o},p.setCacheLimits=function(o,i){ac=o,Vh=i},p.setColumn=function(o,i,s){o[4*i+0]=s[0],o[4*i+1]=s[1],o[4*i+2]=s[2],o[4*i+3]=s[3]},p.setRTLTextPlugin=function(o,i,s=!1){if(f===zo||f===ju||f===da)throw new Error("setRTLTextPlugin cannot be called multiple times.");a=ts.resolveURL(o),f=zo,Zr=i,g(),s||I()},p.smoothstep=ka,p.spec=Oe,p.squaredLength=function(o){var i=o[0],s=o[1],c=o[2];return i*i+s*s+c*c},p.storeAuthState=function(o,i){i?zn.add(o):zn.delete(o)},p.sub=io,p.subtract=mm,p.symbolSize=uh,p.tileAABB=function(o,i,s,c,d,m,y,x,w){if("globe"===w.name)return function iy(o,i,s){const c=i/o.worldSize,d=o.globeMatrix;if(s.z<=1){const we=Qa(s).getCorners();return Op(we,d,c),Nr.fromPoints(we)}const m=md(s),y=Fp(m);Op(y,d,c);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(m.contains(o.center)){for(const $e of y)dd(E,E,$e),pd(w,w,$e);w[2]=0;const we=o.point,Re=[we.x*c,we.y*c,0];return dd(E,E,Re),pd(w,w,Re),new Nr(E,w)}const D=[d[12]*c,d[13]*c,d[14]*c],k=m.getCenter(),R=cn(o.center.lat,-cr,cr),L=cn(k.lat,-cr,cr),N=Bs(o.center.lng),j=ya(R);let q=N-Bs(k.lng);const J=j-ya(L);q>.5?q-=1:q<-.5&&(q+=1);let se=0;Math.abs(q)>Math.abs(J)?se=q>=0?1:3:(se=J>=0?0:2,Bl(D,D,[d[4]*c,d[5]*c,d[6]*c],-Math.sin(on(J>=0?m.getSouth():m.getNorth()))*Za));const Y=y[se],oe=y[(se+1)%4],ce=new Cw(Y,oe,D),le=[ny(ce,0)||Y[0],ny(ce,1)||Y[1],ny(ce,2)||Y[2]],xe=Ju(o.zoom);if(xe>0){const we=function({x:$e,y:Te,z:Ne},ze,Ge,Xe,Pe){const lt=1/(1<<Ne);let gt=$e*lt,ht=gt+lt,zt=Te*lt,nt=zt+lt,It=0;const Vt=(gt+ht)/2-Xe;return Vt>.5?It=-1:Vt<-.5&&(It=1),gt=((gt+It)*ze-(Xe*=ze))*Ge+Xe,ht=((ht+It)*ze-Xe)*Ge+Xe,zt=(zt*ze-(Pe*=ze))*Ge+Pe,nt=(nt*ze-Pe)*Ge+Pe,[[gt,nt,0],[ht,nt,0],[ht,zt,0],[gt,zt,0]]}(s,i,o._pixelsPerMercatorPixel,N,j);for(let $e=0;$e<y.length;$e++)Oc(y[$e],we[$e],xe);const Re=Wa([],we[se],we[(se+1)%4]);no(Re,Re,.5),Oc(le,Re,xe)}for(const we of y)dd(E,E,we),pd(w,w,we);return E[2]=Math.min(Y[2],oe[2]),dd(E,E,le),pd(w,w,le),new Nr(E,w)}(o,i,new sg(s,c,d));const E=qc({z:s,x:c,y:d},w);return new Nr([(m+E.x/E.scale)*i,i*(E.y/E.scale),y],[(m+E.x2/E.scale)*i,i*(E.y2/E.scale),x])},p.tileCornersToBounds=md,p.tileTransform=qc,p.transformMat3=function(o,i,s){var c=i[0],d=i[1],m=i[2];return o[0]=c*s[0]+d*s[3]+m*s[6],o[1]=c*s[1]+d*s[4]+m*s[7],o[2]=c*s[2]+d*s[5]+m*s[8],o},p.transformMat4=ni,p.transformMat4$1=fs,p.transformQuat=Z_,p.transitionTileAABBinECEF=xm,p.translate=qa,p.transpose=function(o,i){if(o===i){var s=i[1],c=i[2],d=i[5];o[1]=i[3],o[2]=i[6],o[3]=s,o[5]=i[7],o[6]=c,o[7]=d}else o[0]=i[0],o[1]=i[3],o[2]=i[6],o[3]=i[1],o[4]=i[4],o[5]=i[7],o[6]=i[2],o[7]=i[5],o[8]=i[8];return o},p.triggerPluginCompletionEvent=u,p.uniqueId=nr,p.updateGlobeVertexNormal=function(o,i,s,c,d){const m=5*i+2;o.float32[m+0]=s,o.float32[m+1]=c,o.float32[m+2]=d},p.validateCustomStyleLayer=function(o){const i=[],s=o.id;return void 0===s&&i.push({message:`layers.${s}: missing required property "id"`}),void 0===o.render&&i.push({message:`layers.${s}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&i.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),i},p.validateFilter=o=>Lo(xr(o)),p.validateFog=o=>Lo(Mc(o)),p.validateLayer=o=>Lo(Ic(o)),p.validateLight=o=>Lo(Fr(o)),p.validateSource=o=>Lo(ld(o)),p.validateStyle=Nu,p.validateTerrain=o=>Lo(cd(o)),p.values=Ys,p.vectorTile=gs,p.version=Xo,p.warnOnce=li,p.window=je,p.wrap=pn}),Bh(0,function(p){function je(ae){if("number"==typeof ae||"boolean"==typeof ae||"string"==typeof ae||null==ae)return JSON.stringify(ae);if(Array.isArray(ae)){let H="[";for(const re of ae)H+=`${je(re)},`;return`${H}]`}let U="{";for(const H of Object.keys(ae).sort())U+=`${H}:${je(ae[H])},`;return`${U}}`}function Xo(ae){let U="";for(const H of p.refProperties)U+=`/${je(ae[H])}`;return U}class so{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,H){for(const he of U)this._layerConfigs[he.id]=he,(this._layers[he.id]=p.createStyleLayer(he)).compileFilter(),this.keyCache[he.id]&&delete this.keyCache[he.id];for(const he of H)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const re=function(he,ge){const Ce={};for(let me=0;me<he.length;me++){const Se=ge&&ge[he[me].id]||Xo(he[me]);ge&&(ge[he[me].id]=Se);let it=Ce[Se];it||(it=Ce[Se]=[]),it.push(he[me])}const be=[];for(const me in Ce)be.push(Ce[me]);return be}(p.values(this._layerConfigs),this.keyCache);for(const he of re){const ge=he.map(st=>this._layers[st.id]),Ce=ge[0];if("none"===Ce.visibility)continue;const be=Ce.source||"";let me=this.familiesBySource[be];me||(me=this.familiesBySource[be]={});const Se=Ce.sourceLayer||"_geojsonTileLayer";let it=me[Se];it||(it=me[Se]=[]),it.push(ge)}}}class Kt{loadTile(U,H){const{uid:re,encoding:he,rawImageData:ge,padding:Ce,buildQuadTree:be}=U,me=p.window.ImageBitmap&&ge instanceof p.window.ImageBitmap?this.getImageData(ge,Ce):ge;H(null,new p.DEMData(re,me,he,Ce<1,be))}getImageData(U,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const re=this.offscreenCanvasContext.getImageData(-H,-H,U.width+2*H,U.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}function Zt(ae,U){if(0!==ae.length){Li(ae[0],U);for(var H=1;H<ae.length;H++)Li(ae[H],!U)}}function Li(ae,U){for(var H=0,re=0,he=0,ge=ae.length,Ce=ge-1;he<ge;Ce=he++){var be=(ae[he][0]-ae[Ce][0])*(ae[Ce][1]+ae[he][1]),me=H+be;re+=Math.abs(H)>=Math.abs(be)?H-me+be:be-me+H,H=me}H+re>=0!=!!U&&ae.reverse()}var kr=p.getDefaultExportFromCjs(function ae(U,H){var re,he=U&&U.type;if("FeatureCollection"===he)for(re=0;re<U.features.length;re++)ae(U.features[re],H);else if("GeometryCollection"===he)for(re=0;re<U.geometries.length;re++)ae(U.geometries[re],H);else if("Feature"===he)ae(U.geometry,H);else if("Polygon"===he)Zt(U.coordinates,H);else if("MultiPolygon"===he)for(re=0;re<U.coordinates.length;re++)Zt(U.coordinates[re],H);return U});const Eo=p.VectorTileFeature.prototype.toGeoJSON;var ws={exports:{}},ic=p.pointGeometry,dl=p.vectorTile.VectorTileFeature,Xr=ao;function ao(ae,U){this.options=U||{},this.features=ae,this.length=ae.length}function Hr(ae,U){this.id="number"==typeof ae.id?ae.id:void 0,this.type=ae.type,this.rawGeometry=1===ae.type?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=U||4096}ao.prototype.feature=function(ae){return new Hr(this.features[ae],this.options.extent)},Hr.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var U=0;U<ae.length;U++){for(var H=ae[U],re=[],he=0;he<H.length;he++)re.push(new ic(H[he][0],H[he][1]));this.geometry.push(re)}return this.geometry},Hr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,U=1/0,H=-1/0,re=1/0,he=-1/0,ge=0;ge<ae.length;ge++)for(var Ce=ae[ge],be=0;be<Ce.length;be++){var me=Ce[be];U=Math.min(U,me.x),H=Math.max(H,me.x),re=Math.min(re,me.y),he=Math.max(he,me.y)}return[U,re,H,he]},Hr.prototype.toGeoJSON=dl.prototype.toGeoJSON;var Ta=p.pbf,Cs=Xr;function Io(ae){var U=new Ta;return function(H,re){for(var he in H.layers)re.writeMessage(3,at,H.layers[he])}(ae,U),U.finish()}function at(ae,U){var H;U.writeVarintField(15,ae.version||1),U.writeStringField(1,ae.name||""),U.writeVarintField(5,ae.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<ae.length;H++)re.feature=ae.feature(H),U.writeMessage(2,Nh,re);var he=re.keys;for(H=0;H<he.length;H++)U.writeStringField(3,he[H]);var ge=re.values;for(H=0;H<ge.length;H++)U.writeMessage(4,uu,ge[H])}function Nh(ae,U){var H=ae.feature;void 0!==H.id&&U.writeVarintField(1,H.id),U.writeMessage(2,Da,ae),U.writeVarintField(3,H.type),U.writeMessage(4,rc,H)}function Da(ae,U){var H=ae.feature,re=ae.keys,he=ae.values,ge=ae.keycache,Ce=ae.valuecache;for(var be in H.properties){var me=H.properties[be],Se=ge[be];if(null!==me){void 0===Se&&(re.push(be),ge[be]=Se=re.length-1),U.writeVarint(Se);var it=typeof me;"string"!==it&&"boolean"!==it&&"number"!==it&&(me=JSON.stringify(me));var st=it+":"+me,Ye=Ce[st];void 0===Ye&&(he.push(me),Ce[st]=Ye=he.length-1),U.writeVarint(Ye)}}}function on(ae,U){return(U<<3)+(7&ae)}function Hi(ae){return ae<<1^ae>>31}function rc(ae,U){for(var H=ae.loadGeometry(),re=ae.type,he=0,ge=0,Ce=H.length,be=0;be<Ce;be++){var me=H[be],Se=1;1===re&&(Se=me.length),U.writeVarint(on(1,Se));for(var it=3===re?me.length-1:me.length,st=0;st<it;st++){1===st&&1!==re&&U.writeVarint(on(2,it-1));var Ye=me[st].x-he,Ut=me[st].y-ge;U.writeVarint(Hi(Ye)),U.writeVarint(Hi(Ut)),he+=Ye,ge+=Ut}3===re&&U.writeVarint(on(7,1))}}function uu(ae,U){var H=typeof ae;"string"===H?U.writeStringField(1,ae):"boolean"===H?U.writeBooleanField(7,ae):"number"===H&&(ae%1!=0?U.writeDoubleField(3,ae):ae<0?U.writeSVarintField(6,ae):U.writeVarintField(5,ae))}ws.exports=Io,ws.exports.fromVectorTileJs=Io,ws.exports.fromGeojsonVt=function(ae,U){U=U||{};var H={};for(var re in ae)H[re]=new Cs(ae[re].features,U),H[re].name=re,H[re].version=U.version,H[re].extent=U.extent;return Io({layers:H})},ws.exports.GeoJSONWrapper=Cs;var Sa=p.getDefaultExportFromCjs(ws.exports);const Ko={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},cn=Math.fround||(ka=new Float32Array(1),ae=>(ka[0]=+ae,ka[0]));var ka;const pn=3,Bi=5,Ys=6;class Ci{constructor(U){this.options=Object.assign(Object.create(Ko),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:H,minZoom:re,maxZoom:he}=this.options;H&&console.time("total time");const ge=`prepare ${U.length} points`;H&&console.time(ge),this.points=U;const Ce=[];for(let me=0;me<U.length;me++){const Se=U[me];if(!Se.geometry)continue;const[it,st]=Se.geometry.coordinates,Ye=cn(Es(it)),Ut=cn(Yo(st));Ce.push(Ye,Ut,1/0,me,-1,1),this.options.reduce&&Ce.push(0)}let be=this.trees[he+1]=this._createTree(Ce);H&&console.timeEnd(ge);for(let me=he;me>=re;me--){const Se=+Date.now();be=this.trees[me]=this._createTree(this._cluster(be,me)),H&&console.log("z%d: %d clusters in %dms",me,be.numItems,+Date.now()-Se)}return H&&console.timeEnd("total time"),this}getClusters(U,H){let re=((U[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,U[1]));let ge=180===U[2]?180:((U[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)re=-180,ge=180;else if(re>ge){const st=this.getClusters([re,he,180,Ce],H),Ye=this.getClusters([-180,he,ge,Ce],H);return st.concat(Ye)}const be=this.trees[this._limitZoom(H)],me=be.range(Es(re),Yo(Ce),Es(ge),Yo(he)),Se=be.data,it=[];for(const st of me){const Ye=this.stride*st;it.push(Se[Ye+Bi]>1?Js(Se,Ye,this.clusterProps):this.points[Se[Ye+pn]])}return it}getChildren(U){const H=this._getOriginId(U),re=this._getOriginZoom(U),he="No cluster with the specified id.",ge=this.trees[re];if(!ge)throw new Error(he);const Ce=ge.data;if(H*this.stride>=Ce.length)throw new Error(he);const be=this.options.radius/(this.options.extent*Math.pow(2,re-1)),me=ge.within(Ce[H*this.stride],Ce[H*this.stride+1],be),Se=[];for(const it of me){const st=it*this.stride;Ce[st+4]===U&&Se.push(Ce[st+Bi]>1?Js(Ce,st,this.clusterProps):this.points[Ce[st+pn]])}if(0===Se.length)throw new Error(he);return Se}getLeaves(U,H,re){const he=[];return this._appendLeaves(he,U,H=H||10,re=re||0,0),he}getTile(U,H,re){const he=this.trees[this._limitZoom(U)],ge=Math.pow(2,U),{extent:Ce,radius:be}=this.options,me=be/Ce,Se=(re-me)/ge,it=(re+1+me)/ge,st={features:[]};return this._addTileFeatures(he.range((H-me)/ge,Se,(H+1+me)/ge,it),he.data,H,re,ge,st),0===H&&this._addTileFeatures(he.range(1-me/ge,Se,1,it),he.data,ge,re,ge,st),H===ge-1&&this._addTileFeatures(he.range(0,Se,me/ge,it),he.data,-1,re,ge,st),st.features.length?st:null}getClusterExpansionZoom(U){let H=this._getOriginZoom(U)-1;for(;H<=this.options.maxZoom;){const re=this.getChildren(U);if(H++,1!==re.length)break;U=re[0].properties.cluster_id}return H}_appendLeaves(U,H,re,he,ge){const Ce=this.getChildren(H);for(const be of Ce){const me=be.properties;if(me&&me.cluster?ge+me.point_count<=he?ge+=me.point_count:ge=this._appendLeaves(U,me.cluster_id,re,he,ge):ge<he?ge++:U.push(be),U.length===re)break}return ge}_createTree(U){const H=new p.KDBush(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<U.length;re+=this.stride)H.add(U[re],U[re+1]);return H.finish(),H.data=U,H}_addTileFeatures(U,H,re,he,ge,Ce){for(const be of U){const me=be*this.stride,Se=H[me+Bi]>1;let it,st,Ye;if(Se)it=nr(H,me,this.clusterProps),st=H[me],Ye=H[me+1];else{const Ht=this.points[H[me+pn]];it=Ht.properties;const[nn,fn]=Ht.geometry.coordinates;st=Es(nn),Ye=Yo(fn)}const Ut={type:1,geometry:[[Math.round(this.options.extent*(st*ge-re)),Math.round(this.options.extent*(Ye*ge-he))]],tags:it};let Rt;Rt=Se||this.options.generateId?H[me+pn]:this.points[H[me+pn]].id,void 0!==Rt&&(Ut.id=Rt),Ce.features.push(Ut)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,H){const{radius:re,extent:he,reduce:ge,minPoints:Ce}=this.options,be=re/(he*Math.pow(2,H)),me=U.data,Se=[],it=this.stride;for(let st=0;st<me.length;st+=it){if(me[st+2]<=H)continue;me[st+2]=H;const Ye=me[st],Ut=me[st+1],Rt=U.within(me[st],me[st+1],be),Ht=me[st+Bi];let nn=Ht;for(const fn of Rt){const oi=fn*it;me[oi+2]>H&&(nn+=me[oi+Bi])}if(nn>Ht&&nn>=Ce){let fn,oi=Ye*Ht,yi=Ut*Ht,fr=-1;const Pi=((st/it|0)<<5)+(H+1)+this.points.length;for(const $i of Rt){const qi=$i*it;if(me[qi+2]<=H)continue;me[qi+2]=H;const zn=me[qi+Bi];oi+=me[qi]*zn,yi+=me[qi+1]*zn,me[qi+4]=Pi,ge&&(fn||(fn=this._map(me,st,!0),fr=this.clusterProps.length,this.clusterProps.push(fn)),ge(fn,this._map(me,qi)))}me[st+4]=Pi,Se.push(oi/nn,yi/nn,1/0,Pi,-1,nn),ge&&Se.push(fr)}else{for(let fn=0;fn<it;fn++)Se.push(me[st+fn]);if(nn>1)for(const fn of Rt){const oi=fn*it;if(!(me[oi+2]<=H)){me[oi+2]=H;for(let yi=0;yi<it;yi++)Se.push(me[oi+yi])}}}}return Se}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,H,re){if(U[H+Bi]>1){const Ce=this.clusterProps[U[H+Ys]];return re?Object.assign({},Ce):Ce}const he=this.points[U[H+pn]].properties,ge=this.options.map(he);return re&&ge===he?Object.assign({},ge):ge}}function Js(ae,U,H){return{type:"Feature",id:ae[U+pn],properties:nr(ae,U,H),geometry:{type:"Point",coordinates:[(re=ae[U],360*(re-.5)),hi(ae[U+1])]}};var re}function nr(ae,U,H){const re=ae[U+Bi],he=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,ge=ae[U+Ys],Ce=-1===ge?{}:Object.assign({},H[ge]);return Object.assign(Ce,{cluster:!0,cluster_id:ae[U+pn],point_count:re,point_count_abbreviated:he})}function Es(ae){return ae/360+.5}function Yo(ae){const U=Math.sin(ae*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function hi(ae){const U=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Jn(ae,U,H,re){for(var he,ge=re,Ce=H-U>>1,be=H-U,me=ae[U],Se=ae[U+1],it=ae[H],st=ae[H+1],Ye=U+3;Ye<H;Ye+=3){var Ut=pl(ae[Ye],ae[Ye+1],me,Se,it,st);if(Ut>ge)he=Ye,ge=Ut;else if(Ut===ge){var Rt=Math.abs(Ye-Ce);Rt<be&&(he=Ye,be=Rt)}}ge>re&&(he-U>3&&Jn(ae,U,he,re),ae[he+2]=ge,H-he>3&&Jn(ae,he,H,re))}function pl(ae,U,H,re,he,ge){var Ce=he-H,be=ge-re;if(0!==Ce||0!==be){var me=((ae-H)*Ce+(U-re)*be)/(Ce*Ce+be*be);me>1?(H=he,re=ge):me>0&&(H+=Ce*me,re+=be*me)}return(Ce=ae-H)*Ce+(be=U-re)*be}function ct(ae,U,H,re){var he={id:void 0===ae?null:ae,type:U,geometry:H,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ge){var Ce=ge.geometry,be=ge.type;if("Point"===be||"MultiPoint"===be||"LineString"===be)ea(ge,Ce);else if("Polygon"===be||"MultiLineString"===be)for(var me=0;me<Ce.length;me++)ea(ge,Ce[me]);else if("MultiPolygon"===be)for(me=0;me<Ce.length;me++)for(var Se=0;Se<Ce[me].length;Se++)ea(ge,Ce[me][Se])}(he),he}function ea(ae,U){for(var H=0;H<U.length;H+=3)ae.minX=Math.min(ae.minX,U[H]),ae.minY=Math.min(ae.minY,U[H+1]),ae.maxX=Math.max(ae.maxX,U[H]),ae.maxY=Math.max(ae.maxY,U[H+1])}function lo(ae,U,H,re){if(U.geometry){var he=U.geometry.coordinates,ge=U.geometry.type,Ce=Math.pow(H.tolerance/((1<<H.maxZoom)*H.extent),2),be=[],me=U.id;if(H.promoteId?me=U.properties[H.promoteId]:H.generateId&&(me=re||0),"Point"===ge)fl(he,be);else if("MultiPoint"===ge)for(var Se=0;Se<he.length;Se++)fl(he[Se],be);else if("LineString"===ge)li(he,be,Ce,!1);else if("MultiLineString"===ge){if(H.lineMetrics){for(Se=0;Se<he.length;Se++)li(he[Se],be=[],Ce,!1),ae.push(ct(me,"LineString",be,U.properties));return}Mo(he,be,Ce,!1)}else if("Polygon"===ge)Mo(he,be,Ce,!0);else{if("MultiPolygon"!==ge){if("GeometryCollection"===ge){for(Se=0;Se<U.geometry.geometries.length;Se++)lo(ae,{id:me,geometry:U.geometry.geometries[Se],properties:U.properties},H,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<he.length;Se++){var it=[];Mo(he[Se],it,Ce,!0),be.push(it)}}ae.push(ct(me,ge,be,U.properties))}}function fl(ae,U){U.push(zh(ae[0])),U.push(ta(ae[1])),U.push(0)}function li(ae,U,H,re){for(var he,ge,Ce=0,be=0;be<ae.length;be++){var me=zh(ae[be][0]),Se=ta(ae[be][1]);U.push(me),U.push(Se),U.push(0),be>0&&(Ce+=re?(he*Se-me*ge)/2:Math.sqrt(Math.pow(me-he,2)+Math.pow(Se-ge,2))),he=me,ge=Se}var it=U.length-3;U[2]=1,Jn(U,0,it,H),U[it+2]=1,U.size=Math.abs(Ce),U.start=0,U.end=U.size}function Mo(ae,U,H,re){for(var he=0;he<ae.length;he++){var ge=[];li(ae[he],ge,H,re),U.push(ge)}}function zh(ae){return ae/360+.5}function ta(ae){var U=Math.sin(ae*Math.PI/180),H=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return H<0?0:H>1?1:H}function co(ae,U,H,re,he,ge,Ce,be){if(re/=U,ge>=(H/=U)&&Ce<re)return ae;if(Ce<H||ge>=re)return null;for(var me=[],Se=0;Se<ae.length;Se++){var it=ae[Se],st=it.geometry,Ye=it.type,Ut=0===he?it.minX:it.minY,Rt=0===he?it.maxX:it.maxY;if(Ut>=H&&Rt<re)me.push(it);else if(!(Rt<H||Ut>=re)){var Ht=[];if("Point"===Ye||"MultiPoint"===Ye)hu(st,Ht,H,re,he);else if("LineString"===Ye)oc(st,Ht,H,re,he,!1,be.lineMetrics);else if("MultiLineString"===Ye)na(st,Ht,H,re,he,!1);else if("Polygon"===Ye)na(st,Ht,H,re,he,!0);else if("MultiPolygon"===Ye)for(var nn=0;nn<st.length;nn++){var fn=[];na(st[nn],fn,H,re,he,!0),fn.length&&Ht.push(fn)}if(Ht.length){if(be.lineMetrics&&"LineString"===Ye){for(nn=0;nn<Ht.length;nn++)me.push(ct(it.id,Ye,Ht[nn],it.tags));continue}"LineString"!==Ye&&"MultiLineString"!==Ye||(1===Ht.length?(Ye="LineString",Ht=Ht[0]):Ye="MultiLineString"),"Point"!==Ye&&"MultiPoint"!==Ye||(Ye=3===Ht.length?"Point":"MultiPoint"),me.push(ct(it.id,Ye,Ht,it.tags))}}}return me.length?me:null}function hu(ae,U,H,re,he){for(var ge=0;ge<ae.length;ge+=3){var Ce=ae[ge+he];Ce>=H&&Ce<=re&&(U.push(ae[ge]),U.push(ae[ge+1]),U.push(ae[ge+2]))}}function oc(ae,U,H,re,he,ge,Ce){for(var be,me,Se=du(ae),it=0===he?ac:Vh,st=ae.start,Ye=0;Ye<ae.length-3;Ye+=3){var Ut=ae[Ye],Rt=ae[Ye+1],Ht=ae[Ye+2],nn=ae[Ye+3],fn=ae[Ye+4],oi=0===he?Ut:Rt,yi=0===he?nn:fn,fr=!1;Ce&&(be=Math.sqrt(Math.pow(Ut-nn,2)+Math.pow(Rt-fn,2))),oi<H?yi>H&&(me=it(Se,Ut,Rt,nn,fn,H),Ce&&(Se.start=st+be*me)):oi>re?yi<re&&(me=it(Se,Ut,Rt,nn,fn,re),Ce&&(Se.start=st+be*me)):sc(Se,Ut,Rt,Ht),yi<H&&oi>=H&&(me=it(Se,Ut,Rt,nn,fn,H),fr=!0),yi>re&&oi<=re&&(me=it(Se,Ut,Rt,nn,fn,re),fr=!0),!ge&&fr&&(Ce&&(Se.end=st+be*me),U.push(Se),Se=du(ae)),Ce&&(st+=be)}var Pi=ae.length-3;Ut=ae[Pi],Rt=ae[Pi+1],Ht=ae[Pi+2],(oi=0===he?Ut:Rt)>=H&&oi<=re&&sc(Se,Ut,Rt,Ht),Pi=Se.length-3,ge&&Pi>=3&&(Se[Pi]!==Se[0]||Se[Pi+1]!==Se[1])&&sc(Se,Se[0],Se[1],Se[2]),Se.length&&U.push(Se)}function du(ae){var U=[];return U.size=ae.size,U.start=ae.start,U.end=ae.end,U}function na(ae,U,H,re,he,ge){for(var Ce=0;Ce<ae.length;Ce++)oc(ae[Ce],U,H,re,he,ge,!1)}function sc(ae,U,H,re){ae.push(U),ae.push(H),ae.push(re)}function ac(ae,U,H,re,he,ge){var Ce=(ge-U)/(re-U);return ae.push(ge),ae.push(H+(he-H)*Ce),ae.push(1),Ce}function Vh(ae,U,H,re,he,ge){var Ce=(ge-H)/(he-H);return ae.push(U+(re-U)*Ce),ae.push(ge),ae.push(1),Ce}function Kr(ae,U){for(var H=[],re=0;re<ae.length;re++){var he,ge=ae[re],Ce=ge.type;if("Point"===Ce||"MultiPoint"===Ce||"LineString"===Ce)he=ia(ge.geometry,U);else if("MultiLineString"===Ce||"Polygon"===Ce){he=[];for(var be=0;be<ge.geometry.length;be++)he.push(ia(ge.geometry[be],U))}else if("MultiPolygon"===Ce)for(he=[],be=0;be<ge.geometry.length;be++){for(var me=[],Se=0;Se<ge.geometry[be].length;Se++)me.push(ia(ge.geometry[be][Se],U));he.push(me)}H.push(ct(ge.id,Ce,he,ge.tags))}return H}function ia(ae,U){var H=[];H.size=ae.size,void 0!==ae.start&&(H.start=ae.start,H.end=ae.end);for(var re=0;re<ae.length;re+=3)H.push(ae[re]+U,ae[re+1],ae[re+2]);return H}function pu(ae,U){if(ae.transformed)return ae;var H,re,he,ge=1<<ae.z,Ce=ae.x,be=ae.y;for(H=0;H<ae.features.length;H++){var me=ae.features[H],Se=me.geometry,it=me.type;if(me.geometry=[],1===it)for(re=0;re<Se.length;re+=2)me.geometry.push(ml(Se[re],Se[re+1],U,ge,Ce,be));else for(re=0;re<Se.length;re++){var st=[];for(he=0;he<Se[re].length;he+=2)st.push(ml(Se[re][he],Se[re][he+1],U,ge,Ce,be));me.geometry.push(st)}}return ae.transformed=!0,ae}function ml(ae,U,H,re,he,ge){return[Math.round(H*(ae*re-he)),Math.round(H*(U*re-ge))]}function lc(ae,U,H,re,he){for(var ge=U===he.maxZoom?0:he.tolerance/((1<<U)*he.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:H,y:re,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},be=0;be<ae.length;be++){Ce.numFeatures++,To(Ce,ae[be],ge,he);var me=ae[be].minX,Se=ae[be].minY,it=ae[be].maxX,st=ae[be].maxY;me<Ce.minX&&(Ce.minX=me),Se<Ce.minY&&(Ce.minY=Se),it>Ce.maxX&&(Ce.maxX=it),st>Ce.maxY&&(Ce.maxY=st)}return Ce}function To(ae,U,H,re){var he=U.geometry,ge=U.type,Ce=[];if("Point"===ge||"MultiPoint"===ge)for(var be=0;be<he.length;be+=3)Ce.push(he[be]),Ce.push(he[be+1]),ae.numPoints++,ae.numSimplified++;else if("LineString"===ge)Pa(Ce,he,ae,H,!1,!1);else if("MultiLineString"===ge||"Polygon"===ge)for(be=0;be<he.length;be++)Pa(Ce,he[be],ae,H,"Polygon"===ge,0===be);else if("MultiPolygon"===ge)for(var me=0;me<he.length;me++){var Se=he[me];for(be=0;be<Se.length;be++)Pa(Ce,Se[be],ae,H,!0,0===be)}if(Ce.length){var it=U.tags||null;if("LineString"===ge&&re.lineMetrics){for(var st in it={},U.tags)it[st]=U.tags[st];it.mapbox_clip_start=he.start/he.size,it.mapbox_clip_end=he.end/he.size}var Ye={geometry:Ce,type:"Polygon"===ge||"MultiPolygon"===ge?3:"LineString"===ge||"MultiLineString"===ge?2:1,tags:it};null!==U.id&&(Ye.id=U.id),ae.features.push(Ye)}}function Pa(ae,U,H,re,he,ge){var Ce=re*re;if(re>0&&U.size<(he?Ce:re))H.numPoints+=U.length/3;else{for(var be=[],me=0;me<U.length;me+=3)(0===re||U[me+2]>Ce)&&(H.numSimplified++,be.push(U[me]),be.push(U[me+1])),H.numPoints++;he&&function(Se,it){for(var st=0,Ye=0,Ut=Se.length,Rt=Ut-2;Ye<Ut;Rt=Ye,Ye+=2)st+=(Se[Ye]-Se[Rt])*(Se[Ye+1]+Se[Rt+1]);if(st>0===it)for(Ye=0,Ut=Se.length;Ye<Ut/2;Ye+=2){var Ht=Se[Ye],nn=Se[Ye+1];Se[Ye]=Se[Ut-2-Ye],Se[Ye+1]=Se[Ut-1-Ye],Se[Ut-2-Ye]=Ht,Se[Ut-1-Ye]=nn}}(be,ge),ae.push(be)}}function Ra(ae,U){var H=(U=this.options=function(he,ge){for(var Ce in ge)he[Ce]=ge[Ce];return he}(Object.create(this.options),U)).debug;if(H&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var he,ge,Ce,be,me,Se,re=function(he,ge){var Ce=[];if("FeatureCollection"===he.type)for(var be=0;be<he.features.length;be++)lo(Ce,he.features[be],ge,be);else lo(Ce,"Feature"===he.type?he:{geometry:he},ge);return Ce}(ae,U);this.tiles={},this.tileCoords=[],H&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),be=he=re,me=co(he,1,-1-(Ce=(ge=U).buffer/ge.extent),Ce,0,-1,2,ge),Se=co(he,1,1-Ce,2+Ce,0,-1,2,ge),(me||Se)&&(be=co(he,1,-Ce,1+Ce,0,-1,2,ge)||[],me&&(be=Kr(me,1).concat(be)),Se&&(be=be.concat(Kr(Se,-1)))),(re=be).length&&this.splitTile(re,0,0,0),H&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Oa(ae,U,H){return 32*((1<<ae)*H+U)+ae}function gl(ae,U){const H=ae.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const re=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!re)return U(null,null);const he=new class{constructor(Ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Ce.length,this._features=Ce}feature(Ce){return new class{constructor(be){this._feature=be,this.extent=p.EXTENT,this.type=be.type,this.properties=be.tags,"id"in be&&!isNaN(be.id)&&(this.id=parseInt(be.id,10))}loadGeometry(){if(1===this._feature.type){const be=[];for(const me of this._feature.geometry)be.push([new p.Point(me[0],me[1])]);return be}{const be=[];for(const me of this._feature.geometry){const Se=[];for(const it of me)Se.push(new p.Point(it[0],it[1]));be.push(Se)}return be}}toGeoJSON(be,me,Se){return Eo.call(this,be,me,Se)}}(this._features[Ce])}}(re.features);let ge=Sa(he);0===ge.byteOffset&&ge.byteLength===ge.buffer.byteLength||(ge=new Uint8Array(ge)),U(null,{vectorTile:he,rawData:ge.buffer})}Ra.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ra.prototype.splitTile=function(ae,U,H,re,he,ge,Ce){for(var be=[ae,U,H,re],me=this.options,Se=me.debug;be.length;){re=be.pop(),H=be.pop(),U=be.pop(),ae=be.pop();var it=1<<U,st=Oa(U,H,re),Ye=this.tiles[st];if(!Ye&&(Se>1&&console.time("creation"),Ye=this.tiles[st]=lc(ae,U,H,re,me),this.tileCoords.push({z:U,x:H,y:re}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,H,re,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var Ut="z"+U;this.stats[Ut]=(this.stats[Ut]||0)+1,this.total++}if(Ye.source=ae,he){if(U===me.maxZoom||U===he)continue;var Rt=1<<he-U;if(H!==Math.floor(ge/Rt)||re!==Math.floor(Ce/Rt))continue}else if(U===me.indexMaxZoom||Ye.numPoints<=me.indexMaxPoints)continue;if(Ye.source=null,0!==ae.length){Se>1&&console.time("clipping");var Ht,nn,fn,oi,yi,fr,Pi=.5*me.buffer/me.extent,$i=.5-Pi,qi=.5+Pi,zn=1+Pi;Ht=nn=fn=oi=null,yi=co(ae,it,H-Pi,H+qi,0,Ye.minX,Ye.maxX,me),fr=co(ae,it,H+$i,H+zn,0,Ye.minX,Ye.maxX,me),ae=null,yi&&(Ht=co(yi,it,re-Pi,re+qi,1,Ye.minY,Ye.maxY,me),nn=co(yi,it,re+$i,re+zn,1,Ye.minY,Ye.maxY,me),yi=null),fr&&(fn=co(fr,it,re-Pi,re+qi,1,Ye.minY,Ye.maxY,me),oi=co(fr,it,re+$i,re+zn,1,Ye.minY,Ye.maxY,me),fr=null),Se>1&&console.timeEnd("clipping"),be.push(Ht||[],U+1,2*H,2*re),be.push(nn||[],U+1,2*H,2*re+1),be.push(fn||[],U+1,2*H+1,2*re),be.push(oi||[],U+1,2*H+1,2*re+1)}}},Ra.prototype.getTile=function(ae,U,H){var re=this.options,he=re.extent,ge=re.debug;if(ae<0||ae>24)return null;var Ce=1<<ae,be=Oa(ae,U=(U%Ce+Ce)%Ce,H);if(this.tiles[be])return pu(this.tiles[be],he);ge>1&&console.log("drilling down to z%d-%d-%d",ae,U,H);for(var me,Se=ae,it=U,st=H;!me&&Se>0;)Se--,it=Math.floor(it/2),st=Math.floor(st/2),me=this.tiles[Oa(Se,it,st)];return me&&me.source?(ge>1&&console.log("found parent tile z%d-%d-%d",Se,it,st),ge>1&&console.time("drilling down"),this.splitTile(me.source,Se,it,st,ae,U,H),ge>1&&console.timeEnd("drilling down"),this.tiles[be]?pu(this.tiles[be],he):null):null};class _l extends p.VectorTileWorkerSource{constructor(U,H,re,he,ge){super(U,H,re,he,gl),ge&&(this.loadGeoJSON=ge)}loadData(U,H){const re=U&&U.request,he=re&&re.collectResourceTiming;this.loadGeoJSON(U,(ge,Ce)=>{if(ge||!Ce)return H(ge);if("object"!=typeof Ce)return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{kr(Ce,!0);try{if(U.filter){const me=p.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===me.result)throw new Error(me.value.map(it=>`${it.key}: ${it.message}`).join(", "));Ce={type:"FeatureCollection",features:Ce.features.filter(it=>me.value.evaluate({zoom:0},it))}}this._geoJSONIndex=U.cluster?new Ci(function({superclusterOptions:me,clusterProperties:Se}){if(!Se||!me)return me;const it={},st={},Ye={accumulated:null,zoom:0},Ut={properties:null},Rt=Object.keys(Se);for(const Ht of Rt){const[nn,fn]=Se[Ht],oi=p.createExpression(fn),yi=p.createExpression("string"==typeof nn?[nn,["accumulated"],["get",Ht]]:nn);it[Ht]=oi.value,st[Ht]=yi.value}return me.map=Ht=>{Ut.properties=Ht;const nn={};for(const fn of Rt)nn[fn]=it[fn].evaluate(Ye,Ut);return nn},me.reduce=(Ht,nn)=>{Ut.properties=nn;for(const fn of Rt)Ye.accumulated=Ht[fn],Ht[fn]=st[fn].evaluate(Ye,Ut)},me}(U)).load(Ce.features):new Ra(me=Ce,U.geojsonVtOptions)}catch(me){return H(me)}this.loaded={};const be={};if(he){const me=p.getPerformanceMeasurement(re);me&&(be.resourceTiming={},be.resourceTiming[U.source]=JSON.parse(JSON.stringify(me)))}H(null,be)}var me})}reloadTile(U,H){const re=this.loaded;return re&&re[U.uid]?super.reloadTile(U,H):this.loadTile(U,H)}loadGeoJSON(U,H){if(U.request)p.getJSON(U.request,H);else{if("string"!=typeof U.data)return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(U.data))}catch{return H(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(re){H(re)}}getClusterChildren(U,H){try{H(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(re){H(re)}}getClusterLeaves(U,H){try{H(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(re){H(re)}}}class jh{constructor(U){this.self=U,this.actor=new p.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:_l},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,re)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=re},this.self.registerRTLTextPlugin=H=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=H.applyArabicShaping,p.plugin.processBidirectionalText=H.processBidirectionalText,p.plugin.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(U,H,re){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],re()}checkIfReady(U,H,re){re()}setReferrer(U,H){this.referrer=H}spriteLoaded(U,H){this.isSpriteLoaded[U]=H;for(const re in this.workerSources[U]){const he=this.workerSources[U][re];for(const ge in he)he[ge]instanceof p.VectorTileWorkerSource&&(he[ge].isSpriteLoaded=H,he[ge].fire(new p.Event("isSpriteLoaded")))}}setImages(U,H,re){this.availableImages[U]=H;for(const he in this.workerSources[U]){const ge=this.workerSources[U][he];for(const Ce in ge)ge[Ce].availableImages=H}re()}enableTerrain(U,H,re){this.terrain=H,re()}setProjection(U,H){this.projections[U]=p.getProjection(H)}setLayers(U,H,re){this.getLayerIndex(U).replace(H),re()}updateLayers(U,H,re){this.getLayerIndex(U).update(H.layers,H.removedIds),re()}loadTile(U,H,re){const he=this.enableTerrain?p.extend({enableTerrain:this.terrain},H):H;he.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,H.type,H.source).loadTile(he,re)}loadDEMTile(U,H,re){const he=this.enableTerrain?p.extend({buildQuadTree:this.terrain},H):H;this.getDEMWorkerSource(U,H.source).loadTile(he,re)}reloadTile(U,H,re){const he=this.enableTerrain?p.extend({enableTerrain:this.terrain},H):H;he.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,H.type,H.source).reloadTile(he,re)}abortTile(U,H,re){this.getWorkerSource(U,H.type,H.source).abortTile(H,re)}removeTile(U,H,re){this.getWorkerSource(U,H.type,H.source).removeTile(H,re)}removeSource(U,H,re){if(!this.workerSources[U]||!this.workerSources[U][H.type]||!this.workerSources[U][H.type][H.source])return;const he=this.workerSources[U][H.type][H.source];delete this.workerSources[U][H.type][H.source],void 0!==he.removeSource?he.removeSource(H,re):re()}loadWorkerSource(U,H,re){try{this.self.importScripts(H.url),re()}catch(he){re(he.toString())}}syncRTLPluginState(U,H,re){try{p.plugin.setState(H);const he=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=he){this.self.importScripts(he);const ge=p.plugin.isParsed();re(ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${he}`),ge)}}catch(he){re(he.toString())}}getAvailableImages(U){let H=this.availableImages[U];return H||(H=[]),H}getLayerIndex(U){let H=this.layerIndexes[U];return H||(H=this.layerIndexes[U]=new so),H}getWorkerSource(U,H,re){return this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][H]||(this.workerSources[U][H]={}),this.workerSources[U][H][re]||(this.workerSources[U][H][re]=new this.workerSourceTypes[H]({send:(ge,Ce,be,me,Se,it)=>{this.actor.send(ge,Ce,be,U,Se,it)},scheduler:this.actor.scheduler},this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])),this.workerSources[U][H][re]}getDEMWorkerSource(U,H){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][H]||(this.demWorkerSources[U][H]=new Kt),this.demWorkerSources[U][H]}enforceCacheSizeLimit(U,H){p.enforceCacheSizeLimit(H)}getWorkerPerformanceMetrics(U,H,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new jh(self)),jh}),Bh(0,function(p){function je(f,a){if(Array.isArray(f)){if(!Array.isArray(a)||f.length!==a.length)return!1;for(let u=0;u<f.length;u++)if(!je(f[u],a[u]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==a){if("object"!=typeof a||Object.keys(f).length!==Object.keys(a).length)return!1;for(const u in f)if(!je(f[u],a[u]))return!1;return!0}return f===a}var Xo=so;function so(f){return a=f,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),I=URL.createObjectURL(b);try{v=new Worker(I),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(I),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===Kt[u=a&&a.failIfMajorPerformanceCaveat]&&(Kt[u]=function(g){var v,I,T,S,b=(I=g,T=document.createElement("canvas"),(S=Object.create(so.webGLContextAttributes)).failIfMajorPerformanceCaveat=I,T.getContext("webgl",S)||T.getContext("experimental-webgl",S));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!Kt[u]||document.documentMode));var a,u}var Kt={};function Zt(f,a,u){const g=p.window.document.createElement(f);return void 0!==a&&(g.className=a),u&&u.appendChild(g),g}function Li(f,a,u){const g=p.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const v of Object.keys(a))g.setAttributeNS(null,v,a[v]);return u&&u.appendChild(g),g}so.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const kr=p.window.document&&p.window.document.documentElement.style,Eo=kr&&void 0!==kr.userSelect?"userSelect":"WebkitUserSelect";let ws;function ic(){kr&&Eo&&(ws=kr[Eo],kr[Eo]="none")}function dl(){kr&&Eo&&(kr[Eo]=ws)}function Xr(f){f.preventDefault(),f.stopPropagation(),p.window.removeEventListener("click",Xr,!0)}function ao(){p.window.addEventListener("click",Xr,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Xr,!0)},0)}function Hr(f,a){const u=f.getBoundingClientRect();return Io(f,u,a)}function Ta(f,a){const u=f.getBoundingClientRect(),g=[];for(let v=0;v<a.length;v++)g.push(Io(f,u,a[v]));return g}function Cs(f){return void 0!==p.window.InstallTrigger&&2===f.button&&f.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Io(f,a,u){const g=f.offsetWidth===a.width?1:f.offsetWidth/a.width;return new p.Point((u.clientX-a.left)*g,(u.clientY-a.top)*g)}function at(f,a){var u=a[0],g=a[1],v=a[2],b=a[3],I=u*b-v*g;return I?(f[0]=b*(I=1/I),f[1]=-g*I,f[2]=-v*I,f[3]=u*I,f):null}function Nh(f){const{userImage:a}=f;return!!(a&&a.render&&a.render())&&(f.data.replace(new Uint8Array(a.data.buffer)),!0)}class Da extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(a){return!!this.getImage(a)}getImage(a){return this.images[a]}addImage(a,u){this._validate(a,u)&&(this.images[a]=u)}_validate(a,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new p.ErrorEvent(new Error(`Image "${a}" has invalid "content" value`))),g=!1),g}_validateStretch(a,u){if(!a)return!0;let g=0;for(const v of a){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(a,u){return!(a&&(4!==a.length||a[0]<0||u.data.width<a[0]||a[1]<0||u.data.height<a[1]||a[2]<0||u.data.width<a[2]||a[3]<0||u.data.height<a[3]||a[2]<a[0]||a[3]<a[1]))}updateImage(a,u){u.version=this.images[a].version+1,this.images[a]=u,this.updatedImages[a]=!0}removeImage(a){const u=this.images[a];delete this.images[a],delete this.patterns[a],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a,u){let g=!0;if(!this.isLoaded())for(const v of a)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(a,u):this.requestors.push({ids:a,callback:u})}_notify(a,u){const g={};for(const v of a){this.images[v]||this.fire(new p.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:p.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:a,height:u}=this.atlasImage;return{width:a,height:u}}getPattern(a){const u=this.patterns[a],g=this.getImage(a);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new p.ImagePosition(v,g);this.patterns[a]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const u=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(a,this.atlasImage,u.RGBA),this.atlasTexture&&this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const b in this.patterns)a.push(this.patterns[b].bin);const{w:u,h:g}=p.potpack(a),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:I}=this.patterns[b],T=I.x+1,S=I.y+1,F=this.images[b].data,O=F.width,z=F.height;p.RGBAImage.copy(F,v,{x:0,y:0},{x:T,y:S},{width:O,height:z}),p.RGBAImage.copy(F,v,{x:0,y:z-1},{x:T,y:S-1},{width:O,height:1}),p.RGBAImage.copy(F,v,{x:0,y:0},{x:T,y:S+z},{width:O,height:1}),p.RGBAImage.copy(F,v,{x:O-1,y:0},{x:T-1,y:S},{width:1,height:z}),p.RGBAImage.copy(F,v,{x:0,y:0},{x:T+O,y:S},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const u of a){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];Nh(g)&&this.updateImage(u,g)}}}const on=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(f,a){return function([u,g,v]){const b=p.degToRad(g+90),I=p.degToRad(v);return{x:u*Math.cos(b)*Math.sin(I),y:u*Math.sin(b)*Math.sin(I),z:u*Math.cos(I),azimuthal:g,polar:v}}(f.expression.evaluate(a))}interpolate(f,a,u){return{x:p.number(f.x,a.x,u),y:p.number(f.y,a.y,u),z:p.number(f.z,a.z,u),azimuthal:p.number(f.azimuthal,a.azimuthal,u),polar:p.number(f.polar,a.polar,u)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)});class Hi extends p.Evented{constructor(a){super(),this._transitionable=new p.Transitionable(on),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,u={}){if(!this._validate(p.validateLight,a,u))for(const g in a){const v=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const rc=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)});let uu=class extends p.Evented{constructor(f,a){super(),this._transitionable=new p.Transitionable(rc),this.set(f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=a}get(){return this._transitionable.serialize()}set(f){for(const a in f){const u=f[a];p.endsWith(a,"-transition")?this._transitionable.setTransition(a.slice(0,-11),u):this._transitionable.setValue(a,u)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}};function Sa(f,a,u,g){const v=p.smoothstep(45,65,u),[b,I]=Ko(f,g),T=p.length(a);let S=1-Math.min(1,Math.exp((T-b)/(I-b)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*v*f.alpha}function Ko(f,a){const u=.5/Math.tan(.5*a);return[f.range[0]+u,f.range[1]+u]}const cn=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])});class ka extends p.Evented{constructor(a,u){super(),this._transitionable=new p.Transitionable(cn),this.set(a),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const a=this._transform,u="globe"===a.projection.name,g=p.globeToMercatorTransition(a.zoom),v=this.properties.get("range"),b=[.5,3];return{range:u?[p.number(b[0],v[0],g),p.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(a,u={}){if(!this._validate(p.validateFog,a,u)){for(const g of Object.keys(p.spec.fog))a&&void 0===a[g]&&(a[g]=p.spec.fog[g].default);for(const g in a){const v=a[g];p.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-11),v):this._transitionable.setValue(g,v)}}}getOpacity(a){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,a))*u.a}getOpacityAtLatLng(a,u){return this._transform.projection.supportsFog?function(g,v,b){const I=p.MercatorCoordinate.fromLngLat(v),T=b.elevation?b.elevation.getAtPointOrZero(I):0,S=[I.x,I.y,T];return p.transformMat4(S,S,b.mercatorFogMatrix),Sa(g,S,b.pitch,b._fov)}(this.state,a,u):0}getFovAdjustedRange(a){return this._transform.projection.supportsFog?Ko(this.state,a):[0,1]}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,u,g){return(!g||!1!==g.validate)&&p.emitValidationErrors(this,a.call(p.validateStyle,p.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class pn{constructor(a,u){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new pn.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(a,u,g){p.asyncAll(this.actors,(v,b)=>{v.send(a,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(a=>{a.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Bi(f,a,u){return a*(p.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}pn.Actor=p.Actor;class Ys{constructor(a,u,g,v){this.screenBounds=a,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(a,u){let g,v;if(a instanceof p.Point||"number"==typeof a[0]){const b=p.Point.convert(a);g=[b],v=u.isPointAboveHorizon(b)}else{const b=p.Point.convert(a[0]),I=p.Point.convert(a[1]);g=[b,I],v=p.polygonizeBounds(b,I).every(T=>u.isPointAboveHorizon(T))}return new Ys(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(a){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],a)}bufferedCameraGeometry(a){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],v=p.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),p.bufferConvexPolygon(v,a)}bufferedCameraGeometryGlobe(a){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new p.Point(1,1)):this.screenBounds[1],v=p.polygonizeBounds(u,g,a),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(a,u,g,v=0){const b=a.queryPadding/u._pixelsPerMercatorPixel+1,I=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let T=a.tileID.wrap+(I.unwrapped?v:0);const S=I.polygon.map(ee=>p.getTilePoint(a.tileTransform,ee,T));if(!p.polygonIntersectsBox(S,0,0,p.EXTENT,p.EXTENT))return;T=a.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const F=this.screenGeometryMercator.polygon.map(ee=>p.getTileVec3(a.tileTransform,ee,T)),O=F.map(ee=>new p.Point(ee[0],ee[1])),z=u.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),$=p.getTileVec3(a.tileTransform,z,T),Q=F.map(ee=>{const V=p.sub(ee,ee,$);return p.normalize(V,V),new p.Ray($,V)}),K=Bi(a,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:Q,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(X=p.getBounds(S),X.min.x=p.clamp(X.min.x,0,p.EXTENT),X.min.y=p.clamp(X.min.y,0,p.EXTENT),X.max.x=p.clamp(X.max.x,0,p.EXTENT),X.max.y=p.clamp(X.max.y,0,p.EXTENT),X),tile:a,tileID:a.tileID,pixelToTileUnitsFactor:K};var X}_bufferedScreenMercator(a,u){const g=nr(a);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(a),u):{polygon:this.bufferedScreenGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(a,u){const g=nr(a);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(a),u):{polygon:this.bufferedCameraGeometry(a).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(a,u){const g=function(b,I){const T=p.multiply([],I.pixelMatrix,I.globeMatrix),S=[0,-p.GLOBE_RADIUS,0,1],F=[0,p.GLOBE_RADIUS,0,1],O=[0,0,0,1];p.transformMat4$1(S,S,T),p.transformMat4$1(F,F,T),p.transformMat4$1(O,O,T);const z=new p.Point(S[0]/S[3],S[1]/S[3]),$=new p.Point(F[0]/F[3],F[1]/F[3]),Q=p.polygonContainsPoint(b,z)&&S[3]<O[3],K=p.polygonContainsPoint(b,$)&&F[3]<O[3];if(!Q&&!K)return null;const X=function(pe,ye,_e){for(let Me=1;Me<pe.length;Me++){const We=Js(ye.pointCoordinate3D(pe[Me-1]).x),Ee=Js(ye.pointCoordinate3D(pe[Me]).x);if(_e<0){if(We<Ee)return{idx:Me,t:-We/(Ee-1-We)}}else if(Ee<We)return{idx:Me,t:(1-We)/(Ee+1-We)}}return null}(b,I,Q?-1:1);if(!X)return null;const{idx:ee,t:V}=X;let W=ee>1?Ci(b.slice(0,ee),I):[],ne=ee<b.length?Ci(b.slice(ee),I):[];W=W.map(pe=>new p.Point(Js(pe.x),pe.y)),ne=ne.map(pe=>new p.Point(Js(pe.x),pe.y));const te=[...W];0===te.length&&te.push(ne[ne.length-1]);const de=p.number(te[te.length-1].y,(0===ne.length?W[0]:ne[0]).y,V);let fe;return fe=Q?[new p.Point(0,de),new p.Point(0,0),new p.Point(1,0),new p.Point(1,de)]:[new p.Point(1,de),new p.Point(1,1),new p.Point(0,1),new p.Point(0,de)],te.push(...fe),0===ne.length?te.push(W[0]):te.push(...ne),{polygon:te.map(pe=>new p.MercatorCoordinate(pe.x,pe.y)),unwrapped:!1}}(a,u);if(g)return g;const v=function(b,I){let T=!1,S=-1/0,F=0;for(let z=0;z<b.length-1;z++)b[z].x>S&&(S=b[z].x,F=z);for(let z=0;z<b.length-1;z++){const $=(F+z)%(b.length-1),Q=b[$],K=b[$+1];Math.abs(Q.x-K.x)>.5&&(Q.x<K.x?(Q.x+=1,0===$&&(b[b.length-1].x+=1)):(K.x+=1,$+1===b.length-1&&(b[0].x+=1)),T=!0)}const O=p.mercatorXfromLng(I.center.lng);return T&&O<Math.abs(O-1)&&b.forEach(z=>{z.x-=1}),{polygon:b,unwrapped:T}}(Ci(a,u).map(b=>new p.Point(Js(b.x),b.y)),u);return{polygon:v.polygon.map(b=>new p.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function Ci(f,a){return p.resample(f,u=>{const g=a.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Js(f){return f<0?1+f%1:f%1}function nr(f){return 100*f|0}function Es(f,a,u,g,v){const b=function(I,T){if(I)return v(I);if(T){f.url&&T.tiles&&f.tiles&&delete f.tiles;const S=p.pick(p.extend(T,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(F=>F.id)),S.tiles=a.canonicalizeTileset(S,f.url),v(null,S)}};return f.url?p.getJSON(a.transformRequest(a.normalizeSourceURL(f.url,null,u,g),p.ResourceType.Source),b):p.exported.frame(()=>b(null,f))}class Yo{constructor(a,u,g){this.bounds=p.LngLatBounds.convert(this.validateBounds(a)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(a){return Array.isArray(a)&&4===a.length?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const u=Math.pow(2,a.z),g=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*u),I=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*u);return a.x>=g&&a.x<b&&a.y>=v&&a.y<I}}class hi{constructor(a,u,g){this.context=a;const v=a.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pl{constructor(a,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=a;const b=a.gl;this.buffer=b.createBuffer(),a.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&a.enableVertexAttribArray(v)}}setVertexAttribPointers(a,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],I=u.attributes[b.name];void 0!==I&&a.vertexAttribPointer(I,b.components,a[Jn[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ct{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ea extends ct{getDefault(){return p.Color.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class lo extends ct{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class fl extends ct{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class li extends ct{getDefault(){return[!0,!0,!0,!0]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Mo extends ct{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class zh extends ct{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class ta extends ct{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const u=this.current;(a.func!==u.func||a.ref!==u.ref||a.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class co extends ct{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class hu extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=a,this.dirty=!1}}class oc extends ct{getDefault(){return[0,1]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class du extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=a,this.dirty=!1}}class na extends ct{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class sc extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.BLEND):u.disable(u.BLEND),this.current=a,this.dirty=!1}}class ac extends ct{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Vh extends ct{getDefault(){return p.Color.transparent}set(a){const u=this.current;(a.r!==u.r||a.g!==u.g||a.b!==u.b||a.a!==u.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Kr extends ct{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class ia extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;a?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=a,this.dirty=!1}}class pu extends ct{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class ml extends ct{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}let lc,To=class extends ct{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Pa extends ct{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Ra extends ct{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const u=this.current;(a[0]!==u[0]||a[1]!==u[1]||a[2]!==u[2]||a[3]!==u[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Oa extends ct{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class gl extends ct{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class _l extends ct{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class jh extends ct{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class ae extends ct{getDefault(){return null}set(a){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class U extends ct{constructor(a){super(a),this.vao=a.extVertexArrayObject}getDefault(){return null}set(a){this.vao&&(a!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(a),this.current=a,this.dirty=!1)}}class H extends ct{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class re extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class he extends ct{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class ge extends ct{constructor(a,u){super(a),this.context=a,this.parent=u}getDefault(){return null}}class Ce extends ge{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class be extends ge{attachment(){return this.gl.DEPTH_ATTACHMENT}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class me extends be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Se{constructor(a,u,g,v){this.context=a,this.width=u,this.height=g;const b=this.framebuffer=a.gl.createFramebuffer();this.colorAttachment=new Ce(a,b),v&&(this.depthAttachment=new be(a,b))}destroy(){const a=this.context.gl,u=this.colorAttachment.get();if(u&&a.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&a.deleteRenderbuffer(g)}a.deleteFramebuffer(this.framebuffer)}}class it{constructor(a,u=!1){if(this.gl=a,this.isWebGL2=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),u){const g=a;this.extVertexArrayObject={createVertexArrayOES:g.createVertexArray.bind(a),deleteVertexArrayOES:g.deleteVertexArray.bind(a),bindVertexArrayOES:g.bindVertexArray.bind(a)}}this.clearColor=new ea(this),this.clearDepth=new lo(this),this.clearStencil=new fl(this),this.colorMask=new li(this),this.depthMask=new Mo(this),this.stencilMask=new zh(this),this.stencilFunc=new ta(this),this.stencilOp=new co(this),this.stencilTest=new hu(this),this.depthRange=new oc(this),this.depthTest=new du(this),this.depthFunc=new na(this),this.blend=new sc(this),this.blendFunc=new ac(this),this.blendColor=new Vh(this),this.blendEquation=new Kr(this),this.cullFace=new ia(this),this.cullFaceSide=new pu(this),this.frontFace=new ml(this),this.program=new To(this),this.activeTexture=new Pa(this),this.viewport=new Ra(this),this.bindFramebuffer=new Oa(this),this.bindRenderbuffer=new gl(this),this.bindTexture=new _l(this),this.bindVertexBuffer=new jh(this),this.bindElementBuffer=new ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new U(this),this.pixelStoreUnpack=new H(this),this.pixelStoreUnpackPremultiplyAlpha=new re(this),this.pixelStoreUnpackFlipY=new he(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=a.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=a.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=a.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),u||(this.extTextureHalfFloat=a.getExtension("OES_texture_half_float")),(u||this.extTextureHalfFloat&&a.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=a.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u||a.getExtension("OES_standard_derivatives"),this.extTimerQuery=a.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,u){return new hi(this,a,u)}createVertexBuffer(a,u,g){return new pl(this,a,u,g)}createRenderbuffer(a,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,a,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(a,u,g){return new Se(this,a,u,g)}clear({color:a,depth:u,stencil:g}){const v=this.gl;let b=0;a&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(a){!1===a.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){je(a.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st extends p.Evented{constructor(a,u,g,v){if(super(),this.id=a,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(u,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(a){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Es(this._options,this.map._requestManager,u,g,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),g&&2!==g.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new p.ErrorEvent(v))):b&&(p.extend(this,b),b.bounds&&(this.tileBounds=new Yo(b.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(v)})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(a,u){const g=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),data:void 0,uid:a.uid,tileID:a.tileID,tileZoom:a.tileZoom,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:a.isSymbolTile};if(v.request.collectResourceTiming=this._collectResourceTiming,a.actor&&"expired"!==a.state)"loading"===a.state?a.reloadCallback=u:a.request=a.actor.send("reloadTile",v,b.bind(this));else if(a.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)a.request=a.actor.send("loadTile",v,b.bind(this),void 0,!0);else{const I=p.loadVectorTile.call({deduped:this._deduped},v,(T,S)=>{T||!S?b.call(this,T):(v.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},a.actor&&a.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);a.request={cancel:I}}function b(I,T){return delete a.request,a.aborted?u(null):I&&404!==I.status?u(I):(T&&T.resourceTiming&&(a.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&a.setExpiryData(T),a.loadVectorData(T,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(a.reloadCallback&&(this.loadTile(a,a.reloadCallback),a.reloadCallback=null)))}}abortTile(a){a.request&&(a.request.cancel(),delete a.request),a.actor&&a.actor.send("abortTile",{uid:a.uid,type:this.type,source:this.id})}unloadTile(a){a.unloadVectorData(),a.actor&&a.actor.send("removeTile",{uid:a.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ye extends p.Evented{constructor(a,u,g,v){super(),this.id=a,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},u),p.extend(this,p.pick(u,["url","scheme","tileSize"]))}load(a){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Es(this._options,this.map._requestManager,null,null,(u,g)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new p.ErrorEvent(u)):g&&(p.extend(this,g),g.bounds&&(this.tileBounds=new Yo(g.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(g.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),a&&a(u)})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(a){return this._options.tiles=a,this.reload(),this}setUrl(a){return this.url=a,this._options.url=a,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a,u){const g=p.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(a.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);a.request=p.getImage(this.map._requestManager.transformRequest(v,p.ResourceType.Tile),(b,I,T,S)=>(delete a.request,a.aborted?(a.state="unloaded",u(null)):b?(a.state="errored",u(b)):I?(this.map._refreshExpiredTiles&&a.setExpiryData({cacheControl:T,expires:S}),a.setTexture(I,this.map.painter),a.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(a,u,g){a.setTexture(u,g)}static unloadTileData(a,u){a.texture&&u.saveTileTexture(a.texture)}abortTile(a,u){a.request&&(a.request.cancel(),delete a.request),u()}unloadTile(a,u){a.texture&&this.map.painter.saveTileTexture(a.texture),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ut(f,a,u,g,v,b,I,T){const S=[f,u,v,a,g,b,1,1,1],F=[I,T,1],O=p.adjoint([],S),[z,$,Q]=p.transformMat3(F,F,p.transpose(O,O));return p.multiply$1(S,[z,0,0,0,$,0,0,0,Q],S)}class Rt extends p.Evented{constructor(a,u,g,v){super(),this.id=a,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u,this._dirty=!1}load(a,u){this._loaded=u||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(g,v)=>{if(this._imageRequest=null,this._loaded=!0,g)this.fire(new p.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=p.window;this.image=v instanceof b?p.exported.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,a&&(this.coordinates=a),this._finishLoading()}})}loaded(){return this._loaded}updateImage(a){return this.image&&a.url?(this._imageRequest&&a.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=a.url,this.load(a.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(a){this.coordinates=a,this._boundsArray=void 0;const u=a.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,I=-1/0,T=-1/0;for(const z of g)v=Math.min(v,z.x),b=Math.min(b,z.y),I=Math.max(I,z.x),T=Math.max(T,z.y);const S=Math.max(I-v,T-b),F=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),O=Math.pow(2,F);return new p.CanonicalTileID(F,Math.floor((v+I)/2*O),Math.floor((b+T)/2*O))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(a){for(const S in this.tiles){const F=this.tiles[S];"loaded"!==F.state&&(F.state="loaded",F.texture=this.texture)}if(this._boundsArray)return;const u=p.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,I]=this.coordinates.map(S=>{const F=u.projection.project(S[0],S[1]);return p.getTilePoint(u,F)._round()});this.perspectiveTransform=function(S,F,O,z,$,Q,K,X,ee,V){const W=Ut(0,0,S,0,0,F,S,F),ne=Ut(O,z,$,Q,K,X,ee,V);return p.multiply$1(ne,p.adjoint(W,W),ne),[ne[6]/ne[8]*S/p.EXTENT,ne[7]/ne[8]*F/p.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,I.x,I.y,b.x,b.y);const T=this._boundsArray=new p.StructArrayLayout4i8;T.emplaceBack(g.x,g.y,0,0),T.emplaceBack(v.x,v.y,p.EXTENT,0),T.emplaceBack(I.x,I.y,0,p.EXTENT),T.emplaceBack(b.x,b.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=a.createVertexBuffer(T,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const a=this.map.painter.context,u=a.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(a,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(a)}loadTile(a,u){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={},u(null)):(a.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ht={vector:st,raster:Ye,"raster-dem":class extends Ye{constructor(f,a,u,g){super(f,a,u,g),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox"}loadTile(f,a){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(f.state="errored",a(v)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",a(null))}f.request=p.getImage(this.map._requestManager.transformRequest(u,p.ResourceType.Tile),function(v,b,I,T){if(delete f.request,f.aborted)f.state="unloaded",a(null);else if(v)f.state="errored",a(v);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:I,expires:T});const S=p.window.ImageBitmap&&b instanceof p.window.ImageBitmap&&(null==lc&&(lc=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),lc),F=1-(b.width-p.prevPowerOfTwo(b.width))/2;F<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const O=S?b:p.exported.getImageData(b,F),z={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:O,encoding:this.encoding,padding:F};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",z,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const a=f.canonical,u=Math.pow(2,a.z),g=(a.x-1+u)%u,v=0===a.x?f.wrap-1:f.wrap,b=(a.x+1+u)%u,I=a.x+1===u?f.wrap+1:f.wrap,T={};return T[new p.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y).key]={backfilled:!1},T[new p.OverscaledTileID(f.overscaledZ,I,a.z,b,a.y).key]={backfilled:!1},a.y>0&&(T[new p.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y-1).key]={backfilled:!1},T[new p.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},T[new p.OverscaledTileID(f.overscaledZ,I,a.z,b,a.y-1).key]={backfilled:!1}),a.y+1<u&&(T[new p.OverscaledTileID(f.overscaledZ,v,a.z,g,a.y+1).key]={backfilled:!1},T[new p.OverscaledTileID(f.overscaledZ,f.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},T[new p.OverscaledTileID(f.overscaledZ,I,a.z,b,a.y+1).key]={backfilled:!1}),T}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends p.Evented{constructor(f,a,u,g){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=a.data,this._options=p.extend({},a),this._collectResourceTiming=a.collectResourceTiming,void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId;const v=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*v,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*v,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?a.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,a.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==a.clusterRadius?a.clusterRadius:50)*v,log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,a){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},a),this}getClusterChildren(f,a){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},a),this}getClusterLeaves(f,a,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:a,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=p.extend({},this.workerOptions),a=this._data;"string"==typeof a?(f.request=this.map._requestManager.transformRequest(p.exported.resolveURL(a),p.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new p.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new p.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,a){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete f.request,f.unloadVectorData(),f.aborted?a(null):g?a(g):(f.loadVectorData(v,this.map.painter,"reloadTile"===u),a(null))),void 0,"loadTile"===u)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Rt{constructor(f,a,u,g){super(f,a,u,g),this.roundZoom=!0,this.type="video",this.options=a}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const a of f.urls)this.urls.push(this.map._requestManager.transformRequest(a,p.ResourceType.Source).url);p.getVideo(this.urls,(a,u)=>{this._loaded=!0,a?this.fire(new p.ErrorEvent(a)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const a=this.video.seekable;f<a.start(0)||f>a.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,a=f.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(f,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Rt,canvas:class extends Rt{constructor(f,a,u,g){super(f,a,u,g),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const a=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(a,this.canvas,a.gl.RGBA,{premultiply:!0}),this._prepareData(a)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends p.Evented{constructor(f,a,u,g){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=a,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Yo(this._implementation.bounds,this.minzoom,this.maxzoom)),a.update=this._update.bind(this),a.clearTiles=this._clearTiles.bind(this),a.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(a,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:a,y:u,z:g}=f.canonical;return this._implementation.hasTile({x:a,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,a){const{x:u,y:g,z:v}=f.tileID.canonical,b=new p.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:g,z:v},{signal:b.signal})).then(function(I){return delete f.request,f.aborted?(f.state="unloaded",a(null)):void 0===I?(f.state="errored",a(null)):null===I?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",a(null)):(T=I)instanceof p.window.ImageData||T instanceof p.window.HTMLCanvasElement||T instanceof p.window.ImageBitmap||T instanceof p.window.HTMLImageElement?(this.loadTileData(f,I),f.state="loaded",void a(null)):(f.state="errored",a(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var T}.bind(this)).catch(I=>{20!==I.code&&(f.state="errored",a(I))}),f.request.cancel=()=>b.abort()}loadTileData(f,a){Ye.loadTileData(f,a,this._map.painter)}unloadTileData(f){Ye.unloadTileData(f,this._map.painter)}unloadTile(f,a){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:g,z:v}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}a()}abortTile(f,a){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),a()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},nn=function(f,a,u,g){const v=new Ht[a.type](f,a,u,g);if(v.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${v.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],v),v};function fn(f,a){const u=p.identity([]);return p.scale(u,u,[.5*f.width,.5*-f.height,1]),p.translate(u,u,[1,-1,0]),p.multiply(u,u,f.calculateProjMatrix(a.toUnwrapped())),Float32Array.from(u)}function oi(f,a,u,g,v,b,I,T=!1){const S=f.tilesIn(g,I,T);S.sort(fr);const F=[];for(const z of S)F.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(a,u,f._state,z,v,b,fn(f.transform,z.tile.tileID),T)});const O=function(z){const $={},Q={};for(const K of z){const X=K.queryResults,ee=K.wrappedTileID,V=Q[ee]=Q[ee]||{};for(const W in X){const ne=X[W],te=V[W]=V[W]||{},de=$[W]=$[W]||[];for(const fe of ne)te[fe.featureIndex]||(te[fe.featureIndex]=!0,de.push(fe))}}return $}(F);for(const z in O)O[z].forEach($=>{const Q=$.feature,K=Q.layer;K&&"background"!==K.type&&"sky"!==K.type&&(Q.source=K.source,K["source-layer"]&&(Q.sourceLayer=K["source-layer"]),Q.state=void 0!==Q.id?f.getFeatureState(K["source-layer"],Q.id):{})});return O}function yi(f,a){const u=f.getRenderableIds().map(b=>f.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const I=u[b],T=I.tileID.canonical.key;v[T]||(v[T]=!0,I.querySourceFeatures(g,a))}return g}function fr(f,a){const u=f.tileID,g=a.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function Pi(){return null!=Zr.workerClass?new Zr.workerClass:new p.window.Worker(Zr.workerUrl)}const $i="mapboxgl_preloaded_worker_pool";class qi{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<qi.workerCount;)this.workers.push(new Pi);return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$i]}numActive(){return Object.keys(this.active).length}}let zn;function Do(){return zn||(zn=new qi),zn}function Jo(f,a){const u={};for(const g in f)"ref"!==g&&(u[g]=f[g]);return p.refProperties.forEach(g=>{g in a&&(u[g]=a[g])}),u}function rm(f){f=f.slice();const a=Object.create(null);for(let u=0;u<f.length;u++)a[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=Jo(f[u],a[f[u].ref]));return f}qi.workerCount=2;const Tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Uh(f,a,u){u.push({command:Tn.addSource,args:[f,a[f]]})}function Fa(f,a,u){a.push({command:Tn.removeSource,args:[f]}),u[f]=!0}function fu(f,a,u,g){Fa(f,u,g),Uh(f,a,u)}function ra(f,a,u){let g;for(g in f[u])if(f[u].hasOwnProperty(g)&&"data"!==g&&!je(f[u][g],a[u][g]))return!1;for(g in a[u])if(a[u].hasOwnProperty(g)&&"data"!==g&&!je(f[u][g],a[u][g]))return!1;return!0}function es(f,a,u,g,v,b){let I;for(I in a=a||{},f=f||{})f.hasOwnProperty(I)&&(je(f[I],a[I])||u.push({command:b,args:[g,I,a[I],v]}));for(I in a)a.hasOwnProperty(I)&&!f.hasOwnProperty(I)&&(je(f[I],a[I])||u.push({command:b,args:[g,I,a[I],v]}))}function ts(f){return f.id}function mu(f,a){return f[a.id]=a,f}class Gh{constructor(a,u){this.reset(a,u)}reset(a,u){this.points=a||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(1===this.points.length)return this.points[0];a=p.clamp(a,0,1);let u=1,g=this._distances[u];const v=a*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,I=this._distances[b],T=g-I,S=T>0?(v-I)/T:0;return this.points[b].mult(1-S).add(this.points[u].mult(S))}}class La{constructor(a,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(a/g),this.yCellCount=Math.ceil(u/g);for(let I=0;I<this.xCellCount*this.yCellCount;I++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=u,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(a,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(a,u,g,v,b,I){this.boxCells[b].push(I)}_insertCircleCell(a,u,g,v,b,I){this.circleCells[b].push(I)}_query(a,u,g,v,b,I){if(g<0||a>this.width||v<0||u>this.height)return!b&&[];const T=[];if(a<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let S=0;S<this.boxKeys.length;S++)T.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const F=this.circles[3*S],O=this.circles[3*S+1],z=this.circles[3*S+2];T.push({key:this.circleKeys[S],x1:F-z,y1:O-z,x2:F+z,y2:O+z})}return I?T.filter(I):T}return this._forEachCell(a,u,g,v,this._queryCell,T,{hitTest:b,seenUids:{box:{},circle:{}}},I),b?T.length>0:T}_queryCircle(a,u,g,v,b){const I=a-g,T=a+g,S=u-g,F=u+g;if(T<0||I>this.width||F<0||S>this.height)return!v&&[];const O=[];return this._forEachCell(I,S,T,F,this._queryCellCircle,O,{hitTest:v,circle:{x:a,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?O.length>0:O}query(a,u,g,v,b){return this._query(a,u,g,v,!1,b)}hitTest(a,u,g,v,b){return this._query(a,u,g,v,!0,b)}hitTestCircle(a,u,g,v){return this._queryCircle(a,u,g,!0,v)}_queryCell(a,u,g,v,b,I,T,S){const F=T.seenUids,O=this.boxCells[b];if(null!==O){const $=this.bboxes;for(const Q of O)if(!F.box[Q]){F.box[Q]=!0;const K=4*Q;if(a<=$[K+2]&&u<=$[K+3]&&g>=$[K+0]&&v>=$[K+1]&&(!S||S(this.boxKeys[Q]))){if(T.hitTest)return I.push(!0),!0;I.push({key:this.boxKeys[Q],x1:$[K],y1:$[K+1],x2:$[K+2],y2:$[K+3]})}}}const z=this.circleCells[b];if(null!==z){const $=this.circles;for(const Q of z)if(!F.circle[Q]){F.circle[Q]=!0;const K=3*Q;if(this._circleAndRectCollide($[K],$[K+1],$[K+2],a,u,g,v)&&(!S||S(this.circleKeys[Q]))){if(T.hitTest)return I.push(!0),!0;{const X=$[K],ee=$[K+1],V=$[K+2];I.push({key:this.circleKeys[Q],x1:X-V,y1:ee-V,x2:X+V,y2:ee+V})}}}}}_queryCellCircle(a,u,g,v,b,I,T,S){const F=T.circle,O=T.seenUids,z=this.boxCells[b];if(null!==z){const Q=this.bboxes;for(const K of z)if(!O.box[K]){O.box[K]=!0;const X=4*K;if(this._circleAndRectCollide(F.x,F.y,F.radius,Q[X+0],Q[X+1],Q[X+2],Q[X+3])&&(!S||S(this.boxKeys[K])))return I.push(!0),!0}}const $=this.circleCells[b];if(null!==$){const Q=this.circles;for(const K of $)if(!O.circle[K]){O.circle[K]=!0;const X=3*K;if(this._circlesCollide(Q[X],Q[X+1],Q[X+2],F.x,F.y,F.radius)&&(!S||S(this.circleKeys[K])))return I.push(!0),!0}}}_forEachCell(a,u,g,v,b,I,T,S){const F=this._convertToXCellCoord(a),O=this._convertToYCellCoord(u),z=this._convertToXCellCoord(g),$=this._convertToYCellCoord(v);for(let Q=F;Q<=z;Q++)for(let K=O;K<=$;K++)if(b.call(this,a,u,g,v,this.xCellCount*K+Q,I,T,S))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,u,g,v,b,I){const T=v-a,S=b-u,F=g+I;return F*F>T*T+S*S}_circleAndRectCollide(a,u,g,v,b,I,T){const S=(I-v)/2,F=Math.abs(a-(v+S));if(F>S+g)return!1;const O=(T-b)/2,z=Math.abs(u-(b+O));if(z>O+g)return!1;if(F<=S||z<=O)return!0;const $=F-S,Q=z-O;return $*$+Q*Q<=g*g}}const Is={unknown:0,flipRequired:1,flipNotRequired:2},cc=Math.tan(85*Math.PI/180);function Oe(f,a,u,g,v,b,I){const T=p.create();if(u)if("globe"===b.name){const S=p.calculateGlobeLabelMatrix(v,a);p.multiply(T,T,S)}else{const S=at([],I);T[0]=S[0],T[1]=S[1],T[4]=S[2],T[5]=S[3],g||p.rotateZ(T,T,v.angle)}else p.multiply(T,v.labelPlaneMatrix,f);return T}function Ms(f,a,u,g,v,b,I){const T=Oe(f,a,u,g,v,b,I);return"globe"===b.name&&u||(T[2]=T[6]=T[10]=T[14]=0),T}function Ei(f,a,u,g,v,b,I){if(u){if("globe"===b.name){const T=Oe(f,a,u,g,v,b,I);return p.invert(T,T),p.multiply(T,f,T),T}{const T=p.clone(f),S=p.identity([]);return S[0]=I[0],S[1]=I[1],S[4]=I[2],S[5]=I[3],p.multiply(T,T,S),g||p.rotateZ(T,T,-v.angle),T}}return v.glCoordMatrix}function An(f,a,u,g){const v=[f,a,u,1];u?p.transformMat4$1(v,v,g):Yt(v,v,g);const b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function rp(f,a){return Math.min(.5+f/a*.5,1.5)}function So(f,a){const u=f[0]/f[3],g=f[1]/f[3];return u>=-a[0]&&u<=a[0]&&g>=-a[1]&&g<=a[1]}function uc(f,a,u,g,v,b,I,T,S,F){const O=u.transform,z=g?f.textSizeData:f.iconSizeData,$=p.evaluateSizeForZoom(z,u.transform.zoom),Q="globe"===O.projection.name,K=[256/u.width*2+1,256/u.height*2+1],X=g?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;X.clear();let ee=null;Q&&(ee=g?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const V=f.lineVertexArray,W=g?f.text.placedSymbolArray:f.icon.placedSymbolArray,ne=u.transform.width/u.transform.height;let te,de=!1;for(let fe=0;fe<W.length;fe++){const pe=W.get(fe),{numGlyphs:ye,writingMode:_e}=pe;if(_e!==p.WritingMode.vertical||de||te===p.WritingMode.horizontal||(de=!0),te=_e,(pe.hidden||_e===p.WritingMode.vertical)&&!de){kt(ye,X);continue}de=!1;const Me=new p.Point(pe.tileAnchorX,pe.tileAnchorY);let{x:We,y:Ee,z:Be}=O.projection.projectTilePoint(Me.x,Me.y,F.canonical);if(S){const[Nt,_t,Dt]=S(Me);We+=Nt,Ee+=_t,Be+=Dt}const De=[We,Ee,Be,1];if(p.transformMat4$1(De,De,a),!So(De,K)){kt(ye,X);continue}const Ze=rp(u.transform.cameraToCenterDistance,De[3]),Ie=p.evaluateSizeForFeature(z,$,pe),Fe=I?Ie/Ze:Ie*Ze,Qe=An(We,Ee,Be,v);if(Qe[3]<=0){kt(ye,X);continue}let Ue={};const et=I?null:S,Ct=Ke(pe,Fe,!1,T,a,v,b,f.glyphOffsetArray,V,X,ee,Qe,Me,Ue,ne,et,O.projection,F,I);de=Ct.useVertical,et&&Ct.needsFlipping&&(Ue={}),(Ct.notEnoughRoom||de||Ct.needsFlipping&&Ke(pe,Fe,!0,T,a,v,b,f.glyphOffsetArray,V,X,ee,Qe,Me,Ue,ne,et,O.projection,F,I).notEnoughRoom)&&kt(ye,X)}g?(f.text.dynamicLayoutVertexBuffer.updateData(X),ee&&f.text.globeExtVertexBuffer.updateData(ee)):(f.icon.dynamicLayoutVertexBuffer.updateData(X),ee&&f.icon.globeExtVertexBuffer.updateData(ee))}function Qn(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X){const{lineStartIndex:ee,glyphStartIndex:V,segment:W}=T,ne=V+T.numGlyphs,te=ee+T.lineLength,de=a.getoffsetX(V),fe=a.getoffsetX(ne-1),pe=yn(f*de,u,g,v,b,I,W,ee,te,S,F,O,z,$,!0,Q,K,X);if(!pe)return null;const ye=yn(f*fe,u,g,v,b,I,W,ee,te,S,F,O,z,$,!0,Q,K,X);return ye?{first:pe,last:ye}:null}function oa(f,a,u,g){return f===p.WritingMode.horizontal&&Math.abs(g)>Math.abs(u)?{useVertical:!0}:f===p.WritingMode.vertical?g>0?{needsFlipping:!0}:null:a!==Is.unknown&&(0===(v=u)||Math.abs(g/v)>cc)?a===Is.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null;var v}function Ke(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X,ee,V,W){const ne=a/24,te=f.lineOffsetX*ne,de=f.lineOffsetY*ne,{lineStartIndex:fe,glyphStartIndex:pe,numGlyphs:ye,segment:_e,writingMode:Me,flipState:We}=f,Ee=fe+f.lineLength,Be=De=>{if(O){const[Qe,Ue,et]=De.up,Ct=F.length;p.updateGlobeVertexNormal(O,Ct+0,Qe,Ue,et),p.updateGlobeVertexNormal(O,Ct+1,Qe,Ue,et),p.updateGlobeVertexNormal(O,Ct+2,Qe,Ue,et),p.updateGlobeVertexNormal(O,Ct+3,Qe,Ue,et)}const[Ze,Ie,Fe]=De.point;p.addDynamicAttributes(F,Ze,Ie,Fe,De.angle)};if(ye>1){const De=Qn(ne,T,te,de,u,z,$,f,S,b,Q,X,!1,ee,V,W);if(!De)return{notEnoughRoom:!0};if(g&&!u){let[Ze,Ie,Fe]=De.first.point,[Qe,Ue,et]=De.last.point;[Ze,Ie]=An(Ze,Ie,Fe,I),[Qe,Ue]=An(Qe,Ue,et,I);const Ct=oa(Me,We,(Qe-Ze)*K,Ue-Ie);if(f.flipState=Ct&&Ct.needsFlipping?Is.flipRequired:Is.flipNotRequired,Ct)return Ct}Be(De.first);for(let Ze=pe+1;Ze<pe+ye-1;Ze++){const Ie=yn(ne*T.getoffsetX(Ze),te,de,u,z,$,_e,fe,Ee,S,b,Q,X,!1,!1,ee,V,W);if(!Ie)return F.length-=4*(Ze-pe),{notEnoughRoom:!0};Be(Ie)}Be(De.last)}else{if(g&&!u){const Ze=An($.x,$.y,0,v),Ie=fe+_e+1,Fe=new p.Point(S.getx(Ie),S.gety(Ie)),Qe=An(Fe.x,Fe.y,0,v),Ue=Qe[3]>0?Qe:an($,Fe,Ze,1,v,void 0,ee,V.canonical),et=oa(Me,We,(Ue[0]-Ze[0])*K,Ue[1]-Ze[1]);if(f.flipState=et&&et.needsFlipping?Is.flipRequired:Is.flipNotRequired,et)return et}const De=yn(ne*T.getoffsetX(pe),te,de,u,z,$,_e,fe,Ee,S,b,Q,X,!1,!1,ee,V,W);if(!De)return{notEnoughRoom:!0};Be(De)}return{}}function sn(f,a,u,g,v){const{x:b,y:I,z:T}=g.projectTilePoint(f.x,f.y,a);if(!v)return An(b,I,T,u);const[S,F,O]=v(f);return An(b+S,I+F,T+O,u)}function an(f,a,u,g,v,b,I,T){const S=sn(f.sub(a)._unit()._add(f),T,v,I,b);return p.sub(S,u,S),p.normalize(S,S),p.scaleAndAdd(S,u,S,g)}function yn(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X,ee,V){const W=g?f-a:f+a;let ne=W>0?1:-1,te=0;g&&(ne*=-1,te=Math.PI),ne<0&&(te+=Math.PI);let de=T+I+(ne>0?0:1)|0,fe=v,pe=v,ye=0,_e=0;const Me=Math.abs(W),We=[],Ee=[];let Be=b,De=Be;const Ze=()=>an(De,Be,pe,Me-ye+1,O,$,X,ee.canonical);for(;ye+_e<=Me;){if(de+=ne,de<T||de>=S)return null;if(pe=fe,De=Be,We.push(pe),Q&&Ee.push(De),Be=new p.Point(F.getx(de),F.gety(de)),fe=z[de],!fe){const Dt=sn(Be,ee.canonical,O,X,$);fe=Dt[3]>0?z[de]=Dt:Ze()}ye+=_e,_e=p.distance(pe,fe)}K&&$&&(z[de]&&(fe=Ze(),_e=p.distance(pe,fe)),z[de]=fe);const Ie=(Me-ye)/_e,Fe=Be.sub(De)._mult(Ie)._add(De),Qe=p.sub([],fe,pe),Ue=p.scaleAndAdd([],pe,Qe,Ie);let et=[0,0,1],Ct=Qe[0],Nt=Qe[1];if(V&&(et=X.upVector(ee.canonical,Fe.x,Fe.y),0!==et[0]||0!==et[1]||1!==et[2])){const Dt=[et[2],0,-et[0]],hn=p.cross([],et,Dt);p.normalize(Dt,Dt),p.normalize(hn,hn),Ct=p.dot(Qe,Dt),Nt=p.dot(Qe,hn)}if(u){const Dt=p.cross([],et,Qe);p.normalize(Dt,Dt),p.scaleAndAdd(Ue,Ue,Dt,u*ne)}const _t=te+Math.atan2(Nt,Ct);return We.push(Ue),Q&&Ee.push(Fe),{point:Ue,angle:_t,path:We,tilePath:Ee,up:et}}function kt(f,a){const u=a.length,g=u+4*f;a.resize(g),a.float32.fill(-1/0,4*u,4*g)}function Yt(f,a,u){const g=a[0],v=a[1];return f[0]=u[0]*g+u[4]*v+u[12],f[1]=u[1]*g+u[5]*v+u[13],f[3]=u[3]*g+u[7]*v+u[15],f}const Pr=100;class gu{constructor(a,u,g=new La(a.width+200,a.height+200,25),v=new La(a.width+200,a.height+200,25)){this.transform=a,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+Pr,this.screenBottomBoundary=a.height+Pr,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.fogState=u}placeCollisionBox(a,u,g,v,b,I,T,S){let F=g.projectedAnchorX,O=g.projectedAnchorY,z=g.projectedAnchorZ;const $=g.elevation,Q=g.tileID,K=a.getProjection();if($&&Q){const[fe,pe,ye]=K.upVector(Q.canonical,g.tileAnchorX,g.tileAnchorY),_e=K.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=fe*$*_e,O+=pe*$*_e,z+=ye*$*_e}const X=this.projectAndGetPerspectiveRatio(T,F,O,z,g.tileID,"globe"===K.name||!!$||this.transform.pitch>0,K),ee=I*X.perspectiveRatio,V=(g.x1*u+v.x-g.padding)*ee+X.point.x,W=(g.y1*u+v.y-g.padding)*ee+X.point.y,ne=(g.x2*u+v.x+g.padding)*ee+X.point.x,te=(g.y2*u+v.y+g.padding)*ee+X.point.y,de=X.perspectiveRatio<=.55||X.occluded;return!this.isInsideGrid(V,W,ne,te)||!b&&this.grid.hitTest(V,W,ne,te,S)||de?{box:[],offscreen:!1,occluded:X.occluded}:{box:[V,W,ne,te],offscreen:this.isOffscreen(V,W,ne,te),occluded:!1}}placeCollisionCircles(a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X){const ee=[],V=this.transform.elevation,W=a.getProjection(),ne=V?V.getAtTileOffsetFunc(X,this.transform.center.lat,this.transform.worldSize,W):null,te=new p.Point(g.tileAnchorX,g.tileAnchorY);let{x:de,y:fe,z:pe}=W.projectTilePoint(te.x,te.y,X.canonical);if(ne){const[Fe,Qe,Ue]=ne(te);de+=Fe,fe+=Qe,pe+=Ue}const ye="globe"===W.name,_e=this.projectAndGetPerspectiveRatio(T,de,fe,pe,X,ye||!!V||this.transform.pitch>0,W),{perspectiveRatio:Me}=_e,We=(z?I/Me:I*Me)/p.ONE_EM,Ee=An(de,fe,pe,S),Be=_e.signedDistanceFromCamera>0?Qn(We,b,g.lineOffsetX*We,g.lineOffsetY*We,!1,Ee,te,g,v,S,{},V&&!z?ne:null,z&&!!V,W,X,z):null;let De=!1,Ze=!1,Ie=!0;if(Be&&!_e.occluded){const Fe=.5*Q*Me+K,Qe=new p.Point(-100,-100),Ue=new p.Point(this.screenRightBoundary,this.screenBottomBoundary),et=new Gh,{first:Ct,last:Nt}=Be,_t=Ct.path.length;let Dt=[];for(let wt=_t-1;wt>=1;wt--)Dt.push(Ct.path[wt]);for(let wt=1;wt<Nt.path.length;wt++)Dt.push(Nt.path[wt]);const hn=2.5*Fe;F&&(Dt=Dt.map(([wt,Dn,Vn],Sn)=>(ne&&!ye&&(Vn=ne(Sn<_t-1?Ct.tilePath[_t-1-Sn]:Nt.tilePath[Sn-_t+2])[2]),An(wt,Dn,Vn,F))),Dt.some(wt=>wt[3]<=0)&&(Dt=[]));let ln=[];if(Dt.length>0){let wt=1/0,Dn=-1/0,Vn=1/0,Sn=-1/0;for(const jn of Dt)wt=Math.min(wt,jn[0]),Vn=Math.min(Vn,jn[1]),Dn=Math.max(Dn,jn[0]),Sn=Math.max(Sn,jn[1]);Dn>=Qe.x&&wt<=Ue.x&&Sn>=Qe.y&&Vn<=Ue.y&&(ln=[Dt.map(jn=>new p.Point(jn[0],jn[1]))],(wt<Qe.x||Dn>Ue.x||Vn<Qe.y||Sn>Ue.y)&&(ln=p.clipLine(ln,Qe.x,Qe.y,Ue.x,Ue.y)))}for(const wt of ln){et.reset(wt,.25*Fe);let Dn=0;Dn=et.length<=.5*Fe?1:Math.ceil(et.paddedLength/hn)+1;for(let Vn=0;Vn<Dn;Vn++){const Sn=Vn/Math.max(Dn-1,1),jn=et.lerp(Sn),or=jn.x+Pr,Ti=jn.y+Pr;ee.push(or,Ti,Fe,0);const mo=or-Fe,to=Ti-Fe,Xn=or+Fe,Fn=Ti+Fe;if(Ie=Ie&&this.isOffscreen(mo,to,Xn,Fn),Ze=Ze||this.isInsideGrid(mo,to,Xn,Fn),!u&&this.grid.hitTestCircle(or,Ti,Fe,$)&&(De=!0,!O))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!O&&De||!Ze?[]:ee,offscreen:Ie,collisionDetected:De,occluded:_e.occluded}}queryRenderedSymbols(a){if(0===a.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,I=-1/0;for(const O of a){const z=new p.Point(O.x+Pr,O.y+Pr);g=Math.min(g,z.x),v=Math.min(v,z.y),b=Math.max(b,z.x),I=Math.max(I,z.y),u.push(z)}const T=this.grid.query(g,v,b,I).concat(this.ignoredGrid.query(g,v,b,I)),S={},F={};for(const O of T){const z=O.key;if(void 0===S[z.bucketInstanceId]&&(S[z.bucketInstanceId]={}),S[z.bucketInstanceId][z.featureIndex])continue;const $=[new p.Point(O.x1,O.y1),new p.Point(O.x2,O.y1),new p.Point(O.x2,O.y2),new p.Point(O.x1,O.y2)];p.polygonIntersectsPolygon(u,$)&&(S[z.bucketInstanceId][z.featureIndex]=!0,void 0===F[z.bucketInstanceId]&&(F[z.bucketInstanceId]=[]),F[z.bucketInstanceId].push(z.featureIndex))}return F}insertCollisionBox(a,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,u,g,v,b){const I=u?this.ignoredGrid:this.grid,T={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let S=0;S<a.length;S+=4)I.insertCircle(T,a[S],a[S+1],a[S+2])}projectAndGetPerspectiveRatio(a,u,g,v,b,I,T){const S=[u,g,v,1];let F=!1;v||this.transform.pitch>0?(p.transformMat4$1(S,S,a),this.fogState&&b&&"globe"!==T.name&&(F=function($,Q,K,X,ee,V){const W=V.calculateFogTileMatrix(ee),ne=[Q,K,X];return p.transformMat4(ne,ne,W),Sa($,ne,V.pitch,V._fov)}(this.fogState,u,g,v,b.toUnwrapped(),this.transform)>.9)):Yt(S,S,a);const O=S[3];return{point:new p.Point((S[0]/O+1)/2*this.transform.width+Pr,(-S[1]/O+1)/2*this.transform.height+Pr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/O*.5,1.5),signedDistanceFromCamera:O,occluded:I&&S[2]>O||F}}isOffscreen(a,u,g,v){return g<Pr||a>=this.screenRightBoundary||v<Pr||u>this.screenBottomBoundary}isInsideGrid(a,u,g,v){return g>=0&&a<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const a=p.identity([]);return p.translate(a,a,[-100,-100,0]),a}}function ns(f,a,u){const g=a.createTileMatrix(f,f.worldSize,u.toUnwrapped());return p.multiply(new Float32Array(16),f.projMatrix,g)}function rt(f,a,u){if(a.projection.name===u.projection.name)return f.projMatrix;const g=u.clone();return g.setProjection(a.projection),ns(g,a.getProjection(),f)}function Wn(f,a,u){return a.name===u.projection.name?f.projMatrix:ns(u,a,f)}class Jt{constructor(a,u,g,v){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class vn{constructor(a,u,g,v,b,I=!1){this.text=new Jt(a?a.text:null,u,g,b),this.icon=new Jt(a?a.icon:null,u,v,b),this.clipped=I}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hc{constructor(a,u,g,v=!1){this.text=a,this.icon=u,this.skipFade=g,this.clipped=v}}class _u{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Hh{constructor(a,u,g,v,b){this.bucketInstanceId=a,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class dc{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const u=++this.maxGroupID;this.collisionGroups[a]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[a]}}function ir(f,a,u,g,v){const{horizontalAlign:b,verticalAlign:I}=p.getAnchorAlignment(f),T=-(b-.5)*a,S=-(I-.5)*u,F=p.evaluateVariableOffset(f,g);return new p.Point(T+F[0]*v,S+F[1]*v)}function yu(f,a,u,g,v){const b=new p.Point(f,a);return u&&b._rotate(g?v:-v),b}class vu{constructor(a,u,g,v,b){this.transform=a.clone(),this.projection=a.projection.name,this.collisionIndex=new gu(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new dc(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,u,g,v){const b=g.getBucket(u),I=g.latestFeatureIndex;if(!b||!I||u.id!==b.layerIds[0])return;const T=b.layers[0].layout,S=g.collisionBoxArray,F=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/p.EXTENT,z=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const $=(Q=g.tileID,K=b.getProjection(),X=this.transform,K.name===this.projection?X.calculateProjMatrix(Q.toUnwrapped()):ns(X,K,Q));var Q,K,X;const ee="map"===T.get("text-pitch-alignment"),V="map"===T.get("text-rotation-alignment");u.compileFilter();const W=u.dynamicFilter(),ne=u.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(g),de=Ms($,g.tileID.canonical,ee,V,this.transform,b.getProjection(),te);let fe=null;if(ee){const _e=Ei($,g.tileID.canonical,ee,V,this.transform,b.getProjection(),te);fe=p.multiply([],this.transform.labelPlaneMatrix,_e)}let pe=null;W&&g.latestFeatureIndex&&(pe={unwrappedTileID:z,dynamicFilter:W,dynamicFilterNeedsFeature:ne,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Hh(b.bucketInstanceId,I,b.sourceLayerIndex,b.index,g.tileID);const ye={bucket:b,layout:T,posMatrix:$,textLabelPlaneMatrix:de,labelToScreenMatrix:fe,clippingData:pe,scale:F,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const _e of b.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:We,symbolInstanceEnd:Ee}=_e;a.push({sortKey:Me,symbolInstanceStart:We,symbolInstanceEnd:Ee,parameters:ye})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ye})}attemptAnchorPlacement(a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X,ee,V,W){const{textOffset0:ne,textOffset1:te,crossTileID:de}=$,fe=[ne,te],pe=ir(a,g,v,fe,b),ye=this.collisionIndex.placeCollisionBox(K,b,u,yu(pe.x,pe.y,I,T,this.transform.angle),z,S,F,O.predicate);if(ee){const _e=K.getSymbolInstanceIconSize(W,this.transform.zoom,$.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(K,_e,ee,yu(pe.x,pe.y,I,T,this.transform.angle),z,S,F,O.predicate).box.length)return}if(ye.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[de]&&this.prevPlacement.placements[de]&&this.prevPlacement.placements[de].text&&(_e=this.prevPlacement.variableOffsets[de].anchor),this.variableOffsets[de]={textOffset:fe,width:g,height:v,anchor:a,textScale:b,prevAnchor:_e},this.markUsedJustification(K,a,$,X),K.allowVerticalPlacement&&(this.markUsedOrientation(K,X,$),this.placedOrientations[de]=X),{shift:pe,placedGlyphBoxes:ye}}}placeLayerBucketPart(a,u,g,v){const{bucket:b,layout:I,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:F,clippingData:O,textPixelRatio:z,holdingForFade:$,collisionBoxArray:Q,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:X,collisionGroup:ee}=a.parameters,V=I.get("text-optional"),W=I.get("icon-optional"),ne=I.get("text-allow-overlap"),te=I.get("icon-allow-overlap"),de="map"===I.get("text-rotation-alignment"),fe="map"===I.get("text-pitch-alignment"),pe="none"!==I.get("icon-text-fit"),ye="viewport-y"===I.get("symbol-z-order");this.transform.setProjection(b.projection);let _e=ne&&(te||!b.hasIconData()||W),Me=te&&(ne||!b.hasTextData()||V);!b.collisionArrays&&Q&&b.deserializeCollisionBoxes(Q),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,Q);const We=(Ee,Be,De)=>{const{crossTileID:Ze,numVerticalGlyphVertices:Ie}=Ee;if(O){const Xn={zoom:this.transform.zoom,pitch:this.transform.pitch};let Fn=null;if(O.dynamicFilterNeedsFeature){const kn=this.retainedQueryData[b.bucketInstanceId];Fn=O.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:kn.bucketIndex,sourceLayerIndex:kn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(Xn,Fn,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new p.Point(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Ze]=new hc(!1,!1,!1,!0),void u.add(Ze)}if(u.has(Ze))return;if($)return void(this.placements[Ze]=new hc(!1,!1,!1));let Fe=!1,Qe=!1,Ue=!0,et=!1,Ct=!1,Nt=null,_t={box:null,offscreen:null,occluded:null},Dt={box:null,offscreen:null,occluded:null},hn=null,ln=null,wt=null,Dn=0,Vn=0,Sn=0;De.textFeatureIndex?Dn=De.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Dn=Ee.featureIndex),De.verticalTextFeatureIndex&&(Vn=De.verticalTextFeatureIndex);const jn=Xn=>{Xn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const Fn=this.transform.elevation;(Fn||Xn.elevation)&&(Xn.elevation=Fn?Fn.getAtTileOffset(Xn.tileID,Xn.tileAnchorX,Xn.tileAnchorY):0)},or=De.textBox;if(or){jn(or);const Xn=kn=>{let xi=p.WritingMode.horizontal;if(b.allowVerticalPlacement&&!kn&&this.prevPlacement){const br=this.prevPlacement.placedOrientations[Ze];br&&(this.placedOrientations[Ze]=br,xi=br,this.markUsedOrientation(b,xi,Ee))}return xi},Fn=(kn,xi)=>{if(b.allowVerticalPlacement&&Ie>0&&De.verticalTextBox){for(const br of b.writingModes)if(br===p.WritingMode.vertical?(_t=xi(),Dt=_t):_t=kn(),_t&&_t.box&&_t.box.length)break}else _t=kn()};if(I.get("text-variable-anchor")){let kn=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]){const ti=this.prevPlacement.variableOffsets[Ze];kn.indexOf(ti.anchor)>0&&(kn=kn.filter(mi=>mi!==ti.anchor),kn.unshift(ti.anchor))}const xi=(ti,mi,Uu)=>{const hs=b.getSymbolInstanceTextSize(K,Ee,this.transform.zoom,Be),$a=(ti.x2-ti.x1)*hs+2*ti.padding,ds=(ti.y2-ti.y1)*hs+2*ti.padding,ps=pe&&!te?mi:null;ps&&jn(ps);let Rs={box:[],offscreen:!1,occluded:!1};const Gu=ne?2*kn.length:kn.length;for(let Ol=0;Ol<Gu;++Ol){const Hu=this.attemptAnchorPlacement(kn[Ol%kn.length],ti,$a,ds,hs,de,fe,z,T,ee,Ol>=kn.length,Ee,Be,b,Uu,ps,K,X);if(Hu&&(Rs=Hu.placedGlyphBoxes,Rs&&Rs.box&&Rs.box.length)){Fe=!0,Nt=Hu.shift;break}}return Rs};Fn(()=>xi(or,De.iconBox,p.WritingMode.horizontal),()=>{const ti=De.verticalTextBox;return ti&&jn(ti),b.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&Ie>0&&ti?xi(ti,De.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(Fe=_t.box,Ue=_t.offscreen,et=_t.occluded);const br=Xn(!(!_t||!_t.box));if(!Fe&&this.prevPlacement){const ti=this.prevPlacement.variableOffsets[Ze];ti&&(this.variableOffsets[Ze]=ti,this.markUsedJustification(b,ti.anchor,Ee,br))}}else{const kn=(xi,br)=>{const ti=b.getSymbolInstanceTextSize(K,Ee,this.transform.zoom,Be),mi=this.collisionIndex.placeCollisionBox(b,ti,xi,new p.Point(0,0),ne,z,T,ee.predicate);return mi&&mi.box&&mi.box.length&&(this.markUsedOrientation(b,br,Ee),this.placedOrientations[Ze]=br),mi};Fn(()=>kn(or,p.WritingMode.horizontal),()=>{const xi=De.verticalTextBox;return b.allowVerticalPlacement&&Ie>0&&xi?(jn(xi),kn(xi,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Xn(!!(_t&&_t.box&&_t.box.length))}}if(hn=_t,Fe=hn&&hn.box&&hn.box.length>0,Ue=hn&&hn.offscreen,et=hn&&hn.occluded,Ee.useRuntimeCollisionCircles){const Xn=b.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),Fn=p.evaluateSizeForFeature(b.textSizeData,K,Xn),kn=I.get("text-padding");ln=this.collisionIndex.placeCollisionCircles(b,ne,Xn,b.lineVertexArray,b.glyphOffsetArray,Fn,T,S,F,g,fe,ee.predicate,Ee.collisionCircleDiameter*Fn/p.ONE_EM,kn,this.retainedQueryData[b.bucketInstanceId].tileID),Fe=ne||ln.circles.length>0&&!ln.collisionDetected,Ue=Ue&&ln.offscreen,et=ln.occluded}if(De.iconFeatureIndex&&(Sn=De.iconFeatureIndex),De.iconBox){const Xn=Fn=>{jn(Fn);const kn=pe&&Nt?yu(Nt.x,Nt.y,de,fe,this.transform.angle):new p.Point(0,0),xi=b.getSymbolInstanceIconSize(X,this.transform.zoom,Ee.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,xi,Fn,kn,te,z,T,ee.predicate)};Dt&&Dt.box&&Dt.box.length&&De.verticalIconBox?(wt=Xn(De.verticalIconBox),Qe=wt.box.length>0):(wt=Xn(De.iconBox),Qe=wt.box.length>0),Ue=Ue&&wt.offscreen,Ct=wt.occluded}const Ti=V||0===Ee.numHorizontalGlyphVertices&&0===Ie,mo=W||0===Ee.numIconVertices;if(Ti||mo?mo?Ti||(Qe=Qe&&Fe):Fe=Qe&&Fe:Qe=Fe=Qe&&Fe,Fe&&hn&&hn.box&&this.collisionIndex.insertCollisionBox(hn.box,I.get("text-ignore-placement"),b.bucketInstanceId,Dt&&Dt.box&&Vn?Vn:Dn,ee.ID),Qe&&wt&&this.collisionIndex.insertCollisionBox(wt.box,I.get("icon-ignore-placement"),b.bucketInstanceId,Sn,ee.ID),ln&&(Fe&&this.collisionIndex.insertCollisionCircles(ln.circles,I.get("text-ignore-placement"),b.bucketInstanceId,Dn,ee.ID),g)){const Xn=b.bucketInstanceId;let Fn=this.collisionCircleArrays[Xn];void 0===Fn&&(Fn=this.collisionCircleArrays[Xn]=new _u);for(let kn=0;kn<ln.circles.length;kn+=4)Fn.circles.push(ln.circles[kn+0]),Fn.circles.push(ln.circles[kn+1]),Fn.circles.push(ln.circles[kn+2]),Fn.circles.push(ln.collisionDetected?1:0)}const to="globe"!==b.projection.name;_e=_e&&(to||!et),Me=Me&&(to||!Ct),this.placements[Ze]=new hc(Fe||_e,Qe||Me,Ue||b.justReloaded),u.add(Ze)};if(ye){const Ee=b.getSortedSymbolIndexes(this.transform.angle);for(let Be=Ee.length-1;Be>=0;--Be){const De=Ee[Be];We(b.symbolInstances.get(De),De,b.collisionArrays[De])}}else for(let Ee=a.symbolInstanceStart;Ee<a.symbolInstanceEnd;Ee++)We(b.symbolInstances.get(Ee),Ee,b.collisionArrays[Ee]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[b.bucketInstanceId];p.invert(Ee.invProjMatrix,T),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(a,u,g,v){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:S,crossTileID:F}=g,O=p.getAnchorJustification(u),z=v===p.WritingMode.vertical?S:"left"===O?b:"center"===O?I:"right"===O?T:-1;b>=0&&(a.text.placedSymbolArray.get(b).crossTileID=z>=0&&b!==z?0:F),I>=0&&(a.text.placedSymbolArray.get(I).crossTileID=z>=0&&I!==z?0:F),T>=0&&(a.text.placedSymbolArray.get(T).crossTileID=z>=0&&T!==z?0:F),S>=0&&(a.text.placedSymbolArray.get(S).crossTileID=z>=0&&S!==z?0:F)}markUsedOrientation(a,u,g){const v=u===p.WritingMode.horizontal||u===p.WritingMode.horizontalOnly?u:0,b=u===p.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:I,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:F}=g,O=a.text.placedSymbolArray;I>=0&&(O.get(I).placedOrientation=v),T>=0&&(O.get(T).placedOrientation=v),S>=0&&(O.get(S).placedOrientation=v),F>=0&&(O.get(F).placedOrientation=b)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(a):1,b=u?u.opacities:{},I=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(const S in this.placements){const F=this.placements[S],O=b[S];O?(this.opacities[S]=new vn(O,v,F.text,F.icon,null,F.clipped),g=g||F.text!==O.text.placed||F.icon!==O.icon.placed):(this.opacities[S]=new vn(null,v,F.text,F.icon,F.skipFade,F.clipped),g=g||F.text||F.icon)}for(const S in b){const F=b[S];if(!this.opacities[S]){const O=new vn(F,v,!1,!1);O.isHidden()||(this.opacities[S]=O,g=g||F.text.placed||F.icon.placed)}}for(const S in I)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=I[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);g?this.lastPlacementChangeTime=a:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:a)}updateLayerOpacities(a,u){const g=new Set;for(const v of u){const b=v.getBucket(a);b&&v.latestFeatureIndex&&a.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(a,u,g){a.hasTextData()&&a.text.opacityVertexArray.clear(),a.hasIconData()&&a.icon.opacityVertexArray.clear(),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const v=a.layers[0].layout,b=!!a.layers[0].dynamicFilter(),I=new vn(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),S=v.get("icon-allow-overlap"),F=v.get("text-variable-anchor"),O="map"===v.get("text-rotation-alignment"),z="map"===v.get("text-pitch-alignment"),$="none"!==v.get("icon-text-fit"),Q=new vn(null,0,T&&(S||!a.hasIconData()||v.get("icon-optional")),S&&(T||!a.hasTextData()||v.get("text-optional")),!0);!a.collisionArrays&&g&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(g);const K=(ee,V,W)=>{for(let ne=0;ne<V/4;ne++)ee.opacityVertexArray.emplaceBack(W)};let X=0;for(let ee=0;ee<a.symbolInstances.length;ee++){const V=a.symbolInstances.get(ee),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:ne,crossTileID:te,numIconVertices:de}=V,fe=u.has(te);let pe=this.opacities[te];fe?pe=I:pe||(pe=Q,this.opacities[te]=pe),u.add(te);const ye=W>0||ne>0,_e=de>0,Me=this.placedOrientations[te],We=Me===p.WritingMode.vertical,Ee=Me===p.WritingMode.horizontal||Me===p.WritingMode.horizontalOnly;if(!ye&&!_e||pe.isHidden()||X++,ye){const Be=fc(pe.text);K(a.text,W,We?vi:Be),K(a.text,ne,Ee?vi:Be);const De=pe.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:Ie,rightJustifiedTextSymbolIndex:Fe,verticalPlacedTextSymbolIndex:Qe}=V,Ue=a.text.placedSymbolArray,et=De||We?1:0;Ze>=0&&(Ue.get(Ze).hidden=et),Ie>=0&&(Ue.get(Ie).hidden=et),Fe>=0&&(Ue.get(Fe).hidden=et),Qe>=0&&(Ue.get(Qe).hidden=De||Ee?1:0);const Ct=this.variableOffsets[te];Ct&&this.markUsedJustification(a,Ct.anchor,V,Me);const Nt=this.placedOrientations[te];Nt&&(this.markUsedJustification(a,"left",V,Nt),this.markUsedOrientation(a,Nt,V))}if(_e){const Be=fc(pe.icon),{placedIconSymbolIndex:De,verticalPlacedIconSymbolIndex:Ze}=V,Ie=a.icon.placedSymbolArray,Fe=pe.icon.isHidden()?1:0;De>=0&&(K(a.icon,de,We?vi:Be),Ie.get(De).hidden=Fe),Ze>=0&&(K(a.icon,V.numVerticalIconVertices,Ee?vi:Be),Ie.get(Ze).hidden=Fe)}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const Be=a.collisionArrays[ee];if(Be){let De=new p.Point(0,0),Ze=!0;if(Be.textBox||Be.verticalTextBox){if(F){const Fe=this.variableOffsets[te];Fe?(De=ir(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textScale),O&&De._rotate(z?this.transform.angle:-this.transform.angle)):Ze=!1}b&&(Ze=!pe.clipped),Be.textBox&&pc(a.textCollisionBox.collisionVertexArray,pe.text.placed,!Ze||We,De.x,De.y),Be.verticalTextBox&&pc(a.textCollisionBox.collisionVertexArray,pe.text.placed,!Ze||Ee,De.x,De.y)}const Ie=Ze&&Boolean(!Ee&&Be.verticalIconBox);Be.iconBox&&pc(a.iconCollisionBox.collisionVertexArray,pe.icon.placed,Ie,$?De.x:0,$?De.y:0),Be.verticalIconBox&&pc(a.iconCollisionBox.collisionVertexArray,pe.icon.placed,!Ie,$?De.x:0,$?De.y:0)}}}if(a.fullyClipped=0===X,a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=ee.invProjMatrix,a.placementViewportMatrix=ee.viewportMatrix,a.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return 0===this.fadeDuration?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>a}setStale(){this.stale=!0}}function pc(f,a,u,g,v){f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0),f.emplaceBack(a?1:0,u?1:0,g||0,v||0)}const Ii=Math.pow(2,25),Mi=Math.pow(2,24),op=Math.pow(2,17),sp=Math.pow(2,16),Yr=Math.pow(2,9),uo=Math.pow(2,8),om=Math.pow(2,1);function fc(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const a=f.placed?1:0,u=Math.floor(127*f.opacity);return u*Ii+a*Mi+u*op+a*sp+u*Yr+a*uo+u*om+a}const vi=0;class mr{constructor(a){this._sortAcrossTiles="viewport-y"!==a.layout.get("symbol-z-order")&&void 0!==a.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(a,u,g,v,b){const I=this._bucketParts;for(;this._currentTileIndex<a.length;)if(u.getBucketParts(I,v,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<I.length;){const T=I[this._currentPartIndex];if(u.placeLayerBucketPart(T,this._seenCrossTileIDs,g,0===T.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Bn{constructor(a,u,g,v,b,I,T,S){this.placement=new vu(a,b,I,T,S),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(a,u,g){const v=p.exported.now(),b=()=>{const I=p.exported.now()-v;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){const I=u[a[this._currentPlacementIndex]],T=this.placement.collisionIndex.transform.zoom;if("symbol"===I.type&&(!I.minzoom||I.minzoom<=T)&&(!I.maxzoom||I.maxzoom>T)){if(this._inProgressLayer||(this._inProgressLayer=new mr(I)),this._inProgressLayer.continuePlacement(g[I.source],this.placement,this._showCollisionBoxes,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const yl=512/p.EXTENT/2;class gr{constructor(a,u,g){this.tileID=a,this.bucketInstanceId=g,this.index=new p.KDBush(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=a.canonical.x*p.EXTENT,b=a.canonical.y*p.EXTENT;for(let I=0;I<u.length;I++){const{key:T,crossTileID:S,tileAnchorX:F,tileAnchorY:O}=u.get(I),z=Math.floor((v+F)*yl),$=Math.floor((b+O)*yl);this.index.add(z,$),this.keys.push(T),this.crossTileIDs.push(S)}this.index.finish()}findMatches(a,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),b=yl/Math.pow(2,u.canonical.z-this.tileID.canonical.z),I=u.canonical.x*p.EXTENT,T=u.canonical.y*p.EXTENT;for(let S=0;S<a.length;S++){const F=a.get(S);if(F.crossTileID)continue;const{key:O,tileAnchorX:z,tileAnchorY:$}=F,Q=Math.floor((I+z)*b),K=Math.floor((T+$)*b),X=this.index.range(Q-v,K-v,Q+v,K+v);for(const ee of X){const V=this.crossTileIDs[ee];if(this.keys[ee]===O&&!g.has(V)){g.add(V),F.crossTileID=V;break}}}}}class ap{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Mt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const u=Math.round((a-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const I in v){const T=v[I];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),b[T.tileID.key]=T}this.indexes[g]=b}this.lng=a}addBucket(a,u,g){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]=new Set);const v=this.usedCrossTileIDs[a.overscaledZ];for(const b in this.indexes){const I=this.indexes[b];if(Number(b)>a.overscaledZ)for(const T in I){const S=I[T];S.tileID.isChildOf(a)&&S.findMatches(u.symbolInstances,a,v)}else{const T=I[a.scaledTo(Number(b)).key];T&&T.findMatches(u.symbolInstances,a,v)}}for(let b=0;b<u.symbolInstances.length;b++){const I=u.symbolInstances.get(b);I.crossTileID||(I.crossTileID=g.generate(),v.add(I.crossTileID))}return void 0===this.indexes[a.overscaledZ]&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new gr(a,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(a,u){for(const g of u.crossTileIDs)this.usedCrossTileIDs[a].delete(g)}removeStaleBuckets(a){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)a[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class sa{constructor(){this.layerIndexes={},this.crossTileIDs=new ap,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,u,g,v){let b=this.layerIndexes[a.id];void 0===b&&(b=this.layerIndexes[a.id]=new Mt);let I=!1;const T={};"globe"!==v.name&&b.handleWrapJump(g);for(const S of u){const F=S.getBucket(a);F&&a.id===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(S.tileID,F,this.crossTileIDs)&&(I=!0),T[F.bucketInstanceId]=!0)}return b.removeStaleBuckets(T)&&(I=!0),I}pruneUnusedLayers(a){const u={};a.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const di=(f,a)=>p.emitValidationErrors(f,a&&a.filter(u=>"source.canvas"!==u.identifier)),Ba=p.pick(Tn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),sm=p.pick(Tn,["setCenter","setZoom","setBearing","setPitch"]),Au={version:8,layers:[],sources:{}},vl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class is extends p.Evented{constructor(a,u={}){super(),this.map=a,this.dispatcher=new pn(Do(),this),this.imageManager=new Da,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(a._requestManager,u.localFontFamily?p.LocalGlyphMode.all:u.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new sa,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const g=this;this._rtlTextPluginCallback=is.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,I)=>{if(p.triggerPluginCompletionEvent(b),I&&I.every(T=>T))for(const T in g._sourceCaches){const S=g._sourceCaches[T],F=S.getSource().type;"vector"!==F&&"geojson"!==F||S.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const I in this._layers){const T=this._layers[I];T.source===b.id&&this._validateLayer(T)}})}loadURL(a,u={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!p.isMapboxURL(a);a=this.map._requestManager.normalizeStyleURL(a,u.accessToken);const v=this.map._requestManager.transformRequest(a,p.ResourceType.Style);this._request=p.getJSON(v,(b,I)=>{this._request=null,b?this.fire(new p.ErrorEvent(b)):I&&this._load(I,g)})}loadJSON(a,u={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(a,!1!==u.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Au,!1)}_updateLayerCount(a,u){const g=u?1:-1;a.is3D()&&(this._num3DLayers+=g),"circle"===a.type&&(this._numCircleLayers+=g),"symbol"===a.type&&(this._numSymbolLayers+=g)}_load(a,u){if(u&&di(this,p.validateStyle(a)))return;this._loaded=!0,this.stylesheet=p.clone$1(a),this._updateMapProjection();for(const v in a.sources)this.addSource(v,a.sources[v],{validate:!1});this._changed=!1,a.sprite?this._loadSprite(a.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(a.glyphs);const g=rm(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(const v of g){const b=p.createStyleLayer(v);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Hi(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(a){a?this.stylesheet.projection=a:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(a){this._spriteRequest=function(u,g,v){let b,I,T;const S=p.exported.devicePixelRatio>1?"@2x":"";let F=p.getJSON(g.transformRequest(g.normalizeSpriteURL(u,S,".json"),p.ResourceType.SpriteJSON),($,Q)=>{F=null,T||(T=$,b=Q,z())}),O=p.getImage(g.transformRequest(g.normalizeSpriteURL(u,S,".png"),p.ResourceType.SpriteImage),($,Q)=>{O=null,T||(T=$,I=Q,z())});function z(){if(T)v(T);else if(b&&I){const $=p.exported.getImageData(I),Q={};for(const K in b){const{width:X,height:ee,x:V,y:W,sdf:ne,pixelRatio:te,stretchX:de,stretchY:fe,content:pe}=b[K],ye=new p.RGBAImage({width:X,height:ee});p.RGBAImage.copy($,ye,{x:V,y:W},{x:0,y:0},{width:X,height:ee}),Q[K]={data:ye,pixelRatio:te,sdf:ne,stretchX:de,stretchY:fe,content:pe}}v(null,Q)}}return{cancel(){F&&(F.cancel(),F=null),O&&(O.cancel(),O=null)}}}(a,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new p.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(a){const u=this.getSource(a.source);if(!u)return;const g=a.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${a.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this._sourceCaches)if(!this._sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(a){const u=[];for(const g of a){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const a in this._sourceCaches)if(this._sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(a){return!!this.terrain&&("function"==typeof a.isLayerDraped?a.isLayerDraped():vl[a.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(a){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const I in this._updatedSources){const T=this._updatedSources[I];"reload"===T?this._reloadSource(I):"clear"===T&&this._clearSource(I)}this._updateTilesForChangedImages();for(const I in this._updatedPaintProps)this._layers[I].updateTransitions(a);this.light.updateTransitions(a),this.fog&&this.fog.updateTransitions(a),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(a,this._availableImages),!b.isHidden(a.zoom)){const T=this._getLayerSourceCache(b);T&&(T.used=!0)}const I=this.map.painter;if(I){const T=b.getProgramIds();if(!T)continue;const S=b.getProgramConfiguration(a.zoom);for(const F of T)I.useProgram(F,S)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(a),this.terrain&&this.terrain.recalculate(a),this.fog&&this.fog.recalculate(a),this.z=a.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateWorkerLayers(a,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(a),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(a){if(this._checkLoaded(),di(this,p.validateStyle(a)))return!1;(a=p.clone$1(a)).layers=rm(a.layers);const u=function(v,b){if(!v)return[{command:Tn.setStyle,args:[b]}];let I=[];try{if(!je(v.version,b.version))return[{command:Tn.setStyle,args:[b]}];je(v.center,b.center)||I.push({command:Tn.setCenter,args:[b.center]}),je(v.zoom,b.zoom)||I.push({command:Tn.setZoom,args:[b.zoom]}),je(v.bearing,b.bearing)||I.push({command:Tn.setBearing,args:[b.bearing]}),je(v.pitch,b.pitch)||I.push({command:Tn.setPitch,args:[b.pitch]}),je(v.sprite,b.sprite)||I.push({command:Tn.setSprite,args:[b.sprite]}),je(v.glyphs,b.glyphs)||I.push({command:Tn.setGlyphs,args:[b.glyphs]}),je(v.transition,b.transition)||I.push({command:Tn.setTransition,args:[b.transition]}),je(v.light,b.light)||I.push({command:Tn.setLight,args:[b.light]}),je(v.fog,b.fog)||I.push({command:Tn.setFog,args:[b.fog]}),je(v.projection,b.projection)||I.push({command:Tn.setProjection,args:[b.projection]});const T={},S=[];!function(z,$,Q,K){let X;for(X in $=$||{},z=z||{})z.hasOwnProperty(X)&&($.hasOwnProperty(X)||Fa(X,Q,K));for(X in $){if(!$.hasOwnProperty(X))continue;const ee=$[X];z.hasOwnProperty(X)?je(z[X],ee)||("geojson"===z[X].type&&"geojson"===ee.type&&ra(z,$,X)?Q.push({command:Tn.setGeoJSONSourceData,args:[X,ee.data]}):fu(X,$,Q,K)):Uh(X,$,Q)}}(v.sources,b.sources,S,T);const F=[];v.layers&&v.layers.forEach(z=>{z.source&&T[z.source]?I.push({command:Tn.removeLayer,args:[z.id]}):F.push(z)});let O=v.terrain;O&&T[O.source]&&(I.push({command:Tn.setTerrain,args:[void 0]}),O=void 0),I=I.concat(S),je(O,b.terrain)||I.push({command:Tn.setTerrain,args:[b.terrain]}),function(z,$,Q){$=$||[];const K=(z=z||[]).map(ts),X=$.map(ts),ee=z.reduce(mu,{}),V=$.reduce(mu,{}),W=K.slice(),ne=Object.create(null);let te,de,fe,pe,ye,_e,Me;for(te=0,de=0;te<K.length;te++)fe=K[te],V.hasOwnProperty(fe)?de++:(Q.push({command:Tn.removeLayer,args:[fe]}),W.splice(W.indexOf(fe,de),1));for(te=0,de=0;te<X.length;te++)fe=X[X.length-1-te],W[W.length-1-te]!==fe&&(ee.hasOwnProperty(fe)?(Q.push({command:Tn.removeLayer,args:[fe]}),W.splice(W.lastIndexOf(fe,W.length-de),1)):de++,_e=W[W.length-te],Q.push({command:Tn.addLayer,args:[V[fe],_e]}),W.splice(W.length-te,0,fe),ne[fe]=!0);for(te=0;te<X.length;te++)if(fe=X[te],pe=ee[fe],ye=V[fe],!ne[fe]&&!je(pe,ye))if(je(pe.source,ye.source)&&je(pe["source-layer"],ye["source-layer"])&&je(pe.type,ye.type)){for(Me in es(pe.layout,ye.layout,Q,fe,null,Tn.setLayoutProperty),es(pe.paint,ye.paint,Q,fe,null,Tn.setPaintProperty),je(pe.filter,ye.filter)||Q.push({command:Tn.setFilter,args:[fe,ye.filter]}),je(pe.minzoom,ye.minzoom)&&je(pe.maxzoom,ye.maxzoom)||Q.push({command:Tn.setLayerZoomRange,args:[fe,ye.minzoom,ye.maxzoom]}),pe)pe.hasOwnProperty(Me)&&"layout"!==Me&&"paint"!==Me&&"filter"!==Me&&"metadata"!==Me&&"minzoom"!==Me&&"maxzoom"!==Me&&(0===Me.indexOf("paint.")?es(pe[Me],ye[Me],Q,fe,Me.slice(6),Tn.setPaintProperty):je(pe[Me],ye[Me])||Q.push({command:Tn.setLayerProperty,args:[fe,Me,ye[Me]]}));for(Me in ye)ye.hasOwnProperty(Me)&&!pe.hasOwnProperty(Me)&&"layout"!==Me&&"paint"!==Me&&"filter"!==Me&&"metadata"!==Me&&"minzoom"!==Me&&"maxzoom"!==Me&&(0===Me.indexOf("paint.")?es(pe[Me],ye[Me],Q,fe,Me.slice(6),Tn.setPaintProperty):je(pe[Me],ye[Me])||Q.push({command:Tn.setLayerProperty,args:[fe,Me,ye[Me]]}))}else Q.push({command:Tn.removeLayer,args:[fe]}),_e=W[W.lastIndexOf(fe)+1],Q.push({command:Tn.addLayer,args:[ye,_e]})}(F,b.layers,I)}catch(T){console.warn("Unable to compute style diff:",T),I=[{command:Tn.setStyle,args:[b]}]}return I}(this.serialize(),a).filter(v=>!(v.command in sm));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in Ba));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&"setProjection"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=a,this._updateMapProjection(),!0}addImage(a,u){return this.getImage(a)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(a,u),this._afterImageUpdated(a),this)}updateImage(a,u){this.imageManager.updateImage(a,u)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){return this.getImage(a)?(this.imageManager.removeImage(a),this._afterImageUpdated(a),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(a,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(a))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(p.validateSource,`sources.${a}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=nn(a,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(a),source:v.serialize(),sourceId:a}));const b=I=>{const T=(I?"symbol:":"other:")+a,S=this._sourceCaches[T]=new p.SourceCache(T,v,I);(I?this._symbolSourceCaches:this._otherSourceCaches)[a]=S,S.style=this,S.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(a){this._checkLoaded();const u=this.getSource(a);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===a)return this.fire(new p.ErrorEvent(new Error(`Source "${a}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===a)return this.fire(new p.ErrorEvent(new Error(`Source "${a}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(a);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[a],delete this._symbolSourceCaches[a],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(a,u){this._checkLoaded(),this.getSource(a).setData(u),this._changed=!0}getSource(a){const u=this._getSourceCache(a);return u&&u.getSource()}_getSources(){const a=[];for(const u in this._otherSourceCaches){const g=this._getSourceCache(u);g&&a.push(g.getSource())}return a}addLayer(a,u,g={}){this._checkLoaded();const v=a.id;if(this.getLayer(v))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===a.type){if(di(this,p.validateCustomStyleLayer(a)))return;b=p.createStyleLayer(a)}else{if("object"==typeof a.source&&(this.addSource(v,a.source),a=p.clone$1(a),a=p.extend(a,{source:v})),this._validate(p.validateLayer,`layers.${v}`,a,{arrayIndex:-1},g))return;b=p.createStyleLayer(a),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const I=u?this._order.indexOf(u):this._order.length;if(u&&-1===I)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(I,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const T=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&T&&"custom"!==b.type){const S=this._removedLayers[v];delete this._removedLayers[v],S.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",T.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(a,u){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===u)return;const g=this._order.indexOf(a);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new p.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,a),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(a){this._checkLoaded();const u=this._layers[a];if(!u)return void this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(a);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=u,delete this._layers[a],delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(a){return this._layers[a]}hasLayer(a){return a in this._layers}hasLayerType(a){for(const u in this._layers)if(this._layers[u].type===a)return!0;return!1}setLayerZoomRange(a,u,g){this._checkLoaded();const v=this.getLayer(a);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(a,u,g={}){this._checkLoaded();const v=this.getLayer(a);if(v){if(!je(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(p.validateFilter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=p.clone$1(u),this._updateLayer(v)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be filtered.`)))}getFilter(a){const u=this.getLayer(a);return u&&p.clone$1(u.filter)}setLayoutProperty(a,u,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?je(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(a,u){const g=this.getLayer(a);if(g)return g.getLayoutProperty(u);this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style.`)))}setPaintProperty(a,u,g,v={}){this._checkLoaded();const b=this.getLayer(a);b?je(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${a}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(a,u){const g=this.getLayer(a);return g&&g.getPaintProperty(u)}setFeatureState(a,u){this._checkLoaded();const g=a.source,v=a.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const I=b.type;if("geojson"===I&&v)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===I&&!v)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===a.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const T=this._getSourceCaches(g);for(const S of T)S.setFeatureState(v,a.id,u)}removeFeatureState(a,u){this._checkLoaded();const g=a.source,v=this.getSource(g);if(!v)return void this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,I="vector"===b?a.sourceLayer:void 0;if("vector"===b&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof a.id&&"number"!=typeof a.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const T=this._getSourceCaches(g);for(const S of T)S.removeFeatureState(I,a.id,u)}getFeatureState(a){this._checkLoaded();const u=a.source,g=a.sourceLayer,v=this.getSource(u);if(v){if("vector"!==v.type||g)return void 0===a.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,a.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const a={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();a[g.id]||(a[g.id]=g.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:a,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(a){this._updatedLayers[a.id]=!0;const u=this._getLayerSourceCache(a);a.source&&!this._updatedSources[a.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[a.source]="reload",u.pause()),this._changed=!0,a.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(a){const u=I=>"fill-extrusion"===this._layers[I].type,g={},v=[];for(let I=this._order.length-1;I>=0;I--){const T=this._order[I];if(u(T)){g[T]=I;for(const S of a){const F=S[T];if(F)for(const O of F)v.push(O)}}}v.sort((I,T)=>T.intersectionZ-I.intersectionZ);const b=[];for(let I=this._order.length-1;I>=0;I--){const T=this._order[I];if(u(T))for(let S=v.length-1;S>=0;S--){const F=v[S].feature;if(g[F.layer.id]<I)break;b.push(F),v.pop()}else for(const S of a){const F=S[T];if(F)for(const O of F)b.push(O.feature)}}return b}queryRenderedFeatures(a,u,g){u&&u.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of u.layers){const F=this._layers[S];if(!F)return this.fire(new p.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];v[F.source]=!0}}const b=[];u.availableImages=this._availableImages;const I=u&&u.layers?u.layers.some(S=>{const F=this.getLayer(S);return F&&F.is3D()}):this.has3DLayers(),T=Ys.createFromScreenPoints(a,g);for(const S in this._sourceCaches){const F=this._sourceCaches[S].getSource().id;u.layers&&!v[F]||b.push(oi(this._sourceCaches[S],this._layers,this._serializedLayers,T,u,g,I,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(S,F,O,z,$,Q,K){const X={},ee=Q.queryRenderedSymbols(z),V=[];for(const W of Object.keys(ee).map(Number))V.push(K[W]);V.sort(fr);for(const W of V){const ne=W.featureIndex.lookupSymbolFeatures(ee[W.bucketInstanceId],F,W.bucketIndex,W.sourceLayerIndex,$.filter,$.layers,$.availableImages,S);for(const te in ne){const de=X[te]=X[te]||[],fe=ne[te];fe.sort((pe,ye)=>{const _e=W.featureSortOrder;if(_e){const Me=_e.indexOf(pe.featureIndex);return _e.indexOf(ye.featureIndex)-Me}return ye.featureIndex-pe.featureIndex});for(const pe of fe)de.push(pe)}}for(const W in X)X[W].forEach(ne=>{const te=ne.feature,de=O(S[W]);if(!de)return;const fe=de.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=fe});return X}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),T.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(a,u){u&&u.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(a);let v=[];for(const b of g)v=v.concat(yi(b,u));return v}addSourceType(a,u,g){return is.getSourceType(a)?g(new Error(`A source type called "${a}" already exists.`)):(is.setSourceType(a,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:a,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(a,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const I in a)if(!je(a[I],g[I])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(a,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(a,u=1){if(this._checkLoaded(),!a)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=a;if(1===u){if("object"==typeof g.source){const v="terrain-dem-src";this.addSource(v,g.source),g=p.clone$1(g),g=p.extend(g,{source:v})}if(this._validate(p.validateTerrain,"terrain",g))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,u)}else{const v=this.terrain,b=v.get();for(const I of Object.keys(p.spec.terrain))!g.hasOwnProperty(I)&&p.spec.terrain[I].default&&(g[I]=p.spec.terrain[I].default);for(const I in g)if(!je(g[I],b[I])){v.set(g),this.stylesheet.terrain=g;const T=this._setTransitionParameters({duration:0});v.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(a){const u=this.fog=new ka(a,this.map.transform);this.stylesheet.fog=a;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const a of this.map._markers)a._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(a){if(this._checkLoaded(),!a)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();0===Object.keys(a).length&&u.set(a);for(const v in a)if(!je(a[v],g[v])){u.set(a),this.stylesheet.fog=a;const b=this._setTransitionParameters({duration:0});u.updateTransitions(b);break}}else this._createFog(a);this._markersNeedUpdate=!0}_setTransitionParameters(a){return{now:p.exported.now(),transition:p.extend(a,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const a=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...a),this._drapedFirstOrder.push(...u)}_createTerrain(a,u){const g=this.terrain=new uu(a,u);this.stylesheet.terrain=a,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const a in this._layers){const u=this._layers[a];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const a in this._layers){const u=this._layers[a];"symbol"===u.type&&this._updateLayer(u)}}_validate(a,u,g,v,b={}){return(!b||!1!==b.validate)&&di(this,a.call(p.validateStyle,p.extend({key:u,style:this.serialize(),value:g,styleSpec:p.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this._sourceCaches)this._sourceCaches[a].clearTiles(),this._sourceCaches[a].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(a){const u=this._getSourceCaches(a);for(const g of u)g.clearTiles()}_reloadSource(a){const u=this._getSourceCaches(a);for(const g of u)g.resume(),g.reload()}_reloadSources(){for(const a of this._getSources())a.reload&&a.reload()}_updateSources(a){for(const u in this._sourceCaches)this._sourceCaches[u].update(a)}_generateCollisionBoxes(){for(const a in this._sourceCaches){const u=this._sourceCaches[a];u.resume(),u.reload()}}_updatePlacement(a,u,g,v,b=!1){let I=!1,T=!1;const S={};for(const F of this._order){const O=this._layers[F];if("symbol"!==O.type)continue;if(!S[O.source]){const $=this._getLayerSourceCache(O);if(!$)continue;S[O.source]=$.getRenderableIds(!0).map(Q=>$.getTileByID(Q)).sort((Q,K)=>K.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(K.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(O,S[O.source],a.center.lng,a.projection);I=I||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),a.zoom))&&(this.pauseablePlacement=new Bn(a,this._order,b,u,g,v,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),T=!0),I&&this.pauseablePlacement.placement.setStale()),T||I)for(const F of this._order){const O=this._layers[F];"symbol"===O.type&&this.placement.updateLayerOpacities(O,S[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const a in this._sourceCaches)this._sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(a,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(a,u,g){return p.makeRequest(u,g)}_getSourceCache(a){return this._otherSourceCaches[a]}_getLayerSourceCache(a){return"symbol"===a.type?this._symbolSourceCaches[a.source]:this._otherSourceCaches[a.source]}_getSourceCaches(a){const u=[];return this._otherSourceCaches[a]&&u.push(this._otherSourceCaches[a]),this._symbolSourceCaches[a]&&u.push(this._symbolSourceCaches[a]),u}_isSourceCacheLoaded(a){const u=this._getSourceCaches(a);return 0===u.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${a}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}is.getSourceType=function(f){return Ht[f]},is.setSourceType=function(f,a){Ht[f]=a},is.registerForPluginStateChange=p.registerForPluginStateChange;var xu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",rs="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ko="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Al="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Ts="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Lt={},aa={};const mc=[];_c(xu,mc),_c(ko,mc),_c(Al,mc),_c(Ts,mc),Lt=Rn("",ko),aa=Rn(Ts,Al);const Jr=Rn("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),gc=xu,lp="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var ei={background:Rn("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Rn("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Rn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Rn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Rn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Rn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Rn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Rn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Rn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Rn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Rn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Rn("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Rn("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Rn("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Rn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Rn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Rn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Rn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Rn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Rn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Rn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Rn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Rn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Rn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rs),skyboxGradient:Rn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",rs),skyboxCapture:Rn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Rn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Rn("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function _c(f,a){const u=f.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let g of u)if(g=g.trim(),"#"===g[0]&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=g.split(" ");for(const b of v)a.includes(b)||a.push(b)}}function Rn(f,a){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=a.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v={},b=[...mc];return _c(f,b),_c(a,b),{fragmentSource:f=f.replace(u,(I,T,S,F,O)=>(v[O]=!0,"define"===T?`\n#ifndef HAS_UNIFORM_u_${O}\nvarying ${S} ${F} ${O};\n#else\nuniform ${S} ${F} u_${O};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${O}\n    ${S} ${F} ${O} = u_${O};\n#endif\n`)),vertexSource:a=a.replace(u,(I,T,S,F,O)=>{const z="float"===F?"vec2":"vec4",$=O.match(/color/)?"color":z;return v[O]?"define"===T?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${S} ${z} a_${O};\nvarying ${S} ${F} ${O};\n#else\nuniform ${S} ${F} u_${O};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = a_${O};\n#else\n    ${S} ${F} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${O} = unpack_mix_${$}(a_${O}, u_${O}_t);\n#else\n    ${S} ${F} ${O} = u_${O};\n#endif\n`:"define"===T?`\n#ifndef HAS_UNIFORM_u_${O}\nuniform lowp float u_${O}_t;\nattribute ${S} ${z} a_${O};\n#else\nuniform ${S} ${F} u_${O};\n#endif\n`:"vec4"===$?`\n#ifndef HAS_UNIFORM_u_${O}\n    ${S} ${F} ${O} = a_${O};\n#else\n    ${S} ${F} ${O} = u_${O};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${O}\n    ${S} ${F} ${O} = unpack_mix_${$}(a_${O}, u_${O}_t);\n#else\n    ${S} ${F} ${O} = u_${O};\n#endif\n`}),staticAttributes:g,usedDefines:b}}class U_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(a,u,g,v,b,I,T){this.context=a;let S=this.boundPaintVertexBuffers.length!==v.length;for(let O=0;!S&&O<v.length;O++)this.boundPaintVertexBuffers[O]!==v[O]&&(S=!0);let F=this.boundDynamicVertexBuffers.length!==T.length;for(let O=0;!F&&O<T.length;O++)this.boundDynamicVertexBuffers[O]!==T[O]&&(F=!0);if(!a.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==g||S||F||this.boundIndexBuffer!==b||this.boundVertexOffset!==I)this.freshBind(u,g,v,b,I,T);else{a.bindVertexArrayOES.set(this.vao);for(const O of T)O&&O.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(a,u,g,v,b,I){let T;const S=a.numAttributes,F=this.context,O=F.gl;if(F.extVertexArrayObject)this.vao&&this.destroy(),this.vao=F.extVertexArrayObject.createVertexArrayOES(),F.bindVertexArrayOES.set(this.vao),T=0,this.boundProgram=a,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=I;else{T=F.currentNumAttributes||0;for(let z=S;z<T;z++)O.disableVertexAttribArray(z)}u.enableAttributes(O,a),u.bind(),u.setVertexAttribPointers(O,a,b);for(const z of g)z.enableAttributes(O,a),z.bind(),z.setVertexAttribPointers(O,a,b);for(const z of I)z&&(z.enableAttributes(O,a),z.bind(),z.setVertexAttribPointers(O,a,b));v&&v.bind(),F.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Na(f,a){const u=Math.pow(2,a.canonical.z),g=a.canonical.y;return[new p.MercatorCoordinate(0,g/u).toLngLat().lat,new p.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function bu(f,a,u,g,v,b,I){const T=f.context,S=T.gl,F=u.fbo;if(!F)return;f.prepareDrawTile();const O=f.useProgram("hillshade");T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,F.colorAttachment.get());const z=((X,ee,V,W)=>{const ne=V.paint.get("hillshade-shadow-color"),te=V.paint.get("hillshade-highlight-color"),de=V.paint.get("hillshade-accent-color");let fe=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===V.paint.get("hillshade-illumination-anchor")&&(fe-=X.transform.angle);const pe=!X.options.moving;return{u_matrix:W||X.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Na(0,ee.tileID),u_light:[V.paint.get("hillshade-exaggeration"),fe],u_shadow:ne,u_highlight:te,u_accent:de}})(f,u,g,f.terrain?a.projMatrix:null);f.prepareDrawProgram(T,O,a.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:Q,tileBoundsSegments:K}=f.getTileBoundsBuffers(u);O.draw(T,S.TRIANGLES,v,b,I,p.CullFaceMode.disabled,z,g.id,$,Q,K)}function xl(f,a,u){if(!a.needsDEMTextureUpload)return;const g=f.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||f.getTileTexture(u.stride);const b=u.getPixels();a.demTexture?a.demTexture.update(b,{premultiply:!1}):a.demTexture=new p.Texture(g,b,v.RGBA,{premultiply:!1}),a.needsDEMTextureUpload=!1}function cp(f,a,u,g,v,b){const I=f.context,T=I.gl;if(!a.dem)return;const S=a.dem;if(I.activeTexture.set(T.TEXTURE1),xl(f,a,S),!a.demTexture)return;a.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE);const F=S.dim;I.activeTexture.set(T.TEXTURE0);let O=a.fbo;if(!O){const K=new p.Texture(I,{width:F,height:F,data:null},T.RGBA);K.bind(T.LINEAR,T.CLAMP_TO_EDGE),O=a.fbo=I.createFramebuffer(F,F,!0),O.colorAttachment.set(K.texture)}I.bindFramebuffer.set(O.framebuffer),I.viewport.set([0,0,F,F]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:$,tileBoundsSegments:Q}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(I,T.TRIANGLES,g,v,b,p.CullFaceMode.disabled,((K,X)=>{const ee=X.stride,V=p.create();return p.ortho(V,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(V,V,[0,-p.EXTENT,0]),{u_matrix:V,u_image:1,u_dimension:[ee,ee],u_zoom:K.overscaledZ,u_unpack:X.unpackVector}})(a.tileID,S),u.id,z,$,Q),a.needsHillshadePrepare=!1}const $h=f=>({u_matrix:new p.UniformMatrix4f(f),u_image0:new p.Uniform1i(f),u_skirt_height:new p.Uniform1f(f)}),bl=(f,a)=>({u_matrix:f,u_image0:0,u_skirt_height:a}),yc=(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:a,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:I,u_frustum_tr:T,u_frustum_br:S,u_frustum_bl:F,u_globe_pos:O,u_globe_radius:z,u_viewport:$,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:Q});function os(f,a){return null!=f&&null!=a&&!(!f.hasData()||!a.hasData())&&null!=f.demTexture&&null!=a.demTexture&&f.tileID.key!==a.tileID.key}const $r=new class{constructor(){this.operations={}}newMorphing(f,a,u,g,v){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[f]={startTime:g,phase:0,duration:v,from:a,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const a=this.operations[f];return{from:a.from,to:a.to,phase:a.phase}}update(f){for(const a in this.operations){const u=this.operations[a];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[a];break}}}_nextOp(f,a){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=a,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},za={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function mt(f){return 6*Math.pow(1.5,22-f)}function qh(f,a){const u=1<<f.z;return!a&&(0===f.x||f.x===u-1)||0===f.y||f.y===u-1}const $t=f=>({u_matrix:f});function wl(f,a,u,g,v){if(v>0){const b=p.exported.now(),I=(b-f.timeAdded)/v,T=a?(b-a.timeAdded)/v:-1,S=u.getSource(),F=g.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),O=!a||Math.abs(a.tileID.overscaledZ-F)>Math.abs(f.tileID.overscaledZ-F),z=O&&f.refreshedUponExpiration?1:p.clamp(O?I:1-T,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),a?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class vc extends p.SourceCache{constructor(a){const u={type:"raster-dem",maxzoom:a.transform.maxZoom},g=new pn(Do(),null),v=nn("mock-dem",u,g,a.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(a,u){a.state="loaded",u(null)}}class la extends p.SourceCache{constructor(a){const u=nn("proxy",{type:"geojson",maxzoom:a.transform.maxZoom},new pn(Do(),null),a.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=a,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(a,u,g){if(a.freezeTileCoverage)return;this.transform=a;const v=a.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,I)=>{if(b[I.key]="",!this._tiles[I.key]){const T=new p.Tile(I,this._source.tileSize*I.overscaleFactor(),a.tileZoom);T.state="loaded",this._tiles[I.key]=T}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(a){const u=this.proxyCachedFBO[a];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[a]}}deallocRenderCache(){this.renderCache.forEach(a=>a.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class wu extends p.OverscaledTileID{constructor(a,u,g){super(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class Wh extends p.Elevation{constructor(a,u){super(),this.painter=a,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(S){const F=new p.StructArrayLayout2i4,O=new p.StructArrayLayout3ui6,z=131;F.reserve(17161),O.reserve(33800);const $=p.EXTENT/128,Q=p.EXTENT+$/2,K=Q+$;for(let ee=-$;ee<K;ee+=$)for(let V=-$;V<K;V+=$){const W=V<0||V>Q||ee<0||ee>Q?24575:0,ne=p.clamp(Math.round(V),0,p.EXTENT),te=p.clamp(Math.round(ee),0,p.EXTENT);F.emplaceBack(ne+W,te)}const X=(ee,V)=>{const W=V*z+ee;O.emplaceBack(W+1,W,W+z),O.emplaceBack(W+z,W+z+1,W+1)};for(let ee=1;ee<129;ee++)for(let V=1;V<129;V++)X(V,ee);return[0,129].forEach(ee=>{for(let V=0;V<130;V++)X(V,ee),X(ee,V)}),[F,O,32768]}(),I=a.context;this.gridBuffer=I.createVertexBuffer(g,p.posAttributes.members),this.gridIndexBuffer=I.createIndexBuffer(v),this.gridSegments=p.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new la(u.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const T=I.gl;this._overlapStencilMode=new p.StencilMode({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=a.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vc(u.map)}set style(a){a.on("data",this._onStyleDataEvent.bind(this)),a.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=a,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(a,u,g){if(a&&a.terrain){this._style!==a&&(this.style=a),this.enabled=!0;const v=a.terrain.properties;this.sourceCache=0===a.terrain.drapeRenderMode?this._mockSourceCache:a._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const I=this.getScaledDemTileSize();this.sourceCache.update(u,I,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(a){this._findCoveringTileCache[a]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const a=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==a.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${a.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${a.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(a){a.coord&&"source"===a.dataType?this._clearRenderCacheForTile(a.sourceCacheId,a.coord):"style"===a.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const a in this._style._sourceCaches)this._style._sourceCaches[a].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(a=>a.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const a=2*this.proxySourceCache.getSource().tileSize;return[a,a]}set useVertexMorphing(a){this._useVertexMorphing=a}updateTileBinding(a){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(S=>{const F=u.getTileByID(S).tileID;return F.projMatrix=g.calculateProjMatrix(F.toUnwrapped()),F});(function(S,F){const O=F.transform.pointCoordinate(F.transform.getCameraPoint()),z=new p.Point(O.x,O.y);S.sort(($,Q)=>{if(Q.overscaledZ-$.overscaledZ)return Q.overscaledZ-$.overscaledZ;const K=new p.Point($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),X=new p.Point(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),ee=z.mult(1<<$.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(K)-ee.distSqr(X)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const I=this._style._sourceCaches;for(const S in I){const F=I[S];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,a[S],b),F.usedForTerrain))continue;const O=a[S];F.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[u.id]=v.map(S=>new wu(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const T={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const F=this.terrainTileForTile[S.key];if(!F)continue;const O=F.tileID.key;O in T||(this._visibleDemTiles.push(F),T[O]=O)}}_assignTerrainTiles(a){this._initializing||a.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const a=this.painter.context,u=a.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(a.activeTexture.set(u.TEXTURE1),xl(this.painter,v,b))}}_prepareDemTileUniforms(a,u,g,v){if(!u||null==u.demTexture)return!1;const b=a.tileID.canonical,I=Math.pow(2,u.tileID.canonical.z-b.z),T=v||"";return g[`u_dem_tl${T}`]=[b.x*I%1,b.y*I%1],g[`u_dem_scale${T}`]=I,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const a=this.painter.context,u=a.gl;if(!this._emptyDepthBufferTexture){const g=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(a,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let a=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&a++,g+b},0);return a?u/a:0}_updateEmptyDEMTexture(){const a=this.painter.context,u=a.gl;a.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new p.Texture(a,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(a,u,g){const v=this.painter.context,b=v.gl,I=(T=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(T),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var T;I.u_dem_size=this.sourceCache.getSource().tileSize,I.u_exaggeration=this.exaggeration();let S=null,F=null,O=1;if(g&&g.morphing&&this._useVertexMorphing){const z=g.morphing.srcDemTile,$=g.morphing.dstDemTile;O=g.morphing.phase,z&&$&&(this._prepareDemTileUniforms(a,z,I,"_prev")&&(F=z),this._prepareDemTileUniforms(a,$,I)&&(S=$))}if(F&&S?(v.activeTexture.set(b.TEXTURE2),S.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),F.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),I.u_dem_lerp=O):(S=this.terrainTileForTile[a.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(a,S,I)?S.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(I.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),I.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&S){const z=(1<<S.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;I.u_meter_to_dem=z}if(g&&g.labelPlaneMatrixInv&&(I.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,I),"globe"===this.painter.transform.projection.name){const z=this.globeUniformValues(this.painter.transform,a.tileID.canonical,g&&g.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,z)}}globeUniformValues(a,u,g){const v=a.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,p.EXTENT,0),u_tile_br_up:v.upVector(u,p.EXTENT,p.EXTENT),u_tile_bl_up:v.upVector(u,0,p.EXTENT),u_tile_up_scale:g?p.globeMetersToEcef(1):v.upVectorScale(u,a.center.lat,a.worldSize).metersToTile}}renderToBackBuffer(a){const u=this.painter,g=this.painter.context;0!==a.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,I,T,S){if("globe"===v.transform.projection.name)!function(F,O,z,$,Q){const K=F.context,X=K.gl;let ee,V;const W=F.options.showTerrainWireframe?2:0,ne=F.transform,te=p.globeUseCustomAntiAliasing(F,K,ne),de=(Ze,Ie)=>{if(V===Ze)return;const Fe=[za[Ze],"PROJECTION_GLOBE_VIEW"];te&&Fe.push("CUSTOM_ANTIALIASING"),Ie&&Fe.push(za[W]),ee=F.useProgram("globeRaster",null,Fe),V=Ze},fe=F.colorModeForRenderPass(),pe=new p.DepthMode(X.LEQUAL,p.DepthMode.ReadWrite,F.depthRangeFor3D);$r.update(Q);const ye=p.calculateGlobeMercatorMatrix(ne),_e=[p.mercatorXfromLng(ne.center.lng),p.mercatorYfromLat(ne.center.lat)],Me=W?[!1,!0]:[!1],We=F.globeSharedBuffers,Ee=[ne.width*p.exported.devicePixelRatio,ne.height*p.exported.devicePixelRatio],Be=Float32Array.from(ne.globeMatrix),De={useDenormalizedUpVectorScale:!0};if(Me.forEach(Ze=>{const Ie=F.transform,Fe=mt(Ie.zoom)*O.exaggeration();V=-1;const Qe=Ze?X.LINES:X.TRIANGLES;for(const Ue of $){const et=z.getTile(Ue),Ct=p.StencilMode.disabled,Nt=O.prevTerrainTileForTile[Ue.key],_t=O.terrainTileForTile[Ue.key];os(Nt,_t)&&$r.newMorphing(Ue.key,Nt,_t,Q,250),K.activeTexture.set(X.TEXTURE0),et.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Dt=$r.getMorphValuesForProxy(Ue.key),hn=Dt?1:0;Dt&&p.extend$1(De,{morphing:{srcDemTile:Dt.from,dstDemTile:Dt.to,phase:p.easeCubicInOut(Dt.phase)}});const ln=p.tileCornersToBounds(Ue.canonical),wt=p.getLatitudinalLod(ln.getCenter().lat),Dn=p.getGridMatrix(Ue.canonical,ln,wt,Ie.worldSize/Ie._pixelsPerMercatorPixel),Vn=p.globeNormalizeECEF(p.globeTileBounds(Ue.canonical)),Sn=yc(Ie.projMatrix,Be,ye,Vn,p.globeToMercatorTransition(Ie.zoom),_e,Ie.frustumCorners.TL,Ie.frustumCorners.TR,Ie.frustumCorners.BR,Ie.frustumCorners.BL,Ie.globeCenterInViewSpace,Ie.globeRadius,Ee,Fe,Dn);if(de(hn,Ze),O.setupElevationDraw(et,ee,De),F.prepareDrawProgram(K,ee,Ue.toUnwrapped()),We){const[jn,or,Ti]=Ze?We.getWirefameBuffers(F.context,wt):We.getGridBuffers(wt,0!==Fe);ee.draw(K,Qe,pe,Ct,fe,p.CullFaceMode.backCCW,Sn,"globe_raster",jn,or,Ti)}}}),We){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];te&&Ze.push("CUSTOM_ANTIALIASING"),ee=F.useProgram("globeRaster",null,Ze);for(const Ie of $){const{x:Fe,y:Qe,z:Ue}=Ie.canonical,et=0===Qe,Ct=Qe===(1<<Ue)-1,[Nt,_t,Dt,hn]=We.getPoleBuffers(Ue);if(hn&&(et||Ct)){const ln=z.getTile(Ie);K.activeTexture.set(X.TEXTURE0),ln.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);let wt=p.globePoleMatrixForTile(Ue,Fe,ne);const Dn=p.globeNormalizeECEF(p.globeTileBounds(Ie.canonical)),Vn=(Sn,jn)=>Sn.draw(K,X.TRIANGLES,pe,p.StencilMode.disabled,fe,p.CullFaceMode.disabled,yc(ne.projMatrix,wt,wt,Dn,0,_e,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ee,0),"globe_pole_raster",jn,Dt,hn);O.setupElevationDraw(ln,ee,De),F.prepareDrawProgram(K,ee,Ie.toUnwrapped()),et&&Vn(ee,Nt),Ct&&(wt=p.scale(p.create(),wt,[1,-1,1]),Vn(ee,_t))}}}}(v,b,I,T,S);else{const F=v.context,O=F.gl;let z,$;const Q=v.options.showTerrainWireframe?2:0,K=(ne,te)=>{if($===ne)return;const de=[za[ne]];te&&de.push(za[Q]),z=v.useProgram("terrainRaster",null,de),$=ne},X=v.colorModeForRenderPass(),ee=new p.DepthMode(O.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);$r.update(S);const V=v.transform,W=mt(V.zoom)*b.exaggeration();(Q?[!1,!0]:[!1]).forEach(ne=>{$=-1;const te=ne?O.LINES:O.TRIANGLES,[de,fe]=ne?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const pe of T){const ye=I.getTile(pe),_e=p.StencilMode.disabled,Me=b.prevTerrainTileForTile[pe.key],We=b.terrainTileForTile[pe.key];os(Me,We)&&$r.newMorphing(pe.key,Me,We,S,250),F.activeTexture.set(O.TEXTURE0),ye.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE,O.LINEAR_MIPMAP_NEAREST);const Ee=$r.getMorphValuesForProxy(pe.key),Be=Ee?1:0;let De;Ee&&(De={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:p.easeCubicInOut(Ee.phase)}});const Ze=bl(pe.projMatrix,qh(pe.canonical,V.renderWorldCopies)?W/10:W);K(Be,ne),b.setupElevationDraw(ye,z,De),v.prepareDrawProgram(F,z,pe.toUnwrapped()),z.draw(F,te,ee,_e,X,p.CullFaceMode.backCCW,Ze,"terrain_raster",b.gridBuffer,de,fe)}})}}(u,this,this.proxySourceCache,a,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),a.splice(0,a.length))}renderBatch(a){if(0===this._drapedRenderBatches.length)return a+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],I=this._drapedRenderBatches.shift(),T=[],S=u.style.order;let F=0;for(const O of b){const z=v.getTileByID(O.proxyTileKey),$=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][a]:void 0,Q=void 0!==$?v.renderCache[$]:this.pool[F++],K=void 0!==$;if(z.texture=Q.tex,K&&!Q.dirty){T.push(z.tileID);continue}let X;g.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(g.clear({color:p.Color.transparent,stencil:0}),Q.dirty=!1);for(let ee=I.start;ee<=I.end;++ee){const V=u.style._layers[S[ee]];if(V.isHidden(u.transform.zoom))continue;const W=u.style._getLayerSourceCache(V),ne=W?this.proxyToSource[O.key][W.id]:[O];if(!ne)continue;const te=ne;g.viewport.set([0,0,Q.fb.width,Q.fb.height]),X!==(W?W.id:null)&&(this._setupStencil(Q,ne,V,W),X=W?W.id:null),u.renderLayer(u,W,V,te)}this.renderedToTile?(Q.dirty=!0,T.push(z.tileID)):K||--F,5===F&&(F=0,this.renderToBackBuffer(T))}return this.renderToBackBuffer(T),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),I.end+1}postRender(){}renderCacheEfficiency(a){const u=a.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,I=!1;for(let T=0;T<u;++T){const S=a._layers[a.order[T]];this._style.isLayerDraped(S)?(I&&++v,++b):I||(I=!0,g=S.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let a=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{a=Math.min(a,u.dem.tree.minimums[0])}),0===a?a:(a-30)*this._exaggeration}raycast(a,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const I=b.tileID,T=1<<I.overscaledZ,{x:S,y:F}=I.canonical,O=S/T,z=(S+1)/T,$=F/T,Q=(F+1)/T;return{minx:O,miny:$,maxx:z,maxy:Q,t:b.dem.tree.raycastRoot(O,$,z,Q,a,u,g),tile:b}});v.sort((b,I)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==I.t?I.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const I=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,a,u,g);if(null!=I)return I}return null}_createFBO(){const a=this.painter.context,u=a.gl,g=this.drapeBufferSize;a.activeTexture.set(u.TEXTURE0);const v=new p.Texture(a,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=a.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new me(a,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=a.createRenderbuffer(a.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),a.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),a.extTextureFilterAnisotropic&&!a.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a].hasTransition())return!0;return this._style.order.some(a=>{const u=this._style._layers[a],g=u.isHidden(this.painter.transform.zoom);return"custom"===u.type?!g&&u.shouldRedrape():!g&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let a=!1;for(const g of this._style._getSources())if(g instanceof st){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(b&&!u[b.id]&&!v.isHidden(this.painter.transform.zoom)&&"line"===v.type&&v.widthExpression()instanceof p.ZoomDependentExpression){u[b.id]=!0;for(const I of this.proxyCoords){const T=this.proxyToSource[I.key][b.id];if(T)for(const S of T)this._clearRenderCacheForTile(b.id,S)}}}}_clearRasterLayersFromRenderCache(){let a=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof Ye){a=!0;break}if(!a)return;const u={};for(let g=0;g<this._style.order.length;++g){const v=this._style._layers[this._style.order[g]],b=this._style._getLayerSourceCache(v);if(!b||u[b.id]||v.isHidden(this.painter.transform.zoom)||"raster"!==v.type)continue;const I=v.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][b.id];if(S)for(const F of S){const O=wl(b.getTile(F),b.findLoadedParent(F,0),b,this.painter.transform,I);(1!==O.opacity||0!==O.mix)&&this._clearRenderCacheForTile(b.id,F)}}}}_setupDrapedRenderBatches(){const a=this._style.order,u=a.length;if(0===u)return;const g=[];let v,b=0,I=this._style._layers[a[b]];for(;!this._style.isLayerDraped(I)&&I.isHidden(this.painter.transform.zoom)&&++b<u;)I=this._style._layers[a[b]];for(;b<u;++b){const T=this._style._layers[a[b]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(a){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const I=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let T=0;T<I.length;++T){const S=Object.values(I[T]);u.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let I=g.length-1;I>=0;I--){const T=g[I];if(u.getTileByID(T.key),void 0!==u.proxyCachedFBO[T.key]){const S=a[T.key],F=this.proxyToSource[T.key];let O=0;for(const z in F){const $=F[z],Q=S[z];if(!Q||Q.length!==$.length||$.some((K,X)=>K!==Q[X]||v[z]&&v[z].hasOwnProperty(K.key))){O=-1;break}++O}for(const z in u.proxyCachedFBO[T.key])u.renderCache[u.proxyCachedFBO[T.key][z]].dirty=O<0||O!==Object.values(S).length}}const b=[...this._drapedRenderBatches];b.sort((I,T)=>T.end-T.start-(I.end-I.start));for(const I of b)for(const T of g){if(u.proxyCachedFBO[T.key])continue;let S=u.renderCachePool.pop();void 0===S&&u.renderCache.length<50&&(S=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==S&&(u.proxyCachedFBO[T.key]={},u.proxyCachedFBO[T.key][I.start]=S,u.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(a,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,I=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let T;if(g.isTileClipped())T=u.length,this._overlapStencilMode.test={func:I.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:I.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(a){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[a.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(a,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const I=g.useProgram("clippingMask");for(const T of a){const S=g._tileClippingMaskIDs[T.key]=--u;I.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},S,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,$t(T.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(a){const u=this.painter.transform;if(a.x<0||a.x>u.width||a.y<0||a.y>u.height)return null;const g=[a.x,a.y,1,1];p.transformMat4$1(g,g,u.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=p.mercatorZfromAltitude(1,u.center.lat),I=[v[0],v[1],v[2]/b,0],T=p.subtract([],g.slice(0,3),I);p.normalize(T,T);const S=this.raycast(I,T,this._exaggeration);return null!==S&&S?(p.scaleAndAdd(I,I,T,S),I[3]=I[2],I[2]*=b,I):null}drawDepth(){const a=this.painter,u=a.context,g=this.proxySourceCache,v=Math.ceil(a.width),b=Math.ceil(a.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const I=u.gl,T=u.createFramebuffer(v,b,!0);u.activeTexture.set(I.TEXTURE0);const S=new p.Texture(u,{width:v,height:b,data:null},I.RGBA);S.bind(I.NEAREST,I.CLAMP_TO_EDGE),T.colorAttachment.set(S.texture);const F=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);T.depthAttachment.set(F),this._depthFBO=T,this._depthTexture=S}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(I,T,S,F){if("globe"===I.transform.projection.name)return;const O=I.context,z=O.gl;O.clear({depth:1});const $=I.useProgram("terrainDepth"),Q=new p.DepthMode(z.LESS,p.DepthMode.ReadWrite,I.depthRangeFor3D);for(const K of F){const X=S.getTile(K),ee=bl(K.projMatrix,0);T.setupElevationDraw(X,$),$.draw(O,z.TRIANGLES,Q,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,ee,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(a,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(a,u,g){if(a.getSource()instanceof Rt)return this._setupProxiedCoordsForImageSource(a,u,g);this._findCoveringTileCache[a.id]=this._findCoveringTileCache[a.id]||{};const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords;for(let T=0;T<b.length;T++){const S=b[T],F=this._findTileCoveringTileID(S,a);if(F){const O=this._createProxiedId(S,F,g[S.key]&&g[S.key][a.id]);v.push(O),this.proxyToSource[S.key][a.id]=[O]}}let I=!1;for(let T=0;T<u.length;T++){const S=a.getTile(u[T]);if(!S||!S.hasData())continue;const F=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(F&&F.tileID.canonical.z!==S.tileID.canonical.z){const O=this.proxyToSource[F.tileID.key][a.id],z=this._createProxiedId(F.tileID,S,g[F.tileID.key]&&g[F.tileID.key][a.id]);O?O.splice(O.length-1,0,z):this.proxyToSource[F.tileID.key][a.id]=[z],v.push(z),I=!0}}this._sourceTilesOverlap[a.id]=I}_setupProxiedCoordsForImageSource(a,u,g){if(!a.getSource().loaded())return;const v=this.proxiedCoords[a.id]=[],b=this.proxyCoords,I=a.getSource(),T=new p.Point(I.tileID.x,I.tileID.y)._div(1<<I.tileID.z),S=I.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((O,z)=>(O.min.x=Math.min(O.min.x,z.x-T.x),O.min.y=Math.min(O.min.y,z.y-T.y),O.max.x=Math.max(O.max.x,z.x-T.x),O.max.y=Math.max(O.max.y,z.y-T.y),O),{min:new p.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),F=(O,z)=>{const $=O.wrap+O.canonical.x/(1<<O.canonical.z),Q=O.canonical.y/(1<<O.canonical.z),K=p.EXTENT/(1<<O.canonical.z),X=z.wrap+z.canonical.x/(1<<z.canonical.z),ee=z.canonical.y/(1<<z.canonical.z);return $+K<X+S.min.x||$>X+S.max.x||Q+K<ee+S.min.y||Q>ee+S.max.y};for(let O=0;O<b.length;O++){const z=b[O];for(let $=0;$<u.length;$++){const Q=a.getTile(u[$]);if(!Q||!Q.hasData()||F(z,Q.tileID))continue;const K=this._createProxiedId(z,Q,g[z.key]&&g[z.key][a.id]),X=this.proxyToSource[z.key][a.id];X?X.push(K):this.proxyToSource[z.key][a.id]=[K],v.push(K)}}}_createProxiedId(a,u,g){let v=this.orthoMatrix;if(g){const b=g.find(I=>I.key===u.tileID.key);if(b)return b}if(u.tileID.key!==a.key){const b=a.canonical.z-u.tileID.canonical.z;let I,T,S;v=p.create();const F=u.tileID.wrap-a.wrap<<a.overscaledZ;b>0?(I=p.EXTENT>>b,T=I*((u.tileID.canonical.x<<b)-a.canonical.x+F),S=I*((u.tileID.canonical.y<<b)-a.canonical.y)):(I=p.EXTENT<<-b,T=p.EXTENT*(u.tileID.canonical.x-(a.canonical.x+F<<-b)),S=p.EXTENT*(u.tileID.canonical.y-(a.canonical.y<<-b))),p.ortho(v,0,I,0,I,0,1),p.translate(v,v,[T,S,0])}return new wu(u.tileID,a.key,v)}_findTileCoveringTileID(a,u){let g=u.getTile(a);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[a.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let I=g?g.tileID:a,T=I.overscaledZ;const S=u.getSource().minzoom,F=[];if(!b){const z=u.getSource().maxzoom;if(a.canonical.z>=z){const $=a.canonical.z-z;u.getSource().reparseOverscaled?(T=Math.max(a.canonical.z+2,u.transform.tileZoom),I=new p.OverscaledTileID(T,a.wrap,z,a.canonical.x>>$,a.canonical.y>>$)):0!==$&&(T=z,I=new p.OverscaledTileID(T,a.wrap,z,a.canonical.x>>$,a.canonical.y>>$))}I.key!==a.key&&(F.push(I.key),g=u.getTile(I))}const O=z=>{F.forEach($=>{v[$]=z}),F.length=0};for(T-=1;T>=S&&(!g||!g.hasData());T--){g&&O(g.tileID.key);const z=I.calculateScaledKey(T);if(g=u.getTileByID(z),g&&g.hasData())break;const $=v[z];if(null===$)break;void 0===$?F.push(z):g=u.getTileByID($)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(a){return this.enabled?this._findTileCoveringTileID(a,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(a,u){let g=this._tilesDirty[a];g||(g=this._tilesDirty[a]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const a=function(u){let g=0;const v=new p.StructArrayLayout2ui4,b=131;for(let I=1;I<129;I++){for(let T=1;T<129;T++)g=I*b+T,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),128===I&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(a),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,a.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class xn{static cacheKey(a,u,g,v){let b=`${u}${v?v.cacheKey:""}`;for(const I of g)a.usedDefines.includes(I)&&(b+=`/${I}`);return b}constructor(a,u,g,v,b,I){const T=a.gl;this.program=T.createProgram();const S=function(V){const W=[];for(let ne=0;ne<V.length;ne++){if(null===V[ne])continue;const te=V[ne].split(" ");W.push(te.pop())}return W}(g.staticAttributes),F=v?v.getBinderAttributes():[],O=S.concat(F);let z=v?v.defines():[];z=z.concat(I.map(V=>`#define ${V}`));const $=a.isWebGL2?"#version 300 es\n":"",Q=$+z.concat(a.extStandardDerivatives&&0===$.length?"#extension GL_OES_standard_derivatives : enable\n".concat(lp):lp,lp,gc,Jr.fragmentSource,aa.fragmentSource,g.fragmentSource).join("\n"),K=$+z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",gc,Jr.vertexSource,aa.vertexSource,Lt.vertexSource,g.vertexSource).join("\n"),X=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(X,Q),T.compileShader(X),T.attachShader(this.program,X);const ee=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(ee,K),T.compileShader(ee),T.attachShader(this.program,ee),this.attributes={},this.numAttributes=O.length;for(let V=0;V<this.numAttributes;V++)O[V]&&(T.bindAttribLocation(this.program,V,O[V]),this.attributes[O[V]]=V);T.linkProgram(this.program),T.deleteShader(ee),T.deleteShader(X),this.fixedUniforms=b(a),this.binderUniforms=v?v.getUniforms(a):[],I.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(V=a),u_dem_prev:new p.Uniform1i(V),u_dem_unpack:new p.Uniform4f(V),u_dem_tl:new p.Uniform2f(V),u_dem_scale:new p.Uniform1f(V),u_dem_tl_prev:new p.Uniform2f(V),u_dem_scale_prev:new p.Uniform1f(V),u_dem_size:new p.Uniform1f(V),u_dem_lerp:new p.Uniform1f(V),u_exaggeration:new p.Uniform1f(V),u_depth:new p.Uniform1i(V),u_depth_size_inv:new p.Uniform2f(V),u_meter_to_dem:new p.Uniform1f(V),u_label_plane_matrix_inv:new p.UniformMatrix4f(V)}),I.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new p.Uniform3f(V),u_tile_tr_up:new p.Uniform3f(V),u_tile_br_up:new p.Uniform3f(V),u_tile_bl_up:new p.Uniform3f(V),u_tile_up_scale:new p.Uniform1f(V)}))(a)),I.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new p.UniformMatrix4f(V),u_fog_range:new p.Uniform2f(V),u_fog_color:new p.Uniform4f(V),u_fog_horizon_blend:new p.Uniform1f(V),u_fog_temporal_offset:new p.Uniform1f(V),u_frustum_tl:new p.Uniform3f(V),u_frustum_tr:new p.Uniform3f(V),u_frustum_br:new p.Uniform3f(V),u_frustum_bl:new p.Uniform3f(V),u_globe_pos:new p.Uniform3f(V),u_globe_radius:new p.Uniform1f(V),u_globe_transition:new p.Uniform1f(V),u_is_globe:new p.Uniform1i(V),u_viewport:new p.Uniform2f(V)}))(a))}var V}setTerrainUniformValues(a,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setGlobeUniformValues(a,u){if(!this.globeUniforms)return;const g=this.globeUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v]&&g[v].set(this.program,v,u[v])}}setFogUniformValues(a,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){a.program.set(this.program);for(const v in u)g[v].set(this.program,v,u[v])}}draw(a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X){const ee=a.gl;if(this.failedToCreate)return;a.program.set(this.program),a.setDepthMode(g),a.setStencilMode(v),a.setColorMode(b),a.setCullFace(I);for(const W of Object.keys(this.fixedUniforms))this.fixedUniforms[W].set(this.program,W,T[W]);K&&K.setUniforms(this.program,a,this.binderUniforms,$,{zoom:Q});const V={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[u];for(const W of z.get()){const ne=W.vaos||(W.vaos={});(ne[S]||(ne[S]=new U_)).bind(a,this,F,K?K.getPaintVertexBuffers():[],O,W.vertexOffset,X||[]),ee.drawElements(u,W.primitiveLength*V,ee.UNSIGNED_SHORT,W.primitiveOffset*V*2)}}}function eo(f,a){const u=Math.pow(2,a.tileID.overscaledZ),g=a.tileSize*Math.pow(2,f.transform.tileZoom)/u,v=g*(a.tileID.canonical.x+a.tileID.wrap*u),b=g*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_tile_units_to_pixels:1/Bi(a,1,f.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Po=p.create(),ho=(f,a,u,g,v,b,I,T,S,F,O)=>{const z=a.style.light,$=z.properties.get("position"),Q=[$.x,$.y,$.z],K=p.create$1();"viewport"===z.properties.get("anchor")&&(p.fromRotation(K,-a.transform.angle),p.transformMat3(Q,Q,K));const X=z.properties.get("color"),ee=a.transform,V={u_matrix:f,u_lightpos:Q,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Po,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b};return"globe"===ee.projection.name&&(V.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],V.u_zoom_transition=S,V.u_inv_rot_matrix=O,V.u_merc_center=F,V.u_up_dir=ee.projection.upVector(new p.CanonicalTileID(0,0,0),F[0]*p.EXTENT,F[1]*p.EXTENT),V.u_height_lift=T),V},ss=(f,a,u,g,v,b,I,T,S,F,O,z)=>{const $=ho(f,a,u,g,v,b,I,S,F,O,z),Q={u_height_factor:-Math.pow(2,I.overscaledZ)/T.tileSize/8};return p.extend($,eo(a,T),Q)},bn=f=>({u_matrix:f}),Cl=(f,a,u)=>p.extend(bn(f),eo(a,u)),Zh=(f,a)=>({u_matrix:f,u_world:a}),Qh=(f,a,u,g)=>p.extend(Cl(f,a,u),{u_world:g}),up=p.create(),Ro=(f,a,u,g,v,b)=>{const I=f.transform,T="globe"===I.projection.name;let S;if("map"===b.paint.get("circle-pitch-alignment"))if(T){const O=p.globePixelsToTileUnits(I.zoom,a.canonical)*I._pixelsPerMercatorPixel;S=Float32Array.from([O,0,0,O])}else S=I.calculatePixelsToTileUnitsMatrix(u);else S=new Float32Array([I.pixelsToGLUnits[0],0,0,I.pixelsToGLUnits[1]]);const F={u_camera_to_center_distance:I.cameraToCenterDistance,u_matrix:f.translatePosMatrix(a.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:up,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(T){F.u_inv_rot_matrix=g,F.u_merc_center=v,F.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],F.u_zoom_transition=p.globeToMercatorTransition(I.zoom);const O=v[0]*p.EXTENT,z=v[1]*p.EXTENT;F.u_up_dir=I.projection.upVector(new p.CanonicalTileID(0,0,0),O,z)}return F},Va=f=>{const a=[];return"map"===f.paint.get("circle-pitch-alignment")&&a.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&a.push("SCALE_WITH_MAP"),a},Xh=(f,a,u,g)=>{const v=p.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:a.getCameraToCenterDistance(g),u_extrude_scale:[a.pixelsToGLUnits[0]/v,a.pixelsToGLUnits[1]/v]}},_r=(f,a,u=1)=>({u_matrix:f,u_color:a,u_overlay:0,u_overlay_scale:u}),Kh=p.create(),hp=(f,a,u,g,v,b,I)=>{const T=f.transform,S="globe"===T.projection.name,F=S?p.globePixelsToTileUnits(T.zoom,a.canonical)*T._pixelsPerMercatorPixel:Bi(u,1,b),O={u_matrix:a.projMatrix,u_extrude_scale:F,u_intensity:I,u_inv_rot_matrix:Kh,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[a.canonical.x,a.canonical.y,1<<a.canonical.z],O.u_zoom_transition=p.globeToMercatorTransition(T.zoom);const z=v[0]*p.EXTENT,$=v[1]*p.EXTENT;O.u_up_dir=T.projection.upVector(new p.CanonicalTileID(0,0,0),z,$)}return O},am=(f,a,u,g,v,b,I)=>{const T=f.transform,S=T.calculatePixelsToTileUnitsMatrix(a);return{u_matrix:Cu(f,a,u,g),u_pixels_to_tile_units:S,u_device_pixel_ratio:b,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:Bt(u)?a.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:El(a,f.transform),u_alpha_discard_threshold:0,u_trim_offset:I}},Ni=(f,a,u,g,v)=>{const b=f.transform;return{u_matrix:Cu(f,a,u,g),u_texsize:a.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(a),u_device_pixel_ratio:v,u_image:0,u_tile_units_to_pixels:El(a,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function El(f,a){return 1/Bi(f,1,a.tileZoom)}function Cu(f,a,u,g){return f.translatePosMatrix(g||a.tileID.projMatrix,a,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function Bt(f){const a=f.paint.get("line-dasharray").value;return a.value||"constant"!==a.kind}const yr=(f,a,u,g,v,b)=>{return{u_matrix:f,u_tl_parent:a,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(T=v.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(I=v.paint.get("raster-contrast"),I>0?1/(1-I):1+I),u_spin_weights:mn(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var I,T};function mn(f){f*=Math.PI/180;const a=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*a-u+1)/3,(Math.sqrt(3)*a-u+1)/3]}const zi=p.create(),vr=(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X)=>{const ee=v.transform,V={u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:I,u_coord_matrix:T,u_is_text:+S,u_pitch_with_map:+g,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:zi,u_up_vector:[0,-1,0]};return"globe"===X.name&&(V.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],V.u_zoom_transition=z,V.u_inv_rot_matrix=Q,V.u_merc_center=$,V.u_camera_forward=ee._camera.forward(),V.u_ecef_origin=p.globeECEFOrigin(ee.globeMatrix,O.toUnwrapped()),V.u_tile_matrix=Float32Array.from(ee.globeMatrix),V.u_up_vector=K),V},Ds=(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X,ee)=>p.extend(vr(f,a,u,g,v,b,I,T,S,F,z,$,Q,K,X,ee),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+O}),qr=(f,a,u,g,v,b,I,T,S,F,O,z,$,Q,K,X)=>p.extend(Ds(f,a,u,g,v,b,I,T,!0,S,!0,O,z,$,Q,K,X),{u_texsize_icon:F,u_texture_icon:1}),Eu=(f,a,u)=>({u_matrix:f,u_opacity:a,u_color:u}),dp=(f,a,u,g,v)=>p.extend(function(b,I,T){const S=I.imageManager.getPattern(b.toString()),{width:F,height:O}=I.imageManager.getPixelSize(),z=Math.pow(2,T.tileID.overscaledZ),$=T.tileSize*Math.pow(2,I.transform.tileZoom)/z,Q=$*(T.tileID.canonical.x+T.tileID.wrap*z),K=$*T.tileID.canonical.y;return{u_image:0,u_pattern_tl:S.tl,u_pattern_br:S.br,u_texsize:[F,O],u_pattern_size:S.displaySize,u_tile_units_to_pixels:1/Bi(T,1,I.transform.tileZoom),u_pixel_coord_upper:[Q>>16,K>>16],u_pixel_coord_lower:[65535&Q,65535&K]}}(g,u,v),{u_matrix:f,u_opacity:a}),Il={fillExtrusion:f=>({u_matrix:new p.UniformMatrix4f(f),u_lightpos:new p.Uniform3f(f),u_lightintensity:new p.Uniform1f(f),u_lightcolor:new p.Uniform3f(f),u_vertical_gradient:new p.Uniform1f(f),u_opacity:new p.Uniform1f(f),u_edge_radius:new p.Uniform1f(f),u_ao:new p.Uniform2f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_up_dir:new p.Uniform3f(f),u_height_lift:new p.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new p.UniformMatrix4f(f),u_lightpos:new p.Uniform3f(f),u_lightintensity:new p.Uniform1f(f),u_lightcolor:new p.Uniform3f(f),u_vertical_gradient:new p.Uniform1f(f),u_height_factor:new p.Uniform1f(f),u_edge_radius:new p.Uniform1f(f),u_ao:new p.Uniform2f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_up_dir:new p.Uniform3f(f),u_height_lift:new p.Uniform1f(f),u_image:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_pixel_coord_upper:new p.Uniform2f(f),u_pixel_coord_lower:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f),u_opacity:new p.Uniform1f(f)}),fill:f=>({u_matrix:new p.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new p.UniformMatrix4f(f),u_image:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_pixel_coord_upper:new p.Uniform2f(f),u_pixel_coord_lower:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f)}),fillOutline:f=>({u_matrix:new p.UniformMatrix4f(f),u_world:new p.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new p.UniformMatrix4f(f),u_world:new p.Uniform2f(f),u_image:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_pixel_coord_upper:new p.Uniform2f(f),u_pixel_coord_lower:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new p.Uniform1f(f),u_extrude_scale:new p.UniformMatrix2f(f),u_device_pixel_ratio:new p.Uniform1f(f),u_matrix:new p.UniformMatrix4f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_up_dir:new p.Uniform3f(f)}),collisionBox:f=>({u_matrix:new p.UniformMatrix4f(f),u_camera_to_center_distance:new p.Uniform1f(f),u_extrude_scale:new p.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new p.UniformMatrix4f(f),u_inv_matrix:new p.UniformMatrix4f(f),u_camera_to_center_distance:new p.Uniform1f(f),u_viewport_size:new p.Uniform2f(f)}),debug:f=>({u_color:new p.UniformColor(f),u_matrix:new p.UniformMatrix4f(f),u_overlay:new p.Uniform1i(f),u_overlay_scale:new p.Uniform1f(f)}),clippingMask:f=>({u_matrix:new p.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new p.Uniform1f(f),u_intensity:new p.Uniform1f(f),u_matrix:new p.UniformMatrix4f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_up_dir:new p.Uniform3f(f)}),heatmapTexture:f=>({u_image:new p.Uniform1i(f),u_color_ramp:new p.Uniform1i(f),u_opacity:new p.Uniform1f(f)}),hillshade:f=>({u_matrix:new p.UniformMatrix4f(f),u_image:new p.Uniform1i(f),u_latrange:new p.Uniform2f(f),u_light:new p.Uniform2f(f),u_shadow:new p.UniformColor(f),u_highlight:new p.UniformColor(f),u_accent:new p.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new p.UniformMatrix4f(f),u_image:new p.Uniform1i(f),u_dimension:new p.Uniform2f(f),u_zoom:new p.Uniform1f(f),u_unpack:new p.Uniform4f(f)}),line:f=>({u_matrix:new p.UniformMatrix4f(f),u_pixels_to_tile_units:new p.UniformMatrix2f(f),u_device_pixel_ratio:new p.Uniform1f(f),u_units_to_pixels:new p.Uniform2f(f),u_dash_image:new p.Uniform1i(f),u_gradient_image:new p.Uniform1i(f),u_image_height:new p.Uniform1f(f),u_texsize:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f),u_alpha_discard_threshold:new p.Uniform1f(f),u_trim_offset:new p.Uniform2f(f)}),linePattern:f=>({u_matrix:new p.UniformMatrix4f(f),u_texsize:new p.Uniform2f(f),u_pixels_to_tile_units:new p.UniformMatrix2f(f),u_device_pixel_ratio:new p.Uniform1f(f),u_image:new p.Uniform1i(f),u_units_to_pixels:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f),u_alpha_discard_threshold:new p.Uniform1f(f)}),raster:f=>({u_matrix:new p.UniformMatrix4f(f),u_tl_parent:new p.Uniform2f(f),u_scale_parent:new p.Uniform1f(f),u_fade_t:new p.Uniform1f(f),u_opacity:new p.Uniform1f(f),u_image0:new p.Uniform1i(f),u_image1:new p.Uniform1i(f),u_brightness_low:new p.Uniform1f(f),u_brightness_high:new p.Uniform1f(f),u_saturation_factor:new p.Uniform1f(f),u_contrast_factor:new p.Uniform1f(f),u_spin_weights:new p.Uniform3f(f),u_perspective_transform:new p.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new p.Uniform1i(f),u_is_size_feature_constant:new p.Uniform1i(f),u_size_t:new p.Uniform1f(f),u_size:new p.Uniform1f(f),u_camera_to_center_distance:new p.Uniform1f(f),u_rotate_symbol:new p.Uniform1i(f),u_aspect_ratio:new p.Uniform1f(f),u_fade_change:new p.Uniform1f(f),u_matrix:new p.UniformMatrix4f(f),u_label_plane_matrix:new p.UniformMatrix4f(f),u_coord_matrix:new p.UniformMatrix4f(f),u_is_text:new p.Uniform1i(f),u_pitch_with_map:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_camera_forward:new p.Uniform3f(f),u_tile_matrix:new p.UniformMatrix4f(f),u_up_vector:new p.Uniform3f(f),u_ecef_origin:new p.Uniform3f(f),u_texture:new p.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new p.Uniform1i(f),u_is_size_feature_constant:new p.Uniform1i(f),u_size_t:new p.Uniform1f(f),u_size:new p.Uniform1f(f),u_camera_to_center_distance:new p.Uniform1f(f),u_rotate_symbol:new p.Uniform1i(f),u_aspect_ratio:new p.Uniform1f(f),u_fade_change:new p.Uniform1f(f),u_matrix:new p.UniformMatrix4f(f),u_label_plane_matrix:new p.UniformMatrix4f(f),u_coord_matrix:new p.UniformMatrix4f(f),u_is_text:new p.Uniform1i(f),u_pitch_with_map:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_texture:new p.Uniform1i(f),u_gamma_scale:new p.Uniform1f(f),u_device_pixel_ratio:new p.Uniform1f(f),u_tile_id:new p.Uniform3f(f),u_zoom_transition:new p.Uniform1f(f),u_inv_rot_matrix:new p.UniformMatrix4f(f),u_merc_center:new p.Uniform2f(f),u_camera_forward:new p.Uniform3f(f),u_tile_matrix:new p.UniformMatrix4f(f),u_up_vector:new p.Uniform3f(f),u_ecef_origin:new p.Uniform3f(f),u_is_halo:new p.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new p.Uniform1i(f),u_is_size_feature_constant:new p.Uniform1i(f),u_size_t:new p.Uniform1f(f),u_size:new p.Uniform1f(f),u_camera_to_center_distance:new p.Uniform1f(f),u_rotate_symbol:new p.Uniform1i(f),u_aspect_ratio:new p.Uniform1f(f),u_fade_change:new p.Uniform1f(f),u_matrix:new p.UniformMatrix4f(f),u_label_plane_matrix:new p.UniformMatrix4f(f),u_coord_matrix:new p.UniformMatrix4f(f),u_is_text:new p.Uniform1i(f),u_pitch_with_map:new p.Uniform1i(f),u_texsize:new p.Uniform2f(f),u_texsize_icon:new p.Uniform2f(f),u_texture:new p.Uniform1i(f),u_texture_icon:new p.Uniform1i(f),u_gamma_scale:new p.Uniform1f(f),u_device_pixel_ratio:new p.Uniform1f(f),u_is_halo:new p.Uniform1i(f)}),background:f=>({u_matrix:new p.UniformMatrix4f(f),u_opacity:new p.Uniform1f(f),u_color:new p.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new p.UniformMatrix4f(f),u_opacity:new p.Uniform1f(f),u_image:new p.Uniform1i(f),u_pattern_tl:new p.Uniform2f(f),u_pattern_br:new p.Uniform2f(f),u_texsize:new p.Uniform2f(f),u_pattern_size:new p.Uniform2f(f),u_pixel_coord_upper:new p.Uniform2f(f),u_pixel_coord_lower:new p.Uniform2f(f),u_tile_units_to_pixels:new p.Uniform1f(f)}),terrainRaster:$h,terrainDepth:$h,skybox:f=>({u_matrix:new p.UniformMatrix4f(f),u_sun_direction:new p.Uniform3f(f),u_cubemap:new p.Uniform1i(f),u_opacity:new p.Uniform1f(f),u_temporal_offset:new p.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new p.UniformMatrix4f(f),u_color_ramp:new p.Uniform1i(f),u_center_direction:new p.Uniform3f(f),u_radius:new p.Uniform1f(f),u_opacity:new p.Uniform1f(f),u_temporal_offset:new p.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new p.UniformMatrix3f(f),u_sun_direction:new p.Uniform3f(f),u_sun_intensity:new p.Uniform1f(f),u_color_tint_r:new p.Uniform4f(f),u_color_tint_m:new p.Uniform4f(f),u_luminance:new p.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new p.UniformMatrix4f(f),u_globe_matrix:new p.UniformMatrix4f(f),u_normalize_matrix:new p.UniformMatrix4f(f),u_merc_matrix:new p.UniformMatrix4f(f),u_zoom_transition:new p.Uniform1f(f),u_merc_center:new p.Uniform2f(f),u_image0:new p.Uniform1i(f),u_grid_matrix:new p.UniformMatrix3f(f),u_skirt_height:new p.Uniform1f(f),u_frustum_tl:new p.Uniform3f(f),u_frustum_tr:new p.Uniform3f(f),u_frustum_br:new p.Uniform3f(f),u_frustum_bl:new p.Uniform3f(f),u_globe_pos:new p.Uniform3f(f),u_globe_radius:new p.Uniform1f(f),u_viewport:new p.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new p.Uniform3f(f),u_frustum_tr:new p.Uniform3f(f),u_frustum_br:new p.Uniform3f(f),u_frustum_bl:new p.Uniform3f(f),u_horizon:new p.Uniform1f(f),u_transition:new p.Uniform1f(f),u_fadeout_range:new p.Uniform1f(f),u_color:new p.Uniform4f(f),u_high_color:new p.Uniform4f(f),u_space_color:new p.Uniform4f(f),u_star_intensity:new p.Uniform1f(f),u_star_density:new p.Uniform1f(f),u_star_size:new p.Uniform1f(f),u_temporal_offset:new p.Uniform1f(f),u_horizon_angle:new p.Uniform1f(f),u_rotation_matrix:new p.UniformMatrix4f(f)})};let po;function xt(f,a,u,g,v,b,I){const T=f.context,S=T.gl,F=f.transform,O=f.useProgram("collisionBox"),z=[];let $=0,Q=0;for(let te=0;te<g.length;te++){const de=g[te],fe=a.getTile(de),pe=fe.getBucket(u);if(!pe)continue;const ye=rt(de,pe,F);let _e=ye;0===v[0]&&0===v[1]||(_e=f.translatePosMatrix(ye,fe,v,b));const Me=I?pe.textCollisionBox:pe.iconCollisionBox,We=pe.collisionCircleArray;if(We.length>0){const Ee=p.create(),Be=_e;p.mul(Ee,pe.placementInvProjMatrix,F.glCoordMatrix),p.mul(Ee,Ee,pe.placementViewportMatrix),z.push({circleArray:We,circleOffset:Q,transform:Be,invTransform:Ee,projection:pe.getProjection()}),$+=We.length/4,Q=$}Me&&(f.terrain&&f.terrain.setupElevationDraw(fe,O),O.draw(T,S.LINES,p.DepthMode.disabled,p.StencilMode.disabled,f.colorModeForRenderPass(),p.CullFaceMode.disabled,Xh(_e,F,fe,pe.getProjection()),u.id,Me.layoutVertexBuffer,Me.indexBuffer,Me.segments,null,F.zoom,null,[Me.collisionVertexBuffer,Me.collisionVertexBufferExt]))}if(!I||!z.length)return;const K=f.useProgram("collisionCircle"),X=new p.StructArrayLayout2f1f2i16;X.resize(4*$),X._trim();let ee=0;for(const te of z)for(let de=0;de<te.circleArray.length/4;de++){const fe=4*de,pe=te.circleArray[fe+0],ye=te.circleArray[fe+1],_e=te.circleArray[fe+2],Me=te.circleArray[fe+3];X.emplace(ee++,pe,ye,_e,Me,0),X.emplace(ee++,pe,ye,_e,Me,1),X.emplace(ee++,pe,ye,_e,Me,2),X.emplace(ee++,pe,ye,_e,Me,3)}(!po||po.length<2*$)&&(po=function(te){const de=2*te,fe=new p.StructArrayLayout3ui6;fe.resize(de),fe._trim();for(let pe=0;pe<de;pe++){const ye=6*pe;fe.uint16[ye+0]=4*pe+0,fe.uint16[ye+1]=4*pe+1,fe.uint16[ye+2]=4*pe+2,fe.uint16[ye+3]=4*pe+2,fe.uint16[ye+4]=4*pe+3,fe.uint16[ye+5]=4*pe+0}return fe}($));const V=T.createIndexBuffer(po,!0),W=T.createVertexBuffer(X,p.collisionCircleLayout.members,!0);for(const te of z){const de={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ne=F).getCameraToCenterDistance(te.projection),u_viewport_size:[ne.width,ne.height]};K.draw(T,S.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,f.colorModeForRenderPass(),p.CullFaceMode.disabled,de,u.id,W,V,p.SegmentVector.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,F.zoom)}var ne;W.destroy(),V.destroy()}const un=p.create();function ci({width:f,height:a,anchor:u,textOffset:g,textScale:v},b){const{horizontalAlign:I,verticalAlign:T}=p.getAnchorAlignment(u),S=-(I-.5)*f,F=-(T-.5)*a,O=p.evaluateVariableOffset(u,g);return new p.Point((S/v+O[0])*b,(F/v+O[1])*b)}function Oo(f,a,u,g,v,b,I,T,S,F,O){const z=f.text.placedSymbolArray,$=f.text.dynamicLayoutVertexArray,Q=f.icon.dynamicLayoutVertexArray,K={},X=f.getProjection(),ee=Wn(T,X,b),V=b.elevation,W=X.upVectorScale(T.canonical,b.center.lat,b.worldSize).metersToTile;$.clear();for(let ne=0;ne<z.length;ne++){const te=z.get(ne),{tileAnchorX:de,tileAnchorY:fe,numGlyphs:pe}=te,ye=te.hidden||!te.crossTileID||f.allowVerticalPlacement&&!te.placedOrientation?null:g[te.crossTileID];if(ye){let _e=0,Me=0,We=0;if(V){const et=V?V.getAtTileOffset(T,de,fe):0,[Ct,Nt,_t]=X.upVector(T.canonical,de,fe);_e=et*Ct*W,Me=et*Nt*W,We=et*_t*W}let[Ee,Be,De,Ze]=An(te.projectedAnchorX+_e,te.projectedAnchorY+Me,te.projectedAnchorZ+We,u?ee:I);const Ie=rp(b.getCameraToCenterDistance(X),Ze);let Fe=v.evaluateSizeForFeature(f.textSizeData,F,te)*Ie/p.ONE_EM;u&&(Fe*=f.tilePixelRatio/S);const Qe=ci(ye,Fe);u?(({x:Ee,y:Be,z:De}=X.projectTilePoint(de+Qe.x,fe+Qe.y,T.canonical)),[Ee,Be,De]=An(Ee+_e,Be+Me,De+We,I)):(a&&Qe._rotate(-b.angle),Ee+=Qe.x,Be+=Qe.y,De=0);const Ue=f.allowVerticalPlacement&&te.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let et=0;et<pe;et++)p.addDynamicAttributes($,Ee,Be,De,Ue);O&&te.associatedIconIndex>=0&&(K[te.associatedIconIndex]={x:Ee,y:Be,z:De,angle:Ue})}else kt(pe,$)}if(O){Q.clear();const ne=f.icon.placedSymbolArray;for(let te=0;te<ne.length;te++){const de=ne.get(te),{numGlyphs:fe}=de,pe=K[te];if(de.hidden||!pe)kt(fe,Q);else{const{x:ye,y:_e,z:Me,angle:We}=pe;for(let Ee=0;Ee<fe;Ee++)p.addDynamicAttributes(Q,ye,_e,Me,We)}}f.icon.dynamicLayoutVertexBuffer.updateData(Q)}f.text.dynamicLayoutVertexBuffer.updateData($)}function Ss(f,a,u){return u.iconsInText&&a?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function rr(f,a,u,g,v,b,I,T,S,F,O,z){const $=f.context,Q=$.gl,K=f.transform,X="map"===T,ee="map"===S,V=X&&"point"!==u.layout.get("symbol-placement"),W=X&&!ee&&!V,ne=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let te=!1;const de=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),fe=[p.mercatorXfromLng(K.center.lng),p.mercatorYfromLat(K.center.lat)],pe=u.layout.get("text-variable-anchor"),ye="globe"===K.projection.name,_e=[],Me=[0,-1,0];let We=Me;!ye&&!K.mercatorFromTransition||X||(We=function(Ee){const Be=Ee._camera.getWorldToCamera(Ee.worldSize,1),De=p.multiply([],Be,Ee.globeMatrix);p.invert(De,De);const Ze=[0,0,0],Ie=[0,1,0,0];return p.transformMat4$1(Ie,Ie,De),Ze[0]=Ie[0],Ze[1]=Ie[1],Ze[2]=Ie[2],p.normalize(Ze,Ze),Ze}(K));for(const Ee of g){const Be=a.getTile(Ee),De=Be.getBucket(u);if(!De||"mercator"===De.projection.name&&ye)continue;const Ze=v?De.text:De.icon;if(!Ze||De.fullyClipped||!Ze.segments.get().length)continue;const Ie=Ze.programConfigurations.get(u.id),Fe=v||De.sdfIcons,Qe=v?De.textSizeData:De.iconSizeData,Ue=ee||0!==K.pitch,et=p.evaluateSizeForZoom(Qe,K.zoom);let Ct,Nt,_t,Dt,hn=[0,0],ln=null;if(v)Nt=Be.glyphAtlasTexture,_t=Q.LINEAR,Ct=Be.glyphAtlasTexture.size,De.iconsInText&&(hn=Be.imageAtlasTexture.size,ln=Be.imageAtlasTexture,Dt=Ue||f.options.rotating||f.options.zooming||"composite"===Qe.kind||"camera"===Qe.kind?Q.LINEAR:Q.NEAREST);else{const ds=1!==u.layout.get("icon-size").constantOr(0)||De.iconsNeedLinear;Nt=Be.imageAtlasTexture,_t=Fe||f.options.rotating||f.options.zooming||ds||Ue?Q.LINEAR:Q.NEAREST,Ct=Be.imageAtlasTexture.size}const wt="globe"===De.projection.name,Dn=wt?We:Me,Vn=wt?p.globeToMercatorTransition(K.zoom):0,Sn=Wn(Ee,De.getProjection(),K),jn=K.calculatePixelsToTileUnitsMatrix(Be),or=Oe(Sn,Be.tileID.canonical,ee,X,K,De.getProjection(),jn),Ti=f.terrain&&ee&&V?p.invert(p.create(),or):un,mo=Ei(Sn,Be.tileID.canonical,ee,X,K,De.getProjection(),jn),to=pe&&De.hasTextData(),Xn="none"!==u.layout.get("icon-text-fit")&&to&&De.hasIconData();if(V){const ds=K.elevation,ps=ds?ds.getAtTileOffsetFunc(Ee,K.center.lat,K.worldSize,De.getProjection()):null,Rs=Ms(Sn,Be.tileID.canonical,ee,X,K,De.getProjection(),jn);uc(De,Sn,f,v,Rs,mo,ee,F,ps,Ee)}const Fn=V||v&&pe||Xn,kn=f.translatePosMatrix(Sn,Be,b,I),xi=Fn?un:or,br=f.translatePosMatrix(mo,Be,b,I,!0),ti=De.getProjection().createInversionMatrix(K,Ee.canonical),mi=[];f.terrainRenderModeElevated()&&ee&&mi.push("PITCH_WITH_MAP_TERRAIN"),wt&&mi.push("PROJECTION_GLOBE_VIEW"),Fn&&mi.push("PROJECTED_POS_ON_VIEWPORT");const Uu=Fe&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let hs;hs=Fe?De.iconsInText?qr(Qe.kind,et,W,ee,f,kn,xi,br,Ct,hn,Ee,Vn,fe,ti,Dn,De.getProjection()):Ds(Qe.kind,et,W,ee,f,kn,xi,br,v,Ct,!0,Ee,Vn,fe,ti,Dn,De.getProjection()):vr(Qe.kind,et,W,ee,f,kn,xi,br,v,Ct,Ee,Vn,fe,ti,Dn,De.getProjection());const $a={program:f.useProgram(Ss(Fe,v,De),Ie,mi),buffers:Ze,uniformValues:hs,atlasTexture:Nt,atlasTextureIcon:ln,atlasInterpolation:_t,atlasInterpolationIcon:Dt,isSDF:Fe,hasHalo:Uu,tile:Be,labelPlaneMatrixInv:Ti};if(ne&&De.canOverlap){te=!0;const ds=Ze.segments.get();for(const ps of ds)_e.push({segments:new p.SegmentVector([ps]),sortKey:ps.sortKey,state:$a})}else _e.push({segments:Ze.segments,sortKey:0,state:$a})}te&&_e.sort((Ee,Be)=>Ee.sortKey-Be.sortKey);for(const Ee of _e){const Be=Ee.state;if(f.terrain&&f.terrain.setupElevationDraw(Be.tile,Be.program,{useDepthForOcclusion:!ye,labelPlaneMatrixInv:Be.labelPlaneMatrixInv}),$.activeTexture.set(Q.TEXTURE0),Be.atlasTexture.bind(Be.atlasInterpolation,Q.CLAMP_TO_EDGE),Be.atlasTextureIcon&&($.activeTexture.set(Q.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,Q.CLAMP_TO_EDGE)),Be.isSDF){const De=Be.uniformValues;Be.hasHalo&&(De.u_is_halo=1,as(Be.buffers,Ee.segments,u,f,Be.program,de,O,z,De)),De.u_is_halo=0}as(Be.buffers,Ee.segments,u,f,Be.program,de,O,z,Be.uniformValues)}}function as(f,a,u,g,v,b,I,T,S){const F=g.context,O=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];v.draw(F,F.gl.TRIANGLES,b,I,T,p.CullFaceMode.disabled,S,u.id,f.layoutVertexBuffer,f.indexBuffer,a,u.paint,g.transform.zoom,f.programConfigurations.get(u.id),O)}function Ai(f,a,u,g,v,b,I){const T=f.context.gl,S=u.paint.get("fill-pattern"),F=S&&S.constantOr(1);let O,z,$,Q,K;I?(z=F&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=T.LINES):(z=F?"fillPattern":"fill",O=T.TRIANGLES);for(const X of g){const ee=a.getTile(X);if(F&&!ee.patternsLoaded())continue;const V=ee.getBucket(u);if(!V)continue;f.prepareDrawTile();const W=V.programConfigurations.get(u.id),ne=f.useProgram(z,W);F&&(f.context.activeTexture.set(T.TEXTURE0),ee.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),W.updatePaintBuffers());const te=S.constantOr(null);if(te&&ee.imageAtlas){const fe=ee.imageAtlas.patternPositions[te.toString()];fe&&W.setConstantPatternPositions(fe)}const de=f.translatePosMatrix(X.projMatrix,ee,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(I){Q=V.indexBuffer2,K=V.segments2;const fe=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];$="fillOutlinePattern"===z&&F?Qh(de,f,ee,fe):Zh(de,fe)}else Q=V.indexBuffer,K=V.segments,$=F?Cl(de,f,ee):bn(de);f.prepareDrawProgram(f.context,ne,X.toUnwrapped()),ne.draw(f.context,O,v,f.stencilModeForClipping(X),b,p.CullFaceMode.disabled,$,u.id,V.layoutVertexBuffer,Q,K,u.paint,f.transform.zoom,W)}}function ja(f,a,u,g,v,b,I){const T=f.context,S=T.gl,F=f.transform,O=u.paint.get("fill-extrusion-pattern"),z=O.constantOr(1),$=u.paint.get("fill-extrusion-opacity"),Q=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],K=u.layout.get("fill-extrusion-edge-radius"),X=K>0&&!u.paint.get("fill-extrusion-rounded-roof"),ee=X?0:K,V="globe"===F.projection.name?p.fillExtrusionHeightLift():0,W="globe"===F.projection.name,ne=W?p.globeToMercatorTransition(F.zoom):0,te=[p.mercatorXfromLng(F.center.lng),p.mercatorYfromLat(F.center.lat)],de=[];W&&de.push("PROJECTION_GLOBE_VIEW"),Q[0]>0&&de.push("FAUX_AO"),X&&de.push("ZERO_ROOF_RADIUS");for(const fe of g){const pe=a.getTile(fe),ye=pe.getBucket(u);if(!ye||ye.projection.name!==F.projection.name)continue;const _e=ye.programConfigurations.get(u.id),Me=f.useProgram(z?"fillExtrusionPattern":"fillExtrusion",_e,de);if(f.terrain){const Fe=f.terrain;if(f.style.terrainSetForDrapingOnly())Fe.setupElevationDraw(pe,Me,{useMeterToDem:!0});else{if(!ye.enableTerrain)continue;if(Fe.setupElevationDraw(pe,Me,{useMeterToDem:!0}),Ac(T,a,fe,ye,u,Fe),!ye.centroidVertexBuffer){const Qe=Me.attributes.a_centroid_pos;void 0!==Qe&&S.vertexAttrib2f(Qe,0,0)}}}z&&(f.context.activeTexture.set(S.TEXTURE0),pe.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),_e.updatePaintBuffers());const We=O.constantOr(null);if(We&&pe.imageAtlas){const Fe=pe.imageAtlas.patternPositions[We.toString()];Fe&&_e.setConstantPatternPositions(Fe)}const Ee=f.translatePosMatrix(fe.projMatrix,pe,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Be=F.projection.createInversionMatrix(F,fe.canonical),De=u.paint.get("fill-extrusion-vertical-gradient"),Ze=z?ss(Ee,f,De,$,Q,ee,fe,pe,V,ne,te,Be):ho(Ee,f,De,$,Q,ee,fe,V,ne,te,Be);f.prepareDrawProgram(T,Me,fe.toUnwrapped());const Ie=[];f.terrain&&Ie.push(ye.centroidVertexBuffer),W&&Ie.push(ye.layoutVertexExtBuffer),Me.draw(T,T.gl.TRIANGLES,v,b,I,p.CullFaceMode.backCCW,Ze,u.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,u.paint,f.transform.zoom,_e,Ie)}}function Ac(f,a,u,g,v,b){const I=[V=>{let W=V.canonical.x-1,ne=V.wrap;return W<0&&(W=(1<<V.canonical.z)-1,ne--),new p.OverscaledTileID(V.overscaledZ,ne,V.canonical.z,W,V.canonical.y)},V=>{let W=V.canonical.x+1,ne=V.wrap;return W===1<<V.canonical.z&&(W=0,ne++),new p.OverscaledTileID(V.overscaledZ,ne,V.canonical.z,W,V.canonical.y)},V=>new p.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,(0===V.canonical.y?1<<V.canonical.z:V.canonical.y)-1),V=>new p.OverscaledTileID(V.overscaledZ,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y===(1<<V.canonical.z)-1?0:V.canonical.y+1)],T=V=>{const W=a.getSource().minzoom,ne=de=>{const fe=a.getTileByID(de);if(fe&&fe.hasData())return fe.getBucket(v)},te=[0,-1,1];for(const de of te){if(V.overscaledZ+de<W)continue;const fe=ne(V.calculateScaledKey(V.overscaledZ+de));if(fe)return fe}},S=[0,0,0],F=(V,W)=>(S[0]=Math.min(V.min.y,W.min.y),S[1]=Math.max(V.max.y,W.max.y),S[2]=p.EXTENT-W.min.x>V.max.x?W.min.x-p.EXTENT:V.max.x,S),O=(V,W)=>(S[0]=Math.min(V.min.x,W.min.x),S[1]=Math.max(V.max.x,W.max.x),S[2]=p.EXTENT-W.min.y>V.max.y?W.min.y-p.EXTENT:V.max.y,S),z=[(V,W)=>F(V,W),(V,W)=>F(W,V),(V,W)=>O(V,W),(V,W)=>O(W,V)],$=new p.Point(0,0);let Q,K,X;const ee=(V,W,ne,te,de)=>{const fe=[[te?ne:V,te?V:ne,0],[te?ne:W,te?W:ne,0]],pe=de<0?p.EXTENT+de:de,ye=[te?pe:(V+W)/2,te?(V+W)/2:pe,0];return 0===ne&&de<0||0!==ne&&de>0?b.getForTilePoints(X,[ye],!0,K):fe.push(ye),b.getForTilePoints(u,fe,!0,Q),Math.max(fe[0][2],fe[1][2],ye[2])/b.exaggeration()};for(let V=0;V<4;V++){const W=(V<2?1:5)-V,ne=g.borders[V];if(0===ne.length)continue;const te=X=I[V](u),de=T(te);if(!(de&&de instanceof p.FillExtrusionBucket&&de.enableTerrain)||g.borderDoneWithNeighborZ[V]===de.canonical.z&&de.borderDoneWithNeighborZ[W]===g.canonical.z||(K=b.findDEMTileFor(te),!K||!K.dem))continue;if(!Q){const _e=b.findDEMTileFor(u);if(!_e||!_e.dem)return;Q=_e}const fe=de.borders[W];let pe=0;const ye=de.borderDoneWithNeighborZ[W]!==g.canonical.z;if(g.canonical.z===de.canonical.z){for(let _e=0;_e<ne.length;_e++){const Me=g.featuresOnBorder[ne[_e]],We=Me.borders[V];let Ee;for(;pe<fe.length&&(Ee=de.featuresOnBorder[fe[pe]],!(Ee.borders[W][1]>We[0]+3));)ye&&de.encodeCentroid(void 0,Ee,!1),pe++;if(Ee&&pe<fe.length){const Be=pe;let De=0;for(;!(Ee.borders[W][0]>We[1]-3)&&(De++,++pe!==fe.length);)Ee=de.featuresOnBorder[fe[pe]];if(Ee=de.featuresOnBorder[fe[Be]],Me.intersectsCount()>1||Ee.intersectsCount()>1||1!==De){1!==De&&(pe=Be),g.encodeCentroid(void 0,Me,!1),ye&&de.encodeCentroid(void 0,Ee,!1);continue}const Ze=z[V](Me,Ee),Ie=V%2?p.EXTENT-1:0;$.x=ee(Ze[0],Math.min(p.EXTENT-1,Ze[1]),Ie,V<2,Ze[2]),$.y=0,g.encodeCentroid($,Me,!1),ye&&de.encodeCentroid($,Ee,!1)}else g.encodeCentroid(void 0,Me,!1)}g.borderDoneWithNeighborZ[V]=de.canonical.z,g.needsCentroidUpdate=!0,ye&&(de.borderDoneWithNeighborZ[W]=g.canonical.z,de.needsCentroidUpdate=!0)}else{for(const _e of ne)g.encodeCentroid(void 0,g.featuresOnBorder[_e],!1);if(ye){for(const _e of fe)de.encodeCentroid(void 0,de.featuresOnBorder[_e],!1);de.borderDoneWithNeighborZ[W]=g.canonical.z,de.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[V]=de.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(f)}const en=new p.Color(1,0,0,1),Yh=new p.Color(0,1,0,1),xc=new p.Color(0,0,1,1),pp=new p.Color(1,0,1,1),Ml=new p.Color(0,1,1,1);function Ar(f,a,u){const g=f.context,v=f.transform,b=g.gl,I="globe"===v.projection.name,T=I?["PROJECTION_GLOBE_VIEW"]:null;let S=u.projMatrix;if(I&&p.globeToMercatorTransition(v.zoom)>0){const Me=p.transitionTileAABBinECEF(u.canonical,v),We=p.globeDenormalizeECEF(Me);S=p.multiply(new Float32Array(16),v.globeMatrix,We),p.multiply(S,v.projMatrix,S)}const F=f.useProgram("debug",null,T),O=a.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(O,F);const z=p.DepthMode.disabled,$=p.StencilMode.disabled,Q=f.colorModeForRenderPass(),K="$debug";g.activeTexture.set(b.TEXTURE0),f.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),I?O._makeGlobeTileDebugBuffers(f.context,v):O._makeDebugTileBoundsBuffers(f.context,v.projection);const X=O._tileDebugBuffer||f.debugBuffer,ee=O._tileDebugIndexBuffer||f.debugIndexBuffer,V=O._tileDebugSegments||f.debugSegments;F.draw(g,b.LINE_STRIP,z,$,Q,p.CullFaceMode.disabled,_r(S,p.Color.red),K,X,ee,V,null,null,null,[O._globeTileDebugBorderBuffer]);const W=O.latestRawTileData,ne=Math.floor((W&&W.byteLength||0)/1024),te=a.getTile(u).tileSize,de=512/Math.min(te,512)*(u.overscaledZ/v.zoom)*.5;let fe=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(fe+=` => ${u.overscaledZ}`),fe+=` ${ne}kb`,function(Me,We){Me.initDebugOverlayCanvas();const Ee=Me.debugOverlayCanvas,Be=Me.context.gl,De=Me.debugOverlayCanvas.getContext("2d");De.clearRect(0,0,Ee.width,Ee.height),De.shadowColor="white",De.shadowBlur=2,De.lineWidth=1.5,De.strokeStyle="white",De.textBaseline="top",De.font="bold 36px Open Sans, sans-serif",De.fillText(We,5,5),De.strokeText(We,5,5),Me.debugOverlayTexture.update(Ee),Me.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(f,fe);const pe=O._tileDebugTextBuffer||f.debugBuffer,ye=O._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,_e=O._tileDebugTextSegments||f.debugSegments;F.draw(g,b.TRIANGLES,z,$,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,_r(S,p.Color.transparent,de),K,pe,ye,_e,null,null,null,[O._globeTileDebugTextBuffer])}function Tl(f,a,u,g){Rr(f,0,a+u/2,f.transform.width,u,g)}function ks(f,a,u,g){Rr(f,a-u/2,0,u,f.transform.height,g)}function Rr(f,a,u,g,v,b){const I=f.context,T=I.gl;T.enable(T.SCISSOR_TEST),T.scissor(a*p.exported.devicePixelRatio,u*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,v*p.exported.devicePixelRatio),I.clear({color:b}),T.disable(T.SCISSOR_TEST)}const Dl=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Jh}=Dl;function On(f,a,u,g){f.emplaceBack(a,u,g)}class ed{constructor(a){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,On(this.vertexArray,-1,-1,1),On(this.vertexArray,1,-1,1),On(this.vertexArray,-1,1,1),On(this.vertexArray,1,1,1),On(this.vertexArray,-1,-1,-1),On(this.vertexArray,1,-1,-1),On(this.vertexArray,-1,1,-1),On(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=a.createVertexBuffer(this.vertexArray,Jh),this.indexBuffer=a.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function Wr(f,a,u,g,v,b){const I=f.gl,T=a.paint.get("sky-atmosphere-color"),S=a.paint.get("sky-atmosphere-halo-color"),F=a.paint.get("sky-atmosphere-sun-intensity"),O={u_matrix_3f:p.fromMat4(p.create$1(),g),u_sun_direction:v,u_sun_intensity:F,u_color_tint_r:[(K=T).r,K.g,K.b,K.a],u_color_tint_m:[(X=S).r,X.g,X.b,X.a],u_luminance:5e-5};var K,X;I.framebufferTexture2D(I.FRAMEBUFFER,I.COLOR_ATTACHMENT0,I.TEXTURE_CUBE_MAP_POSITIVE_X+b,a.skyboxTexture,0),u.draw(f,I.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,O,"skyboxCapture",a.skyboxGeometry.vertexBuffer,a.skyboxGeometry.indexBuffer,a.skyboxGeometry.segment)}const Sl=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bc{constructor(a){const u=new p.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new p.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=a.createVertexBuffer(u,Sl.members),this.indexBuffer=a.createIndexBuffer(g),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ls={symbol:function(f,a,u,g,v){if("translucent"!==f.renderPass)return;const b=p.StencilMode.disabled,I=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(T,S,F,O,z,$,Q){const K=S.transform,X="map"===z,ee="map"===$;for(const V of T){const W=O.getTile(V),ne=W.getBucket(F);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const te=p.evaluateSizeForZoom(ne.textSizeData,K.zoom),de=Wn(V,ne.getProjection(),K),fe=K.calculatePixelsToTileUnitsMatrix(W),pe=Oe(de,W.tileID.canonical,ee,X,K,ne.getProjection(),fe),ye="none"!==F.layout.get("icon-text-fit")&&ne.hasIconData();if(te){const _e=Math.pow(2,K.zoom-W.tileID.overscaledZ);Oo(ne,X,ee,Q,p.symbolSize,K,pe,V,_e,te,ye)}}}(g,f,u,a,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&rr(f,a,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,I),0!==u.paint.get("text-opacity").constantOr(1)&&rr(f,a,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,I),a.map.showCollisionBoxes&&(xt(f,a,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),xt(f,a,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,a,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),I=u.paint.get("circle-stroke-opacity"),T=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===I.constantOr(1)))return;const S=f.context,F=S.gl,O=f.transform,z=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),$=p.StencilMode.disabled,Q=f.colorModeForRenderPass(),K="globe"===O.projection.name,X=[p.mercatorXfromLng(O.center.lng),p.mercatorYfromLat(O.center.lat)],ee=[];for(let W=0;W<g.length;W++){const ne=g[W],te=a.getTile(ne),de=te.getBucket(u);if(!de||de.projection.name!==O.projection.name)continue;const fe=de.programConfigurations.get(u.id),pe=Va(u);K&&pe.push("PROJECTION_GLOBE_VIEW");const ye=f.useProgram("circle",fe,pe),_e=de.layoutVertexBuffer,Me=de.globeExtVertexBuffer,We=de.indexBuffer,Ee=O.projection.createInversionMatrix(O,ne.canonical),Be={programConfiguration:fe,program:ye,layoutVertexBuffer:_e,globeExtVertexBuffer:Me,indexBuffer:We,uniformValues:Ro(f,ne,te,Ee,X,u),tile:te};if(T){const De=de.segments.get();for(const Ze of De)ee.push({segments:new p.SegmentVector([Ze]),sortKey:Ze.sortKey,state:Be})}else ee.push({segments:de.segments,sortKey:0,state:Be})}T&&ee.sort((W,ne)=>W.sortKey-ne.sortKey);const V={useDepthForOcclusion:!K};for(const W of ee){const{programConfiguration:ne,program:te,layoutVertexBuffer:de,globeExtVertexBuffer:fe,indexBuffer:pe,uniformValues:ye,tile:_e}=W.state,Me=W.segments;f.terrain&&f.terrain.setupElevationDraw(_e,te,V),f.prepareDrawProgram(S,te,_e.tileID.toUnwrapped()),te.draw(S,F.TRIANGLES,z,$,Q,p.CullFaceMode.disabled,ye,u.id,de,pe,Me,u.paint,O.zoom,ne,[fe])}},heatmap:function(f,a,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const v=f.context,b=v.gl,I=p.StencilMode.disabled,T=new p.ColorMode([b.ONE,b.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Q,K,X,ee){const V=Q.gl,W=K.width*ee,ne=K.height*ee;Q.activeTexture.set(V.TEXTURE1),Q.viewport.set([0,0,W,ne]);let te=X.heatmapFbo;if(!te||te&&(te.width!==W||te.height!==ne)){te&&te.destroy();const de=V.createTexture();V.bindTexture(V.TEXTURE_2D,de),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),te=X.heatmapFbo=Q.createFramebuffer(W,ne,!1),function(fe,pe,ye,_e,Me,We){const Ee=fe.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,fe.isWebGL2&&fe.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Me,We,0,Ee.RGBA,fe.extRenderToTextureHalfFloat?fe.isWebGL2?Ee.HALF_FLOAT:fe.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),_e.colorAttachment.set(ye)}(Q,0,de,te,W,ne)}else V.bindTexture(V.TEXTURE_2D,te.colorAttachment.get()),Q.bindFramebuffer.set(te.framebuffer)})(v,f,u,"globe"===f.transform.projection.name?.5:.25),v.clear({color:p.Color.transparent});const S=f.transform,F="globe"===S.projection.name,O=F?["PROJECTION_GLOBE_VIEW"]:null,z=F?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,$=[p.mercatorXfromLng(S.center.lng),p.mercatorYfromLat(S.center.lat)];for(let Q=0;Q<g.length;Q++){const K=g[Q];if(a.hasRenderableParent(K))continue;const X=a.getTile(K),ee=X.getBucket(u);if(!ee||ee.projection.name!==S.projection.name)continue;const V=ee.programConfigurations.get(u.id),W=f.useProgram("heatmap",V,O),{zoom:ne}=f.transform;f.terrain&&f.terrain.setupElevationDraw(X,W),f.prepareDrawProgram(v,W,K.toUnwrapped());const te=S.projection.createInversionMatrix(S,K.canonical);W.draw(v,b.TRIANGLES,p.DepthMode.disabled,I,T,z,hp(f,K,X,te,$,ne,u.paint.get("heatmap-intensity")),u.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,u.paint,f.transform.zoom,V,F?[ee.globeExtVertexBuffer]:null)}v.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(v,b){const I=v.context,T=I.gl,S=b.heatmapFbo;if(!S)return;I.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get()),I.activeTexture.set(T.TEXTURE1);let F=b.colorRampTexture;F||(F=b.colorRampTexture=new p.Texture(I,b.colorRamp,T.RGBA)),F.bind(T.LINEAR,T.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(I,T.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(f,u))},line:function(f,a,u,g){if("translucent"!==f.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const I=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),S=f.terrain&&f.terrain.renderingToTexture?1:p.exported.devicePixelRatio,F=u.paint.get("line-dasharray"),O=F.constantOr(1),z=u.layout.get("line-cap"),$=u.paint.get("line-pattern"),Q=$.constantOr(1),K=u.paint.get("line-gradient"),X=Q?"linePattern":"line",ee=f.context,V=ee.gl,W=(te=>{const de=[];Bt(te)&&de.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&de.push("RENDER_LINE_GRADIENT");const fe=te.paint.get("line-trim-offset");0===fe[0]&&0===fe[1]||de.push("RENDER_LINE_TRIM_OFFSET");const pe=te.paint.get("line-pattern").constantOr(1),ye=1!==te.paint.get("line-opacity").constantOr(1);return!pe&&ye&&de.push("RENDER_LINE_ALPHA_DISCARD"),de})(u);let ne=W.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const te of g){const de=a.getTile(te);if(Q&&!de.patternsLoaded())continue;const fe=de.getBucket(u);if(!fe)continue;f.prepareDrawTile();const pe=fe.programConfigurations.get(u.id),ye=f.useProgram(X,pe,W),_e=$.constantOr(null);if(_e&&de.imageAtlas){const Fe=de.imageAtlas.patternPositions[_e.toString()];Fe&&pe.setConstantPatternPositions(Fe)}const Me=F.constantOr(null),We=z.constantOr(null);if(!Q&&Me&&We&&de.lineAtlas){const Fe=de.lineAtlas.getDash(Me,We);Fe&&pe.setConstantPatternPositions(Fe)}let[Ee,Be]=u.paint.get("line-trim-offset");("round"===We||"square"===We)&&Ee!==Be&&(0===Ee&&(Ee-=1),1===Be&&(Be+=1));const De=f.terrain?te.projMatrix:null,Ze=Q?Ni(f,de,u,De,S):am(f,de,u,De,fe.lineClipsArray.length,S,[Ee,Be]);if(K){const Fe=fe.gradients[u.id];let Qe=Fe.texture;if(u.gradientVersion!==Fe.version){let Ue=256;if(u.stepInterpolant){const et=a.getSource().maxzoom,Ct=te.canonical.z===et?Math.ceil(1<<f.transform.maxZoom-te.canonical.z):1;Ue=p.clamp(p.nextPowerOfTwo(fe.maxLineLength/p.EXTENT*1024*Ct),256,ee.maxTextureSize)}Fe.gradient=p.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:Ue,image:Fe.gradient||void 0,clips:fe.lineClipsArray}),Fe.texture?Fe.texture.update(Fe.gradient):Fe.texture=new p.Texture(ee,Fe.gradient,V.RGBA),Fe.version=u.gradientVersion,Qe=Fe.texture}ee.activeTexture.set(V.TEXTURE1),Qe.bind(u.stepInterpolant?V.NEAREST:V.LINEAR,V.CLAMP_TO_EDGE)}O&&(ee.activeTexture.set(V.TEXTURE0),de.lineAtlasTexture.bind(V.LINEAR,V.REPEAT),pe.updatePaintBuffers()),Q&&(ee.activeTexture.set(V.TEXTURE0),de.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),pe.updatePaintBuffers()),f.prepareDrawProgram(ee,ye,te.toUnwrapped());const Ie=Fe=>{ye.draw(ee,V.TRIANGLES,I,Fe,T,p.CullFaceMode.disabled,Ze,u.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,u.paint,f.transform.zoom,pe,[fe.layoutVertexBuffer2])};if(ne){const Fe=f.stencilModeForClipping(te).ref;0===Fe&&f.terrain&&ee.clear({stencil:0});const Qe={func:V.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,Ie(new p.StencilMode(Qe,Fe,255,V.KEEP,V.KEEP,V.INVERT)),Ze.u_alpha_discard_threshold=0,Ie(new p.StencilMode(Qe,Fe,255,V.KEEP,V.KEEP,V.KEEP))}else Ie(f.stencilModeForClipping(te))}ne&&(f.resetStencilClippingMasks(),f.terrain&&ee.clear({stencil:0}))},fill:function(f,a,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const I=f.colorModeForRenderPass(),T=u.paint.get("fill-pattern"),S=f.opaquePassEnabledForLayer()&&!T.constantOr(1)&&1===v.constantOr(p.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(f.renderPass===S){const F=f.depthModeForSublayer(1,"opaque"===f.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Ai(f,a,u,g,F,I,!1)}if("translucent"===f.renderPass&&u.paint.get("fill-antialias")){const F=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Ai(f,a,u,g,F,I,!0)}},"fill-extrusion":function(f,a,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===f.renderPass){const b=new p.DepthMode(f.context.gl.LEQUAL,p.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))ja(f,a,u,g,b,p.StencilMode.disabled,p.ColorMode.disabled),ja(f,a,u,g,b,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const I=f.colorModeForRenderPass();ja(f,a,u,g,b,p.StencilMode.disabled,I)}}},hillshade:function(f,a,u,g){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const v=f.context,b=f.depthModeForSublayer(0,p.DepthMode.ReadOnly),I=f.colorModeForRenderPass(),T=f.terrain&&f.terrain.renderingToTexture,[S,F]="translucent"!==f.renderPass||T?[{},g]:f.stencilConfigForOverlap(g);for(const O of F){const z=a.getTile(O);if(z.needsHillshadePrepare&&"offscreen"===f.renderPass)cp(f,z,u,b,p.StencilMode.disabled,I);else if("translucent"===f.renderPass){const $=T&&f.terrain?f.terrain.stencilModeForRTTOverlap(O):S[O.overscaledZ];bu(f,O,z,u,b,$,I)}}v.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,a,u,g,v,b){if("translucent"!==f.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const I=f.context,T=I.gl,S=a.getSource(),F=f.useProgram("raster"),O=f.colorModeForRenderPass(),z=f.terrain&&f.terrain.renderingToTexture,[$,Q]=S instanceof Rt||z?[{},g]:f.stencilConfigForOverlap(g),K=Q[Q.length-1].overscaledZ,X=!f.options.moving;for(const ee of Q){const V=z?p.DepthMode.disabled:f.depthModeForSublayer(ee.overscaledZ-K,1===u.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,T.LESS),W=ee.toUnwrapped(),ne=a.getTile(ee);if(z&&(!ne||!ne.hasData()))continue;const te=z?ee.projMatrix:f.transform.calculateProjMatrix(W,X),de=f.terrain&&z?f.terrain.stencilModeForRTTOverlap(ee):$[ee.overscaledZ],fe=b?0:u.paint.get("raster-fade-duration");ne.registerFadeDuration(fe);const pe=a.findLoadedParent(ee,0),ye=wl(ne,pe,a,f.transform,fe);let _e,Me;f.terrain&&f.terrain.prepareDrawTile();const We="nearest"===u.paint.get("raster-resampling")?T.NEAREST:T.LINEAR;I.activeTexture.set(T.TEXTURE0),ne.texture.bind(We,T.CLAMP_TO_EDGE),I.activeTexture.set(T.TEXTURE1),pe?(pe.texture.bind(We,T.CLAMP_TO_EDGE),_e=Math.pow(2,pe.tileID.overscaledZ-ne.tileID.overscaledZ),Me=[ne.tileID.canonical.x*_e%1,ne.tileID.canonical.y*_e%1]):ne.texture.bind(We,T.CLAMP_TO_EDGE),ne.texture.useMipmap&&I.extTextureFilterAnisotropic&&f.transform.pitch>20&&T.texParameterf(T.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Ee=yr(te,Me||[0,0],_e||1,ye,u,S instanceof Rt?S.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(I,F,W),S instanceof Rt)S.boundsBuffer&&S.boundsSegments&&F.draw(I,T.TRIANGLES,V,p.StencilMode.disabled,O,p.CullFaceMode.disabled,Ee,u.id,S.boundsBuffer,f.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:De,tileBoundsSegments:Ze}=f.getTileBoundsBuffers(ne);F.draw(I,T.TRIANGLES,V,de,O,p.CullFaceMode.disabled,Ee,u.id,Be,De,Ze)}}f.resetStencilClippingMasks()},background:function(f,a,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const I=f.context,T=I.gl,S=f.transform,F=S.tileSize,O=u.paint.get("background-pattern");if(f.isPatternMissing(O))return;const z=!O&&1===v.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==z)return;const $=p.StencilMode.disabled,Q=f.depthModeForSublayer(0,"opaque"===z?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),K=f.colorModeForRenderPass(),X=f.useProgram(O?"backgroundPattern":"background");let ee,V=g;V||(ee=f.getBackgroundTiles(),V=Object.values(ee).map(W=>W.tileID)),O&&(I.activeTexture.set(T.TEXTURE0),f.imageManager.bind(f.context));for(const W of V){const ne=W.toUnwrapped(),te=g?W.projMatrix:f.transform.calculateProjMatrix(ne);f.prepareDrawTile();const de=a?a.getTile(W):ee?ee[W.key]:new p.Tile(W,F,S.zoom,f),fe=O?dp(te,b,f,O,{tileID:W,tileSize:F}):Eu(te,b,v);f.prepareDrawProgram(I,X,ne);const{tileBoundsBuffer:pe,tileBoundsIndexBuffer:ye,tileBoundsSegments:_e}=f.getTileBoundsBuffers(de);X.draw(I,T.TRIANGLES,Q,$,K,p.CullFaceMode.disabled,fe,u.id,pe,ye,_e)}},sky:function(f,a,u){const g=f.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:p.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const I=f.context,T=u.paint.get("sky-type"),S=new p.DepthMode(I.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),F=f.frameCounter/1e3%1;"atmosphere"===T?"offscreen"===f.renderPass?u.needsSkyboxCapture(f)&&(function(O,z,$,Q){const K=O.context,X=K.gl;let ee=z.skyboxFbo;if(!ee){ee=z.skyboxFbo=K.createFramebuffer(32,32,!1),z.skyboxGeometry=new ed(K),z.skyboxTexture=K.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,z.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let te=0;te<6;++te)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+te,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(ee.framebuffer),K.viewport.set([0,0,32,32]);const V=z.getCenter(O,!0),W=O.useProgram("skyboxCapture"),ne=new Float64Array(16);p.identity(ne),p.rotateY(ne,ne,.5*-Math.PI),Wr(K,z,W,ne,V,0),p.identity(ne),p.rotateY(ne,ne,.5*Math.PI),Wr(K,z,W,ne,V,1),p.identity(ne),p.rotateX(ne,ne,.5*-Math.PI),Wr(K,z,W,ne,V,2),p.identity(ne),p.rotateX(ne,ne,.5*Math.PI),Wr(K,z,W,ne,V,3),p.identity(ne),Wr(K,z,W,ne,V,4),p.identity(ne),p.rotateY(ne,ne,Math.PI),Wr(K,z,W,ne,V,5),K.viewport.set([0,0,O.width,O.height])}(f,u),u.markSkyboxValid(f)):"sky"===f.renderPass&&function(O,z,$,Q,K){const X=O.context,ee=X.gl,V=O.transform,W=O.useProgram("skybox");X.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,z.skyboxTexture);const ne={u_matrix:V.skyboxMatrix,u_sun_direction:z.getCenter(O,!1),u_cubemap:0,u_opacity:Q,u_temporal_offset:K};O.prepareDrawProgram(X,W),W.draw(X,ee.TRIANGLES,$,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,ne,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,u,S,b,F):"gradient"===T&&"sky"===f.renderPass&&function(O,z,$,Q,K){const X=O.context,ee=X.gl,V=O.transform,W=O.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new ed(X)),X.activeTexture.set(ee.TEXTURE0);let ne=z.colorRampTexture;ne||(ne=z.colorRampTexture=new p.Texture(X,z.colorRamp,ee.RGBA)),ne.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const te=(de=V.skyboxMatrix,fe=z.getCenter(O,!1),pe=z.paint.get("sky-gradient-radius"),ye=Q,_e=K,{u_matrix:de,u_color_ramp:0,u_center_direction:fe,u_radius:p.degToRad(pe),u_opacity:ye,u_temporal_offset:_e});var de,fe,pe,ye,_e;O.prepareDrawProgram(X,W),W.draw(X,ee.TRIANGLES,$,p.StencilMode.disabled,O.colorModeForRenderPass(),p.CullFaceMode.backCW,te,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(f,u,S,b,F)},debug:function(f,a,u){for(let g=0;g<u.length;g++)Ar(f,a,u[g])},custom:function(f,a,u,g){const v=f.context,b=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||"offscreen"===f.renderPass)&&u.isLayerDraped()){if("offscreen"===f.renderPass){const I=b.prerender;if(I){if(f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),"globe"===f.transform.projection.name){const T=f.transform.pointMerc;I.call(b,v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(f.transform.zoom),[T.x,T.y],f.transform.pixelsPerMeterRatio)}else I.call(b,v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState()}}else if("translucent"===f.renderPass){if(f.terrain&&f.terrain.renderingToTexture){const T=b.renderToTile;if(T){const S=g[0].canonical,F=new p.MercatorCoordinate(S.x+g[0].wrap*(1<<S.z),S.y,S.z);v.setDepthMode(p.DepthMode.disabled),v.setStencilMode(p.StencilMode.disabled),v.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),T.call(b,v.gl,F),v.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),v.setColorMode(f.colorModeForRenderPass()),v.setStencilMode(p.StencilMode.disabled);const I="3d"===b.renderingMode?new p.DepthMode(f.context.gl.LEQUAL,p.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,p.DepthMode.ReadOnly);if(v.setDepthMode(I),"globe"===f.transform.projection.name){const T=f.transform.pointMerc;b.render(v.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),p.globeToMercatorTransition(f.transform.zoom),[T.x,T.y],f.transform.pixelsPerMeterRatio)}else b.render(v.gl,f.transform.customLayerMatrix());v.setDirty(),f.setBaseState(),v.bindFramebuffer.set(null)}}else p.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Fo{constructor(a,u,g=!1){this.context=new it(a,g),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(a,u){const g=!!a&&!!a.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wh(this,a));const v=this._terrain;this.transform.elevation=g?v:null,v.update(a,this.transform,u)}_updateFog(a){const u=a.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(a,u){if(this.width=a*p.exported.devicePixelRatio,this.height=u*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const a=this.context,u=new p.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(p.EXTENT,0),u.emplaceBack(0,p.EXTENT),u.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=a.createVertexBuffer(u,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=a.createVertexBuffer(g,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const v=new p.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(v,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const b=new p.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(p.EXTENT,0,p.EXTENT,0),b.emplaceBack(0,p.EXTENT,0,p.EXTENT),b.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=a.createVertexBuffer(b,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const I=new p.StructArrayLayout3ui6;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(I);const T=new p.StructArrayLayout1ui2;for(const F of[0,1,3,2,0])T.emplaceBack(F);this.debugIndexBuffer=a.createIndexBuffer(T),this.emptyTexture=new p.Texture(a,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),a.gl.RGBA),this.identityMat=p.create();const S=this.context.gl;this.stencilClearMode=new p.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new bc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(a){return a._makeTileBoundsBuffers(this.context,this.transform.projection),a._tileBoundsBuffer?{tileBoundsBuffer:a._tileBoundsBuffer,tileBoundsIndexBuffer:a._tileBoundsIndexBuffer,tileBoundsSegments:a._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const a=this.context,u=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(a,u.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,$t(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(a,u,g){if(!u||this.currentStencilSource===u.id||!a.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const S of g)if(void 0===this._tileClippingMaskIDs[S.key]){T=!0;break}if(!T)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(p.ColorMode.disabled),v.setDepthMode(p.DepthMode.disabled);const I=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of g){const S=u.getTile(T),F=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:z,tileBoundsSegments:$}=this.getTileBoundsBuffers(S);I.draw(v,b.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:b.ALWAYS,mask:0},F,255,b.KEEP,b.KEEP,b.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,$t(T.projMatrix),"$clipping",O,z,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,u=this.context.gl;return new p.StencilMode({func:u.NOTEQUAL,mask:255},a,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(a){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(a);const u=this.context.gl;return new p.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(a){const u=this.context.gl,g=a.sort((I,T)=>T.overscaledZ-I.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const I={};for(let T=0;T<b;T++)I[T+v]=new p.StencilMode({func:u.GEQUAL,mask:255},T+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[I,g]}return[{[v]:p.StencilMode.disabled},g]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([a.CONSTANT_COLOR,a.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(a,u,g){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new p.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,u){this.style=a,this.options=u,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const F in v){const O=v[F];O.used&&O.prepare(this.context)}const b={},I={},T={};for(const F in v){const O=v[F];b[F]=O.getVisibleCoordinates(),I[F]=b[F].slice().reverse(),T[F]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let F=0;F<g.length;F++)if(this.style._layers[g[F]].is3D()){this.opaquePassCutoff=F;break}if(this.terrain&&(this.terrain.updateTileBinding(T),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),!p.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const F of g){const O=this.style._layers[F],z=a._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const $=z?I[z.id]:void 0;("custom"===O.type||O.isSky()||$&&$.length)&&this.renderLayer(this,z,O,$)}this.depthRangeFor3D=[0,1-(a.order.length+2)*this.numSublayers*this.depthEpsilon];const S=this.terrain;if(S&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&S.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const F=this.style._layers[g[this.currentLayer]],O=a._getLayerSourceCache(F);if(F.isSky())continue;const z=O?I[O.id]:void 0;this._renderTileClippingMasks(F,O,z),this.renderLayer(this,O,F,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(F,O){const z=F.context,$=z.gl,Q=F.transform,K=new p.DepthMode($.LEQUAL,p.DepthMode.ReadOnly,[0,1]),X=F.useProgram("globeAtmosphere",null,"globe"===Q.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),ee=p.globeToMercatorTransition(Q.zoom),V=O.properties.get("color").toArray01(),W=O.properties.get("high-color").toArray01(),ne=O.properties.get("space-color").toArray01PremultipliedAlpha(),te=p.identity$1([]);p.rotateY$1(te,te,-p.degToRad(Q._center.lng)),p.rotateX$1(te,te,p.degToRad(Q._center.lat)),p.rotateZ$1(te,te,Q.angle),p.rotateX$1(te,te,-Q._pitch);const de=p.fromQuat(new Float32Array(16),te),fe=p.mapValue(O.properties.get("star-intensity"),0,1,0,.25),ye=p.mapValue(O.properties.get("horizon-blend"),0,1,5e-4,.25),_e=p.globeUseCustomAntiAliasing(F,z,Q)&&5e-4===ye?Q.worldSize/(2*Math.PI*1.025)-1:Q.globeRadius,Me=F.frameCounter/1e3%1,We=p.length(Q.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(We,2)-Math.pow(_e,2)),Be=Math.acos(Ee/We),De={u_frustum_tl:Q.frustumCorners.TL,u_frustum_tr:Q.frustumCorners.TR,u_frustum_br:Q.frustumCorners.BR,u_frustum_bl:Q.frustumCorners.BL,u_horizon:Q.frustumCorners.horizon,u_transition:ee,u_fadeout_range:ye,u_color:V,u_high_color:W,u_space_color:ne,u_star_intensity:fe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Me,u_horizon_angle:Be,u_rotation_matrix:de};F.prepareDrawProgram(z,X);const Ze=F.atmosphereBuffer;Ze&&X.draw(z,$.TRIANGLES,K,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,De,"skybox",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const F=this.style._layers[g[this.currentLayer]],O=a._getLayerSourceCache(F);F.isSky()&&this.renderLayer(this,O,F,O?I[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const F=this.style._layers[g[this.currentLayer]],O=a._getLayerSourceCache(F);if(F.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(F)){if(F.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=O?("symbol"===F.type?T:I)[O.id]:void 0;this._renderTileClippingMasks(F,O,O?b[O.id]:void 0),this.renderLayer(this,O,F,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let F=null;p.values(this.style._layers).forEach(O=>{const z=a._getLayerSourceCache(O);z&&!O.isHidden(this.transform.zoom)&&(!F||F.getSource().maxzoom<z.getSource().maxzoom)&&(F=z)}),F&&this.options.showTileBoundaries&&ls.debug(this,F,F.getVisibleCoordinates())}this.options.showPadding&&function(F){const O=F.transform.padding;Tl(F,F.transform.height-(O.top||0),3,en),Tl(F,O.bottom||0,3,Yh),ks(F,O.left||0,3,xc),ks(F,F.transform.width-(O.right||0),3,pp);const z=F.transform.centerPoint;var $,Q,K,X;Rr($=F,(Q=z.x)-1,(K=F.transform.height-z.y)-10,2,20,X=Ml),Rr($,Q-10,K-1,20,2,X)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}renderLayer(a,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!a.transform.projection.unsupportedLayers||!a.transform.projection.unsupportedLayers.includes(g.type)||a.terrain&&"custom"===g.type)&&ls[g.type](a,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(a){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[a.id];g||(g=this.gpuTimers[a.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const a=this.context.extTimerQuery,u=a.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),a.beginQueryEXT(a.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT)}collectGpuTimers(){const a=this.gpuTimers;return this.gpuTimers={},a}collectDeferredRenderGpuQueries(){const a=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],a}queryGpuTimers(a){const u={};for(const g in a){const v=a[g],b=this.context.extTimerQuery,I=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=I}return u}queryGpuTimeDeferredRender(a){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let g=0;for(const v of a)g+=u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(v);return g}translatePosMatrix(a,u,g,v,b){if(!g[0]&&!g[1])return a;const I=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(I){const F=Math.sin(I),O=Math.cos(I);g=[g[0]*O-g[1]*F,g[0]*F+g[1]*O]}const T=[b?g[0]:Bi(u,g[0],this.transform.zoom),b?g[1]:Bi(u,g[1],this.transform.zoom),0],S=new Float32Array(16);return p.translate(S,a,T),S}saveTileTexture(a){const u=this._tileTextures[a.size[0]];u?u.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const u=this._tileTextures[a];return u&&u.length>0?u.pop():null}isPatternMissing(a){return null===a||void 0!==a&&!this.imageManager.getPattern(a.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const a=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&0===this.terrain.exaggeration(),g=this.style&&this.style.fog,v=[];return this.terrainRenderModeElevated()&&v.push("TERRAIN"),"globe"===this.transform.projection.name&&v.push("GLOBE"),u&&v.push("ZERO_EXAGGERATION"),g&&!a&&0!==g.getOpacity(this.transform.pitch)&&v.push("FOG"),a&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}useProgram(a,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),I=xn.cacheKey(ei[a],a,b,u);return this.cache[I]||(this.cache[I]=new xn(this.context,a,ei[a],u,Il[a],b)),this.cache[I]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(a,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),I=((T,S,F,O,z,$,Q,K,X,ee,V)=>{const W=T.transform,ne=S.properties.get("color").toArray01();ne[3]=O;const te=T.frameCounter/1e3%1;return{u_fog_matrix:F?W.calculateFogTileMatrix(F):T.identityMat,u_fog_range:S.getFovAdjustedRange(W._fov),u_fog_color:ne,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:te,u_frustum_tl:z,u_frustum_tr:$,u_frustum_br:Q,u_frustum_bl:K,u_globe_pos:X,u_globe_radius:ee,u_viewport:V,u_globe_transition:p.globeToMercatorTransition(W.zoom),u_is_globe:+("globe"===W.projection.name)}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);u.setFogUniformValues(a,I)}}setTileLoadedFlag(a){this.tileLoaded=a}saveCanvasCopy(){const a=this.canvasCopy();a&&(this.frameCopies.push(a),this.tileLoaded=!1)}canvasCopy(){const a=this.context.gl,u=a.createTexture();return a.bindTexture(a.TEXTURE_2D,u),a.copyTexImage2D(a.TEXTURE_2D,0,a.RGBA,0,0,a.drawingBufferWidth,a.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const a=this.style&&this.style.fog;return!!a&&0!==a.getOpacity(this.transform.pitch)}getBackgroundTiles(){const a=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=a[v.key]||new p.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Wi{constructor(a=0,u=0,g=0,v=0){if(isNaN(a)||a<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=u,this.left=g,this.right=v}interpolate(a,u,g){return null!=u.top&&null!=a.top&&(this.top=p.number(a.top,u.top,g)),null!=u.bottom&&null!=a.bottom&&(this.bottom=p.number(a.bottom,u.bottom,g)),null!=u.left&&null!=a.left&&(this.left=p.number(a.left,u.left,g)),null!=u.right&&null!=a.right&&(this.right=p.number(a.right,u.right,g)),this}getCenter(a,u){const g=p.clamp((this.left+a-this.right)/2,0,a),v=p.clamp((this.top+u-this.bottom)/2,0,u);return new p.Point(g,v)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new Wi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function td(f,a){const u=p.getColumn(f,3);p.fromQuat(f,a),p.setColumn(f,3,u)}function qt(f,a){const u=p.identity$1([]);return p.rotateZ$1(u,u,-a),p.rotateX$1(u,u,-f),u}function Or(f,a){const u=[f[0],f[1],0],g=[a[0],a[1],0];if(p.length(u)>=1e-15){const I=p.normalize([],u);p.scale$2(g,I,p.dot(g,I)),a[0]=g[0],a[1]=g[1]}const v=p.cross([],a,f);if(p.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return qt(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class Iu{constructor(a,u){this.position=a,this.orientation=u}get position(){return this._position}set position(a){if(a){const u=a instanceof p.MercatorCoordinate?a:new p.MercatorCoordinate(a[0],a[1],a[2]);this._renderWorldCopies&&(u.x=p.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(a,u){if(this.orientation=null,!this.position)return;const g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(a)):0,b=p.MercatorCoordinate.fromLngLat(a,v),I=[b.x-g.x,b.y-g.y,b.z-g.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=Or(I,u)}setPitchBearing(a,u){this.orientation=qt(p.degToRad(a),p.degToRad(-u))}}class ca{constructor(a,u){this._transform=p.identity([]),this.orientation=u,this.position=a}get mercatorPosition(){const a=this.position;return new p.MercatorCoordinate(a[0],a[1],a[2])}get position(){const a=p.getColumn(this._transform,3);return[a[0],a[1],a[2]]}set position(a){var u;a&&p.setColumn(this._transform,3,[(u=a)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(a){this._orientation=a||p.identity$1([]),a&&td(this._transform,this._orientation)}getPitchBearing(){const a=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(a[0]*a[0]+a[1]*a[1]),-a[2])}}setPitchBearing(a,u){this._orientation=qt(a,u),td(this._transform,this._orientation)}forward(){const a=p.getColumn(this._transform,2);return[-a[0],-a[1],-a[2]]}up(){const a=p.getColumn(this._transform,1);return[-a[0],-a[1],-a[2]]}right(){const a=p.getColumn(this._transform,0);return[a[0],a[1],a[2]]}getCameraToWorld(a,u){const g=new Float64Array(16);return p.invert(g,this.getWorldToCamera(a,u)),g}getWorldToCameraPosition(a,u,g){const v=this.position;p.scale$2(v,v,-a);const b=new Float64Array(16);return p.fromScaling(b,[g,g,g]),p.translate(b,b,v),b[10]*=u,b}getWorldToCamera(a,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return p.conjugate(v,this._orientation),p.scale$2(b,b,-a),p.fromQuat(g,v),p.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(a,u,g,v){const b=new Float64Array(16);return p.perspective(b,a,u,g,v),b}getDistanceToElevation(a,u=!1){const g=0===a?0:p.mercatorZfromAltitude(a,u?p.latFromMercatorY(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new ca([...this.position],[...this.orientation])}}function Ps(f,a){const u=Mu(f.projection,f.zoom,f.width,f.height),g=function(b,I,T,S,F){const O=new p.LngLat(T.lng-180*ua,T.lat),z=new p.LngLat(T.lng+180*ua,T.lat),$=b.project(O.lng,O.lat),Q=b.project(z.lng,z.lat),K=-Math.atan2(Q.y-$.y,Q.x-$.x),X=p.MercatorCoordinate.fromLngLat(T);X.y=p.clamp(X.y,-1+ua,1-ua);const ee=X.toLngLat(),V=b.project(ee.lng,ee.lat),W=p.MercatorCoordinate.fromLngLat(ee);W.x+=ua;const ne=W.toLngLat(),te=b.project(ne.lng,ne.lat),de=Tu(te.x-V.x,te.y-V.y,K),fe=p.MercatorCoordinate.fromLngLat(ee);fe.y+=ua;const pe=fe.toLngLat(),ye=b.project(pe.lng,pe.lat),_e=Tu(ye.x-V.x,ye.y-V.y,K),Me=Math.abs(de.x)/Math.abs(_e.y),We=p.identity([]);p.rotateZ(We,We,-K*(1-(F?0:S)));const Ee=p.identity([]);return p.scale(Ee,Ee,[1,1-(1-Me)*S,1]),Ee[4]=-_e.x/_e.y*S,p.rotateZ(Ee,Ee,K),p.multiply(Ee,We,Ee),Ee}(f.projection,0,f.center,u,a),v=fo(f);return p.scale(g,g,[v,v,1]),g}function fo(f){const a=f.projection,u=Mu(f.projection,f.zoom,f.width,f.height),g=fp(a,f.center),v=fp(a,p.LngLat.convert(a.center));return Math.pow(2,g*u+(1-u)*v)}function Mu(f,a,u,g,v=1/0){const b=f.range;if(!b)return 0;const I=Math.min(v,Math.max(u,g)),T=Math.log(I/1024)/Math.LN2;return p.smoothstep(b[0]+T,b[1]+T,a)}const ua=1/4e4;function fp(f,a){const u=p.clamp(a.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=new p.LngLat(a.lng-180*ua,u),v=new p.LngLat(a.lng+180*ua,u),b=f.project(g.lng,u),I=f.project(v.lng,u),T=p.MercatorCoordinate.fromLngLat(g),S=p.MercatorCoordinate.fromLngLat(v),F=I.x-b.x,O=I.y-b.y,z=S.x-T.x,$=S.y-T.y,Q=Math.sqrt((z*z+$*$)/(F*F+O*O));return Math.log(Q)/Math.LN2}function Tu(f,a,u){const g=Math.cos(u),v=Math.sin(u);return{x:f*g-a*v,y:f*v+a*g}}class wc{constructor(a,u,g,v,b,I,T){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=a||0,this._maxZoom=u||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(I),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Wi,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ca,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const a=new wc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return a._elevation=this._elevation,a._centerAltitude=this._centerAltitude,a._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,a.tileSize=this.tileSize,a.mercatorFromTransition=this.mercatorFromTransition,a.width=this.width,a.height=this.height,a.cameraElevationReference=this.cameraElevationReference,a._center=this._center,a._setZoom(this.zoom),a._seaLevelZoom=this._seaLevelZoom,a.angle=this.angle,a._fov=this._fov,a._pitch=this._pitch,a._nearZ=this._nearZ,a._farZ=this._farZ,a._averageElevation=this._averageElevation,a._unmodified=this._unmodified,a._edgeInsets=this._edgeInsets.clone(),a._camera=this._camera.clone(),a._calcMatrices(),a.freezeTileCoverage=this.freezeTileCoverage,a.frustumCorners=this.frustumCorners,a}get elevation(){return this._elevation}set elevation(a){this._elevation!==a&&(this._elevation=a,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(a,u=!1){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(a||g)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(a){this.projectionOptions=a||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const g=!je(u,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setMercatorFromTransition(){const a=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const u=a!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(a){void 0===a?a=!0:null===a&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get cameraWorldSize(){const a=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(a))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.Point(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(a){this.rotation=a}get rotation(){return-this.angle/Math.PI*180}set rotation(a){const u=-a*Math.PI/180;var g,v,b,I,T,S,F,O,z,$;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,I=this.angle,T=(b=this.rotationMatrix)[0],S=b[1],F=b[2],O=b[3],z=Math.sin(I),$=Math.cos(I),v[0]=T*$+F*z,v[1]=S*$+O*z,v[2]=T*-z+F*$,v[3]=S*-z+O*$)}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const u=p.clamp(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const a=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/a)}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=p.degToRad(a),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(a){this._averageElevation=a,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(a){const u=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(a){this._zoom=a,this.scale=this.zoomScale(a),this.tileZoom=Math.floor(a),this.zoomFraction=a-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const a=this._elevation;this._centerAltitude=a.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=a.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const a=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let I=0;I<u.length;I++){const T=new p.Point(u[I][0]*this.width,g+u[I][1]*(this.height-g)),S=a.pointCoordinate(T);if(!S)continue;const F=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);v+=S[3]*F,b+=F}return 0===b?NaN:v/b}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const a=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(a),b=this._mercatorZfromZoom(this._maxZoom),I=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(I))}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}computeZoomRelativeTo(a){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,a.toAltitude()));let g;g=a.z<this._camera.position[2]?[u.x,u.y,u.z]:[a.x,a.y,a.z];const v=p.length(p.sub([],this._camera.position,g));return p.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(a){if(!this.height||!a.position&&!a.orientation)return;this._updateCameraState();let u=!1;if(a.orientation&&!p.exactEquals(a.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(a.orientation)),a.position){const g=[a.position.x,a.position.y,a.position.z];p.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const a=this._camera.position,u=new Iu;return u.position=new p.MercatorCoordinate(a[0],a[1],a[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(a){if(!p.length$1(a))return!1;p.normalize$1(a,a);const u=p.transformQuat([],[0,0,-1],a),g=p.transformQuat([],[0,-1,0],a);if(g[2]<0)return!1;const v=Or(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(a){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;a[2]=p.clamp(a[2],v/g,v/u),this._camera.position=a}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,u,g){this._unmodified=!1,this._edgeInsets.interpolate(a,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const u=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(a){const u=[new p.UnwrappedTileID(0,a)];if(this.renderWorldCopies){const g=this.pointCoordinate(new p.Point(0,0)),v=this.pointCoordinate(new p.Point(this.width,0)),b=this.pointCoordinate(new p.Point(this.width,this.height)),I=this.pointCoordinate(new p.Point(0,this.height)),T=Math.floor(Math.min(g.x,v.x,b.x,I.x)),S=Math.floor(Math.max(g.x,v.x,b.x,I.x)),F=1;for(let O=T-F;O<=S+F;O++)0!==O&&u.push(new p.UnwrappedTileID(O,a))}return u}coveringTiles(a){let u=this.coveringZoomLevel(a);const g=u,v=this.elevation&&!a.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==a.minzoom&&u<a.minzoom)return[];void 0!==a.maxzoom&&u>a.maxzoom&&(u=a.maxzoom);const I=this.locationCoordinate(this.center),T=this.center.lat,S=1<<u,F=[S*I.x,S*I.y,0],O="globe"===this.projection.name,z=!O,$=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,z),Q=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=S*p.mercatorZfromAltitude(1,this.center.lat),X=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),ee=[S*Q.x,S*Q.y,X*(z?1:K)],V=this.cameraToCenterDistance/a.tileSize*(a.roundZoom?1:.502),W=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,ne=a.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,te=a.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?fo(this):1,fe=Ie=>{const Qe=new p.MercatorCoordinate(Ie.x+25e-6,Ie.y,Ie.z),Ue=new p.MercatorCoordinate(Ie.x,Ie.y+25e-6,Ie.z),et=Ie.toLngLat(),Ct=Qe.toLngLat(),Nt=Ue.toLngLat(),_t=this.locationCoordinate(et),Dt=this.locationCoordinate(Ct),hn=this.locationCoordinate(Nt),ln=Math.hypot(Dt.x-_t.x,Dt.y-_t.y),wt=Math.hypot(hn.x-_t.x,hn.y-_t.y);return Math.sqrt(ln*wt)*de/25e-6},pe=Ie=>{const Fe=ne,Qe=te;return{aabb:p.tileAABB(this,S,0,0,0,Ie,Qe,Fe,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:Fe,wrap:Ie,fullyVisible:!1}},ye=[];let _e=[];const Me=u,We=a.reparseOverscaled?g:u,Ee=Ie=>Ie*Ie,Be=Ee((X-this._centerAltitude)*K),De=Ie=>{if(!this._elevation||!Ie.tileID||!b)return;const Fe=this._elevation.getMinMaxForTile(Ie.tileID),Qe=Ie.aabb;Fe?(Qe.min[2]=Fe.min,Qe.max[2]=Fe.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Ie.shouldSplit=Ze(Ie),Ie.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Ze=Ie=>{if(Ie.zoom<W)return!0;if(Ie.zoom===Me)return!1;if(null!=Ie.shouldSplit)return Ie.shouldSplit;const Fe=Ie.aabb.distanceX(ee),Qe=Ie.aabb.distanceY(ee);let Ue=Be,et=1;if(O){Ue=Ee(Ie.aabb.distanceZ(ee));const _t=Math.pow(2,Ie.zoom),Dt=p.latFromMercatorY((Ie.y+1)/_t),hn=p.latFromMercatorY(Ie.y/_t),ln=Math.min(Math.max(T,Dt),hn),wt=p.circumferenceAtLatitude(ln)/p.circumferenceAtLatitude(T);if(et=ln===T?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wt/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&Ie.zoom===Me-1&&wt>=.9)return!0}else if(v&&(Ue=Ee(Ie.aabb.distanceZ(ee)*K)),this.projection.isReprojectedInTileSpace&&g<=5){const _t=Math.pow(2,Ie.zoom),Dt=fe(new p.MercatorCoordinate((Ie.x+.5)/_t,(Ie.y+.5)/_t));et=Dt>.85?1:Dt}const Ct=Fe*Fe+Qe*Qe+Ue;return Ct<Ee((1<<Me-Ie.zoom)*V*et*((_t,Dt)=>{if(Dt*Ee(.707)<_t)return 1;const hn=Math.sqrt(Dt/_t);return hn/(1.4144271570014144+(Math.pow(1.1,hn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ue,Be),Ct))};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)ye.push(pe(-Ie)),ye.push(pe(Ie));for(ye.push(pe(0));ye.length>0;){const Ie=ye.pop(),Fe=Ie.x,Qe=Ie.y;let Ue=Ie.fullyVisible;if(!Ue){const et=Ie.aabb.intersects($);if(0===et)continue;Ue=2===et}if(Ie.zoom!==Me&&Ze(Ie))for(let et=0;et<4;et++){const Ct=(Fe<<1)+et%2,Nt=(Qe<<1)+(et>>1),_t={aabb:b?Ie.aabb.quadrant(et):p.tileAABB(this,S,Ie.zoom+1,Ct,Nt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:Ct,y:Nt,wrap:Ie.wrap,fullyVisible:Ue,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};v&&!O&&(_t.tileID=new p.OverscaledTileID(Ie.zoom+1===Me?We:Ie.zoom+1,Ie.wrap,Ie.zoom+1,Ct,Nt),De(_t)),ye.push(_t)}else{const et=Ie.zoom===Me?We:Ie.zoom;if(a.minzoom&&a.minzoom>et)continue;const Ct=F[0]-(.5+Fe+(Ie.wrap<<Ie.zoom))*(1<<u-Ie.zoom),Nt=F[1]-.5-Qe,_t=Ie.tileID?Ie.tileID:new p.OverscaledTileID(et,Ie.wrap,Ie.zoom,Fe,Qe);_e.push({tileID:_t,distanceSq:Ct*Ct+Nt*Nt})}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,Fe=this.horizonLineFromTop();_e=_e.filter(Qe=>{const Ue=[0,0,0,1],et=[p.EXTENT,p.EXTENT,0,1],Ct=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());p.transformMat4$1(Ue,Ue,Ct),p.transformMat4$1(et,et,Ct);const Nt=p.getAABBPointSquareDist(Ue,et);if(0===Nt)return!0;let _t=!1;const Dt=this._elevation;if(Dt&&Nt>Ie&&0!==Fe){const hn=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let ln;a.isTerrainDEM||(ln=Dt.getMinMaxForTile(Qe.tileID)),ln||(ln={min:te,max:ne});const wt=p.furthestTileCorner(this.rotation),Dn=[wt[0]*p.EXTENT,wt[1]*p.EXTENT,ln.max];p.transformMat4(Dn,Dn,hn),_t=(1-Dn[1])*this.height*.5<Fe}return Nt<Ie||_t})}return _e.sort((Ie,Fe)=>Ie.distanceSq-Fe.distanceSq).map(Ie=>Ie.tileID)}resize(a,u){this.width=a,this.height=u,this.pixelsToGLUnits=[2/a,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const u=p.clamp(a.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),g=this.projection.project(a.lng,u);return new p.Point(g.x*this.worldSize,g.y*this.worldSize)}unproject(a){return this.projection.unproject(a.x/this.worldSize,a.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/p.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(a,u){let g,v;const b=this.centerPoint;if("globe"===this.projection.name){const T=this.worldSize;g=(u.x-b.x)/T,v=(u.y-b.y)/T}else{const T=this.pointCoordinate(u),S=this.pointCoordinate(b);g=T.x-S.x,v=T.y-S.y}const I=this.locationCoordinate(a);this.setLocation(new p.MercatorCoordinate(I.x-g,I.y-v))}setLocation(a){this.center=this.coordinateLocation(a),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(a){return this.projection.locationPoint(this,a)}locationPoint3D(a){return this.projection.locationPoint(this,a,!0)}pointLocation(a){return this.coordinateLocation(this.pointCoordinate(a))}pointLocation3D(a){return this.coordinateLocation(this.pointCoordinate3D(a))}locationCoordinate(a,u){const g=u?p.mercatorZfromAltitude(u,a.lat):void 0,v=this.projection.project(a.lng,a.lat);return new p.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(a){return this.projection.unproject(a.x,a.y)}pointRayIntersection(a,u){const g=u??this._centerAltitude,v=[a.x,a.y,0,1],b=[a.x,a.y,1,1];p.transformMat4$1(v,v,this.pixelMatrixInverse),p.transformMat4$1(b,b,this.pixelMatrixInverse);const I=b[3];p.scale$1(v,v,1/v[3]),p.scale$1(b,b,1/I);const T=v[2],S=b[2];return{p0:v,p1:b,t:T===S?0:(g-T)/(S-T)}}screenPointToMercatorRay(a){const u=[a.x,a.y,0,1],g=[a.x,a.y,1,1];return p.transformMat4$1(u,u,this.pixelMatrixInverse),p.transformMat4$1(g,g,this.pixelMatrixInverse),p.scale$1(u,u,1/u[3]),p.scale$1(g,g,1/g[3]),u[2]=p.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,p.scale$1(u,u,1/this.worldSize),p.scale$1(g,g,1/this.worldSize),new p.Ray([u[0],u[1],u[2]],p.normalize([],p.sub([],g,u)))}rayIntersectionCoordinate(a){const{p0:u,p1:g,t:v}=a,b=p.mercatorZfromAltitude(u[2],this._center.lat),I=p.mercatorZfromAltitude(g[2],this._center.lat);return new p.MercatorCoordinate(p.number(u[0],g[0],v)/this.worldSize,p.number(u[1],g[1],v)/this.worldSize,p.number(b,I,v))}pointCoordinate(a,u=this._centerAltitude){return this.projection.pointCoordinate(this,a.x,a.y,u)}pointCoordinate3D(a){if(!this.elevation)return this.pointCoordinate(a);let u=this.projection.pointCoordinate3D(this,a.x,a.y);if(u)return new p.MercatorCoordinate(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(a.y>v)return this.pointCoordinate(a);const b=.02*v,I=a.clone();for(let T=0;T<10&&v-g>b;T++){I.y=p.number(g,v,.66);const S=this.projection.pointCoordinate3D(this,I.x,I.y);S?(v=I.y,u=S):g=I.y}return u?new p.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(a)}isPointAboveHorizon(a){return this.projection.isPointAboveHorizon(this,a)}isPointOnSurface(a){if(a.y<0||a.y>this.height||a.x<0||a.x>this.width)return!1;if(this.elevation||this.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(a);const u=this.pointCoordinate(a);return u.y>=0&&u.y<=1}_coordinatePoint(a,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(a,this._centerAltitude):this._centerAltitude,v=[a.x*this.worldSize,a.y*this.worldSize,g+a.toAltitude(),1];return p.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new p.Point(v[0]/v[3],v[1]/v[3]):new p.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:a,left:u}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new p.Point(u,a)),I=this.pointLocation3D(new p.Point(v,a)),T=this.pointLocation3D(new p.Point(v,g)),S=this.pointLocation3D(new p.Point(u,g));let F=Math.min(b.lng,I.lng,T.lng,S.lng),O=Math.max(b.lng,I.lng,T.lng,S.lng),z=Math.min(b.lat,I.lat,T.lat,S.lat),$=Math.max(b.lat,I.lat,T.lat,S.lat);const Q=Math.pow(2,-this.zoom)/16*270,K="globe"===this.projection.name?1:4,X=(ee,V,W,ne,te)=>{const de=(ee+W)/2,fe=(V+ne)/2,pe=new p.Point(de,fe),{lng:ye,lat:_e}=this.pointLocation3D(pe),Me=Math.max(0,F-ye,z-_e,ye-O,_e-$);F=Math.min(F,ye),O=Math.max(O,ye),z=Math.min(z,_e),$=Math.max($,_e),(te<K||Me>Q)&&(X(ee,V,de,fe,te+1),X(de,fe,W,ne,te+1))};if(X(u,a,v,a,1),X(v,a,v,g,1),X(v,g,u,g,1),X(u,g,u,a,1),"globe"===this.projection.name){const[ee,V]=p.polesInViewport(this);ee?($=90,O=180,F=-180):V&&(z=-90,O=180,F=-180)}return new p.LngLatBounds(new p.LngLat(F,z),new p.LngLat(O,$))}_getBoundsRectangular(a,u){const{top:g,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,T=new p.Point(v,g),S=new p.Point(I,g),F=new p.Point(I,b),O=new p.Point(v,b);let z=this.pointCoordinate(T,a),$=this.pointCoordinate(S,a);const Q=this.pointCoordinate(F,u),K=this.pointCoordinate(O,u),X=(ee,V)=>(V.y-ee.y)/(V.x-ee.x);return z.y>1&&$.y>=0?z=new p.MercatorCoordinate((1-K.y)/X(K,z)+K.x,1):z.y<0&&$.y<=1&&(z=new p.MercatorCoordinate(-K.y/X(K,z)+K.x,0)),$.y>1&&z.y>=0?$=new p.MercatorCoordinate((1-Q.y)/X(Q,$)+Q.x,1):$.y<0&&z.y<=1&&($=new p.MercatorCoordinate(-Q.y/X(Q,$)+Q.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(z)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const a=this.elevation;if(!a.visibleDemTiles.length||a.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=a.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*a.exaggeration(),u.max*a.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(a=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return a?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(a){this.maxBounds=a,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,a&&(this.minLat=a.getSouth(),this.maxLat=a.getNorth(),this.minLng=a.getWest(),this.maxLng=a.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(a,u){return this.projection.createTileMatrix(this,u,a)}calculateDistanceTileData(a){const u=a.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=a.canonical,b=1/this.height,I=this.cameraWorldSize,T=I/this.zoomScale(v.z),S=(v.x+Math.pow(2,v.z)*a.wrap)*T,F=v.y*T,O=this.point;O.x*=I/this.worldSize,O.y*=I/this.worldSize;const z=this.angle,$=Math.sin(-z),Q=-Math.cos(-z);return g[u]={bearing:[$,Q],center:[(O.x-S)*b,(O.y-F)*b],scale:T/p.EXTENT*b},g[u]}calculateFogTileMatrix(a){const u=a.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,a);return p.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(a,u=!1){const g=a.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(a,this.worldSize);return p.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(a){const u=a.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,I){const{scale:T}=b.tileTransform,S=T*p.EXTENT/(b.tileSize*Math.pow(2,I.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return F=new Float32Array(4),$=(O=I.inverseAdjustmentMatrix)[1],Q=O[2],K=O[3],ee=(z=[S,S])[1],F[0]=O[0]*(X=z[0]),F[1]=$*X,F[2]=Q*ee,F[3]=K*ee,F;var F,O,z,$,Q,K,X,ee}(a,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const a=1/this.worldSize,u=p.fromScaling([],[a,a,a]);return p.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const a=this._elevation;this._updateCameraState();const u=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=p.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,p.normalize(v,v);const I=a.raycast(g,v,a.exaggeration());if(I){const T=p.scaleAndAdd([],g,v,I),S=new p.MercatorCoordinate(T[0],T[1],p.mercatorZfromAltitude(T[2],p.latFromMercatorY(T[1]))),F=(S.z+p.length([S.x-g[0],S.y-g[1],S.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(a=!1){if(!this._elevation)return;const u=this._elevation,g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),b=u.getAtPointOrZero(new p.MercatorCoordinate(...v)),I=this.pixelsPerMeter/this.worldSize*b,T=this._minimumHeightOverTerrain(),S=v[2]-I;if(S<=T)if(S<0||a){const F=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],F.z-v[2]],z=p.length(O);O[2]-=(T-S)/this._pixelsPerMercatorPixel;const $=p.length(O);if(0===$)return;p.scale$2(O,O,z/$*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],F.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||a){const $=this.center;return $.lat=p.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!a)&&($.lng=p.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const u=this._unmodified,{x:g,y:v}=this.point;let b=0,I=g,T=v;const S=this.width/2,F=this.height/2,O=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(v-F<O&&(T=O+F),v+F>z&&(T=z-F),z-O<this.height&&(b=Math.max(b,this.height/(z-O)),T=(z+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,K=this.worldSize/2-($+Q)/2;I=(g+K+this.worldSize)%this.worldSize-K,I-S<$&&(I=$+S),I+S>Q&&(I=Q-S),Q-$<this.width&&(b=Math.max(b,this.width/(Q-$)),I=(Q+$)/2)}I===g&&T===v||(this.center=this.unproject(new p.Point(I,T))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let a=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(a=Math.max(a,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),a}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,u=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const g=Mu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v="meters"===this.projection.zAxisUnit?u:1,b=this._camera.getWorldToCamera(this.worldSize,v),I=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);I[8]=2*-a.x/this.width,I[9]=2*a.y/this.height;let T=p.mul([],I,b);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),pe=p.identity([]);p.translate(pe,pe,[fe.x*this.worldSize,fe.y*this.worldSize,0]),p.multiply(pe,pe,Ps(this)),p.translate(pe,pe,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),p.multiply(T,T,pe),this.inverseAdjustmentMatrix=function(ye){const _e=Ps(ye,!0);return at([],[_e[0],_e[1],_e[4],_e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],T,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=T,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const S=p.invert([],I);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const F=new Float32Array(16);p.identity(F),p.scale(F,F,[1,-1,1]),p.rotateX(F,F,this._pitch),p.rotateZ(F,F,this.angle);const O=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-a.x/this.width,O[9]=2*(a.y+z)/this.height,this.skyboxMatrix=p.multiply(F,O,F);const $=this.point,Q=$.x,K=$.y,X=this.width%2/2,ee=this.height%2/2,V=Math.cos(this.angle),W=Math.sin(this.angle),ne=Q-Math.round(Q)+V*X+W*ee,te=K-Math.round(K)+V*ee+W*X,de=new Float64Array(T);if(p.translate(de,de,[ne>.5?ne-1:ne,te>.5?te-1:te,0]),this.alignedProjMatrix=de,T=p.create(),p.scale(T,T,[this.width/2,-this.height/2,1]),p.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=p.create(),p.scale(T,T,[1,-1,1]),p.translate(T,T,[-1,-1,0]),p.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=p.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const fe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(fe,fe,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const a=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[a,a,u];p.scale$2(b,b,v),p.scale$2(g,g,-1),p.multiply$2(g,g,b);const I=p.create();p.translate(I,I,g),p.scale(I,I,b),this.mercatorFogMatrix=I,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(a,u,v)}_computeCameraPosition(a){const u=(a=a||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-a/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,a/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(a){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=a[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((u-g)/v,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,a,b),this._updateStateFromCamera()}_updateStateFromCamera(){const a=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,I=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),T=Math.max((a[2]-b)/Math.cos(g),I),S=this._zoomFromMercatorZ(T);p.scaleAndAdd(a,a,u,T),this._pitch=p.clamp(g,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(v,-Math.PI,Math.PI),this._setZoom(p.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(a[0],a[1],a[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(a){return Math.pow(2,a)*this.tileSize}_mercatorZfromZoom(a){return this.cameraToCenterDistance/this._worldSizeFromZoom(a)}_minimumHeightOverTerrain(){const a=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(a)}_zoomFromMercatorZ(a){return this.scaleZoom(this.cameraToCenterDistance/(a*this.tileSize))}zoomFromMercatorZAdjusted(a){let u=0,g=p.GLOBE_ZOOM_THRESHOLD_MAX,v=0,b=1/0;for(;g-u>1e-6&&g>u;){const I=u+.5*(g-u),T=this.tileSize*Math.pow(2,I),S=this.getCameraToCenterDistance(this.projection,I,T),F=this.scaleZoom(S/(a*this.tileSize)),O=Math.abs(I-F);O<b&&(b=O,v=I),I<F?u=I:g=I}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(a,u){const g=Math.min(a.x,u.x),v=Math.max(a.x,u.x),b=Math.min(a.y,u.y),I=Math.max(a.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const T=[new p.Point(g,b),new p.Point(v,I),new p.Point(g,I),new p.Point(v,b)],S=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const O of T){const z=this.pointRayIntersection(O);if(z.t<0)return!0;const $=this.rayIntersectionCoordinate(z);if($.x<S||$.y<0||$.x>F||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.Point(0,0),new p.Point(this.width,this.height))}zoomDeltaToMovement(a,u){const g=p.length(p.sub([],this._camera.position,a)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const a=function([u,g,v],b){const I=[u,g,v,1];p.transformMat4$1(I,I,b);const T=I[3]=Math.max(I[3],1e-6);return I[0]/=T,I[1]/=T,I[2]/=T,I}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.Point(a[0],a[1])}{const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.Point(0,a))}}getCameraToCenterDistance(a,u=this.zoom,g=this.worldSize){const v=Mu(a,u,this.width,this.height,1024),b=a.pixelSpaceConversion(this.center.lat,g,v);return.5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const a=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(a,a,this.globeMatrix),a}}function Cc(f,a){let u=!1,g=null;const v=()=>{g=null,u&&(f(),g=setTimeout(v,a),u=!1)};return()=>(u=!0,g||v(),g)}class mp{constructor(a){this._hashName=a&&encodeURIComponent(a),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Cc(this._updateHashUnthrottled.bind(this),300)}addTo(a){return this._map=a,p.window.addEventListener("hashchange",this._onHashChange,!1),a.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const a=this._map;if(!a)return"";const u=Du(a);if(this._hashName){const g=this._hashName;let v=!1;const b=p.window.location.hash.slice(1).split("&").map(I=>{const T=I.split("=")[0];return T===g?(v=!0,`${T}=${u}`):I}).filter(I=>I);return v||b.push(`${g}=${u}`),`#${b.join("&")}`}return`#${u}`}_getCurrentHash(){const a=p.window.location.hash.replace("#","");if(this._hashName){let u;return a.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return a.split("/")}_onHashChange(){const a=this._map;if(!a)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=a.dragRotate.isEnabled()&&a.touchZoomRotate.isEnabled()?+(u[3]||0):a.getBearing();return a.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const a=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,a)}}function Du(f,a){const u=f.getCenter(),g=Math.round(100*f.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),I=Math.round(u.lng*b)/b,T=Math.round(u.lat*b)/b,S=f.getBearing(),F=f.getPitch();let O=a?`/${I}/${T}/${g}`:`${g}/${T}/${I}`;return(S||F)&&(O+="/"+Math.round(10*S)/10),F&&(O+=`/${Math.round(F)}`),O}const Su={linearity:.3,easing:p.bezier(0,0,.3,1)},nd=p.extend({deceleration:2500,maxSpeed:1400},Su),id=p.extend({deceleration:20,maxSpeed:1400},Su),pt=p.extend({deceleration:1e3,maxSpeed:360},Su),cs=p.extend({deceleration:1e3,maxSpeed:90},Su);class lm{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,u=p.exported.now();for(;a.length>0&&u-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new p.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=Pu(u.pan.mag(),g,p.extend({},nd,a||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,ku(v,b)}if(u.zoom){const b=Pu(u.zoom,g,id);v.zoom=this._map.transform.zoom+b.amount,ku(v,b)}if(u.bearing){const b=Pu(u.bearing,g,pt);v.bearing=this._map.transform.bearing+p.clamp(b.amount,-179,179),ku(v,b)}if(u.pitch){const b=Pu(u.pitch,g,cs);v.pitch=this._map.transform.pitch+b.amount,ku(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function ku(f,a){(!f.duration||f.duration<a.duration)&&(f.duration=a.duration,f.easing=a.easing)}function Pu(f,a,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,I=p.clamp(f*v/(a/1e3),-g,g),T=Math.abs(I)/(b*v);return{easing:u.easing,duration:1e3*T,amount:I*(T/2)}}class Vi extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g,v={}){const b=Hr(u.getCanvasContainer(),g),I=u.unproject(b);super(a,p.extend({point:b,lngLat:I,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class kl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){const v="touchend"===a?g.changedTouches:g.touches,b=Ta(u.getCanvasContainer(),v),I=b.map(S=>u.unproject(S)),T=b.reduce((S,F,O,z)=>S.add(F.div(z.length)),new p.Point(0,0));super(a,{points:b,point:T,lngLats:I,lngLat:u.unproject(T),originalEvent:g}),this._defaultPrevented=!1}}class rd extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,u,g){super(a,{originalEvent:g}),this._defaultPrevented=!1}}class gp{constructor(a,u){this._map=a,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(a){return this._firePreventable(new rd(a.type,this._map,a))}mousedown(a,u){return this._mousedownPos=u,this._firePreventable(new Vi(a.type,this._map,a))}mouseup(a){this._map.fire(new Vi(a.type,this._map,a))}preclick(a){const u=p.extend({},a);u.type="preclick",this._map.fire(new Vi(u.type,this._map,u))}click(a,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(a),this._map.fire(new Vi(a.type,this._map,a)))}dblclick(a){return this._firePreventable(new Vi(a.type,this._map,a))}mouseover(a){this._map.fire(new Vi(a.type,this._map,a))}mouseout(a){this._map.fire(new Vi(a.type,this._map,a))}touchstart(a){return this._firePreventable(new kl(a.type,this._map,a))}touchmove(a){this._map.fire(new kl(a.type,this._map,a))}touchend(a){this._map.fire(new kl(a.type,this._map,a))}touchcancel(a){this._map.fire(new kl(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class od{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(a){this._map.fire(new Vi(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Vi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._map.fire(new Vi(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ha{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,u){this.isEnabled()&&a.shiftKey&&0===a.button&&(ic(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(a,u){if(!this._active)return;const g=u,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=Zt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",a));const I=Math.min(v.x,g.x),T=Math.max(v.x,g.x),S=Math.min(v.y,g.y),F=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${I}px,${S}px)`,this._box.style.width=T-I+"px",this._box.style.height=F-S+"px")})}mouseupWindow(a,u){if(!this._active)return;const g=this._startPos,v=u;if(g&&0===a.button){if(this.reset(),ao(),g.x!==v.x||g.y!==v.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:a})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",a)}}keydown(a){this._active&&27===a.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",a))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dl(),delete this._startPos,delete this._lastPos}_fireEvent(a,u){return this._map.fire(new p.Event(a,{originalEvent:u}))}}function Ru(f,a){const u={};for(let g=0;g<f.length;g++)u[f[g].identifier]=a[g];return u}class ji{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(a,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=a.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new p.Point(0,0);for(const I of v)b._add(I);return b.div(v.length)}(u),this.touches=Ru(g,u)))}touchmove(a,u,g){if(this.aborted||!this.centroid)return;const v=Ru(g,u);for(const b in this.touches){const I=v[b];(!I||I.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(a,u,g){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ou{constructor(a){this.singleTap=new ji(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(a,u,g){this.singleTap.touchstart(a,u,g)}touchmove(a,u,g){this.singleTap.touchmove(a,u,g)}touchend(a,u,g){const v=this.singleTap.touchend(a,u,g);if(v){const b=a.timeStamp-this.lastTime<500,I=!this.lastTap||this.lastTap.dist(v)<30;if(b&&I||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class cm{constructor(){this._zoomIn=new Ou({numTouches:1,numTaps:2}),this._zoomOut=new Ou({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,u,g){this._zoomIn.touchstart(a,u,g),this._zoomOut.touchstart(a,u,g)}touchmove(a,u,g){this._zoomIn.touchmove(a,u,g),this._zoomOut.touchmove(a,u,g)}touchend(a,u,g){const v=this._zoomIn.touchend(a,u,g),b=this._zoomOut.touchend(a,u,g);return v?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()+1,around:I.unproject(v)},{originalEvent:a})}):b?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:I.getZoom()-1,around:I.unproject(b)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const _p={0:1,2:2};class Ua{constructor(a){this.reset(),this._clickTolerance=a.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(a,u){return!1}_move(a,u){return{}}mousedown(a,u){if(this._lastPoint)return;const g=Cs(a);this._correctButton(a,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(a,u){const g=this._lastPoint;if(g)if(a.preventDefault(),null!=this._eventButton&&function(v,b){const I=_p[b];return void 0===v.buttons||(v.buttons&I)!==I}(a,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(a){this._lastPoint&&Cs(a)===this._eventButton&&(this._moved&&ao(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fu extends Ua{mousedown(a,u){super.mousedown(a,u),this._lastPoint&&(this._active=!0)}_correctButton(a,u){return 0===u&&!a.ctrlKey}_move(a,u){return{around:u,panDelta:u.sub(a)}}}class sd extends Ua{_correctButton(a,u){return 0===u&&a.ctrlKey||2===u}_move(a,u){const g=.8*(u.x-a.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(a){a.preventDefault()}}class Ec extends Ua{_correctButton(a,u){return 0===u&&a.ctrlKey||2===u}_move(a,u){const g=-.5*(u.y-a.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(a){a.preventDefault()}}class Lu{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.Point(0,0)}touchstart(a,u,g){return this._calculateTransform(a,u,g)}touchmove(a,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return a.cancelable&&a.preventDefault(),this._calculateTransform(a,u,g)}}touchend(a,u,g){this._calculateTransform(a,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,u,g){g.length>0&&(this._active=!0);const v=Ru(g,u),b=new p.Point(0,0),I=new p.Point(0,0);let T=0;for(const F in v){const O=v[F],z=this._touches[F];z&&(b._add(O),I._add(O.sub(z)),T++,v[F]=O)}if(this._touches=v,T<this._minTouches||!I.mag())return;const S=I.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(T),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Zt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class xr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(a){}_move(a,u,g){return{}}touchstart(a,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(a,u,g){const v=this._firstTwoTouches;if(!v)return;a.preventDefault();const[b,I]=v,T=Pl(g,u,b),S=Pl(g,u,I);if(!T||!S)return;const F=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],F,a)}touchend(a,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,I=Pl(g,u,v),T=Pl(g,u,b);I&&T||(this._active&&ao(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pl(f,a,u){for(let g=0;g<f.length;g++)if(f[g].identifier===u)return a[g]}function Bu(f,a){return Math.log(f/a)/Math.LN2}class Zi extends xr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,u){const g=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(Bu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Bu(this._distance,g),pinchAround:u}}}function ad(f,a){return 180*f.angleWith(a)/Math.PI}class Ic extends xr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,u){const g=this._vector;if(this._vector=a[0].sub(a[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ad(this._vector,g),pinchAround:u}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const u=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;const v=ad(a,g);return Math.abs(v)<u}}function Ri(f){return Math.abs(f.y)>Math.abs(f.x)}class yp extends xr{constructor(a){super(),this._map=a}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(a){this._lastPoints=a,Ri(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,u,g){const v=this._lastPoints;if(!v)return;const b=a[0].sub(v[0]),I=a[1].sub(v[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,I,g.timeStamp),!this._valid)?void 0:(this._lastPoints=a,this._active=!0,{pitchDelta:(b.y+I.y)/2*-.5})}gestureBeginsVertically(a,u,g){if(void 0!==this._valid)return this._valid;const v=a.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const I=a.y>0==u.y>0;return Ri(a)&&Ri(u)&&I}}const ld={panStep:100,bearingStep:15,pitchStep:10};class Rl{constructor(){const a=ld;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let u=0,g=0,v=0,b=0,I=0;switch(a.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:a.shiftKey?g=-1:(a.preventDefault(),b=-1);break;case 39:a.shiftKey?g=1:(a.preventDefault(),b=1);break;case 38:a.shiftKey?v=1:(a.preventDefault(),I=-1);break;case 40:a.shiftKey?v=-1:(a.preventDefault(),I=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:T=>{const S=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Fr,zoom:u?Math.round(S)+u*(a.shiftKey?2:1):S,bearing:T.getBearing()+g*this._bearingStep,pitch:T.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-I*this._panStep],center:T.getCenter()},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fr(f){return f*(2-f)}const cd=4.000244140625;class Mc{constructor(a,u){this._map=a,this._el=a.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&"center"===a.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(a){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(a.ctrlKey||a.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=a.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const g=p.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%cd==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),a.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=a,this._delta-=u,this._active||this._start(a)),a.preventDefault()}_onTimeout(a){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Hr(this._el,a);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._map.transform;"wheel"===this._type&&a.projection.wrap&&(a._center.lng>=180||a._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>a._terrainEnabled()&&this._aroundCoord?a.computeZoomRelativeTo(this._aroundCoord):a.zoom;if(0!==this._delta){const S="wheel"===this._type&&Math.abs(this._delta)>cd?this._wheelZoomRate:this._defaultZoomRate;let F=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&0!==F&&(F=1/F);const O=u(),z=Math.pow(2,O),$="number"==typeof this._targetZoom?a.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom($*F))),"wheel"===this._type&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let I,T=!1;if("wheel"===this._type&&v&&b){const S=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),F=b(S);I=p.number(v,g,F),S<1?this._frameId||(this._frameId=!0):T=!0}else I=g,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!T,zoomDelta:I-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let u=p.ease;if(this._prevEase){const g=this._prevEase,v=(p.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),I=.27/Math.sqrt(b*b+1e-4)*.01,T=Math.sqrt(.0729-I*I);u=p.bezier(I,T,.25,1)}return this._prevEase={start:p.exported.now(),duration:a,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Zt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class vp{constructor(a,u){this._clickZoom=a,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class pi{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(a,u){return a.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(a.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ap{constructor(){this._tap=new Ou({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(a,u,g){this._swipePoint||(this._tapTime&&a.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(a,u,g))}touchmove(a,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,a.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(a,u,g)}touchend(a,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(a,u,g)&&(this._tapTime=a.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu{constructor(a,u,g){this._el=a,this._mousePan=u,this._touchPan=g}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class rn{constructor(a,u,g){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xp{constructor(a,u,g,v){this._el=a,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Lo=f=>f.zoom||f.drag||f.pitch||f.rotate;class bp extends p.Event{}class um{constructor(){this.constants=[1,1,.01],this.radius=0}setup(a,u){const g=p.sub([],u,a);this.radius=p.length(g[2]<0?p.div([],g,this.constants):[g[0],g[1],0])}projectRay(a){p.div(a,a,this.constants),p.normalize(a,a),p.mul$1(a,a,this.constants);const u=p.scale$2([],a,this.radius);if(u[2]>0){const g=p.scale$2([],[0,0,1],p.dot(u,[0,0,1])),v=p.scale$2([],p.normalize([],[u[0],u[1],0]),this.radius),b=p.add([],u,p.scale$2([],p.sub([],p.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function Bo(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class No{constructor(a,u){this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new lm(a),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new um,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),p.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[v,b,I]of this._listeners)v.addEventListener(b,v===p.window.document?this.handleWindowEvent:this.handleEvent,I)}destroy(){for(const[a,u,g]of this._listeners)a.removeEventListener(u,a===p.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(a){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new gp(u,a));const v=u.boxZoom=new ha(u,a);this._add("boxZoom",v);const b=new cm,I=new pi;u.doubleClickZoom=new vp(I,b),this._add("tapZoom",b),this._add("clickZoom",I);const T=new Ap;this._add("tapDragZoom",T);const S=u.touchPitch=new yp(u);this._add("touchPitch",S);const F=new sd(a),O=new Ec(a);u.dragRotate=new rn(a,F,O),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const z=new Fu(a),$=new Lu(u,a);u.dragPan=new Nu(g,z,$),this._add("mousePan",z),this._add("touchPan",$,["touchZoom","touchRotate"]);const Q=new Ic,K=new Zi;u.touchZoomRotate=new xp(g,K,Q,T),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new od(u));const X=u.scrollZoom=new Mc(u,this);this._add("scrollZoom",X,["mousePan"]);const ee=u.keyboard=new Rl;this._add("keyboard",ee);for(const V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])a.interactive&&a[V]&&u[V].enable(a[V])}_add(a,u,g){this._handlers.push({handlerName:a,handler:u,allowed:g}),this._handlersById[a]=u}stop(a){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(a,u,g){for(const v in a)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(a){this.handleEvent(a,`${a.type}Window`)}_getMapTouches(a){const u=[];for(const g of a)this._el.contains(g.target)&&u.push(g);return u}handleEvent(a,u){this._updatingCamera=!0;const g="renderFrame"===a.type,v=g?void 0:a,b={needsRenderFrame:!1},I={},T={},S=a.touches?this._getMapTouches(a.touches):void 0,F=S?Ta(this._el,S):g?void 0:Hr(this._el,a);for(const{handlerName:$,handler:Q,allowed:K}of this._handlers){if(!Q.isEnabled())continue;let X;this._blockedByActive(T,K,$)?Q.reset():Q[u||a.type]&&(X=Q[u||a.type](a,F,S),this.mergeHandlerResult(b,I,X,$,v),X&&X.needsRenderFrame&&this._triggerRenderFrame()),(X||Q.isActive())&&(T[$]=Q)}const O={};for(const $ in this._previousActiveHandlers)T[$]||(O[$]=v);this._previousActiveHandlers=T,(Object.keys(O).length||Bo(b))&&(this._changes.push([b,I,O]),this._triggerRenderFrame()),(Object.keys(T).length||Bo(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=b;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(a,u,g,v,b){if(!g)return;p.extend(a,g);const I={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=I),void 0!==g.panDelta&&(u.drag=I),void 0!==g.pitchDelta&&(u.pitch=I),void 0!==g.bearingDelta&&(u.rotate=I)}_applyChanges(){const a={},u={},g={};for(const[v,b,I]of this._changes)v.panDelta&&(a.panDelta=(a.panDelta||new p.Point(0,0))._add(v.panDelta)),v.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(a.around=v.around),void 0!==v.aroundCoord&&(a.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(a.pinchAround=v.pinchAround),v.noInertia&&(a.noInertia=v.noInertia),p.extend(u,b),p.extend(g,I);this._updateMapTransform(a,u,g),this._changes=[]}_updateMapTransform(a,u,g){const v=this._map,b=v.transform,I=W=>[W.x,W.y,W.z];if((W=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Bo(a)){const W=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",W!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!Bo(a))return void this._fireEvents(u,g,!0);let{panDelta:T,zoomDelta:S,bearingDelta:F,pitchDelta:O,around:z,aroundCoord:$,pinchAround:Q}=a;b._isCameraConstrained&&(S>0&&(S=0),b._isCameraConstrained=!1),void 0!==Q&&(z=Q),(S||(W=>u[W]&&!this._eventsInProgress[W])("drag"))&&z&&(this._dragOrigin=I(b.pointCoordinate3D(z)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),z=z||v.transform.centerPoint,F&&(b.bearing+=F),O&&(b.pitch+=O),b._updateCameraState();const K=[0,0,0];if(T)if("mercator"===b.projection.name){const W=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(z).dir),ne=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(z.sub(T)).dir);K[0]=ne[0]-W[0],K[1]=ne[1]-W[1]}else{const W=b.pointCoordinate(z);if("globe"===b.projection.name){T=T.rotate(-b.angle);const ne=b._pixelsPerMercatorPixel/b.worldSize;K[0]=-T.x*p.mercatorScale(p.latFromMercatorY(W.y))*ne,K[1]=-T.y*p.mercatorScale(b.center.lat)*ne}else{const ne=b.pointCoordinate(z.sub(T));W&&ne&&(K[0]=ne.x-W.x,K[1]=ne.y-W.y)}}const X=b.zoom,ee=[0,0,0];if(S){const W=I($||b.pointCoordinate3D(z)),ne={dir:p.normalize([],p.sub([],W,b._camera.position))};if(ne.dir[2]<0){const te=b.zoomDeltaToMovement(W,S);p.scale$2(ee,ne.dir,te)}}const V=p.add(K,K,ee);b._translateCameraConstrained(V),S&&Math.abs(b.zoom-X)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(u,g,!0)}_fireEvents(a,u,g){const v=Lo(this._eventsInProgress),b=Lo(a),I={};for(const O in a){const{originalEvent:z}=a[O];this._eventsInProgress[O]||(I[`${O}start`]=z),this._eventsInProgress[O]=a[O]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const O in I)this._fireEvent(O,I[O]);b&&this._fireEvent("move",b.originalEvent);for(const O in a){const{originalEvent:z}=a[O];this._fireEvent(O,z)}const T={};let S;for(const O in this._eventsInProgress){const{handlerName:z,originalEvent:$}=this._eventsInProgress[O];this._handlersById[z].isActive()||(delete this._eventsInProgress[O],S=u[z]||$,T[`${O}end`]=S)}for(const O in T)this._fireEvent(O,T[O]);const F=Lo(this._eventsInProgress);if(g&&(v||b)&&!F){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=$=>0!==$&&-this._bearingSnap<$&&$<this._bearingSnap;O?(z(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:S})):(this._map.fire(new p.Event("moveend",{originalEvent:S})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(a,u){this._map.fire(new p.Event(a,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{this._frameId=void 0,this.handleEvent(new bp("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ga="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class zu extends p.Evented{constructor(a,u){super(),this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=!1!==u.respectPrefersReducedMotion,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(a,u){return this.jumpTo({center:a},u)}panBy(a,u,g){return a=p.Point.convert(a).mult(-1),this.panTo(this.transform.center,p.extend({offset:a},u),g)}panTo(a,u,g){return this.easeTo(p.extend({center:a},u),g)}getZoom(){return this.transform.zoom}setZoom(a,u){return this.jumpTo({zoom:a},u),this}zoomTo(a,u,g){return this.easeTo(p.extend({zoom:a},u),g)}zoomIn(a,u){return this.zoomTo(this.getZoom()+1,a,u),this}zoomOut(a,u){return this.zoomTo(this.getZoom()-1,a,u),this}getBearing(){return this.transform.bearing}setBearing(a,u){return this.jumpTo({bearing:a},u),this}getPadding(){return this.transform.padding}setPadding(a,u){return this.jumpTo({padding:a},u),this}rotateTo(a,u,g){return this.easeTo(p.extend({bearing:a},u),g)}resetNorth(a,u){return this.rotateTo(0,p.extend({duration:1e3},a),u),this}resetNorthPitch(a,u){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},a),u),this}snapToNorth(a,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,u):this}getPitch(){return this.transform.pitch}setPitch(a,u){return this.jumpTo({pitch:a},u),this}cameraForBounds(a,u){a=p.LngLatBounds.convert(a);const g=u&&u.bearing||0,v=u&&u.pitch||0,b=a.getNorthWest(),I=a.getSouthEast();return this._cameraForBounds(this.transform,b,I,g,v,u)}_extendCameraOptions(a){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(a=p.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},a)).padding){const g=a.padding;a.padding={top:g,bottom:g,right:g,left:g}}return a.padding=p.extend(u,a.padding),a}_minimumAABBFrustumDistance(a,u){const g=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return g/v>a.aspect?g/(2*Math.tan(.5*a.fovX)*a.aspect):v/(2*Math.tan(.5*a.fovY)*a.aspect)}_cameraForBoundsOnGlobe(a,u,g,v,b,I){const T=a.clone(),S=this._extendCameraOptions(I);T.bearing=v,T.pitch=b;const F=p.LngLat.convert(u),O=p.LngLat.convert(g),z=.5*(F.lat+O.lat),$=.5*(F.lng+O.lng),Q=p.latLngToECEF(z,$),K=p.normalize([],Q),X=p.normalize([],p.cross([],K,[0,1,0])),ee=p.cross([],X,K),V=[X[0],X[1],X[2],0,ee[0],ee[1],ee[2],0,K[0],K[1],K[2],0,0,0,0,1],W=[Q,p.latLngToECEF(F.lat,F.lng),p.latLngToECEF(O.lat,F.lng),p.latLngToECEF(O.lat,O.lng),p.latLngToECEF(F.lat,O.lng),p.latLngToECEF(z,F.lng),p.latLngToECEF(z,O.lng),p.latLngToECEF(F.lat,$),p.latLngToECEF(O.lat,$)];let ne=p.Aabb.fromPoints(W.map(Ue=>[p.dot(X,Ue),p.dot(ee,Ue),p.dot(K,Ue)]));const te=p.transformMat4([],ne.center,V);0===p.squaredLength(te)&&p.set(te,0,0,1),p.normalize(te,te),p.scale$2(te,te,p.GLOBE_RADIUS),T.center=p.ecefToLatLng(te);const de=T.getWorldToCameraMatrix(),fe=p.invert(new Float64Array(16),de);ne=p.Aabb.applyTransform(ne,p.multiply([],de,V)),p.transformMat4(te,te,de);const pe=.5*(ne.max[2]-ne.min[2]),ye=this._minimumAABBFrustumDistance(T,ne),_e=p.scale$2([],[0,0,1],pe),Me=p.add(_e,te,_e),We=ye+(0===T.pitch?0:p.distance(te,Me)),Ee=T.globeCenterInViewSpace,Be=p.sub([],te,[Ee[0],Ee[1],Ee[2]]);p.normalize(Be,Be),p.scale$2(Be,Be,We);const De=p.add([],te,Be);p.transformMat4(De,De,fe);const Ze=p.earthRadius/p.GLOBE_RADIUS,Ie=p.length(De),Fe=p.mercatorZfromAltitude(Math.max(Ie*Ze-p.earthRadius,Number.EPSILON),0),Qe=Math.min(T.zoomFromMercatorZAdjusted(Fe),S.maxZoom);return Qe>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"mercator"}),T.zoom=Qe,this._cameraForBounds(T,u,g,v,b,I)):{center:T.center,zoom:Qe,bearing:v,pitch:b}}queryTerrainElevation(a,u){const g=this.transform.elevation;return g?(u=p.extend({},{exaggerated:!0},u),g.getAtPoint(p.MercatorCoordinate.fromLngLat(a),null,u.exaggerated)):null}_cameraForBounds(a,u,g,v,b,I){if("globe"===a.projection.name)return this._cameraForBoundsOnGlobe(a,u,g,v,b,I);const T=a.clone(),S=this._extendCameraOptions(I),F=T.padding;T.bearing=v,T.pitch=b;const O=p.LngLat.convert(u),z=p.LngLat.convert(g),$=new p.LngLat(O.lng,z.lat),Q=new p.LngLat(z.lng,O.lat),K=T.project(O),X=T.project(z),ee=this.queryTerrainElevation(O),V=this.queryTerrainElevation(z),W=this.queryTerrainElevation($),ne=this.queryTerrainElevation(Q),te=[[K.x,K.y,Math.min(ee||0,V||0,W||0,ne||0)],[X.x,X.y,Math.max(ee||0,V||0,W||0,ne||0)]];let de=p.Aabb.fromPoints(te);const fe=T.getWorldToCameraMatrix(),pe=p.invert(new Float64Array(16),fe);de=p.Aabb.applyTransform(de,fe);const ye=p.sub([],de.max,de.min),_e=F.left||0,Me=F.right||0,We=F.bottom||0,Ee=F.top||0,{left:Be,right:De,top:Ze,bottom:Ie}=S.padding,Fe=.5*(_e+Me),Qe=.5*(Ee+We),Ue=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(_e+Me+Be+De))/ye[0],(T.height-(We+Ee+Ie+Ze))/ye[1])),S.maxZoom),et=T.scale/T.zoomScale(Ue);de=new p.Aabb([de.min[0]-(Be+Fe)*et,de.min[1]-(Ie+Qe)*et,de.min[2]],[de.max[0]+(De+Fe)*et,de.max[1]+(Ze+Qe)*et,de.max[2]]);const Ct=.5*ye[2],Nt=this._minimumAABBFrustumDistance(T,de),_t=[0,0,1,0];p.transformMat4$1(_t,_t,fe),p.normalize$2(_t,_t);const Dt=p.scale$2([],_t,Nt+Ct),hn=p.add([],de.center,Dt),ln=("number"==typeof S.offset.x&&"number"==typeof S.offset.y?new p.Point(S.offset.x,S.offset.y):p.Point.convert(S.offset)).rotate(-p.degToRad(v));de.center[0]-=ln.x*et,de.center[1]+=ln.y*et,p.transformMat4(de.center,de.center,pe),p.transformMat4(hn,hn,pe);const wt=[de.center[0],de.center[1],hn[2]*T.pixelsPerMeter];p.scale$2(wt,wt,1/T.worldSize);const Dn=p.lngFromMercatorX(wt[0]),Vn=p.latFromMercatorY(wt[1]),Sn=Math.min(T._zoomFromMercatorZ(wt[2]),S.maxZoom),jn=new p.LngLat(Dn,Vn);return T.mercatorFromTransition&&Sn<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(T.setProjection({name:"globe"}),T.zoom=Sn,this._cameraForBounds(T,u,g,v,b,I)):{center:jn,zoom:Sn,bearing:v,pitch:b}}fitBounds(a,u,g){const v=this.cameraForBounds(a,u);return this._fitInternal(v,u,g)}fitScreenCoordinates(a,u,g,v,b){const I=p.Point.convert(a),T=p.Point.convert(u),S=new p.Point(Math.min(I.x,T.x),Math.min(I.y,T.y)),F=new p.Point(Math.max(I.x,T.x),Math.max(I.y,T.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(I,T))return this;const O=this.transform.pointLocation3D(S),z=this.transform.pointLocation3D(F),$=this.transform.pointLocation3D(new p.Point(S.x,F.y)),Q=this.transform.pointLocation3D(new p.Point(F.x,S.y)),K=[Math.min(O.lng,z.lng,$.lng,Q.lng),Math.min(O.lat,z.lat,$.lat,Q.lat)],X=[Math.max(O.lng,z.lng,$.lng,Q.lng),Math.max(O.lat,z.lat,$.lat,Q.lat)],ee=v&&v.pitch?v.pitch:this.getPitch(),V=this._cameraForBounds(this.transform,K,X,g,ee,v);return this._fitInternal(V,v,b)}_fitInternal(a,u,g){return a?(delete(u=p.extend(a,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(a,u){this.stop();const g=a.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,I=!1;return"zoom"in a&&g.zoom!==+a.zoom&&(v=!0,g.zoom=+a.zoom),void 0!==a.center&&(g.center=p.LngLat.convert(a.center)),"bearing"in a&&g.bearing!==+a.bearing&&(b=!0,g.bearing=+a.bearing),"pitch"in a&&g.pitch!==+a.pitch&&(I=!0,g.pitch=+a.pitch),null==a.padding||g.isPaddingEqual(a.padding)||(g.padding=a.padding),a.preloadOnly?(this._preloadTiles(g),this):(this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),v&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),b&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),I&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Ga),this.transform.getFreeCameraOptions()}setFreeCameraOptions(a,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return p.warnOnce(Ga),this;this.stop();const v=g.zoom,b=g.pitch,I=g.bearing;g.setFreeCameraOptions(a);const T=v!==g.zoom,S=b!==g.pitch,F=I!==g.bearing;return this.fire(new p.Event("movestart",u)).fire(new p.Event("move",u)),T&&this.fire(new p.Event("zoomstart",u)).fire(new p.Event("zoom",u)).fire(new p.Event("zoomend",u)),F&&this.fire(new p.Event("rotatestart",u)).fire(new p.Event("rotate",u)).fire(new p.Event("rotateend",u)),S&&this.fire(new p.Event("pitchstart",u)).fire(new p.Event("pitch",u)).fire(new p.Event("pitchend",u)),this.fire(new p.Event("moveend",u)),this}easeTo(a,u){this._stop(!1,a.easeId),(!1===(a=p.extend({offset:[0,0],duration:500,easing:p.ease},a)).animate||this._prefersReducedMotion(a))&&(a.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),T=this.getPadding(),S="zoom"in a?+a.zoom:v,F="bearing"in a?this._normalizeBearing(a.bearing,b):b,O="pitch"in a?+a.pitch:I,z="padding"in a?a.padding:g.padding,$=p.Point.convert(a.offset);let Q,K,X;if("globe"===g.projection.name){const _e=p.MercatorCoordinate.fromLngLat(g.center),Me=$.rotate(-g.angle);_e.x+=Me.x/g.worldSize,_e.y+=Me.y/g.worldSize;const We=_e.toLngLat(),Ee=p.LngLat.convert(a.center||We);this._normalizeCenter(Ee),Q=g.centerPoint.add(Me),K=new p.Point(_e.x,_e.y).mult(g.worldSize),X=new p.Point(p.mercatorXfromLng(Ee.lng),p.mercatorYfromLat(Ee.lat)).mult(g.worldSize).sub(K)}else{Q=g.centerPoint.add($);const _e=g.pointLocation(Q),Me=p.LngLat.convert(a.center||_e);this._normalizeCenter(Me),K=g.project(_e),X=g.project(Me).sub(K)}const ee=g.zoomScale(S-v);let V,W;a.around&&(V=p.LngLat.convert(a.around),W=g.locationPoint(V));const ne=this._zooming||S!==v,te=this._rotating||b!==F,de=this._pitching||O!==I,fe=!g.isPaddingEqual(z),pe=_e=>Me=>{if(ne&&(_e.zoom=p.number(v,S,Me)),te&&(_e.bearing=p.number(b,F,Me)),de&&(_e.pitch=p.number(I,O,Me)),fe&&(_e.interpolatePadding(T,z,Me),Q=_e.centerPoint.add($)),V)_e.setLocationAtPoint(V,W);else{const We=_e.zoomScale(_e.zoom-v),Ee=S>v?Math.min(2,ee):Math.max(.5,ee),Be=Math.pow(Ee,1-Me),De=_e.unproject(K.add(X.mult(Me*Be)).mult(We));_e.setLocationAtPoint(_e.renderWorldCopies?De.wrap():De,Q)}return a.preloadOnly||this._fireMoveEvents(u),_e};if(a.preloadOnly){const _e=this._emulate(pe,a.duration,g);return this._preloadTiles(_e),this}const ye={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=te,this._pitching=de,this._padding=fe,this._easeId=a.easeId,this._prepareEase(u,a.noMoveStart,ye),this._ease(pe(g),_e=>{g.recenterOnTerrain(),this._afterEase(u,_e)},a),this}_prepareEase(a,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new p.Event("movestart",a)),this._zooming&&!g.zooming&&this.fire(new p.Event("zoomstart",a)),this._rotating&&!g.rotating&&this.fire(new p.Event("rotatestart",a)),this._pitching&&!g.pitching&&this.fire(new p.Event("pitchstart",a))}_fireMoveEvents(a){this.fire(new p.Event("move",a)),this._zooming&&this.fire(new p.Event("zoom",a)),this._rotating&&this.fire(new p.Event("rotate",a)),this._pitching&&this.fire(new p.Event("pitch",a))}_afterEase(a,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new p.Event("zoomend",a)),v&&this.fire(new p.Event("rotateend",a)),b&&this.fire(new p.Event("pitchend",a)),this.fire(new p.Event("moveend",a))}flyTo(a,u){if(this._prefersReducedMotion(a)){const Ue=p.pick(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ue,u)}this.stop(),a=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},a);const g=this.transform,v=this.getZoom(),b=this.getBearing(),I=this.getPitch(),T=this.getPadding(),S="zoom"in a?p.clamp(+a.zoom,g.minZoom,g.maxZoom):v,F="bearing"in a?this._normalizeBearing(a.bearing,b):b,O="pitch"in a?+a.pitch:I,z="padding"in a?a.padding:g.padding,$=g.zoomScale(S-v),Q=p.Point.convert(a.offset);let K=g.centerPoint.add(Q);const X=g.pointLocation(K),ee=p.LngLat.convert(a.center||X);this._normalizeCenter(ee);const V=g.project(X),W=g.project(ee).sub(V);let ne=a.curve;const te=Math.max(g.width,g.height),de=te/$,fe=W.mag();if("minZoom"in a){const Ue=p.clamp(Math.min(a.minZoom,v,S),g.minZoom,g.maxZoom),et=te/g.zoomScale(Ue-v);ne=Math.sqrt(et/fe*2)}const pe=ne*ne;function ye(Ue){const et=(de*de-te*te+(Ue?-1:1)*pe*pe*fe*fe)/(2*(Ue?de:te)*pe*fe);return Math.log(Math.sqrt(et*et+1)-et)}function _e(Ue){return(Math.exp(Ue)-Math.exp(-Ue))/2}function Me(Ue){return(Math.exp(Ue)+Math.exp(-Ue))/2}const We=ye(0);let Ee=function(Ue){return Me(We)/Me(We+ne*Ue)},Be=function(Ue){return te*((Me(We)*(_e(et=We+ne*Ue)/Me(et))-_e(We))/pe)/fe;var et},De=(ye(1)-We)/ne;if(Math.abs(fe)<1e-6||!isFinite(De)){if(Math.abs(te-de)<1e-6)return this.easeTo(a,u);const Ue=de<te?-1:1;De=Math.abs(Math.log(de/te))/ne,Be=function(){return 0},Ee=function(et){return Math.exp(Ue*ne*et)}}a.duration="duration"in a?+a.duration:1e3*De/("screenSpeed"in a?+a.screenSpeed/ne:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0);const Ze=b!==F,Ie=O!==I,Fe=!g.isPaddingEqual(z),Qe=Ue=>et=>{const Ct=et*De,Nt=1/Ee(Ct);Ue.zoom=1===et?S:v+Ue.scaleZoom(Nt),Ze&&(Ue.bearing=p.number(b,F,et)),Ie&&(Ue.pitch=p.number(I,O,et)),Fe&&(Ue.interpolatePadding(T,z,et),K=Ue.centerPoint.add(Q));const _t=1===et?ee:Ue.unproject(V.add(W.mult(Be(Ct))).mult(Nt));return Ue.setLocationAtPoint(Ue.renderWorldCopies?_t.wrap():_t,K),Ue._updateCameraOnTerrain(),a.preloadOnly||this._fireMoveEvents(u),Ue};if(a.preloadOnly){const Ue=this._emulate(Qe,a.duration,g);return this._preloadTiles(Ue),this}return this._zooming=!0,this._rotating=Ze,this._pitching=Ie,this._padding=Fe,this._prepareEase(u,!1),this._ease(Qe(g),()=>this._afterEase(u),a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!a){const g=this.handlers;g&&g.stop(!1)}return this}_ease(a,u,g){!1===g.animate||0===g.duration?(a(1),u()):(this._easeStart=p.exported.now(),this._easeOptions=g,this._onEaseFrame=a,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const a=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(a)),a<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(a,u){a=p.wrap(a,-180,180);const g=Math.abs(a-u);return Math.abs(a-360-u)<g&&(a-=360),Math.abs(a+360-u)<g&&(a+=360),a}_normalizeCenter(a){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=a.lng-u.center.lng;a.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(a){return this._respectPrefersReducedMotion&&p.exported.prefersReducedMotion&&!(a&&a.essential)}_emulate(a,u,g){const v=Math.ceil(15*u/1e3),b=[],I=a(g.clone());for(let T=0;T<=v;T++){const S=I(T/v);b.push(S.clone())}return b}}class Ae{constructor(a={}){this.options=a,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(a){const u=this.options&&this.options.compact;return this._map=a,this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Zt("button","mapboxgl-ctrl-attrib-button",this._container),Zt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Zt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(a,u){const g=this._map._getUIString(`AttributionControl.${u}`);a.setAttribute("aria-label",g),a.removeAttribute("title"),a.firstElementChild&&a.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let a=this._editLink;a||(a=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(a){const g=u.reduce((v,b,I)=>(b.value&&(v+=`${b.key}=${b.value}${I<u.length-1?"&":""}`),v),"?");a.href=`${p.config.FEEDBACK_URL}/${g}#${Du(this._map,!0)}`,a.rel="noopener nofollow",this._setElementTitle(a,"MapFeedback")}}_updateData(a){!a||"metadata"!==a.sourceDataType&&"visibility"!==a.sourceDataType&&"style"!==a.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let a=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const I=b.getSource();I.attribution&&a.indexOf(I.attribution)<0&&a.push(I.attribution)}}a.sort((v,b)=>v.length-b.length),a=a.filter((v,b)=>{for(let I=b+1;I<a.length;I++)if(a[I].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=[...this.options.customAttribution,...a]:a.unshift(this.options.customAttribution));const g=a.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,a.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class En{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(a){this._map=a,this._container=Zt("div","mapboxgl-ctrl");const u=Zt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(a){a&&"metadata"!==a.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const a=this._map.style._sourceCaches;if(0===Object.entries(a).length)return!0;for(const u in a){const g=a[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const a=this._container.children;if(a.length){const u=a[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class In{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const u=++this._id;return this._queue.push({callback:a,id:u,cancelled:!1}),u}remove(a){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===a)return void(v.cancelled=!0)}run(a=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function gn(f,a,u){if(f=new p.LngLat(f.lng,f.lat),a){const g=new p.LngLat(f.lng-360,f.lat),v=new p.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),I=u.locationPoint(f).distSqr(a),T=a.x<0||a.y<0||a.x>u.width||a.y>u.height;u.locationPoint(g).distSqr(a)<I&&(T||Math.abs(g.lng-u.center.lng)<b)?f=g:u.locationPoint(v).distSqr(a)<I&&(T||Math.abs(v.lng-u.center.lng)<b)&&(f=v)}for(;Math.abs(f.lng-u.center.lng)>180;){const g=u.locationPoint(f);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const fi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class dt extends p.Evented{constructor(a,u){if(super(),(a instanceof p.window.HTMLElement||u)&&(a=p.extend({element:a},u)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=a&&a.occludedOpacity||.2,a&&a.element)this._element=a.element,this._offset=p.Point.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=Zt("div");const v=41,b=27,I=Li("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),T=Li("radialGradient",{id:"shadowGradient"},Li("defs",{},I));Li("stop",{offset:"10%","stop-opacity":.4},T),Li("stop",{offset:"100%","stop-opacity":.05},T),Li("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),Li("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),Li("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),Li("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=p.Point.convert(a&&a.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in fi)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(a){return a===this._map||(this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._updateMoving),a.on("moveend",this._update),a.on("remove",this._clearFadeTimer),a._addMarker(this),this.setDraggable(this._draggable),this._update(),a.on("click",this._onMapClick)),this}remove(){const a=this._map;return a&&(a.off("click",this._onMapClick),a.off("move",this._updateMoving),a.off("moveend",this._update),a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler),a.off("mouseup",this._onUp),a.off("touchend",this._onUp),a.off("mousemove",this._onMove),a.off("touchmove",this._onMove),a.off("remove",this._clearFadeTimer),a._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=p.LngLat.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=a,a._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(a){const u=a.code,g=a.charCode||a.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(a){const u=a.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const a=this._popup;return a?(a.isOpen()?(a.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(a.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const a=this._map,u=this._pos;if(!a||!u)return!1;const g=a.unproject(u),v=a.getFreeCameraOptions();if(!v.position)return!1;const b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const a=this._map;if(!a)return;const u=this._pos;if(!u||u.x<0||u.x>a.transform.width||u.y<0||u.y>a.transform.height)return void this._clearFadeTimer();const g=a.unproject(u);let v;a._showingGlobe()&&p.isLngLatBehindGlobe(a.transform,this._lngLat)?v=0:(v=1-a._queryFogOpacity(g),a.transform._terrainEnabled()&&a.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const a=this._pos;if(!a||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${a.x}px,${a.y}px)\n            ${fi[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${u.x}px,${u.y}px)\n        `}_calculateXYTransform(){const a=this._pos,u=this._map,g=this.getPitchAlignment();if(!u||!a||"map"!==g)return"";if(!u._showingGlobe()){const S=u.getPitch();return S?`rotateX(${S}deg)`:""}const v=p.radToDeg(p.globeTiltAtLngLat(u.transform,this._lngLat)),b=a.sub(p.globeCenterToScreenPoint(u.transform)),I=Math.abs(b.x)+Math.abs(b.y);if(0===I)return"";const T=v/I;return`rotateX(${-b.y*T}deg) rotateY(${b.x*T}deg)`}_calculateZTransform(){const a=this._pos,u=this._map;if(!u||!a)return"";let g=0;const v=this.getRotationAlignment();if("map"===v)if(u._showingGlobe()){const b=u.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),I=u.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=p.radToDeg(Math.atan2(I.y,I.x))-90}else g=-u.getBearing();else if("horizon"===v){const b=p.smoothstep(4,6,u.getZoom()),I=p.globeCenterToScreenPoint(u.transform);I.y+=b*u.transform.height;const T=a.sub(I),S=p.radToDeg(Math.atan2(T.y,T.x));g=(S>90?S-270:S+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(a){p.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=gn(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===a?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(a){return this._offset=p.Point.convert(a),this._update(),this}_onMove(a){const u=this._map;if(!u)return;const g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){const b=this._clickTolerance||u._clickTolerance;if(a.point.dist(g)<b)return;this._isDragging=!0}this._pos=a.point.sub(v),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const a=this._map;a&&(a.off("mousemove",this._onMove),a.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(a){const u=this._map,g=this._pos;u&&g&&this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(g),this._pointerdownPos=a.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(a){this._draggable=!!a;const u=this._map;return u&&(a?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(a){return this._occludedOpacity=a||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ha={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},us=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Vu(f=new p.Point(0,0),a="bottom"){if("number"==typeof f){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(a){case"top":return new p.Point(0,f);case"top-left":return new p.Point(u,u);case"top-right":return new p.Point(-u,u);case"bottom":return new p.Point(0,-f);case"bottom-left":return new p.Point(u,-u);case"bottom-right":return new p.Point(-u,-u);case"left":return new p.Point(f,0);case"right":return new p.Point(-f,0)}return new p.Point(0,0)}return f instanceof p.Point||Array.isArray(f)?p.Point.convert(f):p.Point.convert(f[a]||[0,0])}class Tc{constructor(a){this.jumpTo(a)}getValue(a){if(a<=this._startTime)return this._start;if(a>=this._endTime)return this._end;const u=p.easeCubicInOut((a-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(a){return a>=this._startTime&&a<=this._endTime}jumpTo(a){this._startTime=-1/0,this._endTime=-1/0,this._start=a,this._end=a}easeTo(a,u,g){this._start=this.getValue(u),this._end=a,this._startTime=u,this._endTime=u+g}}const wp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},hm={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Cp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Lr{constructor(a,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new sd({clickTolerance:a.dragRotate._mouseRotate._clickTolerance}),this.map=a,g&&(this.mousePitch=new Ec({clickTolerance:a.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(a,u){this.mouseRotate.mousedown(a,u),this.mousePitch&&this.mousePitch.mousedown(a,u),ic()}move(a,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(a,u),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const I=this.mousePitch.mousemoveWindow(a,u),T=I&&I.pitchDelta;T&&g.setPitch(g.getPitch()+T)}}off(){const a=this.element;a.removeEventListener("mousedown",this.mousedown),a.removeEventListener("touchstart",this.touchstart,{passive:!1}),a.removeEventListener("touchmove",this.touchmove),a.removeEventListener("touchend",this.touchend),a.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dl(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(a){this.down(p.extend({},a,{ctrlKey:!0,preventDefault:()=>a.preventDefault()}),Hr(this.element,a)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(a){this.move(a,Hr(this.element,a))}mouseup(a){this.mouseRotate.mouseupWindow(a),this.mousePitch&&this.mousePitch.mouseupWindow(a),this.offTemp()}touchstart(a){1!==a.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ta(this.element,a.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>a.preventDefault()},this._startPos))}touchmove(a){1!==a.targetTouches.length?this.reset():(this._lastPos=Ta(this.element,a.targetTouches)[0],this.move({preventDefault:()=>a.preventDefault()},this._lastPos))}touchend(a){0===a.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const zo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ju={maxWidth:100,unit:"metric"},da={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Zr={version:p.version,supported:Xo,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends zu{constructor(f){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(f=p.extend({},hm,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(f.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wc(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new In,this._domRenderTaskQueue=new In,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},wp,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Tc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=p.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new No(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new mp("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,p.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new Ae({customAttribution:f.customAttribution})),this._logoControl=new En,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update("style"===a.dataType),this.fire(new p.Event(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new p.Event(`${a.dataType}dataloading`,a))})}_getMapId(){return this._mapId}addControl(f,a){if(void 0===a&&(a=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const g=this._controlPositions[a];return-1!==a.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(f);return a>-1&&this._controls.splice(a,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const a=!this._moving;return a&&this.fire(new p.Event("movestart",f)).fire(new p.Event("move",f)),this.fire(new p.Event("resize",f)),a&&this.fire(new p.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(p.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return"auto"===f?p.window.navigator.language:Array.isArray(f)?0===f.length?void 0:f.map(a=>"auto"===a?p.window.navigator.language:a):f}setLanguage(f){const a=this._parseLanguage(f);if(!this.style||a===this._language)return this;this._language=a,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(f){return this._lazyInitEmptyStyle(),f?"string"==typeof f&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const f=this.transform,a=f.projection.name;let u;"globe"===a&&f.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),u=!0):"mercator"===a&&f.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,a){return this._updateProjection(f||a||{name:"mercator"})}_updateProjection(f){let a;if(a="globe"===f.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),a){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(p.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(p.Point.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,a,u){if("mouseenter"===f||"mouseover"===f){let g=!1;const v=I=>{const T=a.filter(F=>this.getLayer(F)),S=T.length?this.queryRenderedFeatures(I.point,{layers:T}):[];S.length?g||(g=!0,u.call(this,new Vi(f,this,I.originalEvent,{features:S}))):g=!1},b=()=>{g=!1};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===f||"mouseout"===f){let g=!1;const v=I=>{const T=a.filter(S=>this.getLayer(S));(T.length?this.queryRenderedFeatures(I.point,{layers:T}):[]).length?g=!0:g&&(g=!1,u.call(this,new Vi(f,this,I.originalEvent)))},b=I=>{g&&(g=!1,u.call(this,new Vi(f,this,I.originalEvent)))};return{layers:new Set(a),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=a.filter(T=>this.getLayer(T)),I=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];I.length&&(v.features=I,u.call(this,v),delete v.features)};return{layers:new Set(a),listener:u,delegates:{[f]:g}}}}on(f,a,u){if(void 0===u)return super.on(f,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(f,a,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(f,a,u){if(void 0===u)return super.once(f,a);Array.isArray(a)||(a=[a]);const g=this._createDelegatedListener(f,a,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(f,a,u){if(void 0===u)return super.off(f,a);a=new Set(Array.isArray(a)?a:[a]);const g=(b,I)=>{if(b.size!==I.size)return!1;for(const T of b)if(!I.has(T))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[f]:void 0;return v&&(b=>{for(let I=0;I<b.length;I++){const T=b[I];if(T.listener===u&&g(T.layers,a)){for(const S in T.delegates)this.off(S,T.delegates[S]);return b.splice(I,1),this}}})(v),this}queryRenderedFeatures(f,a){return this.style?(void 0!==a||void 0===f||f instanceof p.Point||Array.isArray(f)||(a=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],a=a||{},this.transform)):[]}querySourceFeatures(f,a){return this.style.querySourceFeatures(f,a)}isPointOnSurface(f){const{name:a}=this.transform.projection;return"globe"!==a&&"mercator"!==a&&p.warnOnce(`${a} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(p.Point.convert(f))}setStyle(f,a){return!1!==(a=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},a)).diff&&a.localIdeographFontFamily===this._localIdeographFontFamily&&a.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._localFontFamily=a.localFontFamily,this._updateStyle(f,a))}_getUIString(f){const a=this._locale[f];if(null==a)throw new Error(`Missing UI string '${f}'`);return a}_updateStyle(f,a){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new is(this,a||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new is(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,a){if("string"==typeof f){const u=this._requestManager.normalizeStyleURL(f),g=this._requestManager.transformRequest(u,p.ResourceType.Style);p.getJSON(g,(v,b)=>{v?this.fire(new p.ErrorEvent(v)):b&&this._updateDiff(b,a)})}else"object"==typeof f&&this._updateDiff(f,a)}_updateDiff(f,a){try{this.style.setState(f)&&this._update(!0)}catch(u){p.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(f,a){return this._lazyInitEmptyStyle(),this.style.addSource(f,a),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const a in f){const u=f[a]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(f,a,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,a,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,a,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:I}={}){if(this._lazyInitEmptyStyle(),a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap){const{width:T,height:S,data:F}=p.exported.getImageData(a);this.style.addImage(f,{data:new p.RGBAImage({width:T,height:S},F),pixelRatio:u,stretchX:v,stretchY:b,content:I,sdf:g,version:0})}else if(void 0===a.width||void 0===a.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:S}=a,F=a;this.style.addImage(f,{data:new p.RGBAImage({width:T,height:S},new Uint8Array(F.data)),pixelRatio:u,stretchX:v,stretchY:b,content:I,sdf:g,version:0,userImage:F}),F.onAdd&&F.onAdd(this,f)}}updateImage(f,a){const u=this.style.getImage(f);if(!u)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap?p.exported.getImageData(a):a,{width:v,height:b}=g;void 0!==v&&void 0!==b?v===u.data.width&&b===u.data.height?(u.data.replace(g.data,!(a instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&a instanceof p.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,a){p.getImage(this._requestManager.transformRequest(f,p.ResourceType.Image),(u,g)=>{a(u,g instanceof p.window.HTMLImageElement?p.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(f,a){return this._lazyInitEmptyStyle(),this.style.addLayer(f,a),this._update(!0)}moveLayer(f,a){return this.style.moveLayer(f,a),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,a,u){return this.style.setLayerZoomRange(f,a,u),this._update(!0)}setFilter(f,a,u={}){return this.style.setFilter(f,a,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,a,u,g={}){return this.style.setPaintProperty(f,a,u,g),this._update(!0)}getPaintProperty(f,a){return this.style.getPaintProperty(f,a)}setLayoutProperty(f,a,u,g={}){return this.style.setLayoutProperty(f,a,u,g),this._update(!0)}getLayoutProperty(f,a){return this.style.getLayoutProperty(f,a)}setLight(f,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,a),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(f),this.transform):0}setFeatureState(f,a){return this.style.setFeatureState(f,a),this._update()}removeFeatureState(f,a){return this.style.removeFeatureState(f,a),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,a=this._container.getBoundingClientRect().height||300;let u,g,v,b=this._container;for(;b&&(!g||!v);){const I=p.window.getComputedStyle(b).transform;I&&"none"!==I&&(u=I.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(g=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(v=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(f/g):f,this._containerHeight=v?Math.abs(a/v):a}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Zt("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const a=this._canvasContainer=Zt("div","mapboxgl-canvas-container",f);this._interactive&&a.classList.add("mapboxgl-interactive"),this._canvas=Zt("canvas","mapboxgl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Zt("div","mapboxgl-control-container",f),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Zt("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,a){const u=p.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(a),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${a}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const a=this._markers.indexOf(f);-1!==a&&this._markers.splice(a,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const a=this._popups.indexOf(f);-1!==a&&this._popups.splice(a,1)}_setupPainter(){const f=p.extend({},Xo.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),a=this._useWebGL2&&this._canvas.getContext("webgl2",f),u=a||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);u?(this._useWebGL2&&!a&&p.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),p.storeAuthState(u,!0),this.painter=new Fo(u,this.transform,!!a),this.on("data",g=>{"source"===g.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(u)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let a;const u=this.painter.context.extTimerQuery,g=p.exported.now();if(this.listens("gpu-timing-frame")&&(a=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,a)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const T=this.transform.zoom,S=this.transform.pitch,F=p.exported.now(),O=new p.EvaluationParameters(T,{now:F,fadeDuration:v,pitch:S,transition:this.style.getTransition()});this.style.update(O)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),a){const T=p.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,a),setTimeout(()=>{const S=u.getQueryObjectEXT(a,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(a),this.fire(new p.Event("gpu-timing-frame",{cpuTime:T,gpuTime:S})),p.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:S}})},50)}if(this.listens("gpu-timing-layer")){const T=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(T);this.fire(new p.Event("gpu-timing-layer",{layerTimes:S}))},50)}if(this.listens("gpu-timing-deferred-render")){const T=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const S=this.painter.queryGpuTimeDeferredRender(T);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:S}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(I||this._repaint)this.triggerRepaint();else{const T=!this.isMoving()&&this.loaded();if(T&&(b=this._updateAverageElevation(g,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),T&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const S=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:S})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const a of this._markers)f&&!this.getRenderWorldCopies()&&(a._lngLat=a._lngLat.wrap()),a._update();for(const a of this._popups)!f||this.getRenderWorldCopies()||a._trackPointer||(a._lngLat=a._lngLat.wrap()),a._update()}_updateAverageElevation(f,a=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((a||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;const I=Math.abs(g-v);if(I>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,f,300)}else if(I>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===p.AUTH_ERR_MSG||401===f.status)){const a=this.painter.context.gl;p.storeAuthState(a,!1),this._logoControl instanceof En&&this._logoControl._updateLogo(),a&&a.clear(a.DEPTH_BUFFER_BIT|a.COLOR_BUFFER_BIT|a.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),a=this.painter.getCanvasCopiesAndTimestamps();a.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const I=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,I),I}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(f),a.canvasCopies.map(v),a.timeStamps)}_canvasPixelComparison(f,a,u){let g=u[1]-u[0];const v=f.length/4;for(let b=0;b<a.length;b++){const I=a[b];let T=0;for(let S=0;S<I.length;S+=4)I[S]===f[S]&&I[S+1]===f[S+1]&&I[S+2]===f[S+2]&&I[S+3]===f[S+3]&&(T+=1);g+=(u[b+2]-u[b+1])*(1-T/v)}return g}remove(){this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=p.exported.frame(a=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(a)}))}_preloadTiles(f){const a=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(a,(u,g)=>u._preloadTiles(f,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,a){p.setCacheLimits(f,a)}get version(){return p.version}},NavigationControl:class{constructor(f){this.options=p.extend({},Cp,f),this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",a=>{this._map&&this._map.zoomIn({},{originalEvent:a})}),Zt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",a=>{this._map&&this._map.zoomOut({},{originalEvent:a})}),Zt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",a=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:a}):u.resetNorth({},{originalEvent:a}))}),this._compassIcon=Zt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const a=f.getZoom(),u=a===f.getMaxZoom(),g=a===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=a)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Lr(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,a){const u=Zt("button",f,this._container);return u.type="button",u.addEventListener("click",a),u}_setButtonTitle(f,a){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${a}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends p.Evented{constructor(f){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},zo,f),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Cc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const a=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};void 0!==this._supportsGeolocation?f(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(u=>a("denied"!==u.state)).catch(()=>a()):a()}_isOutOfMapMaxBounds(f){const a=this._map.getMaxBounds(),u=f.coords;return!!a&&(u.longitude<a.getWest()||u.longitude>a.getEast()||u.latitude<a.getSouth()||u.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",f)),this._finish()}}_updateCamera(f){const a=new p.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,g=this._map.getBearing(),v=p.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(a.toBounds(u),v,{geolocateSource:!0})}_updateMarker(f){if(f){const a=new p.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,a=p.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*a);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",a=>a.preventDefault()),this._geolocateButton=Zt("button","mapboxgl-ctrl-geolocate",this._container),Zt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===f){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",a),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Zt("div","mapboxgl-user-location"),this._dotElement.appendChild(Zt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Zt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new dt({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Zt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new dt({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",a=>{a.geolocateSource||"ACTIVE_LOCK"!==this._watchState||a.originalEvent&&"resize"===a.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(a=>{"granted"===a&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ae,ScaleControl:class{constructor(f){this.options=p.extend({},ju,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,a=this._map,u=a._containerHeight/2,g=a._containerWidth/2-f/2,v=a.unproject([g,u]),b=a.unproject([g+f,u]),I=v.distanceTo(b);if("imperial"===this.options.unit){const T=3.2808*I;T>5280?this._setScale(f,T/5280,"mile"):this._setScale(f,T,"foot")}else"nautical"===this.options.unit?this._setScale(f,I/1852,"nautical-mile"):I>=1e3?this._setScale(f,I/1e3,"kilometer"):this._setScale(f,I,"meter")}_setScale(f,a,u){this._map._requestDomTask(()=>{const g=function(b){const I=Math.pow(10,`${Math.floor(b)}`.length-1);let T=b/I;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(S){const F=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*F)/F}(T),I*T}(a),v=g/a;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==u?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(g):`${g}&nbsp;${da[u]}`,this._container.style.width=f*v+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof p.window.HTMLElement?this._container=f.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Zt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Zt("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(f){super(),this.options=p.extend(Object.create(Ha),f),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=p.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const a=this._map;return a&&(a.on("move",this._update),a.off("mousemove",this._onMouseEvent),a._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(p.window.document.createTextNode(f))}setHTML(f){const a=p.window.document.createDocumentFragment(),u=p.window.document.createElement("body");let g;for(u.innerHTML=f;g=u.firstChild,g;)a.appendChild(g);return this.setDOMContent(a)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let a=this._content;if(a)for(;a.hasChildNodes();)a.firstChild&&a.removeChild(a.firstChild);else a=this._content=Zt("div","mapboxgl-popup-content",this._container||void 0);if(a.appendChild(f),this.options.closeButton){const u=this._closeButton=Zt("button","mapboxgl-popup-close-button",a);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let a;return this._classList.delete(f)?a=!1:(this._classList.add(f),a=!0),this._updateClassList(),a}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const a=this._map,u=this._container,g=this._pos;if(!a||!u||!g)return"bottom";const v=u.offsetWidth,b=u.offsetHeight,I=g.x<v/2,T=g.x>a.transform.width-v/2;if(g.y+f<b)return I?"top-left":T?"top-right":"top";if(g.y>a.transform.height-b){if(I)return"bottom-left";if(T)return"bottom-right"}return I?"left":T?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const a=[...this._classList];a.push("mapboxgl-popup"),this._anchor&&a.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&a.push("mapboxgl-popup-track-pointer"),f.className=a.join(" ")}_update(f){const a=this._map,u=this._content;if(!a||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Zt("div","mapboxgl-popup",a.getContainer()),this._tip=Zt("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),a.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gn(this._lngLat,this._pos,a.transform)),!this._trackPointer||f){const v=this._pos=this._trackPointer&&f?f:a.project(this._lngLat),b=Vu(this.options.offset),I=this._anchor=this._getAnchor(b.y),T=Vu(this.options.offset,I),S=v.add(T).round();a._requestDomTask(()=>{this._container&&I&&(this._container.style.transform=`${fi[I]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&a._showingGlobe()){const v=p.isLngLatBehindGlobe(a.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(us);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:dt,Style:is,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.Point,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:Iu,Evented:p.Evented,config:p.config,prewarm:function(){Do().acquire($i)},clearPrewarmedResources:function(){const f=zn;f&&(f.isPreloaded()&&1===f.numActive()?(f.release($i),zn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(f){p.config.ACCESS_TOKEN=f},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(f){p.config.API_URL=f},get workerCount(){return qi.workerCount},set workerCount(f){qi.workerCount=f},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){p.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){p.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Zr}),ri}()}},nm=>{nm(nm.s=930)}]);